# 摘 要

本设计基于基于STC89C52RC单片机的温度控制系统的工作原理和设计方法。本文介绍了控制系统的硬件部分，包括：温度检测电路，温度控制电路，显示电路。单片机处理信号线单片机对信号进行相应处理，以达到温度控制的目的。该文档还重点介绍了采用模块化结构的软件设计部分。介绍了该控制系统的硬件部分会在文中写出，包括的模块是：数字管显示程序，键盘扫描和按键处理程序，温度信号处理程序，继电器控制程序和过热报警程序。同时，还包括系统中复杂的电路设计等方式。主程序，读取温度子程序，键处理程序，LCD显示程序和数据存储程序。该控制系统可以实时存储相关的温度数据并记录当前的时间。系统程序主要包括主程序，读出温度子程序，处理轮转子程序，转换温度计算子程序、按键处理结构、LCD显示程序以及数据存储程序等。



**关键词：AT89C51，单片机 ，DS18B20温度芯片，温度控制**  



# Abstract

This design uses STC89C52RC single-chip microcomputer as the core of the working principle and design method of temperature control system. The temperature signal is collected by the temperature chip DS18B20 and transmitted to the single-chip microcomputer as a digital signal. This article introduces the hardware part of the control system, including: temperature detection circuit, temperature control circuit, display circuit. The single chip microcomputer processes the signals accordingly to achieve the purpose of temperature control. The single chip microcomputer processes the signals accordingly to achieve the purpose of temperature control. The paper also focouses on the software design part, which adopts a modular structure. The main modules are: digital tube display prog random access memory, keyboard scanning and key processing prog random access memory, temperature signal processing prog random access Memory, relay control prog, random access memory, and over-temperature alarm pr ocess. The control system can store relevant temperature data in real time and record the current time. The system prog random access memory mainly includes a main prog random access memory, a readout temperature subprog random access memory, a calculation temperature subprog random Access memory, a key processing prog random access memory, an LCD display prog random access memory, and a data storage prog random access memory.



----




# 第1章 绪 论

## 1.1 温度控制系统研究的目的和重要性

在人类历史上，环境温度起着极其重要的作用。环境温度是工业生产中最常见的工艺参数之一。每个物理变化和每个化学反应过程都与温度密切相关。因此，温度控制是生产自动化中的重要任务。随着社会的发展，科学技术的进步以及温度测量设备在各个领域的使用，智能化是现代温度控制系统发展的主要组成部分。尤其是近年来，温度控制系统已经应用于人们生活的各个方面，但是温度控制一直是一个尚未发展的领域，但这是一个与人类息息相关的世纪之久的问题。在这种实际情况下，温度控制系统的设计具有广阔的应用前景和重要性。

此结构是为室温控制系统设计的，控制对象是室温。温度控制通常用于日常生活和工业领域，例如用于冷室，洗澡池，酵母池，电源和其他地方的温度控制。过去，温度控制是手动进行的，没有给予足够的重视。实际上，在许多地方都必须很好地调节温度。鉴于此问题，此系统设计的目的是创建一个可使其自身适应设定温度的系统。它被广泛使用，功能强大，小巧美观，易于携带。这是一种实用且廉价的控制系统。

## 1.2 温度控制系统研究概况

国外对温度控制技术的研究始于1970年代。首先，使用模拟组合仪器来收集现场信息并执行指令，记录和控制。分布式控制系统出现在1980年代后期。目前正在开发用于计算机数据采集的控制系统的集成多因素控制系统。当前，温度测量和控制技术在全球不同国家中迅速发展，并且一些国家正在朝着完全自动化和无人值守的方向发展。

中国对温度测量和控制技术的研究相对较晚，始于1980年代。中国工程师和技术人员已经吸收了工业化国家对温度测量和控制技术的吸收，从而掌握了室内温度的微机控制技术。该技术仅限于控制环境中的单个温度因子。中国温度测控设备的计算机应用一般处于从消化吸收阶段，易应用阶段到实用化，全面应用阶段的过渡和发展。从技术上讲，大多数情况下都存在由单片机控制的单参数单回路系统，并且没有真正的集成多参数控制系统。与工业化国家相比，差距很大。我国温度测控的现状还远远没有达到工业化水平。生产中仍有很多困扰我们的问题。设备支持能力差，工业化程度低，环境控制落后，软件和硬件资源无法共享和可靠。缺点，例如不良性行为。

##  1.3 温度传感器技术

传感器技术是现代信息技术的主要内容之一，信息技术包括计算机技术、通信技术和传感器技术。计算机和通信技术发展极快，相当成熟，而传感器应用技术因为需要使用模拟技术，而模拟技术还有很多问题难以解决，因此传感器应用技术也有待进一步发展。为了适应现代科学技术的发展，世界总舵国家都把传感器技术列为现代的关键技术之一。通常将能把非电量转换为电量的器件称为传感器，其实质上是一种功能块，作用是将来自外界的各种信号转换成电信号。它是实现测试与自动控制系统的首要环节。如果没有传感器对原始参数进行精确可靠地测量，那么无论是信号转换或信息处理，或者最佳数据的显示和控制都将无法实现。 

温度传感器，使用范围广，数量多，居各种传感器之手。温度传感器的发展大致经历了以下三个阶段：传统的分立式温度传感器（含敏感元件），主要输能够进行非电量和电量之间的转换；模拟集成温度传感器/控制器；智能温度传感器。目前，国际上新型温度传感器正从模拟式向数字式、集成化、智能化及网络化的方向发展。温度传感器按传感器与被测介质的接触方式可分为接触式温度传感器和非接触式温度传感器两大类，其中，接触式温度传感器的测温元件与被测对象要有良好的热接触，通过热传导及对流原理达到热平衡，这个示值即为被测对象的温度。这种测温方法精度比较高，并可测量物体内部的温度分布。但对于运动的、热容量比较小的及对感温元件有腐蚀作用的对象，这种方法将会产生很大的误差。非接触测温的测温元件与被测对象互不接触。常用的是辐射热交换原理。此种测温方法的主要特点是可测量运动状态的小目标及热容量小或变化迅速的对象，也可测量温度场的温度分布，但受环境的影响比较大。 

温度传感器的发展大致可分为以下几种：  
1. 热电偶传感器。热点偶传感器是工业测量中应用最广泛的一种温度传感器，它与被测对象直接接触，不受中间介质的影响，具有较高的精度；测量范围广，可从-50℃～1600℃进行连续测量，特殊的热电偶如金,铁,镍,铬最低可测到-269℃，钨,铼最高可达2800℃。
2. 模拟集成温度传感器。采用硅半导体集成工艺制成的，因此亦称硅传感器或单片集成温度传感器。模拟集成温度传感器是在20世纪80年代问世的，它将温度传感器集成在一个芯片上、可完成温度测量及模拟信号输出等功能。模拟集成温度传感器的主要特点是：功能单一、测温误差小、价格低、响应速度快、传输距离远、体积小、微功耗等，适合远距离测温，不需要进行非线性校准，外围电路简单。
3. 光纤传感器。光纤测温技术可分为两类:全辐射测温法，单辐射测温法，双波长测温法，多波长测温法等。特点是：光纤挠性好、透光谱段宽、传输损耗低，无论是就地使用或远传均十分方便而且光纤直径小，可以单根、成束、Y型或阵列方式使用，结构布置简单且体积小。缺点是：测量起来困难,难于实现较高的精度，工艺比较复杂,且造价高，推广应用有一定困难。
4. 半导体吸收式光纤温度传感器。半导体吸收式光纤温度传感器是利用了半导体材料的吸收光谱随温度变化的特性实现的。一种传光型光纤温度传感器，是指在光纤传感系统中，光纤仅作为光波的传输通路，而利用其它如光学式或机械式的敏感元件来感受被测温度的变化。在这类传感器中，半导体吸收式光纤温度传感器是研究得比较深入的一种。
5. 智能温度传感器。智能温度传感器(亦称数字温度传感器）是在20世纪90年代中期问世的。它是微电子技术、计算机技术和自动测试技术（ATE）的结晶。目前，国际上已开发出多种智能温度传感器系列产品。智能温度传感器内部包含温度传感器、A/D传感器、信号处理器、存储器（或寄存器）和接口电路。有的产品还带多路选择器、中央控制器（中央处理单元）、随机存取存储器（随机存取存储器）和只读存储器（只读存储器）。智能温度传感器能输出温度数据及相关的温度控制量，适配各种微控制器（M中央处理单元），并且可通过软件来实现测试功能，即智能化取决于软件的开发水平。

随着科学技术的不断进步与发展，温度传感器的种类日益繁多，数字温度传感器更因适用于各种微处理器接口组成的自动温度控制系统具有可以克服模拟传感器与微处理器接口时需要信号调理电路和A/D转换器的弊端等优点，被广泛应用于工业控制、电子测温计、医疗仪器等各种温度控制系统中。其中，比较有代表性的数字温度传感器有DS18B20、MAX6575、DS1722、MAX6635等。相比较而言，传统的温度检测以热敏电阻为温度敏感元件，热敏电阻成本低，但需要后续信号处理电路，而且热敏电阻的可靠性相对较差，测量温度的准确度低，检测系统的精度差。数字式温度传感器的种类也不少，并且在实际工程设计中具有上述诸多优点。
# 第2章 系统总体方案设计

## 2.1 系统工作原理

单片机温度控制系统是以AT89C51单片机为控制核心，辅以采样反馈电路，驱动电路，晶闸管主电路对电炉炉温进行控制的微机控制系统。系统的原理框图如图2-1所示，其基本控制原理为: 用键盘将温度的设定值送入单片机，并在发光二极管显示，启动运行后，通过信号采集电路将温度信号采集到后，送入单片机系统进行PID 控制运算，将控制量输出，改变可控硅管的接通时间便可改变加热丝功率，以达到调节温度的目的控制电阻炉的加热。

当由于环境温度变化太剧烈或由于加热或降温设备出现故障，或者温度传感头出现故障导致在一段时间内不能将环境温度调整到规定的温度限内的时候，单片机通过三极管驱动扬声器发出警笛声。 

![图1-1 第一个方案](http://my.gunplan.top/static/1.0.0.PNG)

图1-1为第一个设计方案，该方案的工作原理简述如下：

1. 锯齿波是由单结晶体管BT和R1，R2，R3，W1和C1组成的张驰震荡产生，然后经射极跟随器V1、R4输出。
2.  控制电压（Uk）与锯齿波电压进行电流叠加后送到V2的基极，合成电压为Us，当Us>0（0.7）时V2导通，Us<0，则V2截止。
3.  由V2、V3以及R8、R9、DW1组成一直流开关，当V2基极电压Ube2>0(0.7)，V2导通，Ube3接近零电位，V3截止，直流开关导通。输出24V直流电压。
4.  过零脉冲的输出，由同步变压器TB，整流桥D1及R10，R11组成一削波同步电源，这个电源与直流开关的输出电压共同去控制V4与V5。只有当直流开关导通期间，V4截止，V4、V5基电极和发射极之间才有工作电压，才能工作在期间，同步电压每次过零时，V4截止，其集电极输出正电压，使V5由截止转导通，经脉冲变压器输出触发脉冲而此脉冲使晶闸管T在需要导通的时刻导通。

在直流开关导通期间使出连续的正弦波控制电压Uk的大小决定了直流开关导通时间的长短，也就决定了在设定周期内导通的周波数，从而可输出功率的调节。显然，控制电压Uk越大，则导通的周波数就越多，输出的功率也就越大，电阻炉的温度也就越高，反之，电阻炉的温度就越低。
闭环控制自动调温的基本指导思想是在系统中增设温度传感器和温度调节器，温度传感器的基本功能是检测电炉的实际温度，并变换成电压讯号和炉温控制电压Uk进行比较，根据两者差值的大小（Δe=Uk-Uft）和变化方向（即△e为正还是为负），通过调节器进行相反方向的调节，使调节器的输出控制直流开关导通时间的长短，从而使设定周期内晶闸管的导通周波数增大或者减小，相应的电炉温度升高一点或者减小一点。采取这种控制方式，可以使炉温在较小的范围内变化，控制精度高。
方案二：为了使得电路的简单化，采用单片机作为控制核心来设计本课题，温度信号采集使用温度传感器DS18B20，温度控制的基本思想为：通过采集到的温度与标准温度之间的差值来控制加热电阻丝的通电时间长短，从而起到恒温控制的目的。方案二的设计框图如下图所示：

![图1-2](http://my.gunplan.top/static/1.0.0.PNG)

本方案采用单片机作为控制核心，使用温度传感器进行温度采集，通过将采集到的温度与标准设定温度之间的差值进行温度控制，从而使得温度维持在标准设定温度。本方案设计成本低，具有具有较高的可靠性，对于系统动态性能与稳定要求不是很高的场合非常的合适。

单片机温度控制系统是以AT89C51单片机为控制核心，辅以采样反馈电路，驱动电路，晶闸管主电路对电炉炉温进行控制的微机控制系统。系统的原理框图如图2-1所示，其基本控制原理为: 用键盘将温度的设定值送入单片机，并在LED显示，启动运行后，通过信号采集电路将温度信号采集到后，送入单片机系统进行PID 控制运算，将控制量输出，改变可控硅管的接通时间便可改变加热丝功率，以达到调节温度的目的控制电阻炉的加热。

当由于环境温度变化太剧烈或由于加热或降温设备出现故障，或者温度传感头出现故障导致在一段时间内不能将环境温度调整到规定的温度限内的时候，单片机通过三极管驱动扬声器发出警笛声。

## 2.2 系统功能介绍

本设计是对房间温度进行检测与控制，设计的温度控制系统实现了基本的温度控制功能：当温度低于设定的温度时，系统自动通过PWM启动加热装置，使温度上升。当温度高于设定的温度时，停止加热。三位数码管及时显示温度，精确到小数点后一位。  
本文设计的温度控制系统具有如下功能：

1. 通过温度芯片DS18B20采集温度，并以数字信号的方式传送给单片机。
2. 四位数码管动态实时显示房间温度，显示精度0.10C。
3. 三个按键实现标准温度的设定。
4. 利用PWM实现温度的控制。



# 第3章系统硬件电路设计

![图3-1电路硬件图](http://my.gunplan.top/static/2.0.1.png)

该解决方案使用AT89C51为核心处理芯片，芯片DS18B20测量内部温度，通过发送信号传输总线到MCU，并且和一个4位LED显示管温度。偏差用于控制电阻丝导通/截止时间的长度。实现恒温控制的界面的最终想法是最终想法。

## 3.1 各模块设计

### 3.1.1 温度传感器电路

本文在课题教学研究中所采用的的温度传感器一般可以分为采用一个美国两个单线的四位数字小型环境温度传感器例如ds18b20。该稳压传感器4.7k##hz该传感器用于输出稳压信号的上和下拉稳压电阻直接通过连接输入到一个微控制器的一个p1.0引脚。

半导体温度传感器DS18B20产生Dalalas数字温度传感器，多并行总线技术。该器件在小型集成电路芯片上制造温度敏感的半导体器件、 A / D 转换器、存储器等。在对本设计中的温度传感器进行多次比较和考虑之后，选择了单线数字设备DS18B20，主要是由于以下原因：

1. 该检测系统的主要特点功能是：在一个允许温度范围的工作检测温度是-55℃〜+125℃，±0.5度的工作温度和在测量值的精度是5℃。温度函数转换器高精度。9至12变量，温度检测值数据可以被直接转换成一个串行16位的非二进制的或数字输出形式的数据输出;最大输入时间频率转变精度为12位测量精度转变为750ms;它们都可以通过一条数据线被直接供电，具有超低电源功耗。
2. 系统进行成本：由于我国计算机信息技术和微电子科学技术的发展，新型企业大规模集成电路设计越来越具有强大，体积变得小是越来越会发生的，价格也会下跌。DS18B20提交空间与普通晶体管之间几乎没有本质区别的，价格只有约$1。
3. 降低系统总线技术操作复杂度：由于设备ds18b20是单总线测量设备，微处理器与之进行接口时只不过需要至少占用在校学生一个模拟i/o口，一根模拟总线测量方式线就可以同时连接数十个设备ds18b20，温度管理进行总线测量方法完全无需任何模拟企业外部网络控制元件，因此，与传统模拟工业生物温度传感器中的网络系统相比，可以测量得到大大幅度增加以及减少系统布线调试次数，降低温度管理系统的技术复杂性，减少重大工程项目的基础建设工作量。
4. 减少系统的引线调试和日常维护：由于大量减少的系统引线数量可以不会引起一些小的事情，大量使用减少接线的工程数量，减少接线工程数量产生的引线施工成本量大大降低，系统的内部布线过程复杂度的降低调试和日常维护另一方面，因为系统引线接口数量的减少产生的故障数量大大下降，使得整个系统中的接口工作变得简单许多，给系统的日常调试工作带来更多方便，之所以认为dsl8820是全方位数字化的元器件，故障基本不会同时发生，干扰性的和可抗性强，因此为了让整个系统的在整个日常生活中而所进行需要保证正常工作的维护任务大大减少，为了更好保证系统可用性而所进行的日常维护相关工作保证正常系统运行的维护工作。

ds18b20温度控制系统传感器引线技术通常存在一个小的引线，引线上的数量通常是3，并且我们可以确定不在一个企业内部：一个单线程的数据网络信息传输包括系统总线数据端口vvdq、外部数据电源线vdd和公共网络地址总线端口gnd。ds18b20有2种直流供电的工作方法：其一种就是采用杜邦线的直流供电电压模式。此时，vdd被完全接地。当它开始产生能量空闲时，它通过内部一个电容器线路来让它存储剩余电量用从外部数据线路中获得剩余能量并用来让它完成整个温度功率转换，相应的当它完成整个温度功率转换的持续时间也会更长。在这种应用情况下，使用一个单片机的一个矩形i/o输出端口让它来自动拉起一个ds18b20总线。另一种模式是外部温度电源连接模式(vdd电源连接+5v)，完成外部温度变化测量的时候相应操作时间短。

在本设计项目中我也可以直接采用由大学生企业提供的并不在相关企业内部的各种电子信息流的流动强度及其发展计算方式等来进行设计实现。cds18b20传感器与驱动单片机的接口连接，其内部接口集成电路设计方案如软件图2-2所示。

![图2-2外部电路](http://my.gunplan.top/static/003.jpg)

### 3.1.2 通用键盘显示电路设计

![图2-3外部电路](http://my.gunplan.top/static/003.jpg)

所示，ale时钟脉冲可以作为一个时钟同步电路8279，从而与示意图的两个时钟脉冲同步。2-3。8279芯片的控制中断电路控制输出信号irqr连接到一个控制单片机的一个p1-1引脚。缓冲器输入地址是将寄存器中的a0连接输入到整个单片机的一个p2-5引脚，ae的缓冲信号则是连接到整个单片机的一个p2-6引脚。读写器和信号数据线缆分别和两个单片机的信号读写器和信号数据线缆来进行连接相连。8279芯片的外部数据传递运输线路由d0-d7与整个单片机的外部数据线直接相连进行相应的连接。

来自8279芯片和AT89C51芯片的许多信号是一致的，可以直接级联，这非常容易控制。8279芯片的8位数据线进行直接连接到AT89C51芯片的P0端口。读取和写入信号连接到89C51的读取和写入信号。 AT89C51锁存信号ALE连接到8279 CLK，在内部分频后，会产生一个公共的非外部时钟脉冲。8279芯片的端子请求信号由反相器反转，然后连接到AT89C51的P1.1端口。 AT89C51的三个可寻址寄存器只需要两个地址即可寻址，即命令/状态寄存器地址和数据寄存器的地址值。8279芯片中与地址相关的信号是A0和芯片选择信号。您的连接直接确定寄存器地址在哪里。一旦确定了硬件电路，就确定了寄存器的地址。

发光驱动二极管的色号发光驱动效率和显示颜色分别取决于每个制造商的材料，如果出现没有什么意外情况是可以使用egred色号，出现其他意外情况可以使用reyellow或是egreen色号。发光电子二极管又称发光电子二极管主要是利用智能电子技术通过测量管理系统控制测量仪表中简单而常用的进入输出一个控制装置，通常说它可以直接用于用来指示一个机器的工作状态或其他相关企业服务信息。具有系统功耗低、配置灵活、接口方便、价格低廉、使用寿命长、对各种电子管直流的流动强度和电势差异性要求低、易于手动实现连接多种电路等多大优点。

液晶电视显示器本身是被动电子显示器，它本身不向外调节发出一种具有一定粒子性的主动电磁波，只需向外调节其发出一种具有一定粒子性的被动电磁波的频率数量。目前，常用的彩色液晶信息显示器通常是根据中国的而液晶对于信息显示失真率的问题总是按克列拉斯效应的基本原理设计制成的，它通常可以通过同时获得一个位于黑色信息发展初始背景上的一个白色初始字符或一个白色初始背景上的一个黑色初始字符的方式显示不同信息形式。便携式检测仪器主要用于电力测量和分析控制和检测智能动力电池中的电力，考虑到低损耗功率的应用要求，经常我们需要同时使用的就是液晶电视显示器，重量轻，功耗低的而且体积小，因此，广泛作为采用的检测手段。但是必须需要借助外来的灯光进行显示。阴极红外射线图形显像管这种显示器虽然可以同时显示多种图形，但显示界面更复杂，成本更高。

在多路显示温度自动巡检仪中只要您需要同时显示4位的和数字两种形式的显示温度和检测路数，可以不必考虑使用某种价格较高的荧光阴极或红射线液晶显像管;4位数字发光光电二极管的实际工作频率电子在直流的波动强度一般为240ma左右，由于需要使用一个交流电源进行供电，足以完全提供四位发光光电二极管液晶显示器所使用需要的最大功率，对于四位发光光电二极管而言，仅有4位，体积也很小，这样比较符合发光光电二极管和四位液晶电视显示器的诸多性能特点，本检测系统建议选择四位发光光电二极管液晶显示器。

键盘设计是一组多按键的整体组合。其主要工作功能之一是实时控制操作系统的正常工作运行状态，向系统接口输入大量数据和发出命令。有两种键盘类型：标准编码数字键盘和非标准编码数字键盘。

除了单个按键之外，编码器的键盘系统还包括一个用于自动生成键码的多个硬件控制电路、抖动控制电路、多个击键和多个按键之间移动时的保护器等电路。每按一个数字键，就表示可以自动重新生成这个数字键的键码。同时还会产生一个脉冲控制信号，通知系统中央处理控制单元进行接收。这种单片键盘使用方便，接口使用程序简单，但由于需要使用更多的相关硬件集成电路，价格也会变得更高，一般来说单片机键盘应用在该系统中的应用不是非常多。

非按列编码数字键盘仅由按行矩阵排列和非按列排行矩阵两种形式的编码键盘所组成。按键的抖动作用主要是简单地停止连接或自动断开触点，按键的触点抖动、按键软件代码的自动形成和每个按键的自动识别都必须是由按键软件操作来自动完成的。由于其价格经济并且实用，在各种单片机硬件应用管理系统中已经得到广泛应用。

上述一系列比较之后，它应该是非编码键盘。

P0端口： P0端口为8位漏极级开路双向 I/O 端口，每个引脚可吸收8TTL 栅极电子流的强度。当端口 P1的引脚首次写入1时，它被定义为高阻输入。P0可用于非内部程序数据存储器，可以定义为数据/地址的第八位。在 FIASH 编程中，P0作为原始代码输入端口。检查 FIASH 时，P0输出原始代码，必须拉起 P0的外部。

端口设置p1：端口设置p1是一个8位双向模拟i/o输出端口，内部分别提供上或下拉输出电阻。端口强度p1缓冲区强度可以达到接收进入输出4ttl门口的电子负载流的最大强度。p1端口的写入管脚板在写入1后，内部拉高，可以直接作为数据输入。当一个端口上的p1从外部被下拉到低稳压电平时，它将达到输出一个电子到直流的最大强度，这可能是由于内部上压下拉。在执行可以被擦除的非读写数据存储器程序编程和数据验证程序过程中，p1端口通常作为第8个输入地址被程序接收。

p2端口：p2端口是它是一个内部上和下拉稳压电阻的8位双向模拟i/o端口。p2端口栅极缓冲器引脚可以用来接收和控制输出4个ttttl栅极缓冲电子的直流的缓冲强度，当一个端口缓冲p2被直接写入"1"时，其引脚被内部上和下拉栅极电阻拉高并可以用作缓冲输入。因此，当它被直接用作电流输入时，端口位于p2的引脚被外部电压拉低到位于输出端的电子负载流的最大强度。这可能是由于内部上下牵拉的原因缘故。当p2端口，用于外部执行程序数据存储器或外部程序数据处理存储器同时访问的16位数据地址，输出时的端口相当p28的8位地址。读出和存储写入外部输出数据时在存储器输入地址8时，p2端口作为输出数据内容在特殊寄存功能下的寄存器。p2端口在整个闪存硬件编程和数据验证系统工作期间使它可以同时接收高八位存储地址以及存储信号和闪存控制器在系统中的信号。

p3端口：p3端口引脚为8个双向直流i/o控制端口，带有内部上压下拉控制电阻，可同时接收和控制输出4个在tttl栅极上的电子到直流的最大强度。当两个p3端口开始写入"1"时，它们在内部被迅速拉升并达到高水平并且被用作信号输入。作为一个输入，由于外部下拉低，p3端口将由于上下下拉而达到输出一个电子负载流的最大强度(ill)。

p3端口如果可以使用作为at89c51的一些特殊控制功能的通用接口也是完全可以的，如下面列表所示：

管脚备选功能

：-：：-：

P3.0 RXD (串行输入)

P3.1 TXD (串行输出)

P3.2/INT0(外部中断0)

P3.3/INT1(外部中断1)

P3.4 T0(定时器0外部输入)

p3.5t1(外部微波信号定时器1外部微波信号发出输入)

P3.6/WR (外部数据存储器写门)

P3.7/RD (外部数据存储器读取频闪)

p3端口同时它也可以用来接收一些主要的可用于总线进行射频闪烁信号编程和射频编程性能验证的射频控制电路信号。

rst：振荡器的复位字节输入。当外部振荡微处理器重置为一个器件时，在两个机器工作周期内保持一个rst引脚的高电平。ale/prog：当振荡器访问一个企业外部的数据网络存储器时，使用网络地址锁存器引脚所允许的外部输出正脉冲信号的高电平来对锁存网络地址的位置和状态进行复位字节。此引脚主要用于在振荡器的闪存脉冲编程期间通过脉冲输入用于闪存编程的脉冲。在通常的，周期性脉冲输出的ale正脉冲信号的恒定脉冲频率大约为1/6振荡器的频率。因此，它们实际上可以跳过一个用作外部脉冲输出的周期性脉冲或跳过一个用于定时目的。但是应该注意的是每一次都需要指出的一点是，外部的数据存储器，这将被用于跳过一个新的ale脉冲。如果振荡器需要禁用一个alert的复位字节输出，可以在振荡器的sfr8eh地址上重新设置0。此时，ale只需要执行一个movr，movd指令为一个新的ale。另外，该引脚被略微拉高。如果外部微处理器在外部脉冲执行的状态ale禁止，则该引脚的设置无效。

psen：外部的应用程序例如数据包和存储器的编程代码包含指令集的选择和数据通门控制信号。在外部软件程序执行的指令代码流在提取中的指令外部程序中的数据流在存储器系统中的每个代码提取指令值在提取期间，每个外部程序机器执行周期有效两次/psen。但是，访问外部应用程序例如数据库和存储器时，这两个有效的/psen的控制信号通常可能不会同时一起出现。

ea/vpp：这是用于保证当/ea端口器继续工作保持低稳压电位，这期间的外部应用程序相同存储器(0000h-ffffh)，无论它的存储器类型是否与内部的应用程序相同存储器。需要特别注意，当外部应用程序开始使用加密的文件方法1时，/ea中的存储器端口会自动锁定内部以用于防止文件重置;同时当/ea端口的继续运行保持正常的最高位时，这里的内部应用程序没有内存。该引脚还同时可以作为用于在不对闪存进行编程期间用于应用12v值的闪存进行编程的备用电源(vpp)。

xtal1：反向控制电路主要用来进行控制振荡信号放大器的时钟输入和内部时钟输出是用来进行控制系统的内部时钟质量管理工作以及辅助系统控制反向电路的外部驱动控制器的输入。

XTAL2：来自反向振荡器的输出。

### 3.1.3 振荡器特性

xtal1和外部xtal2分别提供的是片内反相放大器的脉冲信号输入和振荡器输出。该系列反向放大器的设备可以直接配置为片内的振荡器。石晶振荡和陶瓷振荡均可广泛采用。如果放大器使用外部的时钟源脉冲驱动的设备，则放大器不应需要连接xtal2。对内部的时钟源脉冲信号的多余脉冲输入信号需要通过两频的分频脉冲触发，因此放大器对外部时钟源脉冲信号的所需脉冲的宽度没有严格的要求，但是必须注意保证时钟源脉冲的频率高低和电平的所需脉冲宽度。

### 3.1.4 芯片擦除

通过快速组合正确的两个锁定保存位芯片控制电阻信号并同时将它保持在比ale引脚低10ms，可以轻松快速完成整个程序pe-rom两个芯片控制阵列和三个用于锁定保存位的两个芯片控制电阻被擦除。在重复执行一个芯片用于锁定内存位置的电擦删删除的每个操作中，代码中的数据元组被允许重复执行写入"1"，并且必须在执行芯片锁存重复执行写入一个可编程非零时空函数存储器的字节之前，它才能重复执行此位电擦除后的操作。

此外，at89c51配备了固定的逻辑，可以从低频动态到零的频率静态，支持两种软件模式和可选的自动关机中断模式。系统在空闲时中央控制单元软件自动停止振荡器的工作。然而，随机存取的存储器，定时器，计数器，串行接口和振荡器中断系统继续保持正常工作。在这种关机中断模式下，将自动保存随机存取存储器的所有内容，并自动冻结振荡器，并自动停用所需要使用的其他硬件和芯片振荡器的功能，直到振荡器下一次所使用的硬件振荡器复位完成为止。

许多尚不了解51单片机的互联网用户会遇到以下问题：书籍和在线教程中的AT89S51是什么?8051、89C51等，但没听说过89S51。

在这里，剛刚刚入門的单片机新人应该先阐明一下单片机实际使用的一些产品和理念。mcs-51微控制器单片机是基于美国英特公司于1980年推出的一款单片机产品。其典型的产品理念为8031(芯片无内置的程序和存储器，实际的使用已从单片机市场上完全淘汰)，8051(通用芯片设计采用hmos，功耗为630mw，是89c51的5倍)日期根据实际的使用)。但是到目前为止，8751和其他的通用芯片产品仍然可能是完全兼容的，包括mcs-51核心处理器系列和微控制器(目前已全部停产89s51、89c51等)。在加州理工大学和计算机职业技术学校的单片机培训课程和文档中，mcs-51微控制器仍然可以用作基础理论和学习的一个重要代表。

在一些技术文档中，8051甚至被广泛称为是mcs-51系列中的mcu。8051是早期最典型的单片机代表。由于对mcs-51单片机的深刻历史意义，许多微控制器公司都推出了许多兼容这一系列的单片机，这也就意味着他们的内核确实已经存在于mcs-51。它已经成为8位微控制器的一个标准。

其他飞利浦公司的51mcu产品与51mcs-51核心处理器兼容。相同的微控制器程序，在每个飞利浦微控制器设计制造商的产品和硬件上所需要执行的程序和结果可能是相同的，例如，我们常说的89c51，如飞利浦的at89c51(已宣布停产)，89s51，飞利浦(简称飞利浦)和l公司的winbond(winbond)等。已停产的微控制器是飞利浦atmel公司的单片机和at89c51单片机。同时，许多微控制器功能在原始的基础上已经得到了很大的改进，例如b.时钟。闪存越好(程序中只读存储器的所有内容至少一次可以反复重写1000次)。对于只读存储器(一次只能写入)，at89c51的存储器性能远远地要优于8051。

关于目前的市场营销，pic单片机制造商阵营对89c51提出了强烈的质疑。89c51最严重的问题是存在技术缺陷之一就是添加更多isp(在线更新应用程序)的功能目前是不被认为能夠广泛使用的。因此需要通过添加更多isp功能等新功能之后才能在市场上继续使用。mcs-51图例。在这种的情况下，89s51取代了89c51。目前，89s51依然已经变成了单片机市场中大多数人民的选择之中的一个绝大部分。目前市场份额最大的atmel已经宣布停止了生产新的at89c51，将其产品改用全新的at89s51。89s51进行了一系列技术上的改进。89s51采用全新的0.35标注，可有效控制单片机制造基本的成本，改善产品功能，增强市场竞争力。89sxx可以成为兼容89cxx等51系列单片机的芯片。同时，atmel不再需要接受89c的大量订单。你在目前市场上所能看到的89c51实际上已经是atmel以前停止生产的大量库存。

## 3.2 AT89C51单片机简介

at89c51是一个os8-bit微处理器(fpeam只读存储器-flashprog随机存取只读存储器fpram和一个可自动擦除随机存取只读数据的存储器)，俗称嵌入式微控制器。该设计原件是采用基于atmel的高密度非易失性只读存储器的制造技术设计制造，与符合行业标准的atmcs-51指令集与输出引脚指令集是兼容的并可以一直连接到。由于多功能8位中央处理器和闪存指令集结合在一个独立的单芯片中，atmel的at89c51是一个高效的嵌入式微控制器，它为许多的嵌入式控制系统应用提供了一个灵活和廉价的解决方案。

![3-8硬件电路图](http://my.gunplan.top/static/3.2.png)

at89c51可由一个atmel公司的控制器在线进行编程，用于嵌入式温度数据采集和嵌入式数据通信。at89c51是一款低成本功耗、高性能的cmos8位嵌入式单片机，其中主要包含了可通过重复自动擦除1000次的闪存和具有8k字节的isp(指令系统内的prog随机存取程序和存储器matlable)的嵌入式闪存只读程序和存储器，该芯片元器件主要采用了基于atmel的一种高密度、非易失性的嵌入式存储技术设计制造，兼容了标准的mcs-53指令系统和80c51引脚的结构。该系列芯片元器件集成了一个通用的8位中央处理器和一个isp的嵌入式闪存存储单元，功能强大的微型嵌入式计算机的at89c51可以为许多嵌入式控制和管理系统的应用和分析指令系统的发展历程提供一些具有降低生产成本和经济效益的解决问题的方案。at89c51具有以下的特点：40针、4k字节闪存片上应用程序数据存储器、128字节随机存取应用程序数据存储器(随机存取数据存储器)、32个外部双向数据输入/外部输出(i/o)串行通信端口，5个串行中断优先级，2个串行中断优先级嵌套中断，2个16位的可编程定时计数器，2个全双工串行通信控制端口，watchdog(wdt)控制电路，片上时钟振荡器。

at89c51有三个并行的i/o口，p0：p0.0~p0.7，p1.0~p1.7，p2.0~p2.7。此外，当没有片上或外部存储器时，p0端口可以用作公共i/o的端口，当主机使用外部或片上存储器时，p0端口也可以直接用作地址数据线/端口或数据线。p1端口也可以直接作为一个通用的公共i/o端口，p1.0、p1.1、p1.5~p1.7也可以具有特殊的端口功能，如表3.4所示。当主机没有片外存储器时，p2端口可以直接用作公共的i/o端口，当主机使用外部存储器时，p2端口也可以直接用作高8位地址。

|引脚特殊功能

：-：：-：

P1.0 T2：定时器

P1.1 T2EX：定时器

P1.5 MOSI：用于在线编程(ISP)

P1.6 MOSI：用于在线编程(ISP)

P1.7 SCK：用于在线编程(ISP)

表3.4at89c51p1端口的特殊控制功能

引脚特殊功能

：-：：-：

P3.0 RXD (串行端口输入)

P3.1 TXD (串行端口输入)

P3.2 INT0(外部中断输入0)

P3.3 INT1(外部中断输入1)

P3.4 T0(定时器0外部输入)

p3.5t1(外部定时器1外部定时信号发出输入)

P3.6 WR (外部数据存储器写控制)

p3.7rd(外部的数据存储器对外部读取和控制)

表3.5 AT89C51 P3端口的特殊功能

这个房间的温度监控系统主要使用单片机进行通讯和温度检测。 P3.0接受DS18B20。 P0端口用于设计温度显示界面。微控制器和控制电路共享一个外部时钟，使用一个片上存储器并具有上电复位功能。单片机的最小系统如图3.2.1所示：

[图3.2.1 SCM 最小系系统(http：//my.gunplan.top/static/3.2.1.png)

## 3.3 8279芯片简介

### 3.3.1 引脚介绍

8279采用单5V电源供电，40脚封装。

DB0~DB7：双向数据总线，用来传送8279与中央处理单元之间的数据和命令。

clk：时钟的输入数据线，用于时钟产生的具有内部定时的时钟脉冲。

复位：复位输入线，复位后8279设置在字符显示的左输入端，两个按键锁定的设置为接触回弹式，程序需要将时钟输入线的预分频器信号设置为31，并且保证复位后的信号在高电平下有效。

CS：芯片选择输入线，低电平有效，CS 端低电平时单片机可读写8279

A0：缓冲区低地址。当 A0为高电平时，表示数据总线是命令或状态。当 A0低时，表示数据总线是数据总线。

研发：通过读取控制器将信号发送到输入数据总线，低电平有效，读出数据缓冲区，并将内部数据发送到外部数据总线。

WR：写信号输入线，低电平激活，读出缓冲器并将数据从外部数据总线写入8279的缓冲器。

RL2-140-VCCRL3-239-RL 1

CLK-338-RL 0

IRQ-437-CNTL/STB

RL4-536-SHIFT

RL5-635-SL 3

RL6-734-SL 2

RL7-833-SL 1

RESRT-932-SL 0

RD-1031-OUT B0

WR-1130-OUT B1

DB0-1229-OUT B2

DB1-1328-OUT B3

DB2-1427-OUT A0

DB3-1526-OUT A1

DB4-1625-OUT A2

DB5-1724-OUT A3

DB6-1823-BD

DB7-1922-CS

VSS-2021-A0

irq：中断请求的正确输出和执行，高级有效。在这种键盘自动中断工作模式下，当每次出现的从fifo/sensor随机存取的在该存储器中间没有任何数据时，中间的断线由一个低电平线转变为一个新的高电平，每次键盘中断时由从fifo/sensor随机存取的该存储器的所有数据被自动读出，断开的检测线路降至较低的水平。如果随机存取的存储器中仍然存有信息，该行将再次变为一个较高水平。在线路和传感器正常工作的模式下，每当随机检测到线路和传感器的信号发生变化时，中断线就可能会逐渐变高。

sl0~sl3：视频扫描线缆可用于实时连接和自动扫描任何按键或光开关、传感器或光阵列和触摸显示器或屏幕上的任何数字，可编程或支持视频可编解码。

rl0~rl7：按键返回扫描线通过按钮或传感器的开关与返回扫描线进行连接。上拉按压电路一般设置在相应的返回扫描线内部，以使返回线保持在高水平。只有当一次按压电路关闭时，相应的按键和返回线才会自动转变为一个低电平;当一次无按键闭合时，均保持在较高电平。

shift：这是换位驱动开关的主要功能。当一个换档电压开关自动闭合时，它被一个换位电压开关自动拉至较低的相位电压电流水平。同时在每当未按时接下一个好的换档电压开关时，换档电压开关的整个输入电压状态必须保持在一个好的高电平。在正常的自动键盘扫描模式下，按键自动关闭，按键的操作位置和自动换位键的开关和所输入的操作状态一起由自动键盘扫描存储。

cntl/stb：自动高电平电源关闭当用户打开一个cntl/stb的电源开关时，它将自动将其拉低，否则将始终无法保持一个好的高电平。对于所有使用鼠标键盘输入的操作模式，该行通常被用作选择控制输入。例如当用户按下按钮时，按钮的数据位置与所有控制输入状态的数据存储在一起的数据位置相同。在选通控制输入的模式下，通常需要选择它，并将按钮的数据位置存储在一个fifo随机存取的存储器中。

outa3〜outa0和一个outb3〜outb0：显示数据输出一个8位端口a和一个8位端口b。这两个端口之间既可以独立进行控制，也是一个可以单独视为8位的端口。

bd：使用数字数据空间的长度显示。此命令输出的一个信号结果可以直接用于在一个两位数字的字符转换期间进行显示一个空格，或者你也可以通过使用"显示空格"的一个命令行来控制一个信号在显示空格一个字符的转换空间进行显示。

VCC：+5V电源输入线。

VSS：地线输入线。

### 3.3.2 8279的编程方法

8279按其控制功能块的大小可以细分为：显示器和键盘控制功能块;工作和显示控制功能块;工作和控制处理器功能块;键盘控制接口和中央处理器功能块控制功能块主要包含手动控制和时间寄存器，定时和自动控制，扫描和计数器三个组成部分，它主要的功能是用于控制显示器和键盘的工作和显示控制功能块。

控制和时间数据寄存器：一种用于存储键盘和中央控制单元的通用编程语言控制命令。当8279中央处理器的程序人员确定了键盘和显示器的工作状态模式以及其他显示器工作的条件时，首先将命令键和控制数据放置在一个数据总线上，然后使用命令a0=1，wr=0cs=0并将所有的命令和键数据保存在wr沿边缘增加了控制和显示器的时间数据寄存器，并对其进行解码以方便创建适当的命令控制功能。

定时和计数器控制：它通常包含一个基本的键盘定时和计数器。第一个定时计数器控制是一个分频系数范围为2-31的预定时器。我们可以通过应用程序控制其预设的分频系数，以使内部的频率为100khz，这样的频率可能至少会导致5.1ms。包括键盘阵列扫描时间和10.3毫秒的反跳扫描时间。其他的计数器对该基本的频率扫描时间进行了划分，并为我们提供适当的键，行，键盘阵列扫描和显示键盘扫描时间。

扫描键盘计数器：用于扫描键盘的计数器主要有两种基本编码工作的模式。在基本编码计数器工作的模式下，计数器为键盘提供一个二进制的计数器。在外部软件输出引脚sl0-sl3之后，可以为用于扫描键盘的计数器提供二进制的扫描计数器功能，并在外部软件解码后进行显示。在此工作模式下，扫描键盘计数器对最低有效值的两位进行解码，并且输出引脚sl0-sl3输出1分之4的二进制解码信号，以对键盘的显示器和用于扫描键盘的二进制扫描计数器进行解码。

键盘功能块包括：返回缓冲区、键盘弹跳和控制、8x8 FIFO 传感器随机存取存储器、 FIFO/传感器随机存取存储器状态。

#### 返回抖动缓冲器与鼠标键盘的抖动反向起跳及抖动控制

八个返回行由返回缓冲区缓冲。在键盘工作模式下，逐个检测这些行，找出行键中已关闭的键。如果回弹电路检测到钥匙关闭，则等待10.3ms，然后记录钥匙是否仍然关闭。如果仍然关闭，则矩阵中 key 的行地址和列地址以及 SHIFT 和 CNTL 的状态一起发送到 FIFO 随机存取存储器，并且 FIFO 随机存取存储器中的数据格式如下：

D7 D6 D5 D4 D3 D2 D1 D0

CNTL SHIFT SCAN RET URN

数据的进行格式中，最高位为shicntl，次高位为shift状态，d5-d3来自不同的扫描线上电子的计数器，d2-d0来自中国传感器返回一个电子计数器，扫描线电子计数器和一个回扫线电子计数器的开关值分别可以直接反映正在输出被传感器按下开关键的行，列的开关值，如果在一个传感器的阵列中，返回行上的开关数据直接进入与正在输出被扫描的传感器阵列相对应的一个传感器随机存取电子存储器阵列中的行，这样，每个传感器开关的数量和位置直接被传感器反映为一个传感器随机存取电子存储器的开关位置。

#### FIFO/传感器随机存取存储器

8x8随机存取存储器是键盘模式和选通模式下的先进先出(FIFO)存储器。每条新的信息都是按顺序写的，然后按照写的顺序读出来。当传感器阵列扫描时，存储器被用作传感器随机存取存储器。此时，随机存取存储器中的每一行存储传感器阵列中相应行的状态。

#### FIF0/传感器随机存取存储器状态

在使用键盘或门控的错误模式下，fifo中的状态阵列跟踪信号表示fifo中的状态字符数注意它到底是"满"还是"空"，过多的传感器写入或读取被状态逻辑认为可能是错误，当传感器fifo不为空时，状态阵列跟踪逻辑就会提供一个用于中断传感器应用程序irq的信号。在特殊的传感器状态阵列扫描模式下，如果一个有效的传感器状态发生改变，irq信号可能是一个有效的传感器高电平。fifo表示状态字的低3位表示fifo模式中的传感器字符数，fu位表示一个fifo随机存取的存储器已满;o(超过donmn)du位表示超限错误，即传感器试图将另一个传感器的字符发送到完整的传感器fifo;u(done下)du位表示null错误，即传感器试图写入或读取空的传感器fifo。s/f有两种的含义：在特殊的传感器扫描模式下，s/f的含义是指一个传感器随机存取的存储器中至少可能包含一个指示传感器是否闭合的指示，在特殊的错误模式下，s/f位是一个传感器错误的标志，指示了是否传感器发生了多通道同时写入或关闭的错误，du位表示错误显示随机存取的存储器尚未完全可用，因为"清除显示"或"清除全部"的命令已经无法完成其他未被消除的操作。

显示随机寄存器块的功能块主要包括：16x8显示随机寄存器，16x8显示随机存取地址存储器，显示随机地址存取寄存器)

#### 显示随机存取存储器和显示寄存器

8279内部缓存显示器同样具有16x8的缓存形式自动显示随机存取的数据存储器，通过自动显示一个寄存器和两个四位端口0uta0-3，0utbo-3来自动显示刷新外部存储器的数据显示，显示器同样可以是使用的大都是8段数码管或者是白炽灯，也可以有外部显示器同样可以是使用的大都是8段管或数码管，显示随机存取的数据存储器也同样可以是使用的大都是16x8的形式显示缓存形式，也就是可以直接构成两个16x4的随机存取数据存储器的形式，显示随机存取的存储器字节可由中央处理单元存储器进行数据的读写，被处理单元读写的随机存取的存储器字节的读写地址由随机显示读写地址的寄存器进行指示.数据显示[地址寄存器保存当前中央处理单元存储器的读或写随机取出的存储器字节读写地址，以及正在随机显示着的那两个4位半字节的存储器地址，读写的地址由当前中央处理单元的命令[存储器编程]，也就是可以设置为每次处理单元读写后存储器地址自动加1的一种工作更新方式，在处理单元设置了正确的存储器工作更新方式后，显示随机存取存储器的数据也可由中央处理单元存储器读出，半字节存储器a和半字节b的存储器地址自动由8279更新，以适应由中央处理单元存储器送入的随机存取数据，a和b半字节可独立的送入，也就是可以单独作为一个字节的送入，随中央处理单元所需要设置的工作更新方式而定。

#### I/O 接口功能块

8279通过i/o缓冲器控制与四行中央处理部分控制单元的系统总线网络接口8279，i/o控制部分主要使用cs。a0，rd，wr和四行的中央处理部分控制单元8279之间的单向控制数据是交换的，数据和缓冲器信号是双向控制数据交换的通道，所述控制单元的信号和缓冲器是如下的双向控制数据交换之间的逻辑关系：

CS A0 WR RD 状态

\-----

10--中央处理单元从8279读状态

0101中央处理单元向8279写状态

10--中央处理单元从8279读数据

001-中央处理单元向8279写数据

1 X 数据缓冲区输出处于三种状态

x为任意数(0或1)

\###3.3.38279的操作

如前所述，8279可以完全适应各种手机键盘和电脑显示器的不同功能和工作的方式，由于8279中各个命令功能块的各种工作方式是完全可编程的，用户完全可以根据自己的工作要求，用向8279写命令字的各种编程方法对8279的各种工作方式和功能块进行编程，从上表中我们可以清楚地看出，只要执行命令cs=0同时wr=0=1，然后你们就可以将命令字写到8279，并在命令wr的上升沿将相应的命令程序驱动到8279。

对于中央处理器，8279只有两个端口地址，一个是用于查看和读写处理器的命令和数字的状态(cs=0，a0=1)，一个端口地址用于查看和读写处理器的数据(cs=0，a0=0)，但对于编程语言命令和字代码有很多类型。在8279中给出了区分学校和企业不同的温度命令字的方法主要是对处理器命令和字代码的高3位(d7，d6，d5)和低5位进行了分析和编码，而低5位主要是用于理解命令字的实际含义和教学内容。

#### 8279的编程命令

键盘/显示器方式设置

最高位最低位

--

命令代码000 D D K K K

其中DD为显示方式，KKK为键盘方式

DD的表示：

编码功能

\--

008个8位字符显示-左端传入

01168位字符显示-左输入

1088位字符显示-右输入

1116个8位字符显示-右端送入

所谓左端送

编码功能

\--

000编码扫描键盘-2键连锁

001译码扫描键盘-2键连锁

010编码扫描键盘-N键巡回

011译码扫描键盘-N键巡回

100编码扫描传感器阵列

101译码扫描传感器阵列

110选通输入，编码显示扫描

111选通输入，译码显示扫描

钥匙链和2，其中N是一个关键电路8279双键盘键被按下两次处理，编码和在两个扫描链轮和显示器被解码形成扫描扫描SL0-SL3。

程序时钟

命令代码001 P P P P P

此命令用于确定定时和分频控制中每个预标量的分频控制系数。命令代码ppppp功率系数可以直接形成一个数字2-31。预标准测量也可以在外部没有所述时钟预定频率的情况下来进行，所述基频，得到内部，如果100khz的选择的基本时钟预定频率，能够外部时钟获得与所述时钟频率预定的恢复时间扫描，分频相关的因子;在预定的复位时钟脉冲后100khz如果没有外部时钟被自动馈送到码31自动。

读FIF0/传感器随机存取存储器

命令代码：010 AI X A X =任意

该读取命令主要用于确定中央处理器选择需要读取后续操作的存储器对象分别是8279中的哪一个fif0/来自传感器随机存取的存储器，并且主要用于传感器确定8个随机存取的存储器字节阵列中的哪一个被传感器读取，其中第一个aaa表示中央处理器选择了需要后续读取的行，ai自动为该行添加1个相同的特征位，并且这两者在传统的键盘扫描模式下的数据是不存在直接相关的，对于每次传感器后续的读取8279，数据存储器会按照与传感器数据首次读取时输入的fif0相同的后续读取顺序自动将数据发送出去。从传感器的fifo开始读取所有数据进行后续的读取，直到传感器写入新的命令。在来自传感器随机存取阵列的实施例中，aaa传感器选择了一线来自传感器8个的随机存取的存储器行如果ai=1，来自传感器的下一次后续读取将被读的随机存取数据送到存储器的下一行。

读显示器随机存取存储器

命令代码：011 AI A A A A

中央处理控制单元对8279写此读取命令，则我们确定了一个中央处理控制单元以一个显示器随机存取的一个存储器位作为数据源缓存地址位来进行随机读取的操作，其中的aaaaa为一个显示器随机存取一个存储器的一个数据源缓存地址，ai的行为自动依次加1特征位，若其中ai=1，则每一次读取第一行随机存取的一个存储器之后[第一行行为显示器的数据地址]自动依次加1。

写显示器随机存取存储器

命令代码：100 AI A A A A

中央处理单元将此命令写入8279，它规定下一步将写入8279的显示随机存取存储器。寻址模式和自动加1功能与读显示随机存取存储器相同。

显示器写入禁止/空格

命令代码：101 X IW IW BL BL X=任意

A B A B

此显示命令主要用于同时屏蔽a或b两个显示端口的输出并重新显示其显示的区域。如果将其中两个显示端口用作两行4位的显示，则必须同时屏蔽4位之一，以使对方发送的信息不会直接影响另一半。iw是该端口被屏蔽的功能位。如果为显示端口设置了显示命令iw=1，则该显示端口被此命令所屏蔽。空格显示请特别注意，b0对应于c0和d0，而d0和bl是应于iwensei，则此显示端口将重新显示空格。如果要以单个8位的输出命令格式为该端口创建重新显示的区域，则必须为端口设置两个d0和bl的标志以使该端口的显示完全保持空白。

消除

命令代码：110 CD CD CD CF CA

此数据清除格式命令主要就是用于按一定的数据格式顺序进行数据清除，它显示随机存取器的数据格式存储器的两个fif0状态，其中a和cd分别用于指定一个需要进行清除的数据格式：

CD CD CD

0 X 全"0"(x为任意)

10 AB =16进制

1020(0 O 100000)

11全册"1"

当显示为"1"(或 CA =1)时，允许清除显示

cf显示器清除cd和fifo的状态(其中包括广告和中断)。如果显示cf=1，则显示器清除cd和fif0状态，并重置中断线。传感器直接随机访问存储器的显示也始终被设置为第0行。ca始终被显示器清除，并且其显示效果与cd对应，当显示ca=1时，cf可以进行合成，使用显示器的cd和fif0指定的随机清除存储器格式进行清除。此时显示器的随机访问存储器的状态已经被清除。cd插孔还可以重新设置同步内部的时序。显示期间将自动清除随机存取访问存储器(约16us)。无法被重写。同时，在此期间，fifo的最高有效位设置为"1"。当显示广告的随机存取访问存储器再次恢复可用时，它将自动进行重置。

中断结束/出错方式设置

命令代码：111 E X X X X X=任意

当一个阵列传感器，该命令使IRQ线变低，并且允许写入随机存取存储器(通过位置传感器的变化来检测，IRQ线可具有增加的，这样做防止了信息写入再次随机存取存储器之前其复位)。在 N 键电路模式下，如果 E 位被编程为"1"，芯片电路将以特殊的错误模式运行。

主要用于检查 N 键巡视模式特殊错误模式下的多次按键。如果在一个反弹周期内按下两个键，则可以视为同时多次按下，并建立一个错误标志以防止进一步写入 FIF0，并设置中断(如中断设置)。错误进行标志设计可以被 FIFO 状态字命令读取，CF =1的清除命令我们可以通过重置错误信息标志。

1. 锯齿波由两个单晶二极管bt和r1、r2、r3、w1和c1组成的单晶管张驰振荡器锯齿波产生，然后通过单晶管发射极跟随张驰振荡器将锯齿波输出。

2. 控制电势差(Uk)和锯齿波电势差与电子流的强度叠加，送至 v2基极。综合电势差是我们。当 Us>0(0.7)时，V2打开，Us <0，则 V2结束。

3. V2，V3和R8，R9，DW1流开关已经被组成，当基极电位差V2 Ube2>0(0.7)，V2被接通时，接近零电势差Ube3，V3被关闭，直流开关是打开。

4. 过零脉冲的控制输出由削波同步电源变压器晶闸管tb、整流桥变压器d1、r10和直流开关r11组成的削波整流桥同步变压器电源，它与直流开关的两个输出电势差一起分别用来控制v4和发射器的v5。只有当发射器的dc直流开关发射器打开时，v4才使发射器关闭，并且由于v4和发射器的v5基极电极与两个发射器之间存在一个工作电势差，因此它使发射器可以在此期间正常工作。当每次发射器的同步电势差过零时，v4关断，其集电极和输出存在一个正电势差，这就可以使得v5从发射器的截止开关开始接通，通过这个脉冲使同步变压器的输出触发一个过零脉冲，并且这个触发脉冲可以使变压器晶闸管t在需要发射器导通的时候导通。

直流开关导通时，连续正弦波控制电势差uk的大小决定了直流开关的导通持续时间的长短，这也直接决定了在电阻炉设定的直流开关周期内可以传导的直流开关周期和次数，因此，可以合理地调整直流开关输出的功率。显然，控制电势差uk越大，它可以传导的直流开关周期和次数越多，输出的功率越大，电阻炉的直流开关温度越高。相反，电阻炉的直流开关温度越低。

自动电炉闭环系统温度自动调节的基本设计思想是在热电炉系统中自动添加温度传感器和相应的温度自动控制器。温度传感器的温度调节基本功能主要是通过检测自动热电炉的实际工作温度，将其信号转换为电势差的控制信号，并且我们比较了电炉相应温度控制装置uk的电势差。这种差异的变化大小(e=uk-uft)和电势差变化的方向(即e是正还是负)由温度控制器沿晶闸管相反的输入控制方向自动设置，以便温度控制器的输出信号控制导晶闸管接通的方向和长度。直流晶闸管开关的输入控制接通的时间，使得在一定温度和时间内的设置，晶闸管的输入控制接通电流频率有所增加或流量减少，而使得电炉的相应直流温度控制装置有所频率增加或流量减少。利用这种电势差控制温度的方法，可以在很小的电势差范围内自动改变炉温，并且控制精度高。

方案二：为了更好地可以有效简化控制电路，采用先进的单片机恒温控制技术可以作为一个恒温控制系统和企业的核心单片机来进行设计本文的课题。温度传感器ds18b20用于对温度传感信号的采集。方案二控温的基本设计思想主要是：通过传感器采集的电阻丝温度与单片机标准传感器温度的差值，控制恒温发热系统中电阻丝的数量和持续时间，从而最终达到对恒温发热系统控制的主要目的。控温方案二的单片机设计电路框图结构如下图所示：

![2.2方案二设计框图](http：//my gunplan.top/static/003.jpg)

本解决方案以先进的单片机为温度控制的核心，利用温度传感器自动采集计算机温度，通过传感器采集的计算机温度与单片机标准传感器设定计算机温度之差的距离来测量和控制温度，使得温度始终保持在单片机标准传感器设定的温度。该解决方案设计制作成本低，可靠性高，非常适用于计算机系统的动态控制性能和系统稳定性对温度要求不是很高的应用场合。

## 3.4传感器接口电路设计

### 3.4.1温度数据采集电路

ds18b20是基于dallassemiconductorcorporation的一个网络数字温度传感器。与其他的温度传感器连接方式相比，ds18b20具有以下的功能：当网络连接到如上所述微处理器的唯一单线路的接口模式中，只有一个端口可以被用于直接实现一个微处理器和ds18b20之间的双向通信的线路。

ds18b20支持独立的多点温度网络。几个节点ds18b20可以仅在三条线上通过并联进行连接，以方便地实现基于互联网的多点温度的测量。ds18b20不一定需要外围的组件。所有的传感器集成元件和温度信号转换集成电路都可以像普通的晶体管一样直接集成在单个温度集成电路中。传感器的温度测量范围一般为55〜125°c，温度集成电路测量的固有温度和分辨率范围为0.5°c。温度测量的结果直接传感器输出一个9位数字的温度测量信号，并直接通过"初始化总线"接口串行发送到传感器的中央控制单元。同时，可以直接发送crcr的温度校验码，具有较强的温度抗干扰和自动纠错的功能。温度测量的结果以9位数字的模式串行传输。

尽管ds18b20具有简单的嵌入式温度自动测量和控制系统，较高的分辨率和温度测量的精度，方便的网络连接以及较少的线路和资源占用等诸多优点，但在实际的应用中还是应该充分考虑以下的几个方面：

1. 尽管操作系统的硬件很简单，但我们还是需要相对复杂的软件处理器来对其进行温度补偿。由于ds18b20与其他微处理器之间的读写串行编程需要数据同时传输，因此必须注意保证在读写串行编程期间的连续读写编程时间，否则将是无法对读取进行温度补偿测量的结果。

2. ds18b20的可靠性相关数据未提及任何连接到单个总线的微处理器ds18b20的数量。这很容易就会导致一个错误的假设，即微处理器可以在总线上连接任意数量的总线ds18b20，而在实际的应用中并非如此。如果一条单个总线上微处理器连接了8个以上的总线ds18b20，则几乎没有必要考虑解决单个总线微处理器的可靠性和总线驱动问题以及我们在设计多点温度控制和测量传感器系统时所需要注意和考虑的一些问题。

3. 连接长度的限制是指采用连接长度为ads18b20的信号总线的电缆。由于它具有信号电缆的稳定性和电子电缆的阻挡比较大等特性，如果距离太大，信号传输幅度也会有所降低。如果在测试中普通信号电缆的双绞线传输电缆的长度明显地超过50m，则表示温度降低或读取数据不正确。如果将普通信号总线的电缆改为带屏蔽普通信号电缆的数据传输双绞线，则正常的总线通信数据传输距离应该可以轻松地达到150m。

ds18b20提供两种不同类型的器件封装：pr-35和pdsoic。引脚的顺序排列如下下表3.1所示。该软件封装操作系统中实际上已经使用了基于pr-35软件包的封装工具包。尽管如此，dds18b20仅用于提供一个返回9位温度数字的一个温度测量值，如如下图3.1.2所示。

管脚管脚定义说明

：-：：-：：-：

8脚SOIC 3脚PR-35

21 GND地

12 I/O 数据输入

83 VCC电源

34567 NC空脚

表3-1 DS18B20管脚排列

图3.1.2ds18b20温度值的表示计算方法

d9为低字节的符号位，0为正，1为负，高字节(d10~d15)的其他位用二进制符号位的补码或扩展位形式进行了表示;d0~d8为数据位，以二进制数据位的补码或扩展形式进行表示。如下表3.2显示了数值与温度之间的非线性关系。

温度测量数据(二位位十六进制)数据(十六进制)

：-：：-：：-：

+125000000001111101000FAH

+2500000000001100100032H

+0.500000000000000010001H

000000000000000000000H

+0.51111111111111111 FFFFH

-251111111111001110 FFCEH

-551111111110010010 FF92

表3.2 DS18B20值与温度的关系

由于房间的环境温度不能为负，因此系统不会考虑负温度。这样，您在选择硬件时就可以使用市售组件，而不必使用工业组件，从而可以大大降低成本。读取温度信息后，微控制器仅需要将低字节(D0〜D8)发送到主机和控制电路。

### 3.4.2发光二极管显示接口电气设计

选择的系统控制方式是四路开关室温动态实时传感器显示，显示精度0.1℃。具体的电路原理图所示如图3.2：

![3-2硬件电路图](http：//my.gunplan.top/static/3.2.png)

### 3.4.3发光二极管数码管

发光二极管显示器即为新型发光二极管显示器，具有数据显示醒目、成本低、配置灵活、接口可以方便等特点，单片机电源管理控制系统在应用数据管理操作系统的设计中常用它来直接显示电源管理操作系统的日常工作生活的状态和过程中所采集的数据在信息网络中所输入的数值等。

根据大屏幕发光点阵二极管的排列和结构不同，可将大屏幕发光点阵二极管显示器划分为大屏幕发光二极管点阵数码管和大屏幕发光二极管点阵数码显示器。大屏幕发光二极管点阵数码管主要就是用于在屏幕上显示英文数字和一些英文字母和图形符号，发光二极管点阵显示器同样可以在屏幕上显示英文数字、字母、男人和图形等。大屏幕发光点阵二极管数字点阵显示虽然点阵显示灵活，但它们主要占用的是单片微型计算机系统的软硬件资源比大屏幕发光二极管点阵数码管显示器要多得多。除了使用指定的程序，大屏幕发光点阵数码管显示器或led点阵显示器主要用于请求特殊的点阵显示场合，几乎所有的微型计算机系统应用点阵显示系统都使用大屏幕发光二极管数字点阵显示。

数字管理的显示系统主要有两种显示模式，包括静态数据管理显示程序模式和动态显示程序模式。静态数据管理显示的程序非常不复杂，静态数据管理显示系统的程序模式设计起来非常简单，占用cpu的内存时间很少。仅需要当系统的显示字符串发生更改时才可以调用动态显示程序。但是，硬件和集成电路很多。每个八位数字晶体管都至少必须需要一个8位i/o电源输出输入端口，一个8位限流电源输出驱动器和8个8位限流输出电阻。通常偶尔也可能会需要使用少量的圆形数码管。发光二极管的应用由于静态扫描显示器需要使用较少的电子管组件，并且需要使用更多的静态数字组件与电子管组件在显示器之间进行切换很麻烦。为了有效简化了电路并且大大降低了成本，系统设计使用了一种动态扫描数字显示的方法。

动态扫描显示模式的工作原理是分别打开每个显示器，即一次仅显示一位。为了使用户看到所有的显示器都已显示，必须加快每个显示器的照明周期(增加扫描频率)。通过使用人眼的视觉残留效果，可以实现与连续显示所有显示器相同的效果。动态扫描显示电路如图3.2.2所示：

![图3.2.2动态扫描图](http：//my.gunplan.top/static/003.jpg)

## 3.5 温度控制电路的设计

![图3.2.2温度控制电路](http://my.gunplan.top/static/3.3.png)

通过正确设置开关元件脉冲的宽度来我们可以控制三端双向的可控硅开关元件的开启和脉冲关闭。当伴随着脉冲宽度的增加(脉冲占空比增加)时，三端双向的可控硅开关元件的脉冲导通加热时间和温度延长，电阻丝的开关元件加热的时间也延长，温度也升高。相反，如果我们减小了脉冲的宽度(相当于减小脉冲占空比)，则双向可控硅的脉冲导通加热时间和温度缩短，电阻丝的开关元件加热时间和温度缩短，从而大大降低了元件的温度。

以此方法来控制温度的恒定不变。

## 3.6 脉宽调制

### 3.6.1 脉宽调制的介绍

pwm是高电平脉冲方波宽度调制的一个英文缩写。高比的方波的第一个时间段被简单地称为高电平的占空比，例如，一秒钟高电平和的50%1第二个是占空比的pwm波的脉冲宽度调制(pwm)的定义低电平在各种开关电源中被广泛使用的一个术语。。这个词是根据开关稳压的控制工作方式进行定义和分类的。除pwm混合型外，还有开关调制pfm型和脉宽调制pwm和一种pfm混合型。波的脉宽调制(pwm)的定义开关稳压电路的定义是在设计和控制开关稳压系统的电路设计中在输出的频率可以与低电平保持一个不变的频率情况下，通过电势差的反馈电路来控制和调节其输出的占空比，从而使使用者能够更好地达到维护社会稳定和发展控制输出电势差的主要目的。

脉冲信号宽度的调制(pwm)技术是一种非常有效的可以利用微处理器的模拟数字脉冲信号输出来实现控制和模拟集成电路的一种技术，它被广泛的应用于从电力测量，控制和无线通信系统到电力的智能转换许多应用领域。

### 3.6.2 基本原理

随着我国电子信息技术的发展，出现了多种 PWM 技术，包括：相电势差控制 PWM 、脉冲信号宽度 PWM 方法、随机 PWM 、 SPWM 方法、线电势差控制 PWM 等，然而，镍氢动力电池使用智能手机充电器设计采用的脉冲时间宽度 PWM 方法，以等脉宽的脉冲串作为 PWM 波形，通过不断改变一个脉冲串的周期可进行分析调制，可以同时通过这些改变传统脉冲的宽度或占空比来调节电势差，并且我们可以选择通过研究采用学生适当的控制管理方法来实现协调地改变电势差和频率。

模拟信号的时间值和分辨率可以通过不断的发展变化，对其时间和变化幅度的时间值和分辨率没有必要进行严格的限制。9v模拟信号电池同时也是一种智能模拟设备，因为它的输出电势差不完全一定等于9v，而是随着一定时间而变化，并且同时也可以取任何真实值。类似的地，从模拟信号电池内部吸收的电子流的数量和强度不可能局限于任何一组模拟信号可能的真实值范围。智能模拟信号和传统数字信号的最大区别主要在于后者的真实值范围只能在数字信号预定的任何一组可能的值内，例如，在{0v的电子集合中，5v}。

模拟电势差和收音机电子流的强度控制可直接地应用于扬声器的控制，例如模拟控制汽车和收音机的音量。在简单的控制模拟电势差和收音机中，音量旋钮通过连接扬声器得到可变电阻。当扬声器拧动音量旋钮时，电阻值随之变大或相应地变小;流过这个强度和电阻的电子流的强度也随之增大或相应地减小，从而通过改变扬声器驱动收音机和扬声器的电子流的强度和电阻值，使得音量旋钮相应地随之变大或相应变小。与其他无线电一样，模拟扬声器电路的音量输出与扬声器输入成一个线性的比例。

在简单的需要模拟一个立体声的收音机中，音量控制系统的旋钮与收音机连接时会用到一些可变电阻。其中之一的问题是由于模拟电路倾向于随时间进行漂移，因此难以进行调整。只有可以帮助解决这个复杂问题的精密模拟电路体积可以非常大，体积庞大(尤其是比如老式的家用立体声音量控制设备)和昂贵。精密模拟电路还可能产生严重的热量，其产生的功耗与电路中的工作元件两端的电势差与工作元件电子流的扰动强度的乘积大小成正比。精密模拟电路也肯定可能对于噪声敏感，任何的扰动或者产生的噪声都肯定可能会直接改变工作元件电子流的强度值。

通过对模拟控制电路进行数字控制，可以大量减少控制系统的设计成本和系统功耗的降低。此外，许多的微控制器和dsp已经在日本和中国的芯片上包含了dspwm控制器，这样就使得通过数字进行控制的设备实现自己的功能变得完全可以更加的具有容易。

脉冲宽度调制信号的设计思想

该对象的脉宽调制信号为方波，设定周期为1 s。它的产生将时间计数器设置为10 ms时序，然后通过寄存器R3控制脉冲宽度调制信号的周期。此主题仅具有模拟效果，并且对准确性没有过多要求，因此将1s周期划分为100。在相等的部分中，计时器设置为10 ms，计时器在R3中启动的频率为100。

寄存器r2中需要存储的数据是根据脉冲检测控制电路和数据控制电路进行转换的数字。r2中存储的数据值是用于分别控制一个脉冲系统的信号和1s内一个高电平的脉冲时间的长度。这样我们也就可以从寄存器的p2.6口检测得到用于定义一个周期可调和进行高电平的脉冲时间可调的寄存器来控制脉冲系统的信号。

### 3.6.4 脉宽调制信号的作用

脉冲宽度调制信号从P3.0端口输出。从P3.0端口输出的方波信号连接到三端双向可控硅开关的控制连接，以控制TRIAC的接通和关断。如果方波在一段时间内以高电平出现，则双向可控硅的占空比变长，即加热元件散发的热量更多。简而言之，加热元件释放的能级由方波在一个周期内变高的时间确定。

### 3.6.5 脉冲宽度调制优点

pwm的最大好处的其中之一个特点就是从信号处理器到受控系统的数字信号都是保持数字形式的，没有对数模信号进行的变换。这样保持了数字形式的数模信号最大限度地减少了噪声的产生和影响。数字噪声的大量产生主要是因为只有在其强度足以准确地阐述信号上升沿或信号下降沿跳变的强度时候，数字信号的稳定性才可能会被受到影响。

除了使用指定的程序，大屏幕可以使用点阵数字显示器或led数字显示器。为了请求特殊的显示场合，几乎所有的微型数字计算机或者应用显示系统都使用发光二极管进行数字显示。这些模拟信号可以转换到pwm信号可是它们可以大幅度地增加传输信号距离的范围和长度。在高频接收端，可以直接滤除经过调制的高频方波，并通过适当的rc或lc模拟网络将传输信号的频率恢复到最为模拟的形式。

总之，pwm不仅省钱、占地面积被大量使用节约、抗震和降低噪声的使用性能强，而且同时也成为是一种非常值得许多专业建筑工程师在许多不同类型的建筑设计和工业应用中广泛研究使用的有效解决技术。

 # 第4章 系统软件设计

在微机测控系统中，软件与硬件同样重要。硬件是系统的躯体，软件则是灵魂，当系统的硬件电路设计好之后，系统的主要功能还是要靠软件来实现，而且软件的设计在很大程度上决定了测控系统的性能。为了满足系统的要求，编制软件时一般要符合以下基本要求：  

1. 易理解性、易维护性。通常是指软件系统容易阅读和理解，容易发现和纠正错误，容易修改和补充。由于生产过程自动化程度的不断提高，测控系统的结构日趋复杂，设计人员很难在短时间内就对整个系统理解无误，软件的设计与调试不可能一次完成，有些问题是在运行中逐步暴露出来，这就要求编制的软件容易理解和修改。在软件的设计方法中，结构化设计是最好的一种设计方法，这种设计方法是由整体到局部，然后再由局部到细节，先考虑整个系统所要实现的功能，确定整体目标，然后把这个目标分成一个个的任务。任务中可以分成若干个子任务，送样逐层细分，逐个实现。本仪表就是采用这种模块化的设计方法。这样不但使得设计目标明确、思路清晰，而且在检错、调试时也很方便。当出现问题时，可以根据问题的种类和现象来判断是哪一部分出的问题，很容易找出故障所在和故障原因。同时，采用模块化程序结构设计方案，对于系统功能的扩充和修改也提供了很大的方便。
2. 实时性是电子测量系统的普遍要求，即要求系统及时响应外部事件的发生，并及时给出处理结果。近年来，由于硬件的集成度与运算速度的提高，配合相应的软件，实时性比较容易满足设计要求；
3. 准确性对整个系统具有重要意义，尤其是测量系统，系统要进行一定量的运算，算法的正确性和准确性对结果有着直接的影响，因此在算法的选择、计算的精度等方面都要符合设计的要求；
4. 可靠性是系统软件最重要的指标之一，作为能够稳定运行的系统，抗干扰技术的应用是必不可少的，最起码的要求是在软件受到干扰出现异常时，系统还能恢复正常工作。结合上述编制系统软件的基本要求，首先讨论软件的设计思想。

在微机测控系统中，软件的重要性与硬件设置同样重要。硬件是躯体，软件是灵魂，当系统的硬件电路确定之后，系统的主要功能还要靠软件来实现。如果说硬件决定了产品的造价，那么在硬件搭配合理的前提下软件在很大程度上就决定了产品的性能。

## 4.1 软件设计思想

为了满足系统的要求，编制软件时必须符合以下基本要求: 

易理解性、易维护性。通常是指软件系统容易阅读和理解，容易发现和纠正错误，容易修改和补充。由于生产过程自动化程度的不断提高，测控系统的结构日趋复杂，设计人员很难在短时间内就对整个系统理解无误，软件的设计与调试不可能。

一次完成，有些问题是在运行中逐步暴露出来，这就要求编制的软件容易理解和修改。在软件的设计方法中，结构化设计是最好的一种设计方法，这种设计方法是由整体到局部，然后再由局部到细节，先考虑整个系统所要实现的功能，确定整体目标，然后把这个目标分成一个个的任务。任务中可以分成若干个子任务，送样逐层细分，逐个实现。本仪表就是采用这种模块化的设计方法。这样不但使得设计目标明确、思路清晰，而且在检错、调试时也很方便。当出现问题时，可以根据问题的种类和现象来判断是哪一部分出的问题，很容易找出故障所在和故障原因。同时，采用模块化程序结构设计方案，对于系统功能的扩充和修改也提供了很大的方便。

实时性。实时性是本系统的基本要求。即要求系统及时响应外部事件的发生，并及时给出处理结果。近年来，由于硬件的集成度与速度的提高，配合相应的软件，实时性容易满足要求，特别是对于汇编语言编制的软件。  

1. 可测试性。系统软件的可测试性具有两方面的含义:其一是指比较容易地制定出测试准则，并根据这些准则对软件进行测定；其二是软件设计完成后，首先在模拟环境下运行，经过静态分析和动态仿真运行，证明准确无误后才可投入实际运行。  
2. 准确性。准确性对整个系统具有重要意义。系统要进行大量运算，算法的正确性和准确性问题对控制结果有直接影响，因此在算法选择、位数选择方面要适合要求。
3. 可靠性。可靠性是系统软件最重要的指标之一，它要求两方面的意义:第一是运行参数环境发生变化时，软件都能可靠运行并给出正确结果，也就是要求软件具有自适应性:第二是在环境恶劣干扰严重情况下，软件必须保证也能可靠运行，这对整个系统尤为重要。



## 4.2 软件组成

由于整个系统软件相对比较庞大，为了便于编写、调试、修改和增删，系统软件的编制采用了模块化的设计。即整个控制软件由许多独立的小模块组成，它们之间通过软件接口连接，遵循模块内部数据关系紧凑，模块之间数据关系松散的原则，按功能形成模块化结构。

系统的软件主要由主程序模块、数据采集模块、数据处理模块、控制算法模块等组成。主模块的功能是为其余几个模块构建整体框架及初始化工作；数据采集模块的作用是将A／D转换的数字量采集并储存到存储器中；数据处理模块是将采集到的数据进行一系列的处理，其中最重要的是数字滤波程序：控制算法模块完成控制系统的PID运算并且输出控制量。

下面就介绍本系统几个主要的程序模块。

## 4.3 程序结构分析

**主程序调用了4个子程序，分别是温度传感器读取程序，数码管显示程序、键盘扫描及按键处理程序、温度信号处理程序。**

* 键盘扫描电路及按键处理程序：实现键盘的输入按键的识别及进入相应的程序。
* 温度信号处理程序：对温度芯片送过来的数据进行处理，进行判断和显示。
* 数码管显示程序：向数码的显示送数，控制系统的显示部分。




## 4.4 数据处理模块

数据处理模块负责处理A／D转换后的数字量。其中最重要的环节是数字滤波，所以这里主要讨论系统采用的数字滤波程序。

###  4.4.1 数字滤波

模拟信号都必须经过A／D转换后才能为单片机接受，如果模拟信号受到扰动影响，将使A／D转换结果偏离真实值。因此仅仅对模拟量采样一次，我们是无法确定该结果是否可信的，必须经过多次采样，得到一个A／D转换的数据序列，通过某种处理后，才能得到一个可信度较高的结果。这种从数据序列中提取逼近真值数据的软件算法，通常称为数字滤波算法。

数字滤波克服了模拟滤波器的不足，它与模拟滤波器相比具有以下几个方面的优点:  

1. 由于数字滤波是用程序实现的，因而不需要增加硬件设备，而且可以多个输入通道共用一个滤波程序
2. 由于数字滤波不需要硬件设备，因而可靠性高、稳定性好，各回路之间不存在阻抗匹配等问题
3. 数字滤波可以对频率很低(如O．01HZ)的信号实现滤波，克服了模拟滤波器的缺陷，而且通过改

变数字滤波程序，可以实现不同的滤波方法或改变滤波参数，这比改变模拟滤波器的硬件要更灵活方便。

常用的数字滤波方法有程序判断滤波法、中值滤波法、算术平均滤波法、一阶滞后滤波法、去极值平均滤波法等等，下面简要介绍这几种数字滤波方法。

1. 程序判断滤波法首先要从经验出发，定出一个目标参数最大可能的变化范围。每次采样后都和上次的有效采样值进行比较，如果变化幅度不超过经验值，本次采样有效，否则，本次采样值应视为干扰而放弃，以上次采样值为准。该算法适用于变化缓慢的物理参数的采样过程，如湿度、液位等。
2. 中值滤波法对目标参数连续进行若干次采样，然后将这些采样进行排序，选取中间位置的采样值为有效值。对于变化较为剧烈的参数，此滤波方法不宜采用。
3. 算术平均滤波法是对目标参数进行连续采样，然后求其算术平均值作为有效采样值。该算法适用于抑制随机干扰。采样次数越大，平滑效果越好，但系统的灵敏度要下降。算术平均滤波不能将明显的脉冲干扰消除，只是将其影响削弱。

## 4.5 子程序设计

设计总体程序框图如下，总体程序由主程序，按键子程序，温度获取子程序三部分组成。  
读出温度子程序的主要功能包括初始化,判断DS18B20是否存在,若存在则进行一系列的读操,作若不存在则返回。

### 4.5.1 读出温度子程序

![图4-6 程序结构图](http://my.gunplan.top/static/4.2.1.PNG)

### 4.5.2 LED数码显示管程序

![图4-6 发光二级 数码显示管程序](http://my.gunplan.top/static/4.2.2.PNG)

### 4.5.3 键盘扫描及按键处理子程序

![图4-7  键盘扫描及按键处理子程序](http://my.gunplan.top/static/4.2.3.PNG)


## 4.6 显示处理

显示处理模块主要完成人机交互作用，具体实现将采样温度值、设定温度值以字符的形式通过液晶显示出来。本系统使用HTl621作为显示驱动器。HTl621是128点内存映象和多功能驱动器。附录中给出了显示处理模块的源程序。

# 第5章 系统软件调试

## 5.1 目测

1. 有无短路处。
2. 对照电路图看有无接错、漏接处。
3. 有无虚焊处。
4. 元件是否都对

## 5.2 硬件调试

首先应进行上电前的准备。为了防止硬件的损坏，应在电路板上电前进行电路检查，包括：对芯片的焊接方向进行检查，对芯片的引脚进行短路和断路检查。

在经过检查确认芯片的焊接没有任何问题的情况下，进行上电检查，在电源打开后，先判断电路是否存在异常，如出现芯片过热等现象，应及时切断电源，检查电路故障。在上电无异常状况的前提下，可以用万用表和示波器进行测量。首先测量电源芯片的输出电压是否正常，然后用示波器分别测量各个主要芯片电源引脚，察看电源的波形情况，如有纹波，则在预先留出的位置上焊上退耦电容以消除纹波，保证芯片工作正常。电源测量完毕后，进一步用示波器测量有源晶振的输出脚，其输出是频率为8MHz的波形(非方波，类似正弦波)。在确定晶振起振后，按住复位键，使单片机始终保持在复位状态，同时测量其各个引脚的电平情况，并同数据手册上表述的复位时的芯片引脚状态进行比对，由此可判断单片机是否正常。确认单片机正常之后就可以通过仿真器连接用户板进行调试。

## 5.3 软件的调试

由于软件的编写都是根据各个模块进行的，我们在进行软件的系统模拟调试时应，先确认硬件的接口标记是否在软件程序中一一对应，而且要检测所编写的软件有没有知识性的错误。在觉得基本没有问题后我们通过电脑将程序编译进入系统核心AT89S52单片机，检验软件与硬件各部分是否协调的工作。出现问题时我们要耐心的检查程序并作出适当的修改，直到软件系统的完全契合硬件电路，那我们软件就调试成功了。

1. 测试环境
   环境温度28摄氏度，室内面积20平方米
   测试仪器：数字万用表，温度计0----100摄氏度

2. 测试方法
   使系统运行，采用温度计同时测量室内度变化情况，得出系统测量的温度。

3. 测试结果
   设定温度由0摄氏度到40摄氏度
   标定温差<=1摄氏度   调节时间  15s（具体视现场情况）
   静态误差<=0.5摄氏度   最大超调量1摄氏度

4. 通过测试分析，对于实际室内的温度控制，可以再提出以下 2 点方法 :
   Ⅰ增加传感器个数，对各个温度传感器采集的数据进行求算术平均，可得到较为准确的温度值。
   Ⅱ对实际室内的温度控制，可采用功率较大的电炉，并且通过风扇对箱内温度进行充分搅和降温设备可采用空气压缩机等制冷设备。 

5. 通过实验测试和分析，发现虽然传感器的温度采集精度最高可得到 0.06 ℃，但测试得到的数据最小间隔为 0.03 ℃ 。通过分析，当对浮点数求平均处理时，遇到同一时刻两个传感头采集的温度相差不大，使 0.06 ℃ 时求出平均温度变为 0.03 ℃ 为了解该数据是否真实，可采用一个高精度的数字温度计测试，发现读出的值与其基本一致，由此推断如果在同一时间增加采集温度的个数，则可以进一步提高温度的精度。 

    

## 5.4 注意事项

1. 测驱动电路的过程中发现数码管不能正常显示的情况，经检验发现主要是由于接触不良的问题。其中包括线的接触不良和芯片的接触不良，在实验过程中，数码管有几段时隐时现。用万用表检测发现有线接触不良，重焊后就可正常显示。而芯片接触不良用万用表欧姆档检测有几个引脚本该相通的地方却未通，其解决方法为把芯片拔出正对万能板孔均匀用力插入。
2. 由于焊接时的大意损坏了元件，在调试是我们怎么都找不到问题的所在，我们是用排除法一个一个元件的测试的找出损坏的元件，重新换上新的元件，故障得以解决。
3. 还有关于程序调试过程中出现的问题。执行程序是发现程序执行不稳定，排除软件的错误外，经老师的指导才发现单片机的EA管脚没有接地。因为次程序只用到片内程序存储器，所以在程序执行时一定要把管脚接的，这样程序才能只执行片内的，不然程序会乱跳，从而导致程序执行不稳定。
4. 接三极管的过程中，发现电路不管程序是什么，数码管都是显示8字，经查除发现原来是三极管的极端弄错了，从新调整极端顺序。
5. 在电路调试时由于我们选用的是对射型的光电传感器由于没正对好使的调试一度中断，最后我们通过反复的调试解决了问题
6. 调试时由于线路的繁杂，没有仔细的找到对应部分的线路，使的调试的结果与预期出现很大的误差，我们通过梳理线路后就调试成功了并达到了预期的效果。
7. 在调试时几个模块的电路调试都不是很好，我们就要对线路的硬件连接做仔细的检查，调试的时候我们首先要确定连接的电路没有错误，各个元件管脚间没有虚连，那样我们的调试才会更顺利。# 结束语

这个最后的项目设计对我很有帮助的。这种设计使我对在大学学习的知识有了全面的了解和深入的思考，并让我对所学的知识以及思考和编写最终设计综合游戏的能力有所了解和提升。最后，我完成了这项任务。撰写论文的过程也是学习专业知识的过程的一个重要的阶段。它使我能够使用现有的专业基础知识来设计，分析和解决理论或实践问题，并将知识转化为实践技能培训。我已经掌握了运用自己的知识来解决实际问题的能力。

通过这个最终设计的结果，我发现只有提高理论水平，才能将教科书的知识和实践结合起来，理论知识可以为教学实践服务，以提高我的实践能力。这个设计非常有意义。我有很多经验。通过这个最后的项目，我们知道了理论与实践之间的距离，将理论与实践相结合的重要性，并且我们已经学到了很多我们无法从书本中学到的知识。

我们的学习不仅应以书籍为基础的限制，而且还应以解决理论和实践中的实际问题为目标和导向，而且还应结合实践去具体分析。理论问题是实践问题，问题解决是课程研究。学生本身就是作为专家来看待。用手解决问题比用大脑解决问题更深刻。学习应要求理论与实践相结合。理论问题也是实际问题。这种方法不仅有助于完成理论知识的巩固，而且将有助于推进实践，解决实际问题，并增强我们服务和解决问题的能力。

总的来说，这个最终的设计使我学到了很多东西。这是大学的最后也是最重要的一课。它对我们的未来产生深远的影响，具有十分重要的意义。





# 参考文献

[1] 李伯成.基于MCS-51单片机的嵌入式系统设计.电子工业出版社.2004  
[2] 宗光华,李大寨.多单片机系统应用技术.国防工业出版社.2003  
[3] 胡学海.单片机原理及应用系统设计. 电子工业出版社.2005  
[4] 孙育才,王荣兴,孙华芳.ATMEL新型AT89S52系列单片机及其应用.清华大学  
   出版社.2005  
[5] 于京,张景璐.51系列单片机C程序设计与应用案例.中国电力出版社.2006  
[6] 蔡杏山.Protel 99 SE 电路设计.人民邮电出版社. 2007  
[7] 杨小川.Protel DXP 设计指导教程. 清华大学出版社.2003  
[8]  李晓荃. 单片机原理与应用[M].  电子工业出版社，2000年8月  
[9]  何立民.  AVR单片机原理与接口技术[M]. 北京航空航天大学出版社，2002  
[10]  杨帮文. 新型继电器实用手册[M]. 北京人民邮电出版社.2004  
[11] 何希才.传感器及其应用电路[M].北京:电子工业出版社,2001.131-135  
[12] 丁镇生.传感器及传感技术应用[M].北京:电子工业出版社,1998.  
[13] 王家桢.传感器与变送器[M].北京:清华大学出版社,1996.  
[14] 曾巧媛.单片机原理及应用[M].北京：电子工业出版社.2002  
[15] 何力民.单片机高级教程[M].北京：北京航空大学出版社.2000  
[16] 金发庆.传感器技术与应用[M].北京：北京机械工业出版社.2000  
[17] Katsuhiko Ogata．Moden Control Engineering．Publishing house of electronics industry，2000：1 96—202.  
[18] Microchip 24C01B/02B 8 位PIC®单片机产品手册[ED/OL].  
[19] Borko H，Bernier C L．Indexing concepts and methods .New York:Academic .
[20] Dallas products data Book[M]，1999.  
[21] Maxim products data Book[M]，2001.  
[22] Shao Jianlong, He Chun. Design of a Portable Popular Multifunctional Development System for 8051 Single-chip Microprocessor Family [J].   Computer Engineering and Applications, 2003.13.
      




# 致 谢

本课题的完成中，我得到了很多人的帮助，在此表示衷心的感谢!

首先感谢我的指导老师高老师，我的课题是在他的指导和帮助下完成的，他深厚的理论功底和严谨的治学态度以及高度的敬业精神使我受益非浅，对我课题的完成起到了至关重要的作用。
经过这次毕业设计，使我觉得不论从理论知识还是从实际操纵中都学到了不少知识，我想归纳起来，主要有以下四个方面：  

* 经过这次毕业设计，它让我接触更多平时没接触的科学仪器设备、元器件以及获得相关的仪器调试经验，同时我也发现自己在这方面很多不足之处。体会到理论知识对实践有很大的知道作用，她让我知道，只有在正确的理论指引下，才能设计出合乎实际需要的硬件电路。
* 学会了高效率的查阅资料、运用工具书、医用网络查找资料。我发现，在我们所使用的书籍上有些知识在实际应用中其实不是十分理想，各种参数都需要自己去调整。偶尔还会遇到错误的资料现象，这就要求我们应更加注重实践环节。
* 在毕业设计中，我们应当注意重点与细节的关系。
* 失败不可怕，只要不趴下，昂首向前走，希望总会有的。
* 同组同学相互包容，彼此合作，取长补短，才能铸就最后的成功。可以说这次毕业设计是对所学知识的一次运用和检阅，同时对自学能力提出很高的要求，所以平时的学习离开思考，就是严重的错误，我们学习不应该有偏科现象，各方面知识都要接触，这样做才能为毕业设计打下基石。  

最后,我要感谢的母校东北石油大学大学,为我提供的良好的学习与发展环境。感谢我的指导教师高新成给予我帮助，感谢母校开放、公正的言论环境,现代、实用的学习环境,舒适、便捷的生活环境让我顺利度过了人生的关键三年。愿所有校园里认识的,不认识的；来过的,走过的……愿你们珍惜握在手里的现在,抓住机遇,拥有一个美好的明天。





# 附录一 程序

程序如下:

```assembly
TM_NUM EQU 23H
TM_L EQU 22H
TM_H EQU 21H
DSPBUF EQU 40H
DQ BIT P2.0
FLAG BIT 00H
ORG 0000H
AJMP MAIN
ORG 000BH
AJMP __INTT0__
ORG 30H
MAIN: MOV SP,#070H
      MOV TMOD,#02H
      MOV IE,#82H
      MOV TH0,#6
      MOV TL0,#6
      MOV R2,#04
      MOV R1,#40H
 LL1: MOV @R1,#00
      INC R1
      DJNZ R2,LL1
      SETB RS0
      MOV R2,#00
      MOV R3,#00
      MOV R4,#00
      MOV R5,#00
      MOV 6FH,#00H
      CLR RS0
      CLR P3.0
      MOV 30H,#02
      MOV 31H,#06
      MOV 32H,#0
      LCALL CHEWEN
__INSTANCE__:CLR TR0
      SETB P2.1
      JB P2.1,K3
      LCALL KKEY
   K3:CLR 01H
      MOV R2,44H
      CJNE R2,#00,K2
      SJMP K7
   K2:CPL P3.0
      MOV R3,#30
   K1:LCALL TM_DISP
      DJNZ R3,K1
      DJNZ R2,K2
   K7:MOV R2,45H
      CJNE R2,#00,K4
      SJMP K6
   K4:MOV R4,#255
  K44:CPL P3.0
      MOV R3,#30
   K5:LCALL TM_DISP
      DJNZ R3,K5
      DJNZ R4,K44
      DEC R2
      CJNE R2,#00,K4
  K6: CLR P3.0
      LCALL CHEWEN
      SETB TR0
MAIN2:JB 01H, __INSTANCE__
      LCALL TM_DISP
      SJMP MAIN2
CHEWEN:CLR RS1
       CLR RS0
      LCALL GET_TM
      LCALL TM_COV
      LCALL DTOB
      LCALL DTOB1
      CLR C
      MOV A,33H
      SUBB A,44H
      MOV 44H,A
      MOV A,34H
      SUBB A,45H
      MOV 45H,A
      RET

    __INTT0__:PUSH ACC
          PUSH B
          SETB RS0
          INC R2
          CJNE R2,#100,__JT0__
          INC 6FH
    
          MOV A,6FH
          CJNE A,#20,__JT0__
          MOV 6FH,#00H
          INC R3
          MOV R2,#00H
          CJNE R3,#2,__JT0__
          SETB 01H
          MOV R3,#00
    
     __JT0__: CLR RS0
          POP B
          POP ACC
          RETI


KKEY: MOV R2,#00
      MOV R4,#0AH
 KS2: LCALL TM_DISP
      DJNZ R4,KS2
      SETB P2.1
      JB P2.1,KKEY1
      JNB P2.1,$
      MOV 60H,#DSPBUF+1
      MOV R1,#DSPBUF+1
      MOV R2,#00
KEY1: LCALL TM_DISP_2
      MOV P2,#0FFH
      MOV A,P2
      ORL A,#01
      CPL A
      JZ KEY1

KEY2: JNB ACC.1,KEY3
      JNB P2.1,$
      INC R1

      INC R2
      CJNE R2,#03,L13
      MOV R1,#DSPBUF+1
      MOV R2,#00

 L13: MOV 60H,R1
      SJMP KEY1
KEY3: JNB ACC.2,KEY4
      JNB P2.2,$
      MOV A,@R1
      CJNE R1,#41H,L1
      CJNE A,#09,LL
      SJMP KEY5
  L1: CJNE R1,#42H,L2
      MOV A,@R1
      CJNE A,#09,LL
      SJMP KEY5
  L2: CJNE R1,#43H,L3
      CJNE A,#09,LL

KEY5: MOV @R1,#00
  L3: SJMP KEY1
  LL: INC A
      MOV @R1,A
  L6: SJMP KEY1
KEY4: JNB ACC.3,KEY1
      JNB P2.3,$
      MOV 30H,41H
      MOV 31H,42H
      MOV 32H,43H
      ACALL DTOB
KKEY1:RET

     DTOB:SETB RS0
          SETB RS1
          MOV A,31H
          MOV B,#10
          MUL AB
          ADD A,32H
          MOV 33H,A
          MOV 34H,#00
          MOV R6,30H
          CJNE R6,#00,JT2
          SJMP JT22
     JT2: MOV A,33H
          ADD A,#100
          MOV 33H,A
          MOV A,34H
          ADDC A,#00
          MOV 34H,A
          DJNZ R6,JT2
     JT22:CLR RS1
          CLR RS0
          RET

  DTOB1:  SETB RS0
          SETB RS1
          MOV A,42H
          MOV B,#10
          MUL AB
          ADD A,43H
          MOV 44H,A
          MOV 45H,#00
          MOV R6,41H
          CJNE R6,#00,JJT2
          SJMP JJT22
    JJT2: MOV A,44H
          ADD A,#100
          MOV 44H,A
          MOV A,45H
          ADDC A,#00
          MOV 45H,A
          DJNZ R6,JJT2
   JJT22: CLR RS1
          CLR RS0
          RET
WR_18B20: MOV R2,#08H
         CLR C
         SETB DQ
         MOV R3,#02H
         DJNZ R3,$
         NOP
    WR1: CLR DQ
         MOV R3,#03H
         DJNZ R3,$
         RRC A
         MOV DQ,C
         MOV R3,#20
         DJNZ R3,$
         SETB DQ
         MOV R3,#03H
         DJNZ R3,$
         DJNZ R2,WR1
         SETB DQ
         RET
RD_18B20: MOV R4,#02H
          MOV R1,#22H
     RE0: MOV R2,#08H
     RE1: CLR C
          SETB DQ
          NOP
          CLR DQ
          NOP
          NOP
          SETB DQ
          MOV R3,#01H
          DJNZ R3,$
          MOV C,DQ
          MOV R3,#010H
          DJNZ R3,$
          RRC A
          DJNZ R2,RE1
          MOV @R1,A
          DEC R1
          DJNZ R4,RE0
          RET
INI_18B20: SETB DQ
           NOP
           CLR DQ
           MOV R4,#150
           DJNZ R4,$
          ;LCALL TM_DISP
          ;LCALL TM_DISP
           SETB DQ
      TS0: MOV R4,#19H
           JNB DQ,TS1
           DJNZ R4,TS0
           SJMP TS2
      TS1: SETB FLAG
           SJMP TS3
      TS2: CLR FLAG
           SJMP TS4
      TS3: ;LCALL TM_DISP
           MOV R4,#120
           DJNZ R4,$
      TS4: SETB DQ
           RET
DELAY8ms: MOV R6,#2H
      KL1: MOV R7,#80H

      KL2: DJNZ R7,KL2
          DJNZ R6,KL1
          RET

GET_TM: SETB DQ
    S1: LCALL INI_18B20
        JB FLAG,S2
        SJMP S1
    S2: MOV R4,#10H
        DJNZ R4,$
        MOV A,#0CCH
        LCALL WR_18B20
        MOV A,#44H
        LCALL WR_18B20
        MOV R4,#0ffH
    S3: LCALL TM_DISP
        DJNZ R4,S3
    S4: LCALL INI_18B20
        JB FLAG,S5
        SJMP S4
    S5: MOV A,#0CCH
        LCALL WR_18B20
        MOV A,#0BEH
        LCALL WR_18B20
        LCALL RD_18B20
        LCALL INI_18B20
        MOV R4,#10H
    S6: LCALL TM_DISP
        DJNZ R4,S6
    S7: RET
TM_COV: MOV A,#0F0H
        ANL A,TM_L
        SWAP A
        MOV TM_NUM,A
        MOV A,TM_H
        ANL A,#07H
        SWAP A
        ORL A,TM_NUM
        MOV TM_NUM,A
        MOV R0,#DSPBUF
        JNB 0FH,SING
        MOV @R0,#0BH
        CPL A
        CLR ACC.7
        ADD A,#01H
        MOV TM_NUM,A
        SJMP SING1
  SING: MOV @R0,#0AH
 SING1: MOV B,#10
        DIV AB
        INC R0
        MOV @R0,A
        INC R0
        MOV A,B
        MOV @R0,A
        INC R0
        MOV A,#00H
        JNB 13H,DOT1
        ADD A,#50
  DOT1: JNB 12H,DOT2
        ADD A,#25
  DOT2: JNB 11H,DOT3
        ADD A,#12
  DOT3: JNB 10H,DOT4
        ADD A,#6
  DOT4: MOV B,#10
        DIV AB
        MOV @R0,A
        RET
TM_DISP: CLR RS1
         CLR RS0
         MOV DPTR,#TAB
         MOV R0,#DSPBUF
         MOV B,#0FEH
         MOV R5,#04
   DIP1: MOV A,@R0
         MOV P0,#0FFH
         MOV P1,#0FFH
         MOVC A,@A+DPTR
         CJNE R5,#02,DIP2
         ANL A,#7FH
   DIP2: MOV P0,A
         MOV A,B
         MOV P1,A
         RL A
         MOV B,A
         LCALL DELAY8ms
         INC R0
         DJNZ R5,DIP1
         RET
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
TM_DISP_1: CLR RS1
         CLR RS0
         MOV DPTR,#TAB
         MOV R0,#DSPBUF
         MOV B,#0FEH
         MOV R5,#04
 DDIP4:  MOV A,R0
         MOV P0,#0FFH
         MOV P1,#0FFH
         CJNE A,60H,DDIP1
         MOV A,#0FFH
         SJMP DDIP3
  DDIP1: MOV A,@R0
         MOVC A,@A+DPTR
  DDIP3: CJNE R5,#02,DDIP2
         ANL A,#7FH
  DDIP2: MOV P0,A
         MOV A,B
         MOV P1,A
         RL A
         MOV B,A
         LCALL DELAY8ms
         INC R0
         DJNZ R5,DDIP4
         RET
 ;;;;;;;;;;;;;;;;;;;;;
 TM_DISP_2: MOV R4,#10H
  KS4: LCALL TM_DISP
      DJNZ R4,KS4
      MOV R4,#1FH
  KS5: LCALL TM_DISP_1
      DJNZ R4,KS5
      RET
TAB:
DB 0C0H,0F9H,0A4H,0B0H,99H,92H,82H,0F8H,80H,90H,0FFH,0CFH
END

```

# 附录二  硬件电路图

![图10-8 硬件电路图](http://my.gunplan.top/static/yj1.png)
# 摘 要

本设计基于基于STC89C52RC单片机的温度控制系统的工作原理和设计方法。本文介绍了控制系统的硬件部分，包括：温度检测电路，温度控制电路，显示电路。单片机处理信号线单片机对信号进行相应处理，以达到温度控制的目的。该文档还重点介绍了采用模块化结构的软件设计部分。介绍了该控制系统的硬件部分会在文中写出，包括的模块是：数字管显示程序，键盘扫描和按键处理程序，温度信号处理程序，继电器控制程序和过热报警程序。同时，还包括系统中复杂的电路设计等方式。主程序，读取温度子程序，键处理程序，LCD显示程序和数据存储程序。该控制系统可以实时存储相关的温度数据并记录当前的时间。系统程序主要包括主程序，读出温度子程序，处理轮转子程序，转换温度计算子程序、按键处理结构、LCD显示程序以及数据存储程序等。



**关键词：AT89C51，单片机 ，DS18B20温度芯片，温度控制**  



# Abstract

This design uses STC89C52RC single-chip microcomputer as the core of the working principle and design method of temperature control system. The temperature signal is collected by the temperature chip DS18B20 and transmitted to the single-chip microcomputer as a digital signal. This article introduces the hardware part of the control system, including: temperature detection circuit, temperature control circuit, display circuit. The single chip microcomputer processes the signals accordingly to achieve the purpose of temperature control. The single chip microcomputer processes the signals accordingly to achieve the purpose of temperature control. The paper also focouses on the software design part, which adopts a modular structure. The main modules are: digital tube display prog random access memory, keyboard scanning and key processing prog random access memory, temperature signal processing prog random access Memory, relay control prog, random access memory, and over-temperature alarm pr ocess. The control system can store relevant temperature data in real time and record the current time. The system prog random access memory mainly includes a main prog random access memory, a readout temperature subprog random access memory, a calculation temperature subprog random Access memory, a key processing prog random access memory, an LCD display prog random access memory, and a data storage prog random access memory.



----




# 第1章 绪 论

## 1.1 温度控制系统研究的目的和重要性

在人类历史上，环境温度起着极其重要的作用。环境温度是工业生产中最常见的工艺参数之一。每个物理变化和每个化学反应过程都与温度密切相关。因此，温度控制是生产自动化中的重要任务。随着社会的发展，科学技术的进步以及温度测量设备在各个领域的使用，智能化是现代温度控制系统发展的主要组成部分。尤其是近年来，温度控制系统已经应用于人们生活的各个方面，但是温度控制一直是一个尚未发展的领域，但这是一个与人类息息相关的世纪之久的问题。在这种实际情况下，温度控制系统的设计具有广阔的应用前景和重要性。

此结构是为室温控制系统设计的，控制对象是室温。温度控制通常用于日常生活和工业领域，例如用于冷室，洗澡池，酵母池，电源和其他地方的温度控制。过去，温度控制是手动进行的，没有给予足够的重视。实际上，在许多地方都必须很好地调节温度。鉴于此问题，此系统设计的目的是创建一个可使其自身适应设定温度的系统。它被广泛使用，功能强大，小巧美观，易于携带。这是一种实用且廉价的控制系统。

## 1.2 温度控制系统研究概况

国外对温度控制技术的研究始于1970年代。首先，使用模拟组合仪器来收集现场信息并执行指令，记录和控制。分布式控制系统出现在1980年代后期。目前正在开发用于计算机数据采集的控制系统的集成多因素控制系统。当前，温度测量和控制技术在全球不同国家中迅速发展，并且一些国家正在朝着完全自动化和无人值守的方向发展。

中国对温度测量和控制技术的研究相对较晚，始于1980年代。中国工程师和技术人员已经吸收了工业化国家对温度测量和控制技术的吸收，从而掌握了室内温度的微机控制技术。该技术仅限于控制环境中的单个温度因子。中国温度测控设备的计算机应用一般处于从消化吸收阶段，易应用阶段到实用化，全面应用阶段的过渡和发展。从技术上讲，大多数情况下都存在由单片机控制的单参数单回路系统，并且没有真正的集成多参数控制系统。与工业化国家相比，差距很大。我国温度测控的现状还远远没有达到工业化水平。生产中仍有很多困扰我们的问题。设备支持能力差，工业化程度低，环境控制落后，软件和硬件资源无法共享和可靠。缺点，例如不良性行为。

##  1.3 温度传感器技术

传感器技术是现代信息技术的主要内容之一，信息技术包括计算机技术、通信技术和传感器技术。计算机和通信技术发展极快，相当成熟，而传感器应用技术因为需要使用模拟技术，而模拟技术还有很多问题难以解决，因此传感器应用技术也有待进一步发展。为了适应现代科学技术的发展，世界总舵国家都把传感器技术列为现代的关键技术之一。通常将能把非电量转换为电量的器件称为传感器，其实质上是一种功能块，作用是将来自外界的各种信号转换成电信号。它是实现测试与自动控制系统的首要环节。如果没有传感器对原始参数进行精确可靠地测量，那么无论是信号转换或信息处理，或者最佳数据的显示和控制都将无法实现。 

温度传感器，使用范围广，数量多，居各种传感器之手。温度传感器的发展大致经历了以下三个阶段：传统的分立式温度传感器（含敏感元件），主要输能够进行非电量和电量之间的转换；模拟集成温度传感器/控制器；智能温度传感器。目前，国际上新型温度传感器正从模拟式向数字式、集成化、智能化及网络化的方向发展。温度传感器按传感器与被测介质的接触方式可分为接触式温度传感器和非接触式温度传感器两大类，其中，接触式温度传感器的测温元件与被测对象要有良好的热接触，通过热传导及对流原理达到热平衡，这个示值即为被测对象的温度。这种测温方法精度比较高，并可测量物体内部的温度分布。但对于运动的、热容量比较小的及对感温元件有腐蚀作用的对象，这种方法将会产生很大的误差。非接触测温的测温元件与被测对象互不接触。常用的是辐射热交换原理。此种测温方法的主要特点是可测量运动状态的小目标及热容量小或变化迅速的对象，也可测量温度场的温度分布，但受环境的影响比较大。 

温度传感器的发展大致可分为以下几种：  
1. 热电偶传感器。热点偶传感器是工业测量中应用最广泛的一种温度传感器，它与被测对象直接接触，不受中间介质的影响，具有较高的精度；测量范围广，可从-50℃～1600℃进行连续测量，特殊的热电偶如金,铁,镍,铬最低可测到-269℃，钨,铼最高可达2800℃。
2. 模拟集成温度传感器。采用硅半导体集成工艺制成的，因此亦称硅传感器或单片集成温度传感器。模拟集成温度传感器是在20世纪80年代问世的，它将温度传感器集成在一个芯片上、可完成温度测量及模拟信号输出等功能。模拟集成温度传感器的主要特点是：功能单一、测温误差小、价格低、响应速度快、传输距离远、体积小、微功耗等，适合远距离测温，不需要进行非线性校准，外围电路简单。
3. 光纤传感器。光纤测温技术可分为两类:全辐射测温法，单辐射测温法，双波长测温法，多波长测温法等。特点是：光纤挠性好、透光谱段宽、传输损耗低，无论是就地使用或远传均十分方便而且光纤直径小，可以单根、成束、Y型或阵列方式使用，结构布置简单且体积小。缺点是：测量起来困难,难于实现较高的精度，工艺比较复杂,且造价高，推广应用有一定困难。
4. 半导体吸收式光纤温度传感器。半导体吸收式光纤温度传感器是利用了半导体材料的吸收光谱随温度变化的特性实现的。一种传光型光纤温度传感器，是指在光纤传感系统中，光纤仅作为光波的传输通路，而利用其它如光学式或机械式的敏感元件来感受被测温度的变化。在这类传感器中，半导体吸收式光纤温度传感器是研究得比较深入的一种。
5. 智能温度传感器。智能温度传感器(亦称数字温度传感器）是在20世纪90年代中期问世的。它是微电子技术、计算机技术和自动测试技术（ATE）的结晶。目前，国际上已开发出多种智能温度传感器系列产品。智能温度传感器内部包含温度传感器、A/D传感器、信号处理器、存储器（或寄存器）和接口电路。有的产品还带多路选择器、中央控制器（中央处理单元）、随机存取存储器（随机存取存储器）和只读存储器（只读存储器）。智能温度传感器能输出温度数据及相关的温度控制量，适配各种微控制器（M中央处理单元），并且可通过软件来实现测试功能，即智能化取决于软件的开发水平。

随着科学技术的不断进步与发展，温度传感器的种类日益繁多，数字温度传感器更因适用于各种微处理器接口组成的自动温度控制系统具有可以克服模拟传感器与微处理器接口时需要信号调理电路和A/D转换器的弊端等优点，被广泛应用于工业控制、电子测温计、医疗仪器等各种温度控制系统中。其中，比较有代表性的数字温度传感器有DS18B20、MAX6575、DS1722、MAX6635等。相比较而言，传统的温度检测以热敏电阻为温度敏感元件，热敏电阻成本低，但需要后续信号处理电路，而且热敏电阻的可靠性相对较差，测量温度的准确度低，检测系统的精度差。数字式温度传感器的种类也不少，并且在实际工程设计中具有上述诸多优点。
# 第2章 系统总体方案设计

## 2.1 系统工作原理

单片机温度控制系统是以AT89C51单片机为控制核心，辅以采样反馈电路，驱动电路，晶闸管主电路对电炉炉温进行控制的微机控制系统。系统的原理框图如图2-1所示，其基本控制原理为: 用键盘将温度的设定值送入单片机，并在发光二极管显示，启动运行后，通过信号采集电路将温度信号采集到后，送入单片机系统进行PID 控制运算，将控制量输出，改变可控硅管的接通时间便可改变加热丝功率，以达到调节温度的目的控制电阻炉的加热。

当由于环境温度变化太剧烈或由于加热或降温设备出现故障，或者温度传感头出现故障导致在一段时间内不能将环境温度调整到规定的温度限内的时候，单片机通过三极管驱动扬声器发出警笛声。 

![图1-1 第一个方案](http://my.gunplan.top/static/1.0.0.PNG)

图1-1为第一个设计方案，该方案的工作原理简述如下：

1. 锯齿波是由单结晶体管BT和R1，R2，R3，W1和C1组成的张驰震荡产生，然后经射极跟随器V1、R4输出。
2.  控制电压（Uk）与锯齿波电压进行电流叠加后送到V2的基极，合成电压为Us，当Us>0（0.7）时V2导通，Us<0，则V2截止。
3.  由V2、V3以及R8、R9、DW1组成一直流开关，当V2基极电压Ube2>0(0.7)，V2导通，Ube3接近零电位，V3截止，直流开关导通。输出24V直流电压。
4.  过零脉冲的输出，由同步变压器TB，整流桥D1及R10，R11组成一削波同步电源，这个电源与直流开关的输出电压共同去控制V4与V5。只有当直流开关导通期间，V4截止，V4、V5基电极和发射极之间才有工作电压，才能工作在期间，同步电压每次过零时，V4截止，其集电极输出正电压，使V5由截止转导通，经脉冲变压器输出触发脉冲而此脉冲使晶闸管T在需要导通的时刻导通。

在直流开关导通期间使出连续的正弦波控制电压Uk的大小决定了直流开关导通时间的长短，也就决定了在设定周期内导通的周波数，从而可输出功率的调节。显然，控制电压Uk越大，则导通的周波数就越多，输出的功率也就越大，电阻炉的温度也就越高，反之，电阻炉的温度就越低。
闭环控制自动调温的基本指导思想是在系统中增设温度传感器和温度调节器，温度传感器的基本功能是检测电炉的实际温度，并变换成电压讯号和炉温控制电压Uk进行比较，根据两者差值的大小（Δe=Uk-Uft）和变化方向（即△e为正还是为负），通过调节器进行相反方向的调节，使调节器的输出控制直流开关导通时间的长短，从而使设定周期内晶闸管的导通周波数增大或者减小，相应的电炉温度升高一点或者减小一点。采取这种控制方式，可以使炉温在较小的范围内变化，控制精度高。
方案二：为了使得电路的简单化，采用单片机作为控制核心来设计本课题，温度信号采集使用温度传感器DS18B20，温度控制的基本思想为：通过采集到的温度与标准温度之间的差值来控制加热电阻丝的通电时间长短，从而起到恒温控制的目的。方案二的设计框图如下图所示：

![图1-2](http://my.gunplan.top/static/1.0.0.PNG)

本方案采用单片机作为控制核心，使用温度传感器进行温度采集，通过将采集到的温度与标准设定温度之间的差值进行温度控制，从而使得温度维持在标准设定温度。本方案设计成本低，具有具有较高的可靠性，对于系统动态性能与稳定要求不是很高的场合非常的合适。

单片机温度控制系统是以AT89C51单片机为控制核心，辅以采样反馈电路，驱动电路，晶闸管主电路对电炉炉温进行控制的微机控制系统。系统的原理框图如图2-1所示，其基本控制原理为: 用键盘将温度的设定值送入单片机，并在LED显示，启动运行后，通过信号采集电路将温度信号采集到后，送入单片机系统进行PID 控制运算，将控制量输出，改变可控硅管的接通时间便可改变加热丝功率，以达到调节温度的目的控制电阻炉的加热。

当由于环境温度变化太剧烈或由于加热或降温设备出现故障，或者温度传感头出现故障导致在一段时间内不能将环境温度调整到规定的温度限内的时候，单片机通过三极管驱动扬声器发出警笛声。

## 2.2 系统功能介绍

本设计是对房间温度进行检测与控制，设计的温度控制系统实现了基本的温度控制功能：当温度低于设定的温度时，系统自动通过PWM启动加热装置，使温度上升。当温度高于设定的温度时，停止加热。三位数码管及时显示温度，精确到小数点后一位。  
本文设计的温度控制系统具有如下功能：

1. 通过温度芯片DS18B20采集温度，并以数字信号的方式传送给单片机。
2. 四位数码管动态实时显示房间温度，显示精度0.10C。
3. 三个按键实现标准温度的设定。
4. 利用PWM实现温度的控制。



# 第3章系统硬件电路设计

![图3-1电路硬件图](http://my.gunplan.top/static/2.0.1.png)

该解决方案使用AT89C51为核心处理芯片，芯片DS18B20测量内部温度，通过发送信号传输总线到MCU，并且和一个4位LED显示管温度。偏差用于控制电阻丝导通/截止时间的长度。实现恒温控制的界面的最终想法是最终想法。

## 3.1 各模块设计

### 3.1.1 温度传感器电路

本文在课题教学研究中所采用的的温度传感器一般可以分为采用一个美国两个单线的四位数字小型环境温度传感器例如ds18b20。该稳压传感器4.7k##hz该传感器用于输出稳压信号的上和下拉稳压电阻直接通过连接输入到一个微控制器的一个p1.0引脚。

半导体温度传感器DS18B20产生Dalalas数字温度传感器，多并行总线技术。该器件在小型集成电路芯片上制造温度敏感的半导体器件、 A / D 转换器、存储器等。在对本设计中的温度传感器进行多次比较和考虑之后，选择了单线数字设备DS18B20，主要是由于以下原因：

1. 该检测系统的主要特点功能是：在一个允许温度范围的工作检测温度是-55℃〜+125℃，±0.5度的工作温度和在测量值的精度是5℃。温度函数转换器高精度。9至12变量，温度检测值数据可以被直接转换成一个串行16位的非二进制的或数字输出形式的数据输出;最大输入时间频率转变精度为12位测量精度转变为750ms;它们都可以通过一条数据线被直接供电，具有超低电源功耗。
2. 系统进行成本：由于我国计算机信息技术和微电子科学技术的发展，新型企业大规模集成电路设计越来越具有强大，体积变得小是越来越会发生的，价格也会下跌。DS18B20提交空间与普通晶体管之间几乎没有本质区别的，价格只有约$1。
3. 降低系统总线技术操作复杂度：由于设备ds18b20是单总线测量设备，微处理器与之进行接口时只不过需要至少占用在校学生一个模拟i/o口，一根模拟总线测量方式线就可以同时连接数十个设备ds18b20，温度管理进行总线测量方法完全无需任何模拟企业外部网络控制元件，因此，与传统模拟工业生物温度传感器中的网络系统相比，可以测量得到大大幅度增加以及减少系统布线调试次数，降低温度管理系统的技术复杂性，减少重大工程项目的基础建设工作量。
4. 减少系统的引线调试和日常维护：由于大量减少的系统引线数量可以不会引起一些小的事情，大量使用减少接线的工程数量，减少接线工程数量产生的引线施工成本量大大降低，系统的内部布线过程复杂度的降低调试和日常维护另一方面，因为系统引线接口数量的减少产生的故障数量大大下降，使得整个系统中的接口工作变得简单许多，给系统的日常调试工作带来更多方便，之所以认为dsl8820是全方位数字化的元器件，故障基本不会同时发生，干扰性的和可抗性强，因此为了让整个系统的在整个日常生活中而所进行需要保证正常工作的维护任务大大减少，为了更好保证系统可用性而所进行的日常维护相关工作保证正常系统运行的维护工作。

ds18b20温度控制系统传感器引线技术通常存在一个小的引线，引线上的数量通常是3，并且我们可以确定不在一个企业内部：一个单线程的数据网络信息传输包括系统总线数据端口vvdq、外部数据电源线vdd和公共网络地址总线端口gnd。ds18b20有2种直流供电的工作方法：其一种就是采用杜邦线的直流供电电压模式。此时，vdd被完全接地。当它开始产生能量空闲时，它通过内部一个电容器线路来让它存储剩余电量用从外部数据线路中获得剩余能量并用来让它完成整个温度功率转换，相应的当它完成整个温度功率转换的持续时间也会更长。在这种应用情况下，使用一个单片机的一个矩形i/o输出端口让它来自动拉起一个ds18b20总线。另一种模式是外部温度电源连接模式(vdd电源连接+5v)，完成外部温度变化测量的时候相应操作时间短。

在本设计项目中我也可以直接采用由大学生企业提供的并不在相关企业内部的各种电子信息流的流动强度及其发展计算方式等来进行设计实现。cds18b20传感器与驱动单片机的接口连接，其内部接口集成电路设计方案如软件图2-2所示。

![图2-2外部电路](http://my.gunplan.top/static/003.jpg)

### 3.1.2 通用键盘显示电路设计

![图2-3外部电路](http://my.gunplan.top/static/003.jpg)

所示，ale时钟脉冲可以作为一个时钟同步电路8279，从而与示意图的两个时钟脉冲同步。2-3。8279芯片的控制中断电路控制输出信号irqr连接到一个控制单片机的一个p1-1引脚。缓冲器输入地址是将寄存器中的a0连接输入到整个单片机的一个p2-5引脚，ae的缓冲信号则是连接到整个单片机的一个p2-6引脚。读写器和信号数据线缆分别和两个单片机的信号读写器和信号数据线缆来进行连接相连。8279芯片的外部数据传递运输线路由d0-d7与整个单片机的外部数据线直接相连进行相应的连接。

来自8279芯片和AT89C51芯片的许多信号是一致的，可以直接级联，这非常容易控制。8279芯片的8位数据线进行直接连接到AT89C51芯片的P0端口。读取和写入信号连接到89C51的读取和写入信号。 AT89C51锁存信号ALE连接到8279 CLK，在内部分频后，会产生一个公共的非外部时钟脉冲。8279芯片的端子请求信号由反相器反转，然后连接到AT89C51的P1.1端口。 AT89C51的三个可寻址寄存器只需要两个地址即可寻址，即命令/状态寄存器地址和数据寄存器的地址值。8279芯片中与地址相关的信号是A0和芯片选择信号。您的连接直接确定寄存器地址在哪里。一旦确定了硬件电路，就确定了寄存器的地址。

发光驱动二极管的色号发光驱动效率和显示颜色分别取决于每个制造商的材料，如果出现没有什么意外情况是可以使用egred色号，出现其他意外情况可以使用reyellow或是egreen色号。发光电子二极管又称发光电子二极管主要是利用智能电子技术通过测量管理系统控制测量仪表中简单而常用的进入输出一个控制装置，通常说它可以直接用于用来指示一个机器的工作状态或其他相关企业服务信息。具有系统功耗低、配置灵活、接口方便、价格低廉、使用寿命长、对各种电子管直流的流动强度和电势差异性要求低、易于手动实现连接多种电路等多大优点。

液晶电视显示器本身是被动电子显示器，它本身不向外调节发出一种具有一定粒子性的主动电磁波，只需向外调节其发出一种具有一定粒子性的被动电磁波的频率数量。目前，常用的彩色液晶信息显示器通常是根据中国的而液晶对于信息显示失真率的问题总是按克列拉斯效应的基本原理设计制成的，它通常可以通过同时获得一个位于黑色信息发展初始背景上的一个白色初始字符或一个白色初始背景上的一个黑色初始字符的方式显示不同信息形式。便携式检测仪器主要用于电力测量和分析控制和检测智能动力电池中的电力，考虑到低损耗功率的应用要求，经常我们需要同时使用的就是液晶电视显示器，重量轻，功耗低的而且体积小，因此，广泛作为采用的检测手段。但是必须需要借助外来的灯光进行显示。阴极红外射线图形显像管这种显示器虽然可以同时显示多种图形，但显示界面更复杂，成本更高。

在多路显示温度自动巡检仪中只要您需要同时显示4位的和数字两种形式的显示温度和检测路数，可以不必考虑使用某种价格较高的荧光阴极或红射线液晶显像管;4位数字发光光电二极管的实际工作频率电子在直流的波动强度一般为240ma左右，由于需要使用一个交流电源进行供电，足以完全提供四位发光光电二极管液晶显示器所使用需要的最大功率，对于四位发光光电二极管而言，仅有4位，体积也很小，这样比较符合发光光电二极管和四位液晶电视显示器的诸多性能特点，本检测系统建议选择四位发光光电二极管液晶显示器。

键盘设计是一组多按键的整体组合。其主要工作功能之一是实时控制操作系统的正常工作运行状态，向系统接口输入大量数据和发出命令。有两种键盘类型：标准编码数字键盘和非标准编码数字键盘。

除了单个按键之外，编码器的键盘系统还包括一个用于自动生成键码的多个硬件控制电路、抖动控制电路、多个击键和多个按键之间移动时的保护器等电路。每按一个数字键，就表示可以自动重新生成这个数字键的键码。同时还会产生一个脉冲控制信号，通知系统中央处理控制单元进行接收。这种单片键盘使用方便，接口使用程序简单，但由于需要使用更多的相关硬件集成电路，价格也会变得更高，一般来说单片机键盘应用在该系统中的应用不是非常多。

非按列编码数字键盘仅由按行矩阵排列和非按列排行矩阵两种形式的编码键盘所组成。按键的抖动作用主要是简单地停止连接或自动断开触点，按键的触点抖动、按键软件代码的自动形成和每个按键的自动识别都必须是由按键软件操作来自动完成的。由于其价格经济并且实用，在各种单片机硬件应用管理系统中已经得到广泛应用。

上述一系列比较之后，它应该是非编码键盘。

P0端口： P0端口为8位漏极级开路双向 I/O 端口，每个引脚可吸收8TTL 栅极电子流的强度。当端口 P1的引脚首次写入1时，它被定义为高阻输入。P0可用于非内部程序数据存储器，可以定义为数据/地址的第八位。在 FIASH 编程中，P0作为原始代码输入端口。检查 FIASH 时，P0输出原始代码，必须拉起 P0的外部。

端口设置p1：端口设置p1是一个8位双向模拟i/o输出端口，内部分别提供上或下拉输出电阻。端口强度p1缓冲区强度可以达到接收进入输出4ttl门口的电子负载流的最大强度。p1端口的写入管脚板在写入1后，内部拉高，可以直接作为数据输入。当一个端口上的p1从外部被下拉到低稳压电平时，它将达到输出一个电子到直流的最大强度，这可能是由于内部上压下拉。在执行可以被擦除的非读写数据存储器程序编程和数据验证程序过程中，p1端口通常作为第8个输入地址被程序接收。

p2端口：p2端口是它是一个内部上和下拉稳压电阻的8位双向模拟i/o端口。p2端口栅极缓冲器引脚可以用来接收和控制输出4个ttttl栅极缓冲电子的直流的缓冲强度，当一个端口缓冲p2被直接写入"1"时，其引脚被内部上和下拉栅极电阻拉高并可以用作缓冲输入。因此，当它被直接用作电流输入时，端口位于p2的引脚被外部电压拉低到位于输出端的电子负载流的最大强度。这可能是由于内部上下牵拉的原因缘故。当p2端口，用于外部执行程序数据存储器或外部程序数据处理存储器同时访问的16位数据地址，输出时的端口相当p28的8位地址。读出和存储写入外部输出数据时在存储器输入地址8时，p2端口作为输出数据内容在特殊寄存功能下的寄存器。p2端口在整个闪存硬件编程和数据验证系统工作期间使它可以同时接收高八位存储地址以及存储信号和闪存控制器在系统中的信号。

p3端口：p3端口引脚为8个双向直流i/o控制端口，带有内部上压下拉控制电阻，可同时接收和控制输出4个在tttl栅极上的电子到直流的最大强度。当两个p3端口开始写入"1"时，它们在内部被迅速拉升并达到高水平并且被用作信号输入。作为一个输入，由于外部下拉低，p3端口将由于上下下拉而达到输出一个电子负载流的最大强度(ill)。

p3端口如果可以使用作为at89c51的一些特殊控制功能的通用接口也是完全可以的，如下面列表所示：

管脚备选功能

：-：：-：

P3.0 RXD (串行输入)

P3.1 TXD (串行输出)

P3.2/INT0(外部中断0)

P3.3/INT1(外部中断1)

P3.4 T0(定时器0外部输入)

p3.5t1(外部微波信号定时器1外部微波信号发出输入)

P3.6/WR (外部数据存储器写门)

P3.7/RD (外部数据存储器读取频闪)

p3端口同时它也可以用来接收一些主要的可用于总线进行射频闪烁信号编程和射频编程性能验证的射频控制电路信号。

rst：振荡器的复位字节输入。当外部振荡微处理器重置为一个器件时，在两个机器工作周期内保持一个rst引脚的高电平。ale/prog：当振荡器访问一个企业外部的数据网络存储器时，使用网络地址锁存器引脚所允许的外部输出正脉冲信号的高电平来对锁存网络地址的位置和状态进行复位字节。此引脚主要用于在振荡器的闪存脉冲编程期间通过脉冲输入用于闪存编程的脉冲。在通常的，周期性脉冲输出的ale正脉冲信号的恒定脉冲频率大约为1/6振荡器的频率。因此，它们实际上可以跳过一个用作外部脉冲输出的周期性脉冲或跳过一个用于定时目的。但是应该注意的是每一次都需要指出的一点是，外部的数据存储器，这将被用于跳过一个新的ale脉冲。如果振荡器需要禁用一个alert的复位字节输出，可以在振荡器的sfr8eh地址上重新设置0。此时，ale只需要执行一个movr，movd指令为一个新的ale。另外，该引脚被略微拉高。如果外部微处理器在外部脉冲执行的状态ale禁止，则该引脚的设置无效。

psen：外部的应用程序例如数据包和存储器的编程代码包含指令集的选择和数据通门控制信号。在外部软件程序执行的指令代码流在提取中的指令外部程序中的数据流在存储器系统中的每个代码提取指令值在提取期间，每个外部程序机器执行周期有效两次/psen。但是，访问外部应用程序例如数据库和存储器时，这两个有效的/psen的控制信号通常可能不会同时一起出现。

ea/vpp：这是用于保证当/ea端口器继续工作保持低稳压电位，这期间的外部应用程序相同存储器(0000h-ffffh)，无论它的存储器类型是否与内部的应用程序相同存储器。需要特别注意，当外部应用程序开始使用加密的文件方法1时，/ea中的存储器端口会自动锁定内部以用于防止文件重置;同时当/ea端口的继续运行保持正常的最高位时，这里的内部应用程序没有内存。该引脚还同时可以作为用于在不对闪存进行编程期间用于应用12v值的闪存进行编程的备用电源(vpp)。

xtal1：反向控制电路主要用来进行控制振荡信号放大器的时钟输入和内部时钟输出是用来进行控制系统的内部时钟质量管理工作以及辅助系统控制反向电路的外部驱动控制器的输入。

XTAL2：来自反向振荡器的输出。

### 3.1.3 振荡器特性

xtal1和外部xtal2分别提供的是片内反相放大器的脉冲信号输入和振荡器输出。该系列反向放大器的设备可以直接配置为片内的振荡器。石晶振荡和陶瓷振荡均可广泛采用。如果放大器使用外部的时钟源脉冲驱动的设备，则放大器不应需要连接xtal2。对内部的时钟源脉冲信号的多余脉冲输入信号需要通过两频的分频脉冲触发，因此放大器对外部时钟源脉冲信号的所需脉冲的宽度没有严格的要求，但是必须注意保证时钟源脉冲的频率高低和电平的所需脉冲宽度。

### 3.1.4 芯片擦除

通过快速组合正确的两个锁定保存位芯片控制电阻信号并同时将它保持在比ale引脚低10ms，可以轻松快速完成整个程序pe-rom两个芯片控制阵列和三个用于锁定保存位的两个芯片控制电阻被擦除。在重复执行一个芯片用于锁定内存位置的电擦删删除的每个操作中，代码中的数据元组被允许重复执行写入"1"，并且必须在执行芯片锁存重复执行写入一个可编程非零时空函数存储器的字节之前，它才能重复执行此位电擦除后的操作。

此外，at89c51配备了固定的逻辑，可以从低频动态到零的频率静态，支持两种软件模式和可选的自动关机中断模式。系统在空闲时中央控制单元软件自动停止振荡器的工作。然而，随机存取的存储器，定时器，计数器，串行接口和振荡器中断系统继续保持正常工作。在这种关机中断模式下，将自动保存随机存取存储器的所有内容，并自动冻结振荡器，并自动停用所需要使用的其他硬件和芯片振荡器的功能，直到振荡器下一次所使用的硬件振荡器复位完成为止。

许多尚不了解51单片机的互联网用户会遇到以下问题：书籍和在线教程中的AT89S51是什么?8051、89C51等，但没听说过89S51。

在这里，剛刚刚入門的单片机新人应该先阐明一下单片机实际使用的一些产品和理念。mcs-51微控制器单片机是基于美国英特公司于1980年推出的一款单片机产品。其典型的产品理念为8031(芯片无内置的程序和存储器，实际的使用已从单片机市场上完全淘汰)，8051(通用芯片设计采用hmos，功耗为630mw，是89c51的5倍)日期根据实际的使用)。但是到目前为止，8751和其他的通用芯片产品仍然可能是完全兼容的，包括mcs-51核心处理器系列和微控制器(目前已全部停产89s51、89c51等)。在加州理工大学和计算机职业技术学校的单片机培训课程和文档中，mcs-51微控制器仍然可以用作基础理论和学习的一个重要代表。

在一些技术文档中，8051甚至被广泛称为是mcs-51系列中的mcu。8051是早期最典型的单片机代表。由于对mcs-51单片机的深刻历史意义，许多微控制器公司都推出了许多兼容这一系列的单片机，这也就意味着他们的内核确实已经存在于mcs-51。它已经成为8位微控制器的一个标准。

其他飞利浦公司的51mcu产品与51mcs-51核心处理器兼容。相同的微控制器程序，在每个飞利浦微控制器设计制造商的产品和硬件上所需要执行的程序和结果可能是相同的，例如，我们常说的89c51，如飞利浦的at89c51(已宣布停产)，89s51，飞利浦(简称飞利浦)和l公司的winbond(winbond)等。已停产的微控制器是飞利浦atmel公司的单片机和at89c51单片机。同时，许多微控制器功能在原始的基础上已经得到了很大的改进，例如b.时钟。闪存越好(程序中只读存储器的所有内容至少一次可以反复重写1000次)。对于只读存储器(一次只能写入)，at89c51的存储器性能远远地要优于8051。

关于目前的市场营销，pic单片机制造商阵营对89c51提出了强烈的质疑。89c51最严重的问题是存在技术缺陷之一就是添加更多isp(在线更新应用程序)的功能目前是不被认为能夠广泛使用的。因此需要通过添加更多isp功能等新功能之后才能在市场上继续使用。mcs-51图例。在这种的情况下，89s51取代了89c51。目前，89s51依然已经变成了单片机市场中大多数人民的选择之中的一个绝大部分。目前市场份额最大的atmel已经宣布停止了生产新的at89c51，将其产品改用全新的at89s51。89s51进行了一系列技术上的改进。89s51采用全新的0.35标注，可有效控制单片机制造基本的成本，改善产品功能，增强市场竞争力。89sxx可以成为兼容89cxx等51系列单片机的芯片。同时，atmel不再需要接受89c的大量订单。你在目前市场上所能看到的89c51实际上已经是atmel以前停止生产的大量库存。

## 3.2 AT89C51单片机简介

at89c51是一个os8-bit微处理器(fpeam只读存储器-flashprog随机存取只读存储器fpram和一个可自动擦除随机存取只读数据的存储器)，俗称嵌入式微控制器。该设计原件是采用基于atmel的高密度非易失性只读存储器的制造技术设计制造，与符合行业标准的atmcs-51指令集与输出引脚指令集是兼容的并可以一直连接到。由于多功能8位中央处理器和闪存指令集结合在一个独立的单芯片中，atmel的at89c51是一个高效的嵌入式微控制器，它为许多的嵌入式控制系统应用提供了一个灵活和廉价的解决方案。

![3-8硬件电路图](http://my.gunplan.top/static/3.2.png)

at89c51可由一个atmel公司的控制器在线进行编程，用于嵌入式温度数据采集和嵌入式数据通信。at89c51是一款低成本功耗、高性能的cmos8位嵌入式单片机，其中主要包含了可通过重复自动擦除1000次的闪存和具有8k字节的isp(指令系统内的prog随机存取程序和存储器matlable)的嵌入式闪存只读程序和存储器，该芯片元器件主要采用了基于atmel的一种高密度、非易失性的嵌入式存储技术设计制造，兼容了标准的mcs-53指令系统和80c51引脚的结构。该系列芯片元器件集成了一个通用的8位中央处理器和一个isp的嵌入式闪存存储单元，功能强大的微型嵌入式计算机的at89c51可以为许多嵌入式控制和管理系统的应用和分析指令系统的发展历程提供一些具有降低生产成本和经济效益的解决问题的方案。at89c51具有以下的特点：40针、4k字节闪存片上应用程序数据存储器、128字节随机存取应用程序数据存储器(随机存取数据存储器)、32个外部双向数据输入/外部输出(i/o)串行通信端口，5个串行中断优先级，2个串行中断优先级嵌套中断，2个16位的可编程定时计数器，2个全双工串行通信控制端口，watchdog(wdt)控制电路，片上时钟振荡器。

at89c51有三个并行的i/o口，p0：p0.0~p0.7，p1.0~p1.7，p2.0~p2.7。此外，当没有片上或外部存储器时，p0端口可以用作公共i/o的端口，当主机使用外部或片上存储器时，p0端口也可以直接用作地址数据线/端口或数据线。p1端口也可以直接作为一个通用的公共i/o端口，p1.0、p1.1、p1.5~p1.7也可以具有特殊的端口功能，如表3.4所示。当主机没有片外存储器时，p2端口可以直接用作公共的i/o端口，当主机使用外部存储器时，p2端口也可以直接用作高8位地址。

|引脚特殊功能

：-：：-：

P1.0 T2：定时器

P1.1 T2EX：定时器

P1.5 MOSI：用于在线编程(ISP)

P1.6 MOSI：用于在线编程(ISP)

P1.7 SCK：用于在线编程(ISP)

表3.4at89c51p1端口的特殊控制功能

引脚特殊功能

：-：：-：

P3.0 RXD (串行端口输入)

P3.1 TXD (串行端口输入)

P3.2 INT0(外部中断输入0)

P3.3 INT1(外部中断输入1)

P3.4 T0(定时器0外部输入)

p3.5t1(外部定时器1外部定时信号发出输入)

P3.6 WR (外部数据存储器写控制)

p3.7rd(外部的数据存储器对外部读取和控制)

表3.5 AT89C51 P3端口的特殊功能

这个房间的温度监控系统主要使用单片机进行通讯和温度检测。 P3.0接受DS18B20。 P0端口用于设计温度显示界面。微控制器和控制电路共享一个外部时钟，使用一个片上存储器并具有上电复位功能。单片机的最小系统如图3.2.1所示：

[图3.2.1 SCM 最小系系统(http：//my.gunplan.top/static/3.2.1.png)

## 3.3 8279芯片简介

### 3.3.1 引脚介绍

8279采用单5V电源供电，40脚封装。

DB0~DB7：双向数据总线，用来传送8279与中央处理单元之间的数据和命令。

clk：时钟的输入数据线，用于时钟产生的具有内部定时的时钟脉冲。

复位：复位输入线，复位后8279设置在字符显示的左输入端，两个按键锁定的设置为接触回弹式，程序需要将时钟输入线的预分频器信号设置为31，并且保证复位后的信号在高电平下有效。

CS：芯片选择输入线，低电平有效，CS 端低电平时单片机可读写8279

A0：缓冲区低地址。当 A0为高电平时，表示数据总线是命令或状态。当 A0低时，表示数据总线是数据总线。

研发：通过读取控制器将信号发送到输入数据总线，低电平有效，读出数据缓冲区，并将内部数据发送到外部数据总线。

WR：写信号输入线，低电平激活，读出缓冲器并将数据从外部数据总线写入8279的缓冲器。

RL2-140-VCCRL3-239-RL 1

CLK-338-RL 0

IRQ-437-CNTL/STB

RL4-536-SHIFT

RL5-635-SL 3

RL6-734-SL 2

RL7-833-SL 1

RESRT-932-SL 0

RD-1031-OUT B0

WR-1130-OUT B1

DB0-1229-OUT B2

DB1-1328-OUT B3

DB2-1427-OUT A0

DB3-1526-OUT A1

DB4-1625-OUT A2

DB5-1724-OUT A3

DB6-1823-BD

DB7-1922-CS

VSS-2021-A0

irq：中断请求的正确输出和执行，高级有效。在这种键盘自动中断工作模式下，当每次出现的从fifo/sensor随机存取的在该存储器中间没有任何数据时，中间的断线由一个低电平线转变为一个新的高电平，每次键盘中断时由从fifo/sensor随机存取的该存储器的所有数据被自动读出，断开的检测线路降至较低的水平。如果随机存取的存储器中仍然存有信息，该行将再次变为一个较高水平。在线路和传感器正常工作的模式下，每当随机检测到线路和传感器的信号发生变化时，中断线就可能会逐渐变高。

sl0~sl3：视频扫描线缆可用于实时连接和自动扫描任何按键或光开关、传感器或光阵列和触摸显示器或屏幕上的任何数字，可编程或支持视频可编解码。

rl0~rl7：按键返回扫描线通过按钮或传感器的开关与返回扫描线进行连接。上拉按压电路一般设置在相应的返回扫描线内部，以使返回线保持在高水平。只有当一次按压电路关闭时，相应的按键和返回线才会自动转变为一个低电平;当一次无按键闭合时，均保持在较高电平。

shift：这是换位驱动开关的主要功能。当一个换档电压开关自动闭合时，它被一个换位电压开关自动拉至较低的相位电压电流水平。同时在每当未按时接下一个好的换档电压开关时，换档电压开关的整个输入电压状态必须保持在一个好的高电平。在正常的自动键盘扫描模式下，按键自动关闭，按键的操作位置和自动换位键的开关和所输入的操作状态一起由自动键盘扫描存储。

cntl/stb：自动高电平电源关闭当用户打开一个cntl/stb的电源开关时，它将自动将其拉低，否则将始终无法保持一个好的高电平。对于所有使用鼠标键盘输入的操作模式，该行通常被用作选择控制输入。例如当用户按下按钮时，按钮的数据位置与所有控制输入状态的数据存储在一起的数据位置相同。在选通控制输入的模式下，通常需要选择它，并将按钮的数据位置存储在一个fifo随机存取的存储器中。

outa3〜outa0和一个outb3〜outb0：显示数据输出一个8位端口a和一个8位端口b。这两个端口之间既可以独立进行控制，也是一个可以单独视为8位的端口。

bd：使用数字数据空间的长度显示。此命令输出的一个信号结果可以直接用于在一个两位数字的字符转换期间进行显示一个空格，或者你也可以通过使用"显示空格"的一个命令行来控制一个信号在显示空格一个字符的转换空间进行显示。

VCC：+5V电源输入线。

VSS：地线输入线。

### 3.3.2 8279的编程方法

8279按其控制功能块的大小可以细分为：显示器和键盘控制功能块;工作和显示控制功能块;工作和控制处理器功能块;键盘控制接口和中央处理器功能块控制功能块主要包含手动控制和时间寄存器，定时和自动控制，扫描和计数器三个组成部分，它主要的功能是用于控制显示器和键盘的工作和显示控制功能块。

控制和时间数据寄存器：一种用于存储键盘和中央控制单元的通用编程语言控制命令。当8279中央处理器的程序人员确定了键盘和显示器的工作状态模式以及其他显示器工作的条件时，首先将命令键和控制数据放置在一个数据总线上，然后使用命令a0=1，wr=0cs=0并将所有的命令和键数据保存在wr沿边缘增加了控制和显示器的时间数据寄存器，并对其进行解码以方便创建适当的命令控制功能。

定时和计数器控制：它通常包含一个基本的键盘定时和计数器。第一个定时计数器控制是一个分频系数范围为2-31的预定时器。我们可以通过应用程序控制其预设的分频系数，以使内部的频率为100khz，这样的频率可能至少会导致5.1ms。包括键盘阵列扫描时间和10.3毫秒的反跳扫描时间。其他的计数器对该基本的频率扫描时间进行了划分，并为我们提供适当的键，行，键盘阵列扫描和显示键盘扫描时间。

扫描键盘计数器：用于扫描键盘的计数器主要有两种基本编码工作的模式。在基本编码计数器工作的模式下，计数器为键盘提供一个二进制的计数器。在外部软件输出引脚sl0-sl3之后，可以为用于扫描键盘的计数器提供二进制的扫描计数器功能，并在外部软件解码后进行显示。在此工作模式下，扫描键盘计数器对最低有效值的两位进行解码，并且输出引脚sl0-sl3输出1分之4的二进制解码信号，以对键盘的显示器和用于扫描键盘的二进制扫描计数器进行解码。

键盘功能块包括：返回缓冲区、键盘弹跳和控制、8x8 FIFO 传感器随机存取存储器、 FIFO/传感器随机存取存储器状态。

#### 返回抖动缓冲器与鼠标键盘的抖动反向起跳及抖动控制

八个返回行由返回缓冲区缓冲。在键盘工作模式下，逐个检测这些行，找出行键中已关闭的键。如果回弹电路检测到钥匙关闭，则等待10.3ms，然后记录钥匙是否仍然关闭。如果仍然关闭，则矩阵中 key 的行地址和列地址以及 SHIFT 和 CNTL 的状态一起发送到 FIFO 随机存取存储器，并且 FIFO 随机存取存储器中的数据格式如下：

D7 D6 D5 D4 D3 D2 D1 D0

CNTL SHIFT SCAN RET URN

数据的进行格式中，最高位为shicntl，次高位为shift状态，d5-d3来自不同的扫描线上电子的计数器，d2-d0来自中国传感器返回一个电子计数器，扫描线电子计数器和一个回扫线电子计数器的开关值分别可以直接反映正在输出被传感器按下开关键的行，列的开关值，如果在一个传感器的阵列中，返回行上的开关数据直接进入与正在输出被扫描的传感器阵列相对应的一个传感器随机存取电子存储器阵列中的行，这样，每个传感器开关的数量和位置直接被传感器反映为一个传感器随机存取电子存储器的开关位置。

#### FIFO/传感器随机存取存储器

8x8随机存取存储器是键盘模式和选通模式下的先进先出(FIFO)存储器。每条新的信息都是按顺序写的，然后按照写的顺序读出来。当传感器阵列扫描时，存储器被用作传感器随机存取存储器。此时，随机存取存储器中的每一行存储传感器阵列中相应行的状态。

#### FIF0/传感器随机存取存储器状态

在使用键盘或门控的错误模式下，fifo中的状态阵列跟踪信号表示fifo中的状态字符数注意它到底是"满"还是"空"，过多的传感器写入或读取被状态逻辑认为可能是错误，当传感器fifo不为空时，状态阵列跟踪逻辑就会提供一个用于中断传感器应用程序irq的信号。在特殊的传感器状态阵列扫描模式下，如果一个有效的传感器状态发生改变，irq信号可能是一个有效的传感器高电平。fifo表示状态字的低3位表示fifo模式中的传感器字符数，fu位表示一个fifo随机存取的存储器已满;o(超过donmn)du位表示超限错误，即传感器试图将另一个传感器的字符发送到完整的传感器fifo;u(done下)du位表示null错误，即传感器试图写入或读取空的传感器fifo。s/f有两种的含义：在特殊的传感器扫描模式下，s/f的含义是指一个传感器随机存取的存储器中至少可能包含一个指示传感器是否闭合的指示，在特殊的错误模式下，s/f位是一个传感器错误的标志，指示了是否传感器发生了多通道同时写入或关闭的错误，du位表示错误显示随机存取的存储器尚未完全可用，因为"清除显示"或"清除全部"的命令已经无法完成其他未被消除的操作。

显示随机寄存器块的功能块主要包括：16x8显示随机寄存器，16x8显示随机存取地址存储器，显示随机地址存取寄存器)

#### 显示随机存取存储器和显示寄存器

8279内部缓存显示器同样具有16x8的缓存形式自动显示随机存取的数据存储器，通过自动显示一个寄存器和两个四位端口0uta0-3，0utbo-3来自动显示刷新外部存储器的数据显示，显示器同样可以是使用的大都是8段数码管或者是白炽灯，也可以有外部显示器同样可以是使用的大都是8段管或数码管，显示随机存取的数据存储器也同样可以是使用的大都是16x8的形式显示缓存形式，也就是可以直接构成两个16x4的随机存取数据存储器的形式，显示随机存取的存储器字节可由中央处理单元存储器进行数据的读写，被处理单元读写的随机存取的存储器字节的读写地址由随机显示读写地址的寄存器进行指示.数据显示[地址寄存器保存当前中央处理单元存储器的读或写随机取出的存储器字节读写地址，以及正在随机显示着的那两个4位半字节的存储器地址，读写的地址由当前中央处理单元的命令[存储器编程]，也就是可以设置为每次处理单元读写后存储器地址自动加1的一种工作更新方式，在处理单元设置了正确的存储器工作更新方式后，显示随机存取存储器的数据也可由中央处理单元存储器读出，半字节存储器a和半字节b的存储器地址自动由8279更新，以适应由中央处理单元存储器送入的随机存取数据，a和b半字节可独立的送入，也就是可以单独作为一个字节的送入，随中央处理单元所需要设置的工作更新方式而定。

#### I/O 接口功能块

8279通过i/o缓冲器控制与四行中央处理部分控制单元的系统总线网络接口8279，i/o控制部分主要使用cs。a0，rd，wr和四行的中央处理部分控制单元8279之间的单向控制数据是交换的，数据和缓冲器信号是双向控制数据交换的通道，所述控制单元的信号和缓冲器是如下的双向控制数据交换之间的逻辑关系：

CS A0 WR RD 状态

\-----

10--中央处理单元从8279读状态

0101中央处理单元向8279写状态

10--中央处理单元从8279读数据

001-中央处理单元向8279写数据

1 X 数据缓冲区输出处于三种状态

x为任意数(0或1)

\###3.3.38279的操作

如前所述，8279可以完全适应各种手机键盘和电脑显示器的不同功能和工作的方式，由于8279中各个命令功能块的各种工作方式是完全可编程的，用户完全可以根据自己的工作要求，用向8279写命令字的各种编程方法对8279的各种工作方式和功能块进行编程，从上表中我们可以清楚地看出，只要执行命令cs=0同时wr=0=1，然后你们就可以将命令字写到8279，并在命令wr的上升沿将相应的命令程序驱动到8279。

对于中央处理器，8279只有两个端口地址，一个是用于查看和读写处理器的命令和数字的状态(cs=0，a0=1)，一个端口地址用于查看和读写处理器的数据(cs=0，a0=0)，但对于编程语言命令和字代码有很多类型。在8279中给出了区分学校和企业不同的温度命令字的方法主要是对处理器命令和字代码的高3位(d7，d6，d5)和低5位进行了分析和编码，而低5位主要是用于理解命令字的实际含义和教学内容。

#### 8279的编程命令

键盘/显示器方式设置

最高位最低位

--

命令代码000 D D K K K

其中DD为显示方式，KKK为键盘方式

DD的表示：

编码功能

\--

008个8位字符显示-左端传入

01168位字符显示-左输入

1088位字符显示-右输入

1116个8位字符显示-右端送入

所谓左端送

编码功能

\--

000编码扫描键盘-2键连锁

001译码扫描键盘-2键连锁

010编码扫描键盘-N键巡回

011译码扫描键盘-N键巡回

100编码扫描传感器阵列

101译码扫描传感器阵列

110选通输入，编码显示扫描

111选通输入，译码显示扫描

钥匙链和2，其中N是一个关键电路8279双键盘键被按下两次处理，编码和在两个扫描链轮和显示器被解码形成扫描扫描SL0-SL3。

程序时钟

命令代码001 P P P P P

此命令用于确定定时和分频控制中每个预标量的分频控制系数。命令代码ppppp功率系数可以直接形成一个数字2-31。预标准测量也可以在外部没有所述时钟预定频率的情况下来进行，所述基频，得到内部，如果100khz的选择的基本时钟预定频率，能够外部时钟获得与所述时钟频率预定的恢复时间扫描，分频相关的因子;在预定的复位时钟脉冲后100khz如果没有外部时钟被自动馈送到码31自动。

读FIF0/传感器随机存取存储器

命令代码：010 AI X A X =任意

该读取命令主要用于确定中央处理器选择需要读取后续操作的存储器对象分别是8279中的哪一个fif0/来自传感器随机存取的存储器，并且主要用于传感器确定8个随机存取的存储器字节阵列中的哪一个被传感器读取，其中第一个aaa表示中央处理器选择了需要后续读取的行，ai自动为该行添加1个相同的特征位，并且这两者在传统的键盘扫描模式下的数据是不存在直接相关的，对于每次传感器后续的读取8279，数据存储器会按照与传感器数据首次读取时输入的fif0相同的后续读取顺序自动将数据发送出去。从传感器的fifo开始读取所有数据进行后续的读取，直到传感器写入新的命令。在来自传感器随机存取阵列的实施例中，aaa传感器选择了一线来自传感器8个的随机存取的存储器行如果ai=1，来自传感器的下一次后续读取将被读的随机存取数据送到存储器的下一行。

读显示器随机存取存储器

命令代码：011 AI A A A A

中央处理控制单元对8279写此读取命令，则我们确定了一个中央处理控制单元以一个显示器随机存取的一个存储器位作为数据源缓存地址位来进行随机读取的操作，其中的aaaaa为一个显示器随机存取一个存储器的一个数据源缓存地址，ai的行为自动依次加1特征位，若其中ai=1，则每一次读取第一行随机存取的一个存储器之后[第一行行为显示器的数据地址]自动依次加1。

写显示器随机存取存储器

命令代码：100 AI A A A A

中央处理单元将此命令写入8279，它规定下一步将写入8279的显示随机存取存储器。寻址模式和自动加1功能与读显示随机存取存储器相同。

显示器写入禁止/空格

命令代码：101 X IW IW BL BL X=任意

A B A B

此显示命令主要用于同时屏蔽a或b两个显示端口的输出并重新显示其显示的区域。如果将其中两个显示端口用作两行4位的显示，则必须同时屏蔽4位之一，以使对方发送的信息不会直接影响另一半。iw是该端口被屏蔽的功能位。如果为显示端口设置了显示命令iw=1，则该显示端口被此命令所屏蔽。空格显示请特别注意，b0对应于c0和d0，而d0和bl是应于iwensei，则此显示端口将重新显示空格。如果要以单个8位的输出命令格式为该端口创建重新显示的区域，则必须为端口设置两个d0和bl的标志以使该端口的显示完全保持空白。

消除

命令代码：110 CD CD CD CF CA

此数据清除格式命令主要就是用于按一定的数据格式顺序进行数据清除，它显示随机存取器的数据格式存储器的两个fif0状态，其中a和cd分别用于指定一个需要进行清除的数据格式：

CD CD CD

0 X 全"0"(x为任意)

10 AB =16进制

1020(0 O 100000)

11全册"1"

当显示为"1"(或 CA =1)时，允许清除显示

cf显示器清除cd和fifo的状态(其中包括广告和中断)。如果显示cf=1，则显示器清除cd和fif0状态，并重置中断线。传感器直接随机访问存储器的显示也始终被设置为第0行。ca始终被显示器清除，并且其显示效果与cd对应，当显示ca=1时，cf可以进行合成，使用显示器的cd和fif0指定的随机清除存储器格式进行清除。此时显示器的随机访问存储器的状态已经被清除。cd插孔还可以重新设置同步内部的时序。显示期间将自动清除随机存取访问存储器(约16us)。无法被重写。同时，在此期间，fifo的最高有效位设置为"1"。当显示广告的随机存取访问存储器再次恢复可用时，它将自动进行重置。

中断结束/出错方式设置

命令代码：111 E X X X X X=任意

当一个阵列传感器，该命令使IRQ线变低，并且允许写入随机存取存储器(通过位置传感器的变化来检测，IRQ线可具有增加的，这样做防止了信息写入再次随机存取存储器之前其复位)。在 N 键电路模式下，如果 E 位被编程为"1"，芯片电路将以特殊的错误模式运行。

主要用于检查 N 键巡视模式特殊错误模式下的多次按键。如果在一个反弹周期内按下两个键，则可以视为同时多次按下，并建立一个错误标志以防止进一步写入 FIF0，并设置中断(如中断设置)。错误进行标志设计可以被 FIFO 状态字命令读取，CF =1的清除命令我们可以通过重置错误信息标志。

1. 锯齿波由两个单晶二极管bt和r1、r2、r3、w1和c1组成的单晶管张驰振荡器锯齿波产生，然后通过单晶管发射极跟随张驰振荡器将锯齿波输出。

2. 控制电势差(Uk)和锯齿波电势差与电子流的强度叠加，送至 v2基极。综合电势差是我们。当 Us>0(0.7)时，V2打开，Us <0，则 V2结束。

3. V2，V3和R8，R9，DW1流开关已经被组成，当基极电位差V2 Ube2>0(0.7)，V2被接通时，接近零电势差Ube3，V3被关闭，直流开关是打开。

4. 过零脉冲的控制输出由削波同步电源变压器晶闸管tb、整流桥变压器d1、r10和直流开关r11组成的削波整流桥同步变压器电源，它与直流开关的两个输出电势差一起分别用来控制v4和发射器的v5。只有当发射器的dc直流开关发射器打开时，v4才使发射器关闭，并且由于v4和发射器的v5基极电极与两个发射器之间存在一个工作电势差，因此它使发射器可以在此期间正常工作。当每次发射器的同步电势差过零时，v4关断，其集电极和输出存在一个正电势差，这就可以使得v5从发射器的截止开关开始接通，通过这个脉冲使同步变压器的输出触发一个过零脉冲，并且这个触发脉冲可以使变压器晶闸管t在需要发射器导通的时候导通。

直流开关导通时，连续正弦波控制电势差uk的大小决定了直流开关的导通持续时间的长短，这也直接决定了在电阻炉设定的直流开关周期内可以传导的直流开关周期和次数，因此，可以合理地调整直流开关输出的功率。显然，控制电势差uk越大，它可以传导的直流开关周期和次数越多，输出的功率越大，电阻炉的直流开关温度越高。相反，电阻炉的直流开关温度越低。

自动电炉闭环系统温度自动调节的基本设计思想是在热电炉系统中自动添加温度传感器和相应的温度自动控制器。温度传感器的温度调节基本功能主要是通过检测自动热电炉的实际工作温度，将其信号转换为电势差的控制信号，并且我们比较了电炉相应温度控制装置uk的电势差。这种差异的变化大小(e=uk-uft)和电势差变化的方向(即e是正还是负)由温度控制器沿晶闸管相反的输入控制方向自动设置，以便温度控制器的输出信号控制导晶闸管接通的方向和长度。直流晶闸管开关的输入控制接通的时间，使得在一定温度和时间内的设置，晶闸管的输入控制接通电流频率有所增加或流量减少，而使得电炉的相应直流温度控制装置有所频率增加或流量减少。利用这种电势差控制温度的方法，可以在很小的电势差范围内自动改变炉温，并且控制精度高。

方案二：为了更好地可以有效简化控制电路，采用先进的单片机恒温控制技术可以作为一个恒温控制系统和企业的核心单片机来进行设计本文的课题。温度传感器ds18b20用于对温度传感信号的采集。方案二控温的基本设计思想主要是：通过传感器采集的电阻丝温度与单片机标准传感器温度的差值，控制恒温发热系统中电阻丝的数量和持续时间，从而最终达到对恒温发热系统控制的主要目的。控温方案二的单片机设计电路框图结构如下图所示：

![2.2方案二设计框图](http：//my gunplan.top/static/003.jpg)

本解决方案以先进的单片机为温度控制的核心，利用温度传感器自动采集计算机温度，通过传感器采集的计算机温度与单片机标准传感器设定计算机温度之差的距离来测量和控制温度，使得温度始终保持在单片机标准传感器设定的温度。该解决方案设计制作成本低，可靠性高，非常适用于计算机系统的动态控制性能和系统稳定性对温度要求不是很高的应用场合。

## 3.4传感器接口电路设计

### 3.4.1温度数据采集电路

ds18b20是基于dallassemiconductorcorporation的一个网络数字温度传感器。与其他的温度传感器连接方式相比，ds18b20具有以下的功能：当网络连接到如上所述微处理器的唯一单线路的接口模式中，只有一个端口可以被用于直接实现一个微处理器和ds18b20之间的双向通信的线路。

ds18b20支持独立的多点温度网络。几个节点ds18b20可以仅在三条线上通过并联进行连接，以方便地实现基于互联网的多点温度的测量。ds18b20不一定需要外围的组件。所有的传感器集成元件和温度信号转换集成电路都可以像普通的晶体管一样直接集成在单个温度集成电路中。传感器的温度测量范围一般为55〜125°c，温度集成电路测量的固有温度和分辨率范围为0.5°c。温度测量的结果直接传感器输出一个9位数字的温度测量信号，并直接通过"初始化总线"接口串行发送到传感器的中央控制单元。同时，可以直接发送crcr的温度校验码，具有较强的温度抗干扰和自动纠错的功能。温度测量的结果以9位数字的模式串行传输。

尽管ds18b20具有简单的嵌入式温度自动测量和控制系统，较高的分辨率和温度测量的精度，方便的网络连接以及较少的线路和资源占用等诸多优点，但在实际的应用中还是应该充分考虑以下的几个方面：

1. 尽管操作系统的硬件很简单，但我们还是需要相对复杂的软件处理器来对其进行温度补偿。由于ds18b20与其他微处理器之间的读写串行编程需要数据同时传输，因此必须注意保证在读写串行编程期间的连续读写编程时间，否则将是无法对读取进行温度补偿测量的结果。

2. ds18b20的可靠性相关数据未提及任何连接到单个总线的微处理器ds18b20的数量。这很容易就会导致一个错误的假设，即微处理器可以在总线上连接任意数量的总线ds18b20，而在实际的应用中并非如此。如果一条单个总线上微处理器连接了8个以上的总线ds18b20，则几乎没有必要考虑解决单个总线微处理器的可靠性和总线驱动问题以及我们在设计多点温度控制和测量传感器系统时所需要注意和考虑的一些问题。

3. 连接长度的限制是指采用连接长度为ads18b20的信号总线的电缆。由于它具有信号电缆的稳定性和电子电缆的阻挡比较大等特性，如果距离太大，信号传输幅度也会有所降低。如果在测试中普通信号电缆的双绞线传输电缆的长度明显地超过50m，则表示温度降低或读取数据不正确。如果将普通信号总线的电缆改为带屏蔽普通信号电缆的数据传输双绞线，则正常的总线通信数据传输距离应该可以轻松地达到150m。

ds18b20提供两种不同类型的器件封装：pr-35和pdsoic。引脚的顺序排列如下下表3.1所示。该软件封装操作系统中实际上已经使用了基于pr-35软件包的封装工具包。尽管如此，dds18b20仅用于提供一个返回9位温度数字的一个温度测量值，如如下图3.1.2所示。

管脚管脚定义说明

：-：：-：：-：

8脚SOIC 3脚PR-35

21 GND地

12 I/O 数据输入

83 VCC电源

34567 NC空脚

表3-1 DS18B20管脚排列

图3.1.2ds18b20温度值的表示计算方法

d9为低字节的符号位，0为正，1为负，高字节(d10~d15)的其他位用二进制符号位的补码或扩展位形式进行了表示;d0~d8为数据位，以二进制数据位的补码或扩展形式进行表示。如下表3.2显示了数值与温度之间的非线性关系。

温度测量数据(二位位十六进制)数据(十六进制)

：-：：-：：-：

+125000000001111101000FAH

+2500000000001100100032H

+0.500000000000000010001H

000000000000000000000H

+0.51111111111111111 FFFFH

-251111111111001110 FFCEH

-551111111110010010 FF92

表3.2 DS18B20值与温度的关系

由于房间的环境温度不能为负，因此系统不会考虑负温度。这样，您在选择硬件时就可以使用市售组件，而不必使用工业组件，从而可以大大降低成本。读取温度信息后，微控制器仅需要将低字节(D0〜D8)发送到主机和控制电路。

### 3.4.2发光二极管显示接口电气设计

选择的系统控制方式是四路开关室温动态实时传感器显示，显示精度0.1℃。具体的电路原理图所示如图3.2：

![3-2硬件电路图](http：//my.gunplan.top/static/3.2.png)

### 3.4.3发光二极管数码管

发光二极管显示器即为新型发光二极管显示器，具有数据显示醒目、成本低、配置灵活、接口可以方便等特点，单片机电源管理控制系统在应用数据管理操作系统的设计中常用它来直接显示电源管理操作系统的日常工作生活的状态和过程中所采集的数据在信息网络中所输入的数值等。

根据大屏幕发光点阵二极管的排列和结构不同，可将大屏幕发光点阵二极管显示器划分为大屏幕发光二极管点阵数码管和大屏幕发光二极管点阵数码显示器。大屏幕发光二极管点阵数码管主要就是用于在屏幕上显示英文数字和一些英文字母和图形符号，发光二极管点阵显示器同样可以在屏幕上显示英文数字、字母、男人和图形等。大屏幕发光点阵二极管数字点阵显示虽然点阵显示灵活，但它们主要占用的是单片微型计算机系统的软硬件资源比大屏幕发光二极管点阵数码管显示器要多得多。除了使用指定的程序，大屏幕发光点阵数码管显示器或led点阵显示器主要用于请求特殊的点阵显示场合，几乎所有的微型计算机系统应用点阵显示系统都使用大屏幕发光二极管数字点阵显示。

数字管理的显示系统主要有两种显示模式，包括静态数据管理显示程序模式和动态显示程序模式。静态数据管理显示的程序非常不复杂，静态数据管理显示系统的程序模式设计起来非常简单，占用cpu的内存时间很少。仅需要当系统的显示字符串发生更改时才可以调用动态显示程序。但是，硬件和集成电路很多。每个八位数字晶体管都至少必须需要一个8位i/o电源输出输入端口，一个8位限流电源输出驱动器和8个8位限流输出电阻。通常偶尔也可能会需要使用少量的圆形数码管。发光二极管的应用由于静态扫描显示器需要使用较少的电子管组件，并且需要使用更多的静态数字组件与电子管组件在显示器之间进行切换很麻烦。为了有效简化了电路并且大大降低了成本，系统设计使用了一种动态扫描数字显示的方法。

动态扫描显示模式的工作原理是分别打开每个显示器，即一次仅显示一位。为了使用户看到所有的显示器都已显示，必须加快每个显示器的照明周期(增加扫描频率)。通过使用人眼的视觉残留效果，可以实现与连续显示所有显示器相同的效果。动态扫描显示电路如图3.2.2所示：

![图3.2.2动态扫描图](http：//my.gunplan.top/static/003.jpg)

## 3.5 温度控制电路的设计

![图3.2.2温度控制电路](http://my.gunplan.top/static/3.3.png)

通过正确设置开关元件脉冲的宽度来我们可以控制三端双向的可控硅开关元件的开启和脉冲关闭。当伴随着脉冲宽度的增加(脉冲占空比增加)时，三端双向的可控硅开关元件的脉冲导通加热时间和温度延长，电阻丝的开关元件加热的时间也延长，温度也升高。相反，如果我们减小了脉冲的宽度(相当于减小脉冲占空比)，则双向可控硅的脉冲导通加热时间和温度缩短，电阻丝的开关元件加热时间和温度缩短，从而大大降低了元件的温度。

以此方法来控制温度的恒定不变。

## 3.6 脉宽调制

### 3.6.1 脉宽调制的介绍

pwm是高电平脉冲方波宽度调制的一个英文缩写。高比的方波的第一个时间段被简单地称为高电平的占空比，例如，一秒钟高电平和的50%1第二个是占空比的pwm波的脉冲宽度调制(pwm)的定义低电平在各种开关电源中被广泛使用的一个术语。。这个词是根据开关稳压的控制工作方式进行定义和分类的。除pwm混合型外，还有开关调制pfm型和脉宽调制pwm和一种pfm混合型。波的脉宽调制(pwm)的定义开关稳压电路的定义是在设计和控制开关稳压系统的电路设计中在输出的频率可以与低电平保持一个不变的频率情况下，通过电势差的反馈电路来控制和调节其输出的占空比，从而使使用者能够更好地达到维护社会稳定和发展控制输出电势差的主要目的。

脉冲信号宽度的调制(pwm)技术是一种非常有效的可以利用微处理器的模拟数字脉冲信号输出来实现控制和模拟集成电路的一种技术，它被广泛的应用于从电力测量，控制和无线通信系统到电力的智能转换许多应用领域。

### 3.6.2 基本原理

随着我国电子信息技术的发展，出现了多种 PWM 技术，包括：相电势差控制 PWM 、脉冲信号宽度 PWM 方法、随机 PWM 、 SPWM 方法、线电势差控制 PWM 等，然而，镍氢动力电池使用智能手机充电器设计采用的脉冲时间宽度 PWM 方法，以等脉宽的脉冲串作为 PWM 波形，通过不断改变一个脉冲串的周期可进行分析调制，可以同时通过这些改变传统脉冲的宽度或占空比来调节电势差，并且我们可以选择通过研究采用学生适当的控制管理方法来实现协调地改变电势差和频率。

模拟信号的时间值和分辨率可以通过不断的发展变化，对其时间和变化幅度的时间值和分辨率没有必要进行严格的限制。9v模拟信号电池同时也是一种智能模拟设备，因为它的输出电势差不完全一定等于9v，而是随着一定时间而变化，并且同时也可以取任何真实值。类似的地，从模拟信号电池内部吸收的电子流的数量和强度不可能局限于任何一组模拟信号可能的真实值范围。智能模拟信号和传统数字信号的最大区别主要在于后者的真实值范围只能在数字信号预定的任何一组可能的值内，例如，在{0v的电子集合中，5v}。

模拟电势差和收音机电子流的强度控制可直接地应用于扬声器的控制，例如模拟控制汽车和收音机的音量。在简单的控制模拟电势差和收音机中，音量旋钮通过连接扬声器得到可变电阻。当扬声器拧动音量旋钮时，电阻值随之变大或相应地变小;流过这个强度和电阻的电子流的强度也随之增大或相应地减小，从而通过改变扬声器驱动收音机和扬声器的电子流的强度和电阻值，使得音量旋钮相应地随之变大或相应变小。与其他无线电一样，模拟扬声器电路的音量输出与扬声器输入成一个线性的比例。

在简单的需要模拟一个立体声的收音机中，音量控制系统的旋钮与收音机连接时会用到一些可变电阻。其中之一的问题是由于模拟电路倾向于随时间进行漂移，因此难以进行调整。只有可以帮助解决这个复杂问题的精密模拟电路体积可以非常大，体积庞大(尤其是比如老式的家用立体声音量控制设备)和昂贵。精密模拟电路还可能产生严重的热量，其产生的功耗与电路中的工作元件两端的电势差与工作元件电子流的扰动强度的乘积大小成正比。精密模拟电路也肯定可能对于噪声敏感，任何的扰动或者产生的噪声都肯定可能会直接改变工作元件电子流的强度值。

通过对模拟控制电路进行数字控制，可以大量减少控制系统的设计成本和系统功耗的降低。此外，许多的微控制器和dsp已经在日本和中国的芯片上包含了dspwm控制器，这样就使得通过数字进行控制的设备实现自己的功能变得完全可以更加的具有容易。

脉冲宽度调制信号的设计思想

该对象的脉宽调制信号为方波，设定周期为1 s。它的产生将时间计数器设置为10 ms时序，然后通过寄存器R3控制脉冲宽度调制信号的周期。此主题仅具有模拟效果，并且对准确性没有过多要求，因此将1s周期划分为100。在相等的部分中，计时器设置为10 ms，计时器在R3中启动的频率为100。

寄存器r2中需要存储的数据是根据脉冲检测控制电路和数据控制电路进行转换的数字。r2中存储的数据值是用于分别控制一个脉冲系统的信号和1s内一个高电平的脉冲时间的长度。这样我们也就可以从寄存器的p2.6口检测得到用于定义一个周期可调和进行高电平的脉冲时间可调的寄存器来控制脉冲系统的信号。

### 3.6.4 脉宽调制信号的作用

脉冲宽度调制信号从P3.0端口输出。从P3.0端口输出的方波信号连接到三端双向可控硅开关的控制连接，以控制TRIAC的接通和关断。如果方波在一段时间内以高电平出现，则双向可控硅的占空比变长，即加热元件散发的热量更多。简而言之，加热元件释放的能级由方波在一个周期内变高的时间确定。

### 3.6.5 脉冲宽度调制优点

pwm的最大好处的其中之一个特点就是从信号处理器到受控系统的数字信号都是保持数字形式的，没有对数模信号进行的变换。这样保持了数字形式的数模信号最大限度地减少了噪声的产生和影响。数字噪声的大量产生主要是因为只有在其强度足以准确地阐述信号上升沿或信号下降沿跳变的强度时候，数字信号的稳定性才可能会被受到影响。

除了使用指定的程序，大屏幕可以使用点阵数字显示器或led数字显示器。为了请求特殊的显示场合，几乎所有的微型数字计算机或者应用显示系统都使用发光二极管进行数字显示。这些模拟信号可以转换到pwm信号可是它们可以大幅度地增加传输信号距离的范围和长度。在高频接收端，可以直接滤除经过调制的高频方波，并通过适当的rc或lc模拟网络将传输信号的频率恢复到最为模拟的形式。

总之，pwm不仅省钱、占地面积被大量使用节约、抗震和降低噪声的使用性能强，而且同时也成为是一种非常值得许多专业建筑工程师在许多不同类型的建筑设计和工业应用中广泛研究使用的有效解决技术。

 # 第4章 系统软件设计

在微机测控系统中，软件与硬件同样重要。硬件是系统的躯体，软件则是灵魂，当系统的硬件电路设计好之后，系统的主要功能还是要靠软件来实现，而且软件的设计在很大程度上决定了测控系统的性能。为了满足系统的要求，编制软件时一般要符合以下基本要求：  

1. 易理解性、易维护性。通常是指软件系统容易阅读和理解，容易发现和纠正错误，容易修改和补充。由于生产过程自动化程度的不断提高，测控系统的结构日趋复杂，设计人员很难在短时间内就对整个系统理解无误，软件的设计与调试不可能一次完成，有些问题是在运行中逐步暴露出来，这就要求编制的软件容易理解和修改。在软件的设计方法中，结构化设计是最好的一种设计方法，这种设计方法是由整体到局部，然后再由局部到细节，先考虑整个系统所要实现的功能，确定整体目标，然后把这个目标分成一个个的任务。任务中可以分成若干个子任务，送样逐层细分，逐个实现。本仪表就是采用这种模块化的设计方法。这样不但使得设计目标明确、思路清晰，而且在检错、调试时也很方便。当出现问题时，可以根据问题的种类和现象来判断是哪一部分出的问题，很容易找出故障所在和故障原因。同时，采用模块化程序结构设计方案，对于系统功能的扩充和修改也提供了很大的方便。
2. 实时性是电子测量系统的普遍要求，即要求系统及时响应外部事件的发生，并及时给出处理结果。近年来，由于硬件的集成度与运算速度的提高，配合相应的软件，实时性比较容易满足设计要求；
3. 准确性对整个系统具有重要意义，尤其是测量系统，系统要进行一定量的运算，算法的正确性和准确性对结果有着直接的影响，因此在算法的选择、计算的精度等方面都要符合设计的要求；
4. 可靠性是系统软件最重要的指标之一，作为能够稳定运行的系统，抗干扰技术的应用是必不可少的，最起码的要求是在软件受到干扰出现异常时，系统还能恢复正常工作。结合上述编制系统软件的基本要求，首先讨论软件的设计思想。

在微机测控系统中，软件的重要性与硬件设置同样重要。硬件是躯体，软件是灵魂，当系统的硬件电路确定之后，系统的主要功能还要靠软件来实现。如果说硬件决定了产品的造价，那么在硬件搭配合理的前提下软件在很大程度上就决定了产品的性能。

## 4.1 软件设计思想

为了满足系统的要求，编制软件时必须符合以下基本要求: 

易理解性、易维护性。通常是指软件系统容易阅读和理解，容易发现和纠正错误，容易修改和补充。由于生产过程自动化程度的不断提高，测控系统的结构日趋复杂，设计人员很难在短时间内就对整个系统理解无误，软件的设计与调试不可能。

一次完成，有些问题是在运行中逐步暴露出来，这就要求编制的软件容易理解和修改。在软件的设计方法中，结构化设计是最好的一种设计方法，这种设计方法是由整体到局部，然后再由局部到细节，先考虑整个系统所要实现的功能，确定整体目标，然后把这个目标分成一个个的任务。任务中可以分成若干个子任务，送样逐层细分，逐个实现。本仪表就是采用这种模块化的设计方法。这样不但使得设计目标明确、思路清晰，而且在检错、调试时也很方便。当出现问题时，可以根据问题的种类和现象来判断是哪一部分出的问题，很容易找出故障所在和故障原因。同时，采用模块化程序结构设计方案，对于系统功能的扩充和修改也提供了很大的方便。

实时性。实时性是本系统的基本要求。即要求系统及时响应外部事件的发生，并及时给出处理结果。近年来，由于硬件的集成度与速度的提高，配合相应的软件，实时性容易满足要求，特别是对于汇编语言编制的软件。  

1. 可测试性。系统软件的可测试性具有两方面的含义:其一是指比较容易地制定出测试准则，并根据这些准则对软件进行测定；其二是软件设计完成后，首先在模拟环境下运行，经过静态分析和动态仿真运行，证明准确无误后才可投入实际运行。  
2. 准确性。准确性对整个系统具有重要意义。系统要进行大量运算，算法的正确性和准确性问题对控制结果有直接影响，因此在算法选择、位数选择方面要适合要求。
3. 可靠性。可靠性是系统软件最重要的指标之一，它要求两方面的意义:第一是运行参数环境发生变化时，软件都能可靠运行并给出正确结果，也就是要求软件具有自适应性:第二是在环境恶劣干扰严重情况下，软件必须保证也能可靠运行，这对整个系统尤为重要。



## 4.2 软件组成

由于整个系统软件相对比较庞大，为了便于编写、调试、修改和增删，系统软件的编制采用了模块化的设计。即整个控制软件由许多独立的小模块组成，它们之间通过软件接口连接，遵循模块内部数据关系紧凑，模块之间数据关系松散的原则，按功能形成模块化结构。

系统的软件主要由主程序模块、数据采集模块、数据处理模块、控制算法模块等组成。主模块的功能是为其余几个模块构建整体框架及初始化工作；数据采集模块的作用是将A／D转换的数字量采集并储存到存储器中；数据处理模块是将采集到的数据进行一系列的处理，其中最重要的是数字滤波程序：控制算法模块完成控制系统的PID运算并且输出控制量。

下面就介绍本系统几个主要的程序模块。

## 4.3 程序结构分析

**主程序调用了4个子程序，分别是温度传感器读取程序，数码管显示程序、键盘扫描及按键处理程序、温度信号处理程序。**

* 键盘扫描电路及按键处理程序：实现键盘的输入按键的识别及进入相应的程序。
* 温度信号处理程序：对温度芯片送过来的数据进行处理，进行判断和显示。
* 数码管显示程序：向数码的显示送数，控制系统的显示部分。




## 4.4 数据处理模块

数据处理模块负责处理A／D转换后的数字量。其中最重要的环节是数字滤波，所以这里主要讨论系统采用的数字滤波程序。

###  4.4.1 数字滤波

模拟信号都必须经过A／D转换后才能为单片机接受，如果模拟信号受到扰动影响，将使A／D转换结果偏离真实值。因此仅仅对模拟量采样一次，我们是无法确定该结果是否可信的，必须经过多次采样，得到一个A／D转换的数据序列，通过某种处理后，才能得到一个可信度较高的结果。这种从数据序列中提取逼近真值数据的软件算法，通常称为数字滤波算法。

数字滤波克服了模拟滤波器的不足，它与模拟滤波器相比具有以下几个方面的优点:  

1. 由于数字滤波是用程序实现的，因而不需要增加硬件设备，而且可以多个输入通道共用一个滤波程序
2. 由于数字滤波不需要硬件设备，因而可靠性高、稳定性好，各回路之间不存在阻抗匹配等问题
3. 数字滤波可以对频率很低(如O．01HZ)的信号实现滤波，克服了模拟滤波器的缺陷，而且通过改

变数字滤波程序，可以实现不同的滤波方法或改变滤波参数，这比改变模拟滤波器的硬件要更灵活方便。

常用的数字滤波方法有程序判断滤波法、中值滤波法、算术平均滤波法、一阶滞后滤波法、去极值平均滤波法等等，下面简要介绍这几种数字滤波方法。

1. 程序判断滤波法首先要从经验出发，定出一个目标参数最大可能的变化范围。每次采样后都和上次的有效采样值进行比较，如果变化幅度不超过经验值，本次采样有效，否则，本次采样值应视为干扰而放弃，以上次采样值为准。该算法适用于变化缓慢的物理参数的采样过程，如湿度、液位等。
2. 中值滤波法对目标参数连续进行若干次采样，然后将这些采样进行排序，选取中间位置的采样值为有效值。对于变化较为剧烈的参数，此滤波方法不宜采用。
3. 算术平均滤波法是对目标参数进行连续采样，然后求其算术平均值作为有效采样值。该算法适用于抑制随机干扰。采样次数越大，平滑效果越好，但系统的灵敏度要下降。算术平均滤波不能将明显的脉冲干扰消除，只是将其影响削弱。

## 4.5 子程序设计

设计总体程序框图如下，总体程序由主程序，按键子程序，温度获取子程序三部分组成。  
读出温度子程序的主要功能包括初始化,判断DS18B20是否存在,若存在则进行一系列的读操,作若不存在则返回。

### 4.5.1 读出温度子程序

![图4-6 程序结构图](http://my.gunplan.top/static/4.2.1.PNG)

### 4.5.2 LED数码显示管程序

![图4-6 发光二级 数码显示管程序](http://my.gunplan.top/static/4.2.2.PNG)

### 4.5.3 键盘扫描及按键处理子程序

![图4-7  键盘扫描及按键处理子程序](http://my.gunplan.top/static/4.2.3.PNG)


## 4.6 显示处理

显示处理模块主要完成人机交互作用，具体实现将采样温度值、设定温度值以字符的形式通过液晶显示出来。本系统使用HTl621作为显示驱动器。HTl621是128点内存映象和多功能驱动器。附录中给出了显示处理模块的源程序。

# 第5章 系统软件调试

## 5.1 目测

1. 有无短路处。
2. 对照电路图看有无接错、漏接处。
3. 有无虚焊处。
4. 元件是否都对

## 5.2 硬件调试

首先应进行上电前的准备。为了防止硬件的损坏，应在电路板上电前进行电路检查，包括：对芯片的焊接方向进行检查，对芯片的引脚进行短路和断路检查。

在经过检查确认芯片的焊接没有任何问题的情况下，进行上电检查，在电源打开后，先判断电路是否存在异常，如出现芯片过热等现象，应及时切断电源，检查电路故障。在上电无异常状况的前提下，可以用万用表和示波器进行测量。首先测量电源芯片的输出电压是否正常，然后用示波器分别测量各个主要芯片电源引脚，察看电源的波形情况，如有纹波，则在预先留出的位置上焊上退耦电容以消除纹波，保证芯片工作正常。电源测量完毕后，进一步用示波器测量有源晶振的输出脚，其输出是频率为8MHz的波形(非方波，类似正弦波)。在确定晶振起振后，按住复位键，使单片机始终保持在复位状态，同时测量其各个引脚的电平情况，并同数据手册上表述的复位时的芯片引脚状态进行比对，由此可判断单片机是否正常。确认单片机正常之后就可以通过仿真器连接用户板进行调试。

## 5.3 软件的调试

由于软件的编写都是根据各个模块进行的，我们在进行软件的系统模拟调试时应，先确认硬件的接口标记是否在软件程序中一一对应，而且要检测所编写的软件有没有知识性的错误。在觉得基本没有问题后我们通过电脑将程序编译进入系统核心AT89S52单片机，检验软件与硬件各部分是否协调的工作。出现问题时我们要耐心的检查程序并作出适当的修改，直到软件系统的完全契合硬件电路，那我们软件就调试成功了。

1. 测试环境
   环境温度28摄氏度，室内面积20平方米
   测试仪器：数字万用表，温度计0----100摄氏度

2. 测试方法
   使系统运行，采用温度计同时测量室内度变化情况，得出系统测量的温度。

3. 测试结果
   设定温度由0摄氏度到40摄氏度
   标定温差<=1摄氏度   调节时间  15s（具体视现场情况）
   静态误差<=0.5摄氏度   最大超调量1摄氏度

4. 通过测试分析，对于实际室内的温度控制，可以再提出以下 2 点方法 :
   Ⅰ增加传感器个数，对各个温度传感器采集的数据进行求算术平均，可得到较为准确的温度值。
   Ⅱ对实际室内的温度控制，可采用功率较大的电炉，并且通过风扇对箱内温度进行充分搅和降温设备可采用空气压缩机等制冷设备。 

5. 通过实验测试和分析，发现虽然传感器的温度采集精度最高可得到 0.06 ℃，但测试得到的数据最小间隔为 0.03 ℃ 。通过分析，当对浮点数求平均处理时，遇到同一时刻两个传感头采集的温度相差不大，使 0.06 ℃ 时求出平均温度变为 0.03 ℃ 为了解该数据是否真实，可采用一个高精度的数字温度计测试，发现读出的值与其基本一致，由此推断如果在同一时间增加采集温度的个数，则可以进一步提高温度的精度。 

    

## 5.4 注意事项

1. 测驱动电路的过程中发现数码管不能正常显示的情况，经检验发现主要是由于接触不良的问题。其中包括线的接触不良和芯片的接触不良，在实验过程中，数码管有几段时隐时现。用万用表检测发现有线接触不良，重焊后就可正常显示。而芯片接触不良用万用表欧姆档检测有几个引脚本该相通的地方却未通，其解决方法为把芯片拔出正对万能板孔均匀用力插入。
2. 由于焊接时的大意损坏了元件，在调试是我们怎么都找不到问题的所在，我们是用排除法一个一个元件的测试的找出损坏的元件，重新换上新的元件，故障得以解决。
3. 还有关于程序调试过程中出现的问题。执行程序是发现程序执行不稳定，排除软件的错误外，经老师的指导才发现单片机的EA管脚没有接地。因为次程序只用到片内程序存储器，所以在程序执行时一定要把管脚接的，这样程序才能只执行片内的，不然程序会乱跳，从而导致程序执行不稳定。
4. 接三极管的过程中，发现电路不管程序是什么，数码管都是显示8字，经查除发现原来是三极管的极端弄错了，从新调整极端顺序。
5. 在电路调试时由于我们选用的是对射型的光电传感器由于没正对好使的调试一度中断，最后我们通过反复的调试解决了问题
6. 调试时由于线路的繁杂，没有仔细的找到对应部分的线路，使的调试的结果与预期出现很大的误差，我们通过梳理线路后就调试成功了并达到了预期的效果。
7. 在调试时几个模块的电路调试都不是很好，我们就要对线路的硬件连接做仔细的检查，调试的时候我们首先要确定连接的电路没有错误，各个元件管脚间没有虚连，那样我们的调试才会更顺利。# 结束语

这个最后的项目设计对我很有帮助的。这种设计使我对在大学学习的知识有了全面的了解和深入的思考，并让我对所学的知识以及思考和编写最终设计综合游戏的能力有所了解和提升。最后，我完成了这项任务。撰写论文的过程也是学习专业知识的过程的一个重要的阶段。它使我能够使用现有的专业基础知识来设计，分析和解决理论或实践问题，并将知识转化为实践技能培训。我已经掌握了运用自己的知识来解决实际问题的能力。

通过这个最终设计的结果，我发现只有提高理论水平，才能将教科书的知识和实践结合起来，理论知识可以为教学实践服务，以提高我的实践能力。这个设计非常有意义。我有很多经验。通过这个最后的项目，我们知道了理论与实践之间的距离，将理论与实践相结合的重要性，并且我们已经学到了很多我们无法从书本中学到的知识。

我们的学习不仅应以书籍为基础的限制，而且还应以解决理论和实践中的实际问题为目标和导向，而且还应结合实践去具体分析。理论问题是实践问题，问题解决是课程研究。学生本身就是作为专家来看待。用手解决问题比用大脑解决问题更深刻。学习应要求理论与实践相结合。理论问题也是实际问题。这种方法不仅有助于完成理论知识的巩固，而且将有助于推进实践，解决实际问题，并增强我们服务和解决问题的能力。

总的来说，这个最终的设计使我学到了很多东西。这是大学的最后也是最重要的一课。它对我们的未来产生深远的影响，具有十分重要的意义。





# 参考文献

[1] 李伯成.基于MCS-51单片机的嵌入式系统设计.电子工业出版社.2004  
[2] 宗光华,李大寨.多单片机系统应用技术.国防工业出版社.2003  
[3] 胡学海.单片机原理及应用系统设计. 电子工业出版社.2005  
[4] 孙育才,王荣兴,孙华芳.ATMEL新型AT89S52系列单片机及其应用.清华大学  
   出版社.2005  
[5] 于京,张景璐.51系列单片机C程序设计与应用案例.中国电力出版社.2006  
[6] 蔡杏山.Protel 99 SE 电路设计.人民邮电出版社. 2007  
[7] 杨小川.Protel DXP 设计指导教程. 清华大学出版社.2003  
[8]  李晓荃. 单片机原理与应用[M].  电子工业出版社，2000年8月  
[9]  何立民.  AVR单片机原理与接口技术[M]. 北京航空航天大学出版社，2002  
[10]  杨帮文. 新型继电器实用手册[M]. 北京人民邮电出版社.2004  
[11] 何希才.传感器及其应用电路[M].北京:电子工业出版社,2001.131-135  
[12] 丁镇生.传感器及传感技术应用[M].北京:电子工业出版社,1998.  
[13] 王家桢.传感器与变送器[M].北京:清华大学出版社,1996.  
[14] 曾巧媛.单片机原理及应用[M].北京：电子工业出版社.2002  
[15] 何力民.单片机高级教程[M].北京：北京航空大学出版社.2000  
[16] 金发庆.传感器技术与应用[M].北京：北京机械工业出版社.2000  
[17] Katsuhiko Ogata．Moden Control Engineering．Publishing house of electronics industry，2000：1 96—202.  
[18] Microchip 24C01B/02B 8 位PIC®单片机产品手册[ED/OL].  
[19] Borko H，Bernier C L．Indexing concepts and methods .New York:Academic .
[20] Dallas products data Book[M]，1999.  
[21] Maxim products data Book[M]，2001.  
[22] Shao Jianlong, He Chun. Design of a Portable Popular Multifunctional Development System for 8051 Single-chip Microprocessor Family [J].   Computer Engineering and Applications, 2003.13.
      




# 致 谢

本课题的完成中，我得到了很多人的帮助，在此表示衷心的感谢!

首先感谢我的指导老师高老师，我的课题是在他的指导和帮助下完成的，他深厚的理论功底和严谨的治学态度以及高度的敬业精神使我受益非浅，对我课题的完成起到了至关重要的作用。
经过这次毕业设计，使我觉得不论从理论知识还是从实际操纵中都学到了不少知识，我想归纳起来，主要有以下四个方面：  

* 经过这次毕业设计，它让我接触更多平时没接触的科学仪器设备、元器件以及获得相关的仪器调试经验，同时我也发现自己在这方面很多不足之处。体会到理论知识对实践有很大的知道作用，她让我知道，只有在正确的理论指引下，才能设计出合乎实际需要的硬件电路。
* 学会了高效率的查阅资料、运用工具书、医用网络查找资料。我发现，在我们所使用的书籍上有些知识在实际应用中其实不是十分理想，各种参数都需要自己去调整。偶尔还会遇到错误的资料现象，这就要求我们应更加注重实践环节。
* 在毕业设计中，我们应当注意重点与细节的关系。
* 失败不可怕，只要不趴下，昂首向前走，希望总会有的。
* 同组同学相互包容，彼此合作，取长补短，才能铸就最后的成功。可以说这次毕业设计是对所学知识的一次运用和检阅，同时对自学能力提出很高的要求，所以平时的学习离开思考，就是严重的错误，我们学习不应该有偏科现象，各方面知识都要接触，这样做才能为毕业设计打下基石。  

最后,我要感谢的母校东北石油大学大学,为我提供的良好的学习与发展环境。感谢我的指导教师高新成给予我帮助，感谢母校开放、公正的言论环境,现代、实用的学习环境,舒适、便捷的生活环境让我顺利度过了人生的关键三年。愿所有校园里认识的,不认识的；来过的,走过的……愿你们珍惜握在手里的现在,抓住机遇,拥有一个美好的明天。





# 附录一 程序

程序如下:

```assembly
TM_NUM EQU 23H
TM_L EQU 22H
TM_H EQU 21H
DSPBUF EQU 40H
DQ BIT P2.0
FLAG BIT 00H
ORG 0000H
AJMP MAIN
ORG 000BH
AJMP __INTT0__
ORG 30H
MAIN: MOV SP,#070H
      MOV TMOD,#02H
      MOV IE,#82H
      MOV TH0,#6
      MOV TL0,#6
      MOV R2,#04
      MOV R1,#40H
 LL1: MOV @R1,#00
      INC R1
      DJNZ R2,LL1
      SETB RS0
      MOV R2,#00
      MOV R3,#00
      MOV R4,#00
      MOV R5,#00
      MOV 6FH,#00H
      CLR RS0
      CLR P3.0
      MOV 30H,#02
      MOV 31H,#06
      MOV 32H,#0
      LCALL CHEWEN
__INSTANCE__:CLR TR0
      SETB P2.1
      JB P2.1,K3
      LCALL KKEY
   K3:CLR 01H
      MOV R2,44H
      CJNE R2,#00,K2
      SJMP K7
   K2:CPL P3.0
      MOV R3,#30
   K1:LCALL TM_DISP
      DJNZ R3,K1
      DJNZ R2,K2
   K7:MOV R2,45H
      CJNE R2,#00,K4
      SJMP K6
   K4:MOV R4,#255
  K44:CPL P3.0
      MOV R3,#30
   K5:LCALL TM_DISP
      DJNZ R3,K5
      DJNZ R4,K44
      DEC R2
      CJNE R2,#00,K4
  K6: CLR P3.0
      LCALL CHEWEN
      SETB TR0
MAIN2:JB 01H, __INSTANCE__
      LCALL TM_DISP
      SJMP MAIN2
CHEWEN:CLR RS1
       CLR RS0
      LCALL GET_TM
      LCALL TM_COV
      LCALL DTOB
      LCALL DTOB1
      CLR C
      MOV A,33H
      SUBB A,44H
      MOV 44H,A
      MOV A,34H
      SUBB A,45H
      MOV 45H,A
      RET

    __INTT0__:PUSH ACC
          PUSH B
          SETB RS0
          INC R2
          CJNE R2,#100,__JT0__
          INC 6FH
    
          MOV A,6FH
          CJNE A,#20,__JT0__
          MOV 6FH,#00H
          INC R3
          MOV R2,#00H
          CJNE R3,#2,__JT0__
          SETB 01H
          MOV R3,#00
    
     __JT0__: CLR RS0
          POP B
          POP ACC
          RETI


KKEY: MOV R2,#00
      MOV R4,#0AH
 KS2: LCALL TM_DISP
      DJNZ R4,KS2
      SETB P2.1
      JB P2.1,KKEY1
      JNB P2.1,$
      MOV 60H,#DSPBUF+1
      MOV R1,#DSPBUF+1
      MOV R2,#00
KEY1: LCALL TM_DISP_2
      MOV P2,#0FFH
      MOV A,P2
      ORL A,#01
      CPL A
      JZ KEY1

KEY2: JNB ACC.1,KEY3
      JNB P2.1,$
      INC R1

      INC R2
      CJNE R2,#03,L13
      MOV R1,#DSPBUF+1
      MOV R2,#00

 L13: MOV 60H,R1
      SJMP KEY1
KEY3: JNB ACC.2,KEY4
      JNB P2.2,$
      MOV A,@R1
      CJNE R1,#41H,L1
      CJNE A,#09,LL
      SJMP KEY5
  L1: CJNE R1,#42H,L2
      MOV A,@R1
      CJNE A,#09,LL
      SJMP KEY5
  L2: CJNE R1,#43H,L3
      CJNE A,#09,LL

KEY5: MOV @R1,#00
  L3: SJMP KEY1
  LL: INC A
      MOV @R1,A
  L6: SJMP KEY1
KEY4: JNB ACC.3,KEY1
      JNB P2.3,$
      MOV 30H,41H
      MOV 31H,42H
      MOV 32H,43H
      ACALL DTOB
KKEY1:RET

     DTOB:SETB RS0
          SETB RS1
          MOV A,31H
          MOV B,#10
          MUL AB
          ADD A,32H
          MOV 33H,A
          MOV 34H,#00
          MOV R6,30H
          CJNE R6,#00,JT2
          SJMP JT22
     JT2: MOV A,33H
          ADD A,#100
          MOV 33H,A
          MOV A,34H
          ADDC A,#00
          MOV 34H,A
          DJNZ R6,JT2
     JT22:CLR RS1
          CLR RS0
          RET

  DTOB1:  SETB RS0
          SETB RS1
          MOV A,42H
          MOV B,#10
          MUL AB
          ADD A,43H
          MOV 44H,A
          MOV 45H,#00
          MOV R6,41H
          CJNE R6,#00,JJT2
          SJMP JJT22
    JJT2: MOV A,44H
          ADD A,#100
          MOV 44H,A
          MOV A,45H
          ADDC A,#00
          MOV 45H,A
          DJNZ R6,JJT2
   JJT22: CLR RS1
          CLR RS0
          RET
WR_18B20: MOV R2,#08H
         CLR C
         SETB DQ
         MOV R3,#02H
         DJNZ R3,$
         NOP
    WR1: CLR DQ
         MOV R3,#03H
         DJNZ R3,$
         RRC A
         MOV DQ,C
         MOV R3,#20
         DJNZ R3,$
         SETB DQ
         MOV R3,#03H
         DJNZ R3,$
         DJNZ R2,WR1
         SETB DQ
         RET
RD_18B20: MOV R4,#02H
          MOV R1,#22H
     RE0: MOV R2,#08H
     RE1: CLR C
          SETB DQ
          NOP
          CLR DQ
          NOP
          NOP
          SETB DQ
          MOV R3,#01H
          DJNZ R3,$
          MOV C,DQ
          MOV R3,#010H
          DJNZ R3,$
          RRC A
          DJNZ R2,RE1
          MOV @R1,A
          DEC R1
          DJNZ R4,RE0
          RET
INI_18B20: SETB DQ
           NOP
           CLR DQ
           MOV R4,#150
           DJNZ R4,$
          ;LCALL TM_DISP
          ;LCALL TM_DISP
           SETB DQ
      TS0: MOV R4,#19H
           JNB DQ,TS1
           DJNZ R4,TS0
           SJMP TS2
      TS1: SETB FLAG
           SJMP TS3
      TS2: CLR FLAG
           SJMP TS4
      TS3: ;LCALL TM_DISP
           MOV R4,#120
           DJNZ R4,$
      TS4: SETB DQ
           RET
DELAY8ms: MOV R6,#2H
      KL1: MOV R7,#80H

      KL2: DJNZ R7,KL2
          DJNZ R6,KL1
          RET

GET_TM: SETB DQ
    S1: LCALL INI_18B20
        JB FLAG,S2
        SJMP S1
    S2: MOV R4,#10H
        DJNZ R4,$
        MOV A,#0CCH
        LCALL WR_18B20
        MOV A,#44H
        LCALL WR_18B20
        MOV R4,#0ffH
    S3: LCALL TM_DISP
        DJNZ R4,S3
    S4: LCALL INI_18B20
        JB FLAG,S5
        SJMP S4
    S5: MOV A,#0CCH
        LCALL WR_18B20
        MOV A,#0BEH
        LCALL WR_18B20
        LCALL RD_18B20
        LCALL INI_18B20
        MOV R4,#10H
    S6: LCALL TM_DISP
        DJNZ R4,S6
    S7: RET
TM_COV: MOV A,#0F0H
        ANL A,TM_L
        SWAP A
        MOV TM_NUM,A
        MOV A,TM_H
        ANL A,#07H
        SWAP A
        ORL A,TM_NUM
        MOV TM_NUM,A
        MOV R0,#DSPBUF
        JNB 0FH,SING
        MOV @R0,#0BH
        CPL A
        CLR ACC.7
        ADD A,#01H
        MOV TM_NUM,A
        SJMP SING1
  SING: MOV @R0,#0AH
 SING1: MOV B,#10
        DIV AB
        INC R0
        MOV @R0,A
        INC R0
        MOV A,B
        MOV @R0,A
        INC R0
        MOV A,#00H
        JNB 13H,DOT1
        ADD A,#50
  DOT1: JNB 12H,DOT2
        ADD A,#25
  DOT2: JNB 11H,DOT3
        ADD A,#12
  DOT3: JNB 10H,DOT4
        ADD A,#6
  DOT4: MOV B,#10
        DIV AB
        MOV @R0,A
        RET
TM_DISP: CLR RS1
         CLR RS0
         MOV DPTR,#TAB
         MOV R0,#DSPBUF
         MOV B,#0FEH
         MOV R5,#04
   DIP1: MOV A,@R0
         MOV P0,#0FFH
         MOV P1,#0FFH
         MOVC A,@A+DPTR
         CJNE R5,#02,DIP2
         ANL A,#7FH
   DIP2: MOV P0,A
         MOV A,B
         MOV P1,A
         RL A
         MOV B,A
         LCALL DELAY8ms
         INC R0
         DJNZ R5,DIP1
         RET
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
TM_DISP_1: CLR RS1
         CLR RS0
         MOV DPTR,#TAB
         MOV R0,#DSPBUF
         MOV B,#0FEH
         MOV R5,#04
 DDIP4:  MOV A,R0
         MOV P0,#0FFH
         MOV P1,#0FFH
         CJNE A,60H,DDIP1
         MOV A,#0FFH
         SJMP DDIP3
  DDIP1: MOV A,@R0
         MOVC A,@A+DPTR
  DDIP3: CJNE R5,#02,DDIP2
         ANL A,#7FH
  DDIP2: MOV P0,A
         MOV A,B
         MOV P1,A
         RL A
         MOV B,A
         LCALL DELAY8ms
         INC R0
         DJNZ R5,DDIP4
         RET
 ;;;;;;;;;;;;;;;;;;;;;
 TM_DISP_2: MOV R4,#10H
  KS4: LCALL TM_DISP
      DJNZ R4,KS4
      MOV R4,#1FH
  KS5: LCALL TM_DISP_1
      DJNZ R4,KS5
      RET
TAB:
DB 0C0H,0F9H,0A4H,0B0H,99H,92H,82H,0F8H,80H,90H,0FFH,0CFH
END

```

# 附录二  硬件电路图

![图10-8 硬件电路图](http://my.gunplan.top/static/yj1.png)
# 摘 要

本设计基于基于STC89C52RC单片机的温度控制系统的工作原理和设计方法。本文介绍了控制系统的硬件部分，包括：温度检测电路，温度控制电路，显示电路。单片机处理信号线单片机对信号进行相应处理，以达到温度控制的目的。该文档还重点介绍了采用模块化结构的软件设计部分。介绍了该控制系统的硬件部分会在文中写出，包括的模块是：数字管显示程序，键盘扫描和按键处理程序，温度信号处理程序，继电器控制程序和过热报警程序。同时，还包括系统中复杂的电路设计等方式。主程序，读取温度子程序，键处理程序，LCD显示程序和数据存储程序。该控制系统可以实时存储相关的温度数据并记录当前的时间。系统程序主要包括主程序，读出温度子程序，处理轮转子程序，转换温度计算子程序、按键处理结构、LCD显示程序以及数据存储程序等。



**关键词：AT89C51，单片机 ，DS18B20温度芯片，温度控制**  



# Abstract

This design uses STC89C52RC single-chip microcomputer as the core of the working principle and design method of temperature control system. The temperature signal is collected by the temperature chip DS18B20 and transmitted to the single-chip microcomputer as a digital signal. This article introduces the hardware part of the control system, including: temperature detection circuit, temperature control circuit, display circuit. The single chip microcomputer processes the signals accordingly to achieve the purpose of temperature control. The single chip microcomputer processes the signals accordingly to achieve the purpose of temperature control. The paper also focouses on the software design part, which adopts a modular structure. The main modules are: digital tube display prog random access memory, keyboard scanning and key processing prog random access memory, temperature signal processing prog random access Memory, relay control prog, random access memory, and over-temperature alarm pr ocess. The control system can store relevant temperature data in real time and record the current time. The system prog random access memory mainly includes a main prog random access memory, a readout temperature subprog random access memory, a calculation temperature subprog random Access memory, a key processing prog random access memory, an LCD display prog random access memory, and a data storage prog random access memory.



----




# 第1章 绪 论

## 1.1 温度控制系统研究的目的和重要性

在人类历史上，环境温度起着极其重要的作用。环境温度是工业生产中最常见的工艺参数之一。每个物理变化和每个化学反应过程都与温度密切相关。因此，温度控制是生产自动化中的重要任务。随着社会的发展，科学技术的进步以及温度测量设备在各个领域的使用，智能化是现代温度控制系统发展的主要组成部分。尤其是近年来，温度控制系统已经应用于人们生活的各个方面，但是温度控制一直是一个尚未发展的领域，但这是一个与人类息息相关的世纪之久的问题。在这种实际情况下，温度控制系统的设计具有广阔的应用前景和重要性。

此结构是为室温控制系统设计的，控制对象是室温。温度控制通常用于日常生活和工业领域，例如用于冷室，洗澡池，酵母池，电源和其他地方的温度控制。过去，温度控制是手动进行的，没有给予足够的重视。实际上，在许多地方都必须很好地调节温度。鉴于此问题，此系统设计的目的是创建一个可使其自身适应设定温度的系统。它被广泛使用，功能强大，小巧美观，易于携带。这是一种实用且廉价的控制系统。

## 1.2 温度控制系统研究概况

国外对温度控制技术的研究始于1970年代。首先，使用模拟组合仪器来收集现场信息并执行指令，记录和控制。分布式控制系统出现在1980年代后期。目前正在开发用于计算机数据采集的控制系统的集成多因素控制系统。当前，温度测量和控制技术在全球不同国家中迅速发展，并且一些国家正在朝着完全自动化和无人值守的方向发展。

中国对温度测量和控制技术的研究相对较晚，始于1980年代。中国工程师和技术人员已经吸收了工业化国家对温度测量和控制技术的吸收，从而掌握了室内温度的微机控制技术。该技术仅限于控制环境中的单个温度因子。中国温度测控设备的计算机应用一般处于从消化吸收阶段，易应用阶段到实用化，全面应用阶段的过渡和发展。从技术上讲，大多数情况下都存在由单片机控制的单参数单回路系统，并且没有真正的集成多参数控制系统。与工业化国家相比，差距很大。我国温度测控的现状还远远没有达到工业化水平。生产中仍有很多困扰我们的问题。设备支持能力差，工业化程度低，环境控制落后，软件和硬件资源无法共享和可靠。缺点，例如不良性行为。

##  1.3 温度传感器技术

传感器技术是现代信息技术的主要内容之一，信息技术包括计算机技术、通信技术和传感器技术。计算机和通信技术发展极快，相当成熟，而传感器应用技术因为需要使用模拟技术，而模拟技术还有很多问题难以解决，因此传感器应用技术也有待进一步发展。为了适应现代科学技术的发展，世界总舵国家都把传感器技术列为现代的关键技术之一。通常将能把非电量转换为电量的器件称为传感器，其实质上是一种功能块，作用是将来自外界的各种信号转换成电信号。它是实现测试与自动控制系统的首要环节。如果没有传感器对原始参数进行精确可靠地测量，那么无论是信号转换或信息处理，或者最佳数据的显示和控制都将无法实现。 

温度传感器，使用范围广，数量多，居各种传感器之手。温度传感器的发展大致经历了以下三个阶段：传统的分立式温度传感器（含敏感元件），主要输能够进行非电量和电量之间的转换；模拟集成温度传感器/控制器；智能温度传感器。目前，国际上新型温度传感器正从模拟式向数字式、集成化、智能化及网络化的方向发展。温度传感器按传感器与被测介质的接触方式可分为接触式温度传感器和非接触式温度传感器两大类，其中，接触式温度传感器的测温元件与被测对象要有良好的热接触，通过热传导及对流原理达到热平衡，这个示值即为被测对象的温度。这种测温方法精度比较高，并可测量物体内部的温度分布。但对于运动的、热容量比较小的及对感温元件有腐蚀作用的对象，这种方法将会产生很大的误差。非接触测温的测温元件与被测对象互不接触。常用的是辐射热交换原理。此种测温方法的主要特点是可测量运动状态的小目标及热容量小或变化迅速的对象，也可测量温度场的温度分布，但受环境的影响比较大。 

温度传感器的发展大致可分为以下几种：  
1. 热电偶传感器。热点偶传感器是工业测量中应用最广泛的一种温度传感器，它与被测对象直接接触，不受中间介质的影响，具有较高的精度；测量范围广，可从-50℃～1600℃进行连续测量，特殊的热电偶如金,铁,镍,铬最低可测到-269℃，钨,铼最高可达2800℃。
2. 模拟集成温度传感器。采用硅半导体集成工艺制成的，因此亦称硅传感器或单片集成温度传感器。模拟集成温度传感器是在20世纪80年代问世的，它将温度传感器集成在一个芯片上、可完成温度测量及模拟信号输出等功能。模拟集成温度传感器的主要特点是：功能单一、测温误差小、价格低、响应速度快、传输距离远、体积小、微功耗等，适合远距离测温，不需要进行非线性校准，外围电路简单。
3. 光纤传感器。光纤测温技术可分为两类:全辐射测温法，单辐射测温法，双波长测温法，多波长测温法等。特点是：光纤挠性好、透光谱段宽、传输损耗低，无论是就地使用或远传均十分方便而且光纤直径小，可以单根、成束、Y型或阵列方式使用，结构布置简单且体积小。缺点是：测量起来困难,难于实现较高的精度，工艺比较复杂,且造价高，推广应用有一定困难。
4. 半导体吸收式光纤温度传感器。半导体吸收式光纤温度传感器是利用了半导体材料的吸收光谱随温度变化的特性实现的。一种传光型光纤温度传感器，是指在光纤传感系统中，光纤仅作为光波的传输通路，而利用其它如光学式或机械式的敏感元件来感受被测温度的变化。在这类传感器中，半导体吸收式光纤温度传感器是研究得比较深入的一种。
5. 智能温度传感器。智能温度传感器(亦称数字温度传感器）是在20世纪90年代中期问世的。它是微电子技术、计算机技术和自动测试技术（ATE）的结晶。目前，国际上已开发出多种智能温度传感器系列产品。智能温度传感器内部包含温度传感器、A/D传感器、信号处理器、存储器（或寄存器）和接口电路。有的产品还带多路选择器、中央控制器（中央处理单元）、随机存取存储器（随机存取存储器）和只读存储器（只读存储器）。智能温度传感器能输出温度数据及相关的温度控制量，适配各种微控制器（M中央处理单元），并且可通过软件来实现测试功能，即智能化取决于软件的开发水平。

随着科学技术的不断进步与发展，温度传感器的种类日益繁多，数字温度传感器更因适用于各种微处理器接口组成的自动温度控制系统具有可以克服模拟传感器与微处理器接口时需要信号调理电路和A/D转换器的弊端等优点，被广泛应用于工业控制、电子测温计、医疗仪器等各种温度控制系统中。其中，比较有代表性的数字温度传感器有DS18B20、MAX6575、DS1722、MAX6635等。相比较而言，传统的温度检测以热敏电阻为温度敏感元件，热敏电阻成本低，但需要后续信号处理电路，而且热敏电阻的可靠性相对较差，测量温度的准确度低，检测系统的精度差。数字式温度传感器的种类也不少，并且在实际工程设计中具有上述诸多优点。
# 第2章 系统总体方案设计

## 2.1 系统工作原理

单片机温度控制系统是以AT89C51单片机为控制核心，辅以采样反馈电路，驱动电路，晶闸管主电路对电炉炉温进行控制的微机控制系统。系统的原理框图如图2-1所示，其基本控制原理为: 用键盘将温度的设定值送入单片机，并在发光二极管显示，启动运行后，通过信号采集电路将温度信号采集到后，送入单片机系统进行PID 控制运算，将控制量输出，改变可控硅管的接通时间便可改变加热丝功率，以达到调节温度的目的控制电阻炉的加热。

当由于环境温度变化太剧烈或由于加热或降温设备出现故障，或者温度传感头出现故障导致在一段时间内不能将环境温度调整到规定的温度限内的时候，单片机通过三极管驱动扬声器发出警笛声。 

![图1-1 第一个方案](http://my.gunplan.top/static/1.0.0.PNG)

图1-1为第一个设计方案，该方案的工作原理简述如下：

1. 锯齿波是由单结晶体管BT和R1，R2，R3，W1和C1组成的张驰震荡产生，然后经射极跟随器V1、R4输出。
2.  控制电压（Uk）与锯齿波电压进行电流叠加后送到V2的基极，合成电压为Us，当Us>0（0.7）时V2导通，Us<0，则V2截止。
3.  由V2、V3以及R8、R9、DW1组成一直流开关，当V2基极电压Ube2>0(0.7)，V2导通，Ube3接近零电位，V3截止，直流开关导通。输出24V直流电压。
4.  过零脉冲的输出，由同步变压器TB，整流桥D1及R10，R11组成一削波同步电源，这个电源与直流开关的输出电压共同去控制V4与V5。只有当直流开关导通期间，V4截止，V4、V5基电极和发射极之间才有工作电压，才能工作在期间，同步电压每次过零时，V4截止，其集电极输出正电压，使V5由截止转导通，经脉冲变压器输出触发脉冲而此脉冲使晶闸管T在需要导通的时刻导通。

在直流开关导通期间使出连续的正弦波控制电压Uk的大小决定了直流开关导通时间的长短，也就决定了在设定周期内导通的周波数，从而可输出功率的调节。显然，控制电压Uk越大，则导通的周波数就越多，输出的功率也就越大，电阻炉的温度也就越高，反之，电阻炉的温度就越低。
闭环控制自动调温的基本指导思想是在系统中增设温度传感器和温度调节器，温度传感器的基本功能是检测电炉的实际温度，并变换成电压讯号和炉温控制电压Uk进行比较，根据两者差值的大小（Δe=Uk-Uft）和变化方向（即△e为正还是为负），通过调节器进行相反方向的调节，使调节器的输出控制直流开关导通时间的长短，从而使设定周期内晶闸管的导通周波数增大或者减小，相应的电炉温度升高一点或者减小一点。采取这种控制方式，可以使炉温在较小的范围内变化，控制精度高。
方案二：为了使得电路的简单化，采用单片机作为控制核心来设计本课题，温度信号采集使用温度传感器DS18B20，温度控制的基本思想为：通过采集到的温度与标准温度之间的差值来控制加热电阻丝的通电时间长短，从而起到恒温控制的目的。方案二的设计框图如下图所示：

![图1-2](http://my.gunplan.top/static/1.0.0.PNG)

本方案采用单片机作为控制核心，使用温度传感器进行温度采集，通过将采集到的温度与标准设定温度之间的差值进行温度控制，从而使得温度维持在标准设定温度。本方案设计成本低，具有具有较高的可靠性，对于系统动态性能与稳定要求不是很高的场合非常的合适。

单片机温度控制系统是以AT89C51单片机为控制核心，辅以采样反馈电路，驱动电路，晶闸管主电路对电炉炉温进行控制的微机控制系统。系统的原理框图如图2-1所示，其基本控制原理为: 用键盘将温度的设定值送入单片机，并在LED显示，启动运行后，通过信号采集电路将温度信号采集到后，送入单片机系统进行PID 控制运算，将控制量输出，改变可控硅管的接通时间便可改变加热丝功率，以达到调节温度的目的控制电阻炉的加热。

当由于环境温度变化太剧烈或由于加热或降温设备出现故障，或者温度传感头出现故障导致在一段时间内不能将环境温度调整到规定的温度限内的时候，单片机通过三极管驱动扬声器发出警笛声。

## 2.2 系统功能介绍

本设计是对房间温度进行检测与控制，设计的温度控制系统实现了基本的温度控制功能：当温度低于设定的温度时，系统自动通过PWM启动加热装置，使温度上升。当温度高于设定的温度时，停止加热。三位数码管及时显示温度，精确到小数点后一位。  
本文设计的温度控制系统具有如下功能：

1. 通过温度芯片DS18B20采集温度，并以数字信号的方式传送给单片机。
2. 四位数码管动态实时显示房间温度，显示精度0.10C。
3. 三个按键实现标准温度的设定。
4. 利用PWM实现温度的控制。



# 第3章系统硬件电路设计

![图3-1电路硬件图](http://my.gunplan.top/static/2.0.1.png)

该解决方案使用AT89C51为核心处理芯片，芯片DS18B20测量内部温度，通过发送信号传输总线到MCU，并且和一个4位LED显示管温度。偏差用于控制电阻丝导通/截止时间的长度。实现恒温控制的界面的最终想法是最终想法。

## 3.1 各模块设计

### 3.1.1 温度传感器电路

本文在课题教学研究中所采用的的温度传感器一般可以分为采用一个美国两个单线的四位数字小型环境温度传感器例如ds18b20。该稳压传感器4.7k##hz该传感器用于输出稳压信号的上和下拉稳压电阻直接通过连接输入到一个微控制器的一个p1.0引脚。

半导体温度传感器DS18B20产生Dalalas数字温度传感器，多并行总线技术。该器件在小型集成电路芯片上制造温度敏感的半导体器件、 A / D 转换器、存储器等。在对本设计中的温度传感器进行多次比较和考虑之后，选择了单线数字设备DS18B20，主要是由于以下原因：

1. 该检测系统的主要特点功能是：在一个允许温度范围的工作检测温度是-55℃〜+125℃，±0.5度的工作温度和在测量值的精度是5℃。温度函数转换器高精度。9至12变量，温度检测值数据可以被直接转换成一个串行16位的非二进制的或数字输出形式的数据输出;最大输入时间频率转变精度为12位测量精度转变为750ms;它们都可以通过一条数据线被直接供电，具有超低电源功耗。
2. 系统进行成本：由于我国计算机信息技术和微电子科学技术的发展，新型企业大规模集成电路设计越来越具有强大，体积变得小是越来越会发生的，价格也会下跌。DS18B20提交空间与普通晶体管之间几乎没有本质区别的，价格只有约$1。
3. 降低系统总线技术操作复杂度：由于设备ds18b20是单总线测量设备，微处理器与之进行接口时只不过需要至少占用在校学生一个模拟i/o口，一根模拟总线测量方式线就可以同时连接数十个设备ds18b20，温度管理进行总线测量方法完全无需任何模拟企业外部网络控制元件，因此，与传统模拟工业生物温度传感器中的网络系统相比，可以测量得到大大幅度增加以及减少系统布线调试次数，降低温度管理系统的技术复杂性，减少重大工程项目的基础建设工作量。
4. 减少系统的引线调试和日常维护：由于大量减少的系统引线数量可以不会引起一些小的事情，大量使用减少接线的工程数量，减少接线工程数量产生的引线施工成本量大大降低，系统的内部布线过程复杂度的降低调试和日常维护另一方面，因为系统引线接口数量的减少产生的故障数量大大下降，使得整个系统中的接口工作变得简单许多，给系统的日常调试工作带来更多方便，之所以认为dsl8820是全方位数字化的元器件，故障基本不会同时发生，干扰性的和可抗性强，因此为了让整个系统的在整个日常生活中而所进行需要保证正常工作的维护任务大大减少，为了更好保证系统可用性而所进行的日常维护相关工作保证正常系统运行的维护工作。

ds18b20温度控制系统传感器引线技术通常存在一个小的引线，引线上的数量通常是3，并且我们可以确定不在一个企业内部：一个单线程的数据网络信息传输包括系统总线数据端口vvdq、外部数据电源线vdd和公共网络地址总线端口gnd。ds18b20有2种直流供电的工作方法：其一种就是采用杜邦线的直流供电电压模式。此时，vdd被完全接地。当它开始产生能量空闲时，它通过内部一个电容器线路来让它存储剩余电量用从外部数据线路中获得剩余能量并用来让它完成整个温度功率转换，相应的当它完成整个温度功率转换的持续时间也会更长。在这种应用情况下，使用一个单片机的一个矩形i/o输出端口让它来自动拉起一个ds18b20总线。另一种模式是外部温度电源连接模式(vdd电源连接+5v)，完成外部温度变化测量的时候相应操作时间短。

在本设计项目中我也可以直接采用由大学生企业提供的并不在相关企业内部的各种电子信息流的流动强度及其发展计算方式等来进行设计实现。cds18b20传感器与驱动单片机的接口连接，其内部接口集成电路设计方案如软件图2-2所示。

![图2-2外部电路](http://my.gunplan.top/static/003.jpg)

### 3.1.2 通用键盘显示电路设计

![图2-3外部电路](http://my.gunplan.top/static/003.jpg)

所示，ale时钟脉冲可以作为一个时钟同步电路8279，从而与示意图的两个时钟脉冲同步。2-3。8279芯片的控制中断电路控制输出信号irqr连接到一个控制单片机的一个p1-1引脚。缓冲器输入地址是将寄存器中的a0连接输入到整个单片机的一个p2-5引脚，ae的缓冲信号则是连接到整个单片机的一个p2-6引脚。读写器和信号数据线缆分别和两个单片机的信号读写器和信号数据线缆来进行连接相连。8279芯片的外部数据传递运输线路由d0-d7与整个单片机的外部数据线直接相连进行相应的连接。

来自8279芯片和AT89C51芯片的许多信号是一致的，可以直接级联，这非常容易控制。8279芯片的8位数据线进行直接连接到AT89C51芯片的P0端口。读取和写入信号连接到89C51的读取和写入信号。 AT89C51锁存信号ALE连接到8279 CLK，在内部分频后，会产生一个公共的非外部时钟脉冲。8279芯片的端子请求信号由反相器反转，然后连接到AT89C51的P1.1端口。 AT89C51的三个可寻址寄存器只需要两个地址即可寻址，即命令/状态寄存器地址和数据寄存器的地址值。8279芯片中与地址相关的信号是A0和芯片选择信号。您的连接直接确定寄存器地址在哪里。一旦确定了硬件电路，就确定了寄存器的地址。

发光驱动二极管的色号发光驱动效率和显示颜色分别取决于每个制造商的材料，如果出现没有什么意外情况是可以使用egred色号，出现其他意外情况可以使用reyellow或是egreen色号。发光电子二极管又称发光电子二极管主要是利用智能电子技术通过测量管理系统控制测量仪表中简单而常用的进入输出一个控制装置，通常说它可以直接用于用来指示一个机器的工作状态或其他相关企业服务信息。具有系统功耗低、配置灵活、接口方便、价格低廉、使用寿命长、对各种电子管直流的流动强度和电势差异性要求低、易于手动实现连接多种电路等多大优点。

液晶电视显示器本身是被动电子显示器，它本身不向外调节发出一种具有一定粒子性的主动电磁波，只需向外调节其发出一种具有一定粒子性的被动电磁波的频率数量。目前，常用的彩色液晶信息显示器通常是根据中国的而液晶对于信息显示失真率的问题总是按克列拉斯效应的基本原理设计制成的，它通常可以通过同时获得一个位于黑色信息发展初始背景上的一个白色初始字符或一个白色初始背景上的一个黑色初始字符的方式显示不同信息形式。便携式检测仪器主要用于电力测量和分析控制和检测智能动力电池中的电力，考虑到低损耗功率的应用要求，经常我们需要同时使用的就是液晶电视显示器，重量轻，功耗低的而且体积小，因此，广泛作为采用的检测手段。但是必须需要借助外来的灯光进行显示。阴极红外射线图形显像管这种显示器虽然可以同时显示多种图形，但显示界面更复杂，成本更高。

在多路显示温度自动巡检仪中只要您需要同时显示4位的和数字两种形式的显示温度和检测路数，可以不必考虑使用某种价格较高的荧光阴极或红射线液晶显像管;4位数字发光光电二极管的实际工作频率电子在直流的波动强度一般为240ma左右，由于需要使用一个交流电源进行供电，足以完全提供四位发光光电二极管液晶显示器所使用需要的最大功率，对于四位发光光电二极管而言，仅有4位，体积也很小，这样比较符合发光光电二极管和四位液晶电视显示器的诸多性能特点，本检测系统建议选择四位发光光电二极管液晶显示器。

键盘设计是一组多按键的整体组合。其主要工作功能之一是实时控制操作系统的正常工作运行状态，向系统接口输入大量数据和发出命令。有两种键盘类型：标准编码数字键盘和非标准编码数字键盘。

除了单个按键之外，编码器的键盘系统还包括一个用于自动生成键码的多个硬件控制电路、抖动控制电路、多个击键和多个按键之间移动时的保护器等电路。每按一个数字键，就表示可以自动重新生成这个数字键的键码。同时还会产生一个脉冲控制信号，通知系统中央处理控制单元进行接收。这种单片键盘使用方便，接口使用程序简单，但由于需要使用更多的相关硬件集成电路，价格也会变得更高，一般来说单片机键盘应用在该系统中的应用不是非常多。

非按列编码数字键盘仅由按行矩阵排列和非按列排行矩阵两种形式的编码键盘所组成。按键的抖动作用主要是简单地停止连接或自动断开触点，按键的触点抖动、按键软件代码的自动形成和每个按键的自动识别都必须是由按键软件操作来自动完成的。由于其价格经济并且实用，在各种单片机硬件应用管理系统中已经得到广泛应用。

上述一系列比较之后，它应该是非编码键盘。

P0端口： P0端口为8位漏极级开路双向 I/O 端口，每个引脚可吸收8TTL 栅极电子流的强度。当端口 P1的引脚首次写入1时，它被定义为高阻输入。P0可用于非内部程序数据存储器，可以定义为数据/地址的第八位。在 FIASH 编程中，P0作为原始代码输入端口。检查 FIASH 时，P0输出原始代码，必须拉起 P0的外部。

端口设置p1：端口设置p1是一个8位双向模拟i/o输出端口，内部分别提供上或下拉输出电阻。端口强度p1缓冲区强度可以达到接收进入输出4ttl门口的电子负载流的最大强度。p1端口的写入管脚板在写入1后，内部拉高，可以直接作为数据输入。当一个端口上的p1从外部被下拉到低稳压电平时，它将达到输出一个电子到直流的最大强度，这可能是由于内部上压下拉。在执行可以被擦除的非读写数据存储器程序编程和数据验证程序过程中，p1端口通常作为第8个输入地址被程序接收。

p2端口：p2端口是它是一个内部上和下拉稳压电阻的8位双向模拟i/o端口。p2端口栅极缓冲器引脚可以用来接收和控制输出4个ttttl栅极缓冲电子的直流的缓冲强度，当一个端口缓冲p2被直接写入"1"时，其引脚被内部上和下拉栅极电阻拉高并可以用作缓冲输入。因此，当它被直接用作电流输入时，端口位于p2的引脚被外部电压拉低到位于输出端的电子负载流的最大强度。这可能是由于内部上下牵拉的原因缘故。当p2端口，用于外部执行程序数据存储器或外部程序数据处理存储器同时访问的16位数据地址，输出时的端口相当p28的8位地址。读出和存储写入外部输出数据时在存储器输入地址8时，p2端口作为输出数据内容在特殊寄存功能下的寄存器。p2端口在整个闪存硬件编程和数据验证系统工作期间使它可以同时接收高八位存储地址以及存储信号和闪存控制器在系统中的信号。

p3端口：p3端口引脚为8个双向直流i/o控制端口，带有内部上压下拉控制电阻，可同时接收和控制输出4个在tttl栅极上的电子到直流的最大强度。当两个p3端口开始写入"1"时，它们在内部被迅速拉升并达到高水平并且被用作信号输入。作为一个输入，由于外部下拉低，p3端口将由于上下下拉而达到输出一个电子负载流的最大强度(ill)。

p3端口如果可以使用作为at89c51的一些特殊控制功能的通用接口也是完全可以的，如下面列表所示：

管脚备选功能

：-：：-：

P3.0 RXD (串行输入)

P3.1 TXD (串行输出)

P3.2/INT0(外部中断0)

P3.3/INT1(外部中断1)

P3.4 T0(定时器0外部输入)

p3.5t1(外部微波信号定时器1外部微波信号发出输入)

P3.6/WR (外部数据存储器写门)

P3.7/RD (外部数据存储器读取频闪)

p3端口同时它也可以用来接收一些主要的可用于总线进行射频闪烁信号编程和射频编程性能验证的射频控制电路信号。

rst：振荡器的复位字节输入。当外部振荡微处理器重置为一个器件时，在两个机器工作周期内保持一个rst引脚的高电平。ale/prog：当振荡器访问一个企业外部的数据网络存储器时，使用网络地址锁存器引脚所允许的外部输出正脉冲信号的高电平来对锁存网络地址的位置和状态进行复位字节。此引脚主要用于在振荡器的闪存脉冲编程期间通过脉冲输入用于闪存编程的脉冲。在通常的，周期性脉冲输出的ale正脉冲信号的恒定脉冲频率大约为1/6振荡器的频率。因此，它们实际上可以跳过一个用作外部脉冲输出的周期性脉冲或跳过一个用于定时目的。但是应该注意的是每一次都需要指出的一点是，外部的数据存储器，这将被用于跳过一个新的ale脉冲。如果振荡器需要禁用一个alert的复位字节输出，可以在振荡器的sfr8eh地址上重新设置0。此时，ale只需要执行一个movr，movd指令为一个新的ale。另外，该引脚被略微拉高。如果外部微处理器在外部脉冲执行的状态ale禁止，则该引脚的设置无效。

psen：外部的应用程序例如数据包和存储器的编程代码包含指令集的选择和数据通门控制信号。在外部软件程序执行的指令代码流在提取中的指令外部程序中的数据流在存储器系统中的每个代码提取指令值在提取期间，每个外部程序机器执行周期有效两次/psen。但是，访问外部应用程序例如数据库和存储器时，这两个有效的/psen的控制信号通常可能不会同时一起出现。

ea/vpp：这是用于保证当/ea端口器继续工作保持低稳压电位，这期间的外部应用程序相同存储器(0000h-ffffh)，无论它的存储器类型是否与内部的应用程序相同存储器。需要特别注意，当外部应用程序开始使用加密的文件方法1时，/ea中的存储器端口会自动锁定内部以用于防止文件重置;同时当/ea端口的继续运行保持正常的最高位时，这里的内部应用程序没有内存。该引脚还同时可以作为用于在不对闪存进行编程期间用于应用12v值的闪存进行编程的备用电源(vpp)。

xtal1：反向控制电路主要用来进行控制振荡信号放大器的时钟输入和内部时钟输出是用来进行控制系统的内部时钟质量管理工作以及辅助系统控制反向电路的外部驱动控制器的输入。

XTAL2：来自反向振荡器的输出。

### 3.1.3 振荡器特性

xtal1和外部xtal2分别提供的是片内反相放大器的脉冲信号输入和振荡器输出。该系列反向放大器的设备可以直接配置为片内的振荡器。石晶振荡和陶瓷振荡均可广泛采用。如果放大器使用外部的时钟源脉冲驱动的设备，则放大器不应需要连接xtal2。对内部的时钟源脉冲信号的多余脉冲输入信号需要通过两频的分频脉冲触发，因此放大器对外部时钟源脉冲信号的所需脉冲的宽度没有严格的要求，但是必须注意保证时钟源脉冲的频率高低和电平的所需脉冲宽度。

### 3.1.4 芯片擦除

通过快速组合正确的两个锁定保存位芯片控制电阻信号并同时将它保持在比ale引脚低10ms，可以轻松快速完成整个程序pe-rom两个芯片控制阵列和三个用于锁定保存位的两个芯片控制电阻被擦除。在重复执行一个芯片用于锁定内存位置的电擦删删除的每个操作中，代码中的数据元组被允许重复执行写入"1"，并且必须在执行芯片锁存重复执行写入一个可编程非零时空函数存储器的字节之前，它才能重复执行此位电擦除后的操作。

此外，at89c51配备了固定的逻辑，可以从低频动态到零的频率静态，支持两种软件模式和可选的自动关机中断模式。系统在空闲时中央控制单元软件自动停止振荡器的工作。然而，随机存取的存储器，定时器，计数器，串行接口和振荡器中断系统继续保持正常工作。在这种关机中断模式下，将自动保存随机存取存储器的所有内容，并自动冻结振荡器，并自动停用所需要使用的其他硬件和芯片振荡器的功能，直到振荡器下一次所使用的硬件振荡器复位完成为止。

许多尚不了解51单片机的互联网用户会遇到以下问题：书籍和在线教程中的AT89S51是什么?8051、89C51等，但没听说过89S51。

在这里，剛刚刚入門的单片机新人应该先阐明一下单片机实际使用的一些产品和理念。mcs-51微控制器单片机是基于美国英特公司于1980年推出的一款单片机产品。其典型的产品理念为8031(芯片无内置的程序和存储器，实际的使用已从单片机市场上完全淘汰)，8051(通用芯片设计采用hmos，功耗为630mw，是89c51的5倍)日期根据实际的使用)。但是到目前为止，8751和其他的通用芯片产品仍然可能是完全兼容的，包括mcs-51核心处理器系列和微控制器(目前已全部停产89s51、89c51等)。在加州理工大学和计算机职业技术学校的单片机培训课程和文档中，mcs-51微控制器仍然可以用作基础理论和学习的一个重要代表。

在一些技术文档中，8051甚至被广泛称为是mcs-51系列中的mcu。8051是早期最典型的单片机代表。由于对mcs-51单片机的深刻历史意义，许多微控制器公司都推出了许多兼容这一系列的单片机，这也就意味着他们的内核确实已经存在于mcs-51。它已经成为8位微控制器的一个标准。

其他飞利浦公司的51mcu产品与51mcs-51核心处理器兼容。相同的微控制器程序，在每个飞利浦微控制器设计制造商的产品和硬件上所需要执行的程序和结果可能是相同的，例如，我们常说的89c51，如飞利浦的at89c51(已宣布停产)，89s51，飞利浦(简称飞利浦)和l公司的winbond(winbond)等。已停产的微控制器是飞利浦atmel公司的单片机和at89c51单片机。同时，许多微控制器功能在原始的基础上已经得到了很大的改进，例如b.时钟。闪存越好(程序中只读存储器的所有内容至少一次可以反复重写1000次)。对于只读存储器(一次只能写入)，at89c51的存储器性能远远地要优于8051。

关于目前的市场营销，pic单片机制造商阵营对89c51提出了强烈的质疑。89c51最严重的问题是存在技术缺陷之一就是添加更多isp(在线更新应用程序)的功能目前是不被认为能夠广泛使用的。因此需要通过添加更多isp功能等新功能之后才能在市场上继续使用。mcs-51图例。在这种的情况下，89s51取代了89c51。目前，89s51依然已经变成了单片机市场中大多数人民的选择之中的一个绝大部分。目前市场份额最大的atmel已经宣布停止了生产新的at89c51，将其产品改用全新的at89s51。89s51进行了一系列技术上的改进。89s51采用全新的0.35标注，可有效控制单片机制造基本的成本，改善产品功能，增强市场竞争力。89sxx可以成为兼容89cxx等51系列单片机的芯片。同时，atmel不再需要接受89c的大量订单。你在目前市场上所能看到的89c51实际上已经是atmel以前停止生产的大量库存。

## 3.2 AT89C51单片机简介

at89c51是一个os8-bit微处理器(fpeam只读存储器-flashprog随机存取只读存储器fpram和一个可自动擦除随机存取只读数据的存储器)，俗称嵌入式微控制器。该设计原件是采用基于atmel的高密度非易失性只读存储器的制造技术设计制造，与符合行业标准的atmcs-51指令集与输出引脚指令集是兼容的并可以一直连接到。由于多功能8位中央处理器和闪存指令集结合在一个独立的单芯片中，atmel的at89c51是一个高效的嵌入式微控制器，它为许多的嵌入式控制系统应用提供了一个灵活和廉价的解决方案。

![3-8硬件电路图](http://my.gunplan.top/static/3.2.png)

at89c51可由一个atmel公司的控制器在线进行编程，用于嵌入式温度数据采集和嵌入式数据通信。at89c51是一款低成本功耗、高性能的cmos8位嵌入式单片机，其中主要包含了可通过重复自动擦除1000次的闪存和具有8k字节的isp(指令系统内的prog随机存取程序和存储器matlable)的嵌入式闪存只读程序和存储器，该芯片元器件主要采用了基于atmel的一种高密度、非易失性的嵌入式存储技术设计制造，兼容了标准的mcs-53指令系统和80c51引脚的结构。该系列芯片元器件集成了一个通用的8位中央处理器和一个isp的嵌入式闪存存储单元，功能强大的微型嵌入式计算机的at89c51可以为许多嵌入式控制和管理系统的应用和分析指令系统的发展历程提供一些具有降低生产成本和经济效益的解决问题的方案。at89c51具有以下的特点：40针、4k字节闪存片上应用程序数据存储器、128字节随机存取应用程序数据存储器(随机存取数据存储器)、32个外部双向数据输入/外部输出(i/o)串行通信端口，5个串行中断优先级，2个串行中断优先级嵌套中断，2个16位的可编程定时计数器，2个全双工串行通信控制端口，watchdog(wdt)控制电路，片上时钟振荡器。

at89c51有三个并行的i/o口，p0：p0.0~p0.7，p1.0~p1.7，p2.0~p2.7。此外，当没有片上或外部存储器时，p0端口可以用作公共i/o的端口，当主机使用外部或片上存储器时，p0端口也可以直接用作地址数据线/端口或数据线。p1端口也可以直接作为一个通用的公共i/o端口，p1.0、p1.1、p1.5~p1.7也可以具有特殊的端口功能，如表3.4所示。当主机没有片外存储器时，p2端口可以直接用作公共的i/o端口，当主机使用外部存储器时，p2端口也可以直接用作高8位地址。

|引脚特殊功能

：-：：-：

P1.0 T2：定时器

P1.1 T2EX：定时器

P1.5 MOSI：用于在线编程(ISP)

P1.6 MOSI：用于在线编程(ISP)

P1.7 SCK：用于在线编程(ISP)

表3.4at89c51p1端口的特殊控制功能

引脚特殊功能

：-：：-：

P3.0 RXD (串行端口输入)

P3.1 TXD (串行端口输入)

P3.2 INT0(外部中断输入0)

P3.3 INT1(外部中断输入1)

P3.4 T0(定时器0外部输入)

p3.5t1(外部定时器1外部定时信号发出输入)

P3.6 WR (外部数据存储器写控制)

p3.7rd(外部的数据存储器对外部读取和控制)

表3.5 AT89C51 P3端口的特殊功能

这个房间的温度监控系统主要使用单片机进行通讯和温度检测。 P3.0接受DS18B20。 P0端口用于设计温度显示界面。微控制器和控制电路共享一个外部时钟，使用一个片上存储器并具有上电复位功能。单片机的最小系统如图3.2.1所示：

[图3.2.1 SCM 最小系系统(http：//my.gunplan.top/static/3.2.1.png)

## 3.3 8279芯片简介

### 3.3.1 引脚介绍

8279采用单5V电源供电，40脚封装。

DB0~DB7：双向数据总线，用来传送8279与中央处理单元之间的数据和命令。

clk：时钟的输入数据线，用于时钟产生的具有内部定时的时钟脉冲。

复位：复位输入线，复位后8279设置在字符显示的左输入端，两个按键锁定的设置为接触回弹式，程序需要将时钟输入线的预分频器信号设置为31，并且保证复位后的信号在高电平下有效。

CS：芯片选择输入线，低电平有效，CS 端低电平时单片机可读写8279

A0：缓冲区低地址。当 A0为高电平时，表示数据总线是命令或状态。当 A0低时，表示数据总线是数据总线。

研发：通过读取控制器将信号发送到输入数据总线，低电平有效，读出数据缓冲区，并将内部数据发送到外部数据总线。

WR：写信号输入线，低电平激活，读出缓冲器并将数据从外部数据总线写入8279的缓冲器。

RL2-140-VCCRL3-239-RL 1

CLK-338-RL 0

IRQ-437-CNTL/STB

RL4-536-SHIFT

RL5-635-SL 3

RL6-734-SL 2

RL7-833-SL 1

RESRT-932-SL 0

RD-1031-OUT B0

WR-1130-OUT B1

DB0-1229-OUT B2

DB1-1328-OUT B3

DB2-1427-OUT A0

DB3-1526-OUT A1

DB4-1625-OUT A2

DB5-1724-OUT A3

DB6-1823-BD

DB7-1922-CS

VSS-2021-A0

irq：中断请求的正确输出和执行，高级有效。在这种键盘自动中断工作模式下，当每次出现的从fifo/sensor随机存取的在该存储器中间没有任何数据时，中间的断线由一个低电平线转变为一个新的高电平，每次键盘中断时由从fifo/sensor随机存取的该存储器的所有数据被自动读出，断开的检测线路降至较低的水平。如果随机存取的存储器中仍然存有信息，该行将再次变为一个较高水平。在线路和传感器正常工作的模式下，每当随机检测到线路和传感器的信号发生变化时，中断线就可能会逐渐变高。

sl0~sl3：视频扫描线缆可用于实时连接和自动扫描任何按键或光开关、传感器或光阵列和触摸显示器或屏幕上的任何数字，可编程或支持视频可编解码。

rl0~rl7：按键返回扫描线通过按钮或传感器的开关与返回扫描线进行连接。上拉按压电路一般设置在相应的返回扫描线内部，以使返回线保持在高水平。只有当一次按压电路关闭时，相应的按键和返回线才会自动转变为一个低电平;当一次无按键闭合时，均保持在较高电平。

shift：这是换位驱动开关的主要功能。当一个换档电压开关自动闭合时，它被一个换位电压开关自动拉至较低的相位电压电流水平。同时在每当未按时接下一个好的换档电压开关时，换档电压开关的整个输入电压状态必须保持在一个好的高电平。在正常的自动键盘扫描模式下，按键自动关闭，按键的操作位置和自动换位键的开关和所输入的操作状态一起由自动键盘扫描存储。

cntl/stb：自动高电平电源关闭当用户打开一个cntl/stb的电源开关时，它将自动将其拉低，否则将始终无法保持一个好的高电平。对于所有使用鼠标键盘输入的操作模式，该行通常被用作选择控制输入。例如当用户按下按钮时，按钮的数据位置与所有控制输入状态的数据存储在一起的数据位置相同。在选通控制输入的模式下，通常需要选择它，并将按钮的数据位置存储在一个fifo随机存取的存储器中。

outa3〜outa0和一个outb3〜outb0：显示数据输出一个8位端口a和一个8位端口b。这两个端口之间既可以独立进行控制，也是一个可以单独视为8位的端口。

bd：使用数字数据空间的长度显示。此命令输出的一个信号结果可以直接用于在一个两位数字的字符转换期间进行显示一个空格，或者你也可以通过使用"显示空格"的一个命令行来控制一个信号在显示空格一个字符的转换空间进行显示。

VCC：+5V电源输入线。

VSS：地线输入线。

### 3.3.2 8279的编程方法

8279按其控制功能块的大小可以细分为：显示器和键盘控制功能块;工作和显示控制功能块;工作和控制处理器功能块;键盘控制接口和中央处理器功能块控制功能块主要包含手动控制和时间寄存器，定时和自动控制，扫描和计数器三个组成部分，它主要的功能是用于控制显示器和键盘的工作和显示控制功能块。

控制和时间数据寄存器：一种用于存储键盘和中央控制单元的通用编程语言控制命令。当8279中央处理器的程序人员确定了键盘和显示器的工作状态模式以及其他显示器工作的条件时，首先将命令键和控制数据放置在一个数据总线上，然后使用命令a0=1，wr=0cs=0并将所有的命令和键数据保存在wr沿边缘增加了控制和显示器的时间数据寄存器，并对其进行解码以方便创建适当的命令控制功能。

定时和计数器控制：它通常包含一个基本的键盘定时和计数器。第一个定时计数器控制是一个分频系数范围为2-31的预定时器。我们可以通过应用程序控制其预设的分频系数，以使内部的频率为100khz，这样的频率可能至少会导致5.1ms。包括键盘阵列扫描时间和10.3毫秒的反跳扫描时间。其他的计数器对该基本的频率扫描时间进行了划分，并为我们提供适当的键，行，键盘阵列扫描和显示键盘扫描时间。

扫描键盘计数器：用于扫描键盘的计数器主要有两种基本编码工作的模式。在基本编码计数器工作的模式下，计数器为键盘提供一个二进制的计数器。在外部软件输出引脚sl0-sl3之后，可以为用于扫描键盘的计数器提供二进制的扫描计数器功能，并在外部软件解码后进行显示。在此工作模式下，扫描键盘计数器对最低有效值的两位进行解码，并且输出引脚sl0-sl3输出1分之4的二进制解码信号，以对键盘的显示器和用于扫描键盘的二进制扫描计数器进行解码。

键盘功能块包括：返回缓冲区、键盘弹跳和控制、8x8 FIFO 传感器随机存取存储器、 FIFO/传感器随机存取存储器状态。

#### 返回抖动缓冲器与鼠标键盘的抖动反向起跳及抖动控制

八个返回行由返回缓冲区缓冲。在键盘工作模式下，逐个检测这些行，找出行键中已关闭的键。如果回弹电路检测到钥匙关闭，则等待10.3ms，然后记录钥匙是否仍然关闭。如果仍然关闭，则矩阵中 key 的行地址和列地址以及 SHIFT 和 CNTL 的状态一起发送到 FIFO 随机存取存储器，并且 FIFO 随机存取存储器中的数据格式如下：

D7 D6 D5 D4 D3 D2 D1 D0

CNTL SHIFT SCAN RET URN

数据的进行格式中，最高位为shicntl，次高位为shift状态，d5-d3来自不同的扫描线上电子的计数器，d2-d0来自中国传感器返回一个电子计数器，扫描线电子计数器和一个回扫线电子计数器的开关值分别可以直接反映正在输出被传感器按下开关键的行，列的开关值，如果在一个传感器的阵列中，返回行上的开关数据直接进入与正在输出被扫描的传感器阵列相对应的一个传感器随机存取电子存储器阵列中的行，这样，每个传感器开关的数量和位置直接被传感器反映为一个传感器随机存取电子存储器的开关位置。

#### FIFO/传感器随机存取存储器

8x8随机存取存储器是键盘模式和选通模式下的先进先出(FIFO)存储器。每条新的信息都是按顺序写的，然后按照写的顺序读出来。当传感器阵列扫描时，存储器被用作传感器随机存取存储器。此时，随机存取存储器中的每一行存储传感器阵列中相应行的状态。

#### FIF0/传感器随机存取存储器状态

在使用键盘或门控的错误模式下，fifo中的状态阵列跟踪信号表示fifo中的状态字符数注意它到底是"满"还是"空"，过多的传感器写入或读取被状态逻辑认为可能是错误，当传感器fifo不为空时，状态阵列跟踪逻辑就会提供一个用于中断传感器应用程序irq的信号。在特殊的传感器状态阵列扫描模式下，如果一个有效的传感器状态发生改变，irq信号可能是一个有效的传感器高电平。fifo表示状态字的低3位表示fifo模式中的传感器字符数，fu位表示一个fifo随机存取的存储器已满;o(超过donmn)du位表示超限错误，即传感器试图将另一个传感器的字符发送到完整的传感器fifo;u(done下)du位表示null错误，即传感器试图写入或读取空的传感器fifo。s/f有两种的含义：在特殊的传感器扫描模式下，s/f的含义是指一个传感器随机存取的存储器中至少可能包含一个指示传感器是否闭合的指示，在特殊的错误模式下，s/f位是一个传感器错误的标志，指示了是否传感器发生了多通道同时写入或关闭的错误，du位表示错误显示随机存取的存储器尚未完全可用，因为"清除显示"或"清除全部"的命令已经无法完成其他未被消除的操作。

显示随机寄存器块的功能块主要包括：16x8显示随机寄存器，16x8显示随机存取地址存储器，显示随机地址存取寄存器)

#### 显示随机存取存储器和显示寄存器

8279内部缓存显示器同样具有16x8的缓存形式自动显示随机存取的数据存储器，通过自动显示一个寄存器和两个四位端口0uta0-3，0utbo-3来自动显示刷新外部存储器的数据显示，显示器同样可以是使用的大都是8段数码管或者是白炽灯，也可以有外部显示器同样可以是使用的大都是8段管或数码管，显示随机存取的数据存储器也同样可以是使用的大都是16x8的形式显示缓存形式，也就是可以直接构成两个16x4的随机存取数据存储器的形式，显示随机存取的存储器字节可由中央处理单元存储器进行数据的读写，被处理单元读写的随机存取的存储器字节的读写地址由随机显示读写地址的寄存器进行指示.数据显示[地址寄存器保存当前中央处理单元存储器的读或写随机取出的存储器字节读写地址，以及正在随机显示着的那两个4位半字节的存储器地址，读写的地址由当前中央处理单元的命令[存储器编程]，也就是可以设置为每次处理单元读写后存储器地址自动加1的一种工作更新方式，在处理单元设置了正确的存储器工作更新方式后，显示随机存取存储器的数据也可由中央处理单元存储器读出，半字节存储器a和半字节b的存储器地址自动由8279更新，以适应由中央处理单元存储器送入的随机存取数据，a和b半字节可独立的送入，也就是可以单独作为一个字节的送入，随中央处理单元所需要设置的工作更新方式而定。

#### I/O 接口功能块

8279通过i/o缓冲器控制与四行中央处理部分控制单元的系统总线网络接口8279，i/o控制部分主要使用cs。a0，rd，wr和四行的中央处理部分控制单元8279之间的单向控制数据是交换的，数据和缓冲器信号是双向控制数据交换的通道，所述控制单元的信号和缓冲器是如下的双向控制数据交换之间的逻辑关系：

CS A0 WR RD 状态

\-----

10--中央处理单元从8279读状态

0101中央处理单元向8279写状态

10--中央处理单元从8279读数据

001-中央处理单元向8279写数据

1 X 数据缓冲区输出处于三种状态

x为任意数(0或1)

\###3.3.38279的操作

如前所述，8279可以完全适应各种手机键盘和电脑显示器的不同功能和工作的方式，由于8279中各个命令功能块的各种工作方式是完全可编程的，用户完全可以根据自己的工作要求，用向8279写命令字的各种编程方法对8279的各种工作方式和功能块进行编程，从上表中我们可以清楚地看出，只要执行命令cs=0同时wr=0=1，然后你们就可以将命令字写到8279，并在命令wr的上升沿将相应的命令程序驱动到8279。

对于中央处理器，8279只有两个端口地址，一个是用于查看和读写处理器的命令和数字的状态(cs=0，a0=1)，一个端口地址用于查看和读写处理器的数据(cs=0，a0=0)，但对于编程语言命令和字代码有很多类型。在8279中给出了区分学校和企业不同的温度命令字的方法主要是对处理器命令和字代码的高3位(d7，d6，d5)和低5位进行了分析和编码，而低5位主要是用于理解命令字的实际含义和教学内容。

#### 8279的编程命令

键盘/显示器方式设置

最高位最低位

--

命令代码000 D D K K K

其中DD为显示方式，KKK为键盘方式

DD的表示：

编码功能

\--

008个8位字符显示-左端传入

01168位字符显示-左输入

1088位字符显示-右输入

1116个8位字符显示-右端送入

所谓左端送

编码功能

\--

000编码扫描键盘-2键连锁

001译码扫描键盘-2键连锁

010编码扫描键盘-N键巡回

011译码扫描键盘-N键巡回

100编码扫描传感器阵列

101译码扫描传感器阵列

110选通输入，编码显示扫描

111选通输入，译码显示扫描

钥匙链和2，其中N是一个关键电路8279双键盘键被按下两次处理，编码和在两个扫描链轮和显示器被解码形成扫描扫描SL0-SL3。

程序时钟

命令代码001 P P P P P

此命令用于确定定时和分频控制中每个预标量的分频控制系数。命令代码ppppp功率系数可以直接形成一个数字2-31。预标准测量也可以在外部没有所述时钟预定频率的情况下来进行，所述基频，得到内部，如果100khz的选择的基本时钟预定频率，能够外部时钟获得与所述时钟频率预定的恢复时间扫描，分频相关的因子;在预定的复位时钟脉冲后100khz如果没有外部时钟被自动馈送到码31自动。

读FIF0/传感器随机存取存储器

命令代码：010 AI X A X =任意

该读取命令主要用于确定中央处理器选择需要读取后续操作的存储器对象分别是8279中的哪一个fif0/来自传感器随机存取的存储器，并且主要用于传感器确定8个随机存取的存储器字节阵列中的哪一个被传感器读取，其中第一个aaa表示中央处理器选择了需要后续读取的行，ai自动为该行添加1个相同的特征位，并且这两者在传统的键盘扫描模式下的数据是不存在直接相关的，对于每次传感器后续的读取8279，数据存储器会按照与传感器数据首次读取时输入的fif0相同的后续读取顺序自动将数据发送出去。从传感器的fifo开始读取所有数据进行后续的读取，直到传感器写入新的命令。在来自传感器随机存取阵列的实施例中，aaa传感器选择了一线来自传感器8个的随机存取的存储器行如果ai=1，来自传感器的下一次后续读取将被读的随机存取数据送到存储器的下一行。

读显示器随机存取存储器

命令代码：011 AI A A A A

中央处理控制单元对8279写此读取命令，则我们确定了一个中央处理控制单元以一个显示器随机存取的一个存储器位作为数据源缓存地址位来进行随机读取的操作，其中的aaaaa为一个显示器随机存取一个存储器的一个数据源缓存地址，ai的行为自动依次加1特征位，若其中ai=1，则每一次读取第一行随机存取的一个存储器之后[第一行行为显示器的数据地址]自动依次加1。

写显示器随机存取存储器

命令代码：100 AI A A A A

中央处理单元将此命令写入8279，它规定下一步将写入8279的显示随机存取存储器。寻址模式和自动加1功能与读显示随机存取存储器相同。

显示器写入禁止/空格

命令代码：101 X IW IW BL BL X=任意

A B A B

此显示命令主要用于同时屏蔽a或b两个显示端口的输出并重新显示其显示的区域。如果将其中两个显示端口用作两行4位的显示，则必须同时屏蔽4位之一，以使对方发送的信息不会直接影响另一半。iw是该端口被屏蔽的功能位。如果为显示端口设置了显示命令iw=1，则该显示端口被此命令所屏蔽。空格显示请特别注意，b0对应于c0和d0，而d0和bl是应于iwensei，则此显示端口将重新显示空格。如果要以单个8位的输出命令格式为该端口创建重新显示的区域，则必须为端口设置两个d0和bl的标志以使该端口的显示完全保持空白。

消除

命令代码：110 CD CD CD CF CA

此数据清除格式命令主要就是用于按一定的数据格式顺序进行数据清除，它显示随机存取器的数据格式存储器的两个fif0状态，其中a和cd分别用于指定一个需要进行清除的数据格式：

CD CD CD

0 X 全"0"(x为任意)

10 AB =16进制

1020(0 O 100000)

11全册"1"

当显示为"1"(或 CA =1)时，允许清除显示

cf显示器清除cd和fifo的状态(其中包括广告和中断)。如果显示cf=1，则显示器清除cd和fif0状态，并重置中断线。传感器直接随机访问存储器的显示也始终被设置为第0行。ca始终被显示器清除，并且其显示效果与cd对应，当显示ca=1时，cf可以进行合成，使用显示器的cd和fif0指定的随机清除存储器格式进行清除。此时显示器的随机访问存储器的状态已经被清除。cd插孔还可以重新设置同步内部的时序。显示期间将自动清除随机存取访问存储器(约16us)。无法被重写。同时，在此期间，fifo的最高有效位设置为"1"。当显示广告的随机存取访问存储器再次恢复可用时，它将自动进行重置。

中断结束/出错方式设置

命令代码：111 E X X X X X=任意

当一个阵列传感器，该命令使IRQ线变低，并且允许写入随机存取存储器(通过位置传感器的变化来检测，IRQ线可具有增加的，这样做防止了信息写入再次随机存取存储器之前其复位)。在 N 键电路模式下，如果 E 位被编程为"1"，芯片电路将以特殊的错误模式运行。

主要用于检查 N 键巡视模式特殊错误模式下的多次按键。如果在一个反弹周期内按下两个键，则可以视为同时多次按下，并建立一个错误标志以防止进一步写入 FIF0，并设置中断(如中断设置)。错误进行标志设计可以被 FIFO 状态字命令读取，CF =1的清除命令我们可以通过重置错误信息标志。

1. 锯齿波由两个单晶二极管bt和r1、r2、r3、w1和c1组成的单晶管张驰振荡器锯齿波产生，然后通过单晶管发射极跟随张驰振荡器将锯齿波输出。

2. 控制电势差(Uk)和锯齿波电势差与电子流的强度叠加，送至 v2基极。综合电势差是我们。当 Us>0(0.7)时，V2打开，Us <0，则 V2结束。

3. V2，V3和R8，R9，DW1流开关已经被组成，当基极电位差V2 Ube2>0(0.7)，V2被接通时，接近零电势差Ube3，V3被关闭，直流开关是打开。

4. 过零脉冲的控制输出由削波同步电源变压器晶闸管tb、整流桥变压器d1、r10和直流开关r11组成的削波整流桥同步变压器电源，它与直流开关的两个输出电势差一起分别用来控制v4和发射器的v5。只有当发射器的dc直流开关发射器打开时，v4才使发射器关闭，并且由于v4和发射器的v5基极电极与两个发射器之间存在一个工作电势差，因此它使发射器可以在此期间正常工作。当每次发射器的同步电势差过零时，v4关断，其集电极和输出存在一个正电势差，这就可以使得v5从发射器的截止开关开始接通，通过这个脉冲使同步变压器的输出触发一个过零脉冲，并且这个触发脉冲可以使变压器晶闸管t在需要发射器导通的时候导通。

直流开关导通时，连续正弦波控制电势差uk的大小决定了直流开关的导通持续时间的长短，这也直接决定了在电阻炉设定的直流开关周期内可以传导的直流开关周期和次数，因此，可以合理地调整直流开关输出的功率。显然，控制电势差uk越大，它可以传导的直流开关周期和次数越多，输出的功率越大，电阻炉的直流开关温度越高。相反，电阻炉的直流开关温度越低。

自动电炉闭环系统温度自动调节的基本设计思想是在热电炉系统中自动添加温度传感器和相应的温度自动控制器。温度传感器的温度调节基本功能主要是通过检测自动热电炉的实际工作温度，将其信号转换为电势差的控制信号，并且我们比较了电炉相应温度控制装置uk的电势差。这种差异的变化大小(e=uk-uft)和电势差变化的方向(即e是正还是负)由温度控制器沿晶闸管相反的输入控制方向自动设置，以便温度控制器的输出信号控制导晶闸管接通的方向和长度。直流晶闸管开关的输入控制接通的时间，使得在一定温度和时间内的设置，晶闸管的输入控制接通电流频率有所增加或流量减少，而使得电炉的相应直流温度控制装置有所频率增加或流量减少。利用这种电势差控制温度的方法，可以在很小的电势差范围内自动改变炉温，并且控制精度高。

方案二：为了更好地可以有效简化控制电路，采用先进的单片机恒温控制技术可以作为一个恒温控制系统和企业的核心单片机来进行设计本文的课题。温度传感器ds18b20用于对温度传感信号的采集。方案二控温的基本设计思想主要是：通过传感器采集的电阻丝温度与单片机标准传感器温度的差值，控制恒温发热系统中电阻丝的数量和持续时间，从而最终达到对恒温发热系统控制的主要目的。控温方案二的单片机设计电路框图结构如下图所示：

![2.2方案二设计框图](http：//my gunplan.top/static/003.jpg)

本解决方案以先进的单片机为温度控制的核心，利用温度传感器自动采集计算机温度，通过传感器采集的计算机温度与单片机标准传感器设定计算机温度之差的距离来测量和控制温度，使得温度始终保持在单片机标准传感器设定的温度。该解决方案设计制作成本低，可靠性高，非常适用于计算机系统的动态控制性能和系统稳定性对温度要求不是很高的应用场合。

## 3.4传感器接口电路设计

### 3.4.1温度数据采集电路

ds18b20是基于dallassemiconductorcorporation的一个网络数字温度传感器。与其他的温度传感器连接方式相比，ds18b20具有以下的功能：当网络连接到如上所述微处理器的唯一单线路的接口模式中，只有一个端口可以被用于直接实现一个微处理器和ds18b20之间的双向通信的线路。

ds18b20支持独立的多点温度网络。几个节点ds18b20可以仅在三条线上通过并联进行连接，以方便地实现基于互联网的多点温度的测量。ds18b20不一定需要外围的组件。所有的传感器集成元件和温度信号转换集成电路都可以像普通的晶体管一样直接集成在单个温度集成电路中。传感器的温度测量范围一般为55〜125°c，温度集成电路测量的固有温度和分辨率范围为0.5°c。温度测量的结果直接传感器输出一个9位数字的温度测量信号，并直接通过"初始化总线"接口串行发送到传感器的中央控制单元。同时，可以直接发送crcr的温度校验码，具有较强的温度抗干扰和自动纠错的功能。温度测量的结果以9位数字的模式串行传输。

尽管ds18b20具有简单的嵌入式温度自动测量和控制系统，较高的分辨率和温度测量的精度，方便的网络连接以及较少的线路和资源占用等诸多优点，但在实际的应用中还是应该充分考虑以下的几个方面：

1. 尽管操作系统的硬件很简单，但我们还是需要相对复杂的软件处理器来对其进行温度补偿。由于ds18b20与其他微处理器之间的读写串行编程需要数据同时传输，因此必须注意保证在读写串行编程期间的连续读写编程时间，否则将是无法对读取进行温度补偿测量的结果。

2. ds18b20的可靠性相关数据未提及任何连接到单个总线的微处理器ds18b20的数量。这很容易就会导致一个错误的假设，即微处理器可以在总线上连接任意数量的总线ds18b20，而在实际的应用中并非如此。如果一条单个总线上微处理器连接了8个以上的总线ds18b20，则几乎没有必要考虑解决单个总线微处理器的可靠性和总线驱动问题以及我们在设计多点温度控制和测量传感器系统时所需要注意和考虑的一些问题。

3. 连接长度的限制是指采用连接长度为ads18b20的信号总线的电缆。由于它具有信号电缆的稳定性和电子电缆的阻挡比较大等特性，如果距离太大，信号传输幅度也会有所降低。如果在测试中普通信号电缆的双绞线传输电缆的长度明显地超过50m，则表示温度降低或读取数据不正确。如果将普通信号总线的电缆改为带屏蔽普通信号电缆的数据传输双绞线，则正常的总线通信数据传输距离应该可以轻松地达到150m。

ds18b20提供两种不同类型的器件封装：pr-35和pdsoic。引脚的顺序排列如下下表3.1所示。该软件封装操作系统中实际上已经使用了基于pr-35软件包的封装工具包。尽管如此，dds18b20仅用于提供一个返回9位温度数字的一个温度测量值，如如下图3.1.2所示。

管脚管脚定义说明

：-：：-：：-：

8脚SOIC 3脚PR-35

21 GND地

12 I/O 数据输入

83 VCC电源

34567 NC空脚

表3-1 DS18B20管脚排列

图3.1.2ds18b20温度值的表示计算方法

d9为低字节的符号位，0为正，1为负，高字节(d10~d15)的其他位用二进制符号位的补码或扩展位形式进行了表示;d0~d8为数据位，以二进制数据位的补码或扩展形式进行表示。如下表3.2显示了数值与温度之间的非线性关系。

温度测量数据(二位位十六进制)数据(十六进制)

：-：：-：：-：

+125000000001111101000FAH

+2500000000001100100032H

+0.500000000000000010001H

000000000000000000000H

+0.51111111111111111 FFFFH

-251111111111001110 FFCEH

-551111111110010010 FF92

表3.2 DS18B20值与温度的关系

由于房间的环境温度不能为负，因此系统不会考虑负温度。这样，您在选择硬件时就可以使用市售组件，而不必使用工业组件，从而可以大大降低成本。读取温度信息后，微控制器仅需要将低字节(D0〜D8)发送到主机和控制电路。

### 3.4.2发光二极管显示接口电气设计

选择的系统控制方式是四路开关室温动态实时传感器显示，显示精度0.1℃。具体的电路原理图所示如图3.2：

![3-2硬件电路图](http：//my.gunplan.top/static/3.2.png)

### 3.4.3发光二极管数码管

发光二极管显示器即为新型发光二极管显示器，具有数据显示醒目、成本低、配置灵活、接口可以方便等特点，单片机电源管理控制系统在应用数据管理操作系统的设计中常用它来直接显示电源管理操作系统的日常工作生活的状态和过程中所采集的数据在信息网络中所输入的数值等。

根据大屏幕发光点阵二极管的排列和结构不同，可将大屏幕发光点阵二极管显示器划分为大屏幕发光二极管点阵数码管和大屏幕发光二极管点阵数码显示器。大屏幕发光二极管点阵数码管主要就是用于在屏幕上显示英文数字和一些英文字母和图形符号，发光二极管点阵显示器同样可以在屏幕上显示英文数字、字母、男人和图形等。大屏幕发光点阵二极管数字点阵显示虽然点阵显示灵活，但它们主要占用的是单片微型计算机系统的软硬件资源比大屏幕发光二极管点阵数码管显示器要多得多。除了使用指定的程序，大屏幕发光点阵数码管显示器或led点阵显示器主要用于请求特殊的点阵显示场合，几乎所有的微型计算机系统应用点阵显示系统都使用大屏幕发光二极管数字点阵显示。

数字管理的显示系统主要有两种显示模式，包括静态数据管理显示程序模式和动态显示程序模式。静态数据管理显示的程序非常不复杂，静态数据管理显示系统的程序模式设计起来非常简单，占用cpu的内存时间很少。仅需要当系统的显示字符串发生更改时才可以调用动态显示程序。但是，硬件和集成电路很多。每个八位数字晶体管都至少必须需要一个8位i/o电源输出输入端口，一个8位限流电源输出驱动器和8个8位限流输出电阻。通常偶尔也可能会需要使用少量的圆形数码管。发光二极管的应用由于静态扫描显示器需要使用较少的电子管组件，并且需要使用更多的静态数字组件与电子管组件在显示器之间进行切换很麻烦。为了有效简化了电路并且大大降低了成本，系统设计使用了一种动态扫描数字显示的方法。

动态扫描显示模式的工作原理是分别打开每个显示器，即一次仅显示一位。为了使用户看到所有的显示器都已显示，必须加快每个显示器的照明周期(增加扫描频率)。通过使用人眼的视觉残留效果，可以实现与连续显示所有显示器相同的效果。动态扫描显示电路如图3.2.2所示：

![图3.2.2动态扫描图](http：//my.gunplan.top/static/003.jpg)

## 3.5 温度控制电路的设计

![图3.2.2温度控制电路](http://my.gunplan.top/static/3.3.png)

通过正确设置开关元件脉冲的宽度来我们可以控制三端双向的可控硅开关元件的开启和脉冲关闭。当伴随着脉冲宽度的增加(脉冲占空比增加)时，三端双向的可控硅开关元件的脉冲导通加热时间和温度延长，电阻丝的开关元件加热的时间也延长，温度也升高。相反，如果我们减小了脉冲的宽度(相当于减小脉冲占空比)，则双向可控硅的脉冲导通加热时间和温度缩短，电阻丝的开关元件加热时间和温度缩短，从而大大降低了元件的温度。

以此方法来控制温度的恒定不变。

## 3.6 脉宽调制

### 3.6.1 脉宽调制的介绍

pwm是高电平脉冲方波宽度调制的一个英文缩写。高比的方波的第一个时间段被简单地称为高电平的占空比，例如，一秒钟高电平和的50%1第二个是占空比的pwm波的脉冲宽度调制(pwm)的定义低电平在各种开关电源中被广泛使用的一个术语。。这个词是根据开关稳压的控制工作方式进行定义和分类的。除pwm混合型外，还有开关调制pfm型和脉宽调制pwm和一种pfm混合型。波的脉宽调制(pwm)的定义开关稳压电路的定义是在设计和控制开关稳压系统的电路设计中在输出的频率可以与低电平保持一个不变的频率情况下，通过电势差的反馈电路来控制和调节其输出的占空比，从而使使用者能够更好地达到维护社会稳定和发展控制输出电势差的主要目的。

脉冲信号宽度的调制(pwm)技术是一种非常有效的可以利用微处理器的模拟数字脉冲信号输出来实现控制和模拟集成电路的一种技术，它被广泛的应用于从电力测量，控制和无线通信系统到电力的智能转换许多应用领域。

### 3.6.2 基本原理

随着我国电子信息技术的发展，出现了多种 PWM 技术，包括：相电势差控制 PWM 、脉冲信号宽度 PWM 方法、随机 PWM 、 SPWM 方法、线电势差控制 PWM 等，然而，镍氢动力电池使用智能手机充电器设计采用的脉冲时间宽度 PWM 方法，以等脉宽的脉冲串作为 PWM 波形，通过不断改变一个脉冲串的周期可进行分析调制，可以同时通过这些改变传统脉冲的宽度或占空比来调节电势差，并且我们可以选择通过研究采用学生适当的控制管理方法来实现协调地改变电势差和频率。

模拟信号的时间值和分辨率可以通过不断的发展变化，对其时间和变化幅度的时间值和分辨率没有必要进行严格的限制。9v模拟信号电池同时也是一种智能模拟设备，因为它的输出电势差不完全一定等于9v，而是随着一定时间而变化，并且同时也可以取任何真实值。类似的地，从模拟信号电池内部吸收的电子流的数量和强度不可能局限于任何一组模拟信号可能的真实值范围。智能模拟信号和传统数字信号的最大区别主要在于后者的真实值范围只能在数字信号预定的任何一组可能的值内，例如，在{0v的电子集合中，5v}。

模拟电势差和收音机电子流的强度控制可直接地应用于扬声器的控制，例如模拟控制汽车和收音机的音量。在简单的控制模拟电势差和收音机中，音量旋钮通过连接扬声器得到可变电阻。当扬声器拧动音量旋钮时，电阻值随之变大或相应地变小;流过这个强度和电阻的电子流的强度也随之增大或相应地减小，从而通过改变扬声器驱动收音机和扬声器的电子流的强度和电阻值，使得音量旋钮相应地随之变大或相应变小。与其他无线电一样，模拟扬声器电路的音量输出与扬声器输入成一个线性的比例。

在简单的需要模拟一个立体声的收音机中，音量控制系统的旋钮与收音机连接时会用到一些可变电阻。其中之一的问题是由于模拟电路倾向于随时间进行漂移，因此难以进行调整。只有可以帮助解决这个复杂问题的精密模拟电路体积可以非常大，体积庞大(尤其是比如老式的家用立体声音量控制设备)和昂贵。精密模拟电路还可能产生严重的热量，其产生的功耗与电路中的工作元件两端的电势差与工作元件电子流的扰动强度的乘积大小成正比。精密模拟电路也肯定可能对于噪声敏感，任何的扰动或者产生的噪声都肯定可能会直接改变工作元件电子流的强度值。

通过对模拟控制电路进行数字控制，可以大量减少控制系统的设计成本和系统功耗的降低。此外，许多的微控制器和dsp已经在日本和中国的芯片上包含了dspwm控制器，这样就使得通过数字进行控制的设备实现自己的功能变得完全可以更加的具有容易。

脉冲宽度调制信号的设计思想

该对象的脉宽调制信号为方波，设定周期为1 s。它的产生将时间计数器设置为10 ms时序，然后通过寄存器R3控制脉冲宽度调制信号的周期。此主题仅具有模拟效果，并且对准确性没有过多要求，因此将1s周期划分为100。在相等的部分中，计时器设置为10 ms，计时器在R3中启动的频率为100。

寄存器r2中需要存储的数据是根据脉冲检测控制电路和数据控制电路进行转换的数字。r2中存储的数据值是用于分别控制一个脉冲系统的信号和1s内一个高电平的脉冲时间的长度。这样我们也就可以从寄存器的p2.6口检测得到用于定义一个周期可调和进行高电平的脉冲时间可调的寄存器来控制脉冲系统的信号。

### 3.6.4 脉宽调制信号的作用

脉冲宽度调制信号从P3.0端口输出。从P3.0端口输出的方波信号连接到三端双向可控硅开关的控制连接，以控制TRIAC的接通和关断。如果方波在一段时间内以高电平出现，则双向可控硅的占空比变长，即加热元件散发的热量更多。简而言之，加热元件释放的能级由方波在一个周期内变高的时间确定。

### 3.6.5 脉冲宽度调制优点

pwm的最大好处的其中之一个特点就是从信号处理器到受控系统的数字信号都是保持数字形式的，没有对数模信号进行的变换。这样保持了数字形式的数模信号最大限度地减少了噪声的产生和影响。数字噪声的大量产生主要是因为只有在其强度足以准确地阐述信号上升沿或信号下降沿跳变的强度时候，数字信号的稳定性才可能会被受到影响。

除了使用指定的程序，大屏幕可以使用点阵数字显示器或led数字显示器。为了请求特殊的显示场合，几乎所有的微型数字计算机或者应用显示系统都使用发光二极管进行数字显示。这些模拟信号可以转换到pwm信号可是它们可以大幅度地增加传输信号距离的范围和长度。在高频接收端，可以直接滤除经过调制的高频方波，并通过适当的rc或lc模拟网络将传输信号的频率恢复到最为模拟的形式。

总之，pwm不仅省钱、占地面积被大量使用节约、抗震和降低噪声的使用性能强，而且同时也成为是一种非常值得许多专业建筑工程师在许多不同类型的建筑设计和工业应用中广泛研究使用的有效解决技术。

 # 第4章 系统软件设计

在微机测控系统中，软件与硬件同样重要。硬件是系统的躯体，软件则是灵魂，当系统的硬件电路设计好之后，系统的主要功能还是要靠软件来实现，而且软件的设计在很大程度上决定了测控系统的性能。为了满足系统的要求，编制软件时一般要符合以下基本要求：  

1. 易理解性、易维护性。通常是指软件系统容易阅读和理解，容易发现和纠正错误，容易修改和补充。由于生产过程自动化程度的不断提高，测控系统的结构日趋复杂，设计人员很难在短时间内就对整个系统理解无误，软件的设计与调试不可能一次完成，有些问题是在运行中逐步暴露出来，这就要求编制的软件容易理解和修改。在软件的设计方法中，结构化设计是最好的一种设计方法，这种设计方法是由整体到局部，然后再由局部到细节，先考虑整个系统所要实现的功能，确定整体目标，然后把这个目标分成一个个的任务。任务中可以分成若干个子任务，送样逐层细分，逐个实现。本仪表就是采用这种模块化的设计方法。这样不但使得设计目标明确、思路清晰，而且在检错、调试时也很方便。当出现问题时，可以根据问题的种类和现象来判断是哪一部分出的问题，很容易找出故障所在和故障原因。同时，采用模块化程序结构设计方案，对于系统功能的扩充和修改也提供了很大的方便。
2. 实时性是电子测量系统的普遍要求，即要求系统及时响应外部事件的发生，并及时给出处理结果。近年来，由于硬件的集成度与运算速度的提高，配合相应的软件，实时性比较容易满足设计要求；
3. 准确性对整个系统具有重要意义，尤其是测量系统，系统要进行一定量的运算，算法的正确性和准确性对结果有着直接的影响，因此在算法的选择、计算的精度等方面都要符合设计的要求；
4. 可靠性是系统软件最重要的指标之一，作为能够稳定运行的系统，抗干扰技术的应用是必不可少的，最起码的要求是在软件受到干扰出现异常时，系统还能恢复正常工作。结合上述编制系统软件的基本要求，首先讨论软件的设计思想。

在微机测控系统中，软件的重要性与硬件设置同样重要。硬件是躯体，软件是灵魂，当系统的硬件电路确定之后，系统的主要功能还要靠软件来实现。如果说硬件决定了产品的造价，那么在硬件搭配合理的前提下软件在很大程度上就决定了产品的性能。

## 4.1 软件设计思想

为了满足系统的要求，编制软件时必须符合以下基本要求: 

易理解性、易维护性。通常是指软件系统容易阅读和理解，容易发现和纠正错误，容易修改和补充。由于生产过程自动化程度的不断提高，测控系统的结构日趋复杂，设计人员很难在短时间内就对整个系统理解无误，软件的设计与调试不可能。

一次完成，有些问题是在运行中逐步暴露出来，这就要求编制的软件容易理解和修改。在软件的设计方法中，结构化设计是最好的一种设计方法，这种设计方法是由整体到局部，然后再由局部到细节，先考虑整个系统所要实现的功能，确定整体目标，然后把这个目标分成一个个的任务。任务中可以分成若干个子任务，送样逐层细分，逐个实现。本仪表就是采用这种模块化的设计方法。这样不但使得设计目标明确、思路清晰，而且在检错、调试时也很方便。当出现问题时，可以根据问题的种类和现象来判断是哪一部分出的问题，很容易找出故障所在和故障原因。同时，采用模块化程序结构设计方案，对于系统功能的扩充和修改也提供了很大的方便。

实时性。实时性是本系统的基本要求。即要求系统及时响应外部事件的发生，并及时给出处理结果。近年来，由于硬件的集成度与速度的提高，配合相应的软件，实时性容易满足要求，特别是对于汇编语言编制的软件。  

1. 可测试性。系统软件的可测试性具有两方面的含义:其一是指比较容易地制定出测试准则，并根据这些准则对软件进行测定；其二是软件设计完成后，首先在模拟环境下运行，经过静态分析和动态仿真运行，证明准确无误后才可投入实际运行。  
2. 准确性。准确性对整个系统具有重要意义。系统要进行大量运算，算法的正确性和准确性问题对控制结果有直接影响，因此在算法选择、位数选择方面要适合要求。
3. 可靠性。可靠性是系统软件最重要的指标之一，它要求两方面的意义:第一是运行参数环境发生变化时，软件都能可靠运行并给出正确结果，也就是要求软件具有自适应性:第二是在环境恶劣干扰严重情况下，软件必须保证也能可靠运行，这对整个系统尤为重要。



## 4.2 软件组成

由于整个系统软件相对比较庞大，为了便于编写、调试、修改和增删，系统软件的编制采用了模块化的设计。即整个控制软件由许多独立的小模块组成，它们之间通过软件接口连接，遵循模块内部数据关系紧凑，模块之间数据关系松散的原则，按功能形成模块化结构。

系统的软件主要由主程序模块、数据采集模块、数据处理模块、控制算法模块等组成。主模块的功能是为其余几个模块构建整体框架及初始化工作；数据采集模块的作用是将A／D转换的数字量采集并储存到存储器中；数据处理模块是将采集到的数据进行一系列的处理，其中最重要的是数字滤波程序：控制算法模块完成控制系统的PID运算并且输出控制量。

下面就介绍本系统几个主要的程序模块。

## 4.3 程序结构分析

**主程序调用了4个子程序，分别是温度传感器读取程序，数码管显示程序、键盘扫描及按键处理程序、温度信号处理程序。**

* 键盘扫描电路及按键处理程序：实现键盘的输入按键的识别及进入相应的程序。
* 温度信号处理程序：对温度芯片送过来的数据进行处理，进行判断和显示。
* 数码管显示程序：向数码的显示送数，控制系统的显示部分。




## 4.4 数据处理模块

数据处理模块负责处理A／D转换后的数字量。其中最重要的环节是数字滤波，所以这里主要讨论系统采用的数字滤波程序。

###  4.4.1 数字滤波

模拟信号都必须经过A／D转换后才能为单片机接受，如果模拟信号受到扰动影响，将使A／D转换结果偏离真实值。因此仅仅对模拟量采样一次，我们是无法确定该结果是否可信的，必须经过多次采样，得到一个A／D转换的数据序列，通过某种处理后，才能得到一个可信度较高的结果。这种从数据序列中提取逼近真值数据的软件算法，通常称为数字滤波算法。

数字滤波克服了模拟滤波器的不足，它与模拟滤波器相比具有以下几个方面的优点:  

1. 由于数字滤波是用程序实现的，因而不需要增加硬件设备，而且可以多个输入通道共用一个滤波程序
2. 由于数字滤波不需要硬件设备，因而可靠性高、稳定性好，各回路之间不存在阻抗匹配等问题
3. 数字滤波可以对频率很低(如O．01HZ)的信号实现滤波，克服了模拟滤波器的缺陷，而且通过改

变数字滤波程序，可以实现不同的滤波方法或改变滤波参数，这比改变模拟滤波器的硬件要更灵活方便。

常用的数字滤波方法有程序判断滤波法、中值滤波法、算术平均滤波法、一阶滞后滤波法、去极值平均滤波法等等，下面简要介绍这几种数字滤波方法。

1. 程序判断滤波法首先要从经验出发，定出一个目标参数最大可能的变化范围。每次采样后都和上次的有效采样值进行比较，如果变化幅度不超过经验值，本次采样有效，否则，本次采样值应视为干扰而放弃，以上次采样值为准。该算法适用于变化缓慢的物理参数的采样过程，如湿度、液位等。
2. 中值滤波法对目标参数连续进行若干次采样，然后将这些采样进行排序，选取中间位置的采样值为有效值。对于变化较为剧烈的参数，此滤波方法不宜采用。
3. 算术平均滤波法是对目标参数进行连续采样，然后求其算术平均值作为有效采样值。该算法适用于抑制随机干扰。采样次数越大，平滑效果越好，但系统的灵敏度要下降。算术平均滤波不能将明显的脉冲干扰消除，只是将其影响削弱。

## 4.5 子程序设计

设计总体程序框图如下，总体程序由主程序，按键子程序，温度获取子程序三部分组成。  
读出温度子程序的主要功能包括初始化,判断DS18B20是否存在,若存在则进行一系列的读操,作若不存在则返回。

### 4.5.1 读出温度子程序

![图4-6 程序结构图](http://my.gunplan.top/static/4.2.1.PNG)

### 4.5.2 LED数码显示管程序

![图4-6 发光二级 数码显示管程序](http://my.gunplan.top/static/4.2.2.PNG)

### 4.5.3 键盘扫描及按键处理子程序

![图4-7  键盘扫描及按键处理子程序](http://my.gunplan.top/static/4.2.3.PNG)


## 4.6 显示处理

显示处理模块主要完成人机交互作用，具体实现将采样温度值、设定温度值以字符的形式通过液晶显示出来。本系统使用HTl621作为显示驱动器。HTl621是128点内存映象和多功能驱动器。附录中给出了显示处理模块的源程序。

# 第5章 系统软件调试

## 5.1 目测

1. 有无短路处。
2. 对照电路图看有无接错、漏接处。
3. 有无虚焊处。
4. 元件是否都对

## 5.2 硬件调试

首先应进行上电前的准备。为了防止硬件的损坏，应在电路板上电前进行电路检查，包括：对芯片的焊接方向进行检查，对芯片的引脚进行短路和断路检查。

在经过检查确认芯片的焊接没有任何问题的情况下，进行上电检查，在电源打开后，先判断电路是否存在异常，如出现芯片过热等现象，应及时切断电源，检查电路故障。在上电无异常状况的前提下，可以用万用表和示波器进行测量。首先测量电源芯片的输出电压是否正常，然后用示波器分别测量各个主要芯片电源引脚，察看电源的波形情况，如有纹波，则在预先留出的位置上焊上退耦电容以消除纹波，保证芯片工作正常。电源测量完毕后，进一步用示波器测量有源晶振的输出脚，其输出是频率为8MHz的波形(非方波，类似正弦波)。在确定晶振起振后，按住复位键，使单片机始终保持在复位状态，同时测量其各个引脚的电平情况，并同数据手册上表述的复位时的芯片引脚状态进行比对，由此可判断单片机是否正常。确认单片机正常之后就可以通过仿真器连接用户板进行调试。

## 5.3 软件的调试

由于软件的编写都是根据各个模块进行的，我们在进行软件的系统模拟调试时应，先确认硬件的接口标记是否在软件程序中一一对应，而且要检测所编写的软件有没有知识性的错误。在觉得基本没有问题后我们通过电脑将程序编译进入系统核心AT89S52单片机，检验软件与硬件各部分是否协调的工作。出现问题时我们要耐心的检查程序并作出适当的修改，直到软件系统的完全契合硬件电路，那我们软件就调试成功了。

1. 测试环境
   环境温度28摄氏度，室内面积20平方米
   测试仪器：数字万用表，温度计0----100摄氏度

2. 测试方法
   使系统运行，采用温度计同时测量室内度变化情况，得出系统测量的温度。

3. 测试结果
   设定温度由0摄氏度到40摄氏度
   标定温差<=1摄氏度   调节时间  15s（具体视现场情况）
   静态误差<=0.5摄氏度   最大超调量1摄氏度

4. 通过测试分析，对于实际室内的温度控制，可以再提出以下 2 点方法 :
   Ⅰ增加传感器个数，对各个温度传感器采集的数据进行求算术平均，可得到较为准确的温度值。
   Ⅱ对实际室内的温度控制，可采用功率较大的电炉，并且通过风扇对箱内温度进行充分搅和降温设备可采用空气压缩机等制冷设备。 

5. 通过实验测试和分析，发现虽然传感器的温度采集精度最高可得到 0.06 ℃，但测试得到的数据最小间隔为 0.03 ℃ 。通过分析，当对浮点数求平均处理时，遇到同一时刻两个传感头采集的温度相差不大，使 0.06 ℃ 时求出平均温度变为 0.03 ℃ 为了解该数据是否真实，可采用一个高精度的数字温度计测试，发现读出的值与其基本一致，由此推断如果在同一时间增加采集温度的个数，则可以进一步提高温度的精度。 

    

## 5.4 注意事项

1. 测驱动电路的过程中发现数码管不能正常显示的情况，经检验发现主要是由于接触不良的问题。其中包括线的接触不良和芯片的接触不良，在实验过程中，数码管有几段时隐时现。用万用表检测发现有线接触不良，重焊后就可正常显示。而芯片接触不良用万用表欧姆档检测有几个引脚本该相通的地方却未通，其解决方法为把芯片拔出正对万能板孔均匀用力插入。
2. 由于焊接时的大意损坏了元件，在调试是我们怎么都找不到问题的所在，我们是用排除法一个一个元件的测试的找出损坏的元件，重新换上新的元件，故障得以解决。
3. 还有关于程序调试过程中出现的问题。执行程序是发现程序执行不稳定，排除软件的错误外，经老师的指导才发现单片机的EA管脚没有接地。因为次程序只用到片内程序存储器，所以在程序执行时一定要把管脚接的，这样程序才能只执行片内的，不然程序会乱跳，从而导致程序执行不稳定。
4. 接三极管的过程中，发现电路不管程序是什么，数码管都是显示8字，经查除发现原来是三极管的极端弄错了，从新调整极端顺序。
5. 在电路调试时由于我们选用的是对射型的光电传感器由于没正对好使的调试一度中断，最后我们通过反复的调试解决了问题
6. 调试时由于线路的繁杂，没有仔细的找到对应部分的线路，使的调试的结果与预期出现很大的误差，我们通过梳理线路后就调试成功了并达到了预期的效果。
7. 在调试时几个模块的电路调试都不是很好，我们就要对线路的硬件连接做仔细的检查，调试的时候我们首先要确定连接的电路没有错误，各个元件管脚间没有虚连，那样我们的调试才会更顺利。# 结束语

这个最后的项目设计对我很有帮助的。这种设计使我对在大学学习的知识有了全面的了解和深入的思考，并让我对所学的知识以及思考和编写最终设计综合游戏的能力有所了解和提升。最后，我完成了这项任务。撰写论文的过程也是学习专业知识的过程的一个重要的阶段。它使我能够使用现有的专业基础知识来设计，分析和解决理论或实践问题，并将知识转化为实践技能培训。我已经掌握了运用自己的知识来解决实际问题的能力。

通过这个最终设计的结果，我发现只有提高理论水平，才能将教科书的知识和实践结合起来，理论知识可以为教学实践服务，以提高我的实践能力。这个设计非常有意义。我有很多经验。通过这个最后的项目，我们知道了理论与实践之间的距离，将理论与实践相结合的重要性，并且我们已经学到了很多我们无法从书本中学到的知识。

我们的学习不仅应以书籍为基础的限制，而且还应以解决理论和实践中的实际问题为目标和导向，而且还应结合实践去具体分析。理论问题是实践问题，问题解决是课程研究。学生本身就是作为专家来看待。用手解决问题比用大脑解决问题更深刻。学习应要求理论与实践相结合。理论问题也是实际问题。这种方法不仅有助于完成理论知识的巩固，而且将有助于推进实践，解决实际问题，并增强我们服务和解决问题的能力。

总的来说，这个最终的设计使我学到了很多东西。这是大学的最后也是最重要的一课。它对我们的未来产生深远的影响，具有十分重要的意义。





# 参考文献

[1] 李伯成.基于MCS-51单片机的嵌入式系统设计.电子工业出版社.2004  
[2] 宗光华,李大寨.多单片机系统应用技术.国防工业出版社.2003  
[3] 胡学海.单片机原理及应用系统设计. 电子工业出版社.2005  
[4] 孙育才,王荣兴,孙华芳.ATMEL新型AT89S52系列单片机及其应用.清华大学  
   出版社.2005  
[5] 于京,张景璐.51系列单片机C程序设计与应用案例.中国电力出版社.2006  
[6] 蔡杏山.Protel 99 SE 电路设计.人民邮电出版社. 2007  
[7] 杨小川.Protel DXP 设计指导教程. 清华大学出版社.2003  
[8]  李晓荃. 单片机原理与应用[M].  电子工业出版社，2000年8月  
[9]  何立民.  AVR单片机原理与接口技术[M]. 北京航空航天大学出版社，2002  
[10]  杨帮文. 新型继电器实用手册[M]. 北京人民邮电出版社.2004  
[11] 何希才.传感器及其应用电路[M].北京:电子工业出版社,2001.131-135  
[12] 丁镇生.传感器及传感技术应用[M].北京:电子工业出版社,1998.  
[13] 王家桢.传感器与变送器[M].北京:清华大学出版社,1996.  
[14] 曾巧媛.单片机原理及应用[M].北京：电子工业出版社.2002  
[15] 何力民.单片机高级教程[M].北京：北京航空大学出版社.2000  
[16] 金发庆.传感器技术与应用[M].北京：北京机械工业出版社.2000  
[17] Katsuhiko Ogata．Moden Control Engineering．Publishing house of electronics industry，2000：1 96—202.  
[18] Microchip 24C01B/02B 8 位PIC®单片机产品手册[ED/OL].  
[19] Borko H，Bernier C L．Indexing concepts and methods .New York:Academic .
[20] Dallas products data Book[M]，1999.  
[21] Maxim products data Book[M]，2001.  
[22] Shao Jianlong, He Chun. Design of a Portable Popular Multifunctional Development System for 8051 Single-chip Microprocessor Family [J].   Computer Engineering and Applications, 2003.13.
      




# 致 谢

本课题的完成中，我得到了很多人的帮助，在此表示衷心的感谢!

首先感谢我的指导老师高老师，我的课题是在他的指导和帮助下完成的，他深厚的理论功底和严谨的治学态度以及高度的敬业精神使我受益非浅，对我课题的完成起到了至关重要的作用。
经过这次毕业设计，使我觉得不论从理论知识还是从实际操纵中都学到了不少知识，我想归纳起来，主要有以下四个方面：  

* 经过这次毕业设计，它让我接触更多平时没接触的科学仪器设备、元器件以及获得相关的仪器调试经验，同时我也发现自己在这方面很多不足之处。体会到理论知识对实践有很大的知道作用，她让我知道，只有在正确的理论指引下，才能设计出合乎实际需要的硬件电路。
* 学会了高效率的查阅资料、运用工具书、医用网络查找资料。我发现，在我们所使用的书籍上有些知识在实际应用中其实不是十分理想，各种参数都需要自己去调整。偶尔还会遇到错误的资料现象，这就要求我们应更加注重实践环节。
* 在毕业设计中，我们应当注意重点与细节的关系。
* 失败不可怕，只要不趴下，昂首向前走，希望总会有的。
* 同组同学相互包容，彼此合作，取长补短，才能铸就最后的成功。可以说这次毕业设计是对所学知识的一次运用和检阅，同时对自学能力提出很高的要求，所以平时的学习离开思考，就是严重的错误，我们学习不应该有偏科现象，各方面知识都要接触，这样做才能为毕业设计打下基石。  

最后,我要感谢的母校东北石油大学大学,为我提供的良好的学习与发展环境。感谢我的指导教师高新成给予我帮助，感谢母校开放、公正的言论环境,现代、实用的学习环境,舒适、便捷的生活环境让我顺利度过了人生的关键三年。愿所有校园里认识的,不认识的；来过的,走过的……愿你们珍惜握在手里的现在,抓住机遇,拥有一个美好的明天。





# 附录一 程序

程序如下:

```assembly
TM_NUM EQU 23H
TM_L EQU 22H
TM_H EQU 21H
DSPBUF EQU 40H
DQ BIT P2.0
FLAG BIT 00H
ORG 0000H
AJMP MAIN
ORG 000BH
AJMP __INTT0__
ORG 30H
MAIN: MOV SP,#070H
      MOV TMOD,#02H
      MOV IE,#82H
      MOV TH0,#6
      MOV TL0,#6
      MOV R2,#04
      MOV R1,#40H
 LL1: MOV @R1,#00
      INC R1
      DJNZ R2,LL1
      SETB RS0
      MOV R2,#00
      MOV R3,#00
      MOV R4,#00
      MOV R5,#00
      MOV 6FH,#00H
      CLR RS0
      CLR P3.0
      MOV 30H,#02
      MOV 31H,#06
      MOV 32H,#0
      LCALL CHEWEN
__INSTANCE__:CLR TR0
      SETB P2.1
      JB P2.1,K3
      LCALL KKEY
   K3:CLR 01H
      MOV R2,44H
      CJNE R2,#00,K2
      SJMP K7
   K2:CPL P3.0
      MOV R3,#30
   K1:LCALL TM_DISP
      DJNZ R3,K1
      DJNZ R2,K2
   K7:MOV R2,45H
      CJNE R2,#00,K4
      SJMP K6
   K4:MOV R4,#255
  K44:CPL P3.0
      MOV R3,#30
   K5:LCALL TM_DISP
      DJNZ R3,K5
      DJNZ R4,K44
      DEC R2
      CJNE R2,#00,K4
  K6: CLR P3.0
      LCALL CHEWEN
      SETB TR0
MAIN2:JB 01H, __INSTANCE__
      LCALL TM_DISP
      SJMP MAIN2
CHEWEN:CLR RS1
       CLR RS0
      LCALL GET_TM
      LCALL TM_COV
      LCALL DTOB
      LCALL DTOB1
      CLR C
      MOV A,33H
      SUBB A,44H
      MOV 44H,A
      MOV A,34H
      SUBB A,45H
      MOV 45H,A
      RET

    __INTT0__:PUSH ACC
          PUSH B
          SETB RS0
          INC R2
          CJNE R2,#100,__JT0__
          INC 6FH
    
          MOV A,6FH
          CJNE A,#20,__JT0__
          MOV 6FH,#00H
          INC R3
          MOV R2,#00H
          CJNE R3,#2,__JT0__
          SETB 01H
          MOV R3,#00
    
     __JT0__: CLR RS0
          POP B
          POP ACC
          RETI


KKEY: MOV R2,#00
      MOV R4,#0AH
 KS2: LCALL TM_DISP
      DJNZ R4,KS2
      SETB P2.1
      JB P2.1,KKEY1
      JNB P2.1,$
      MOV 60H,#DSPBUF+1
      MOV R1,#DSPBUF+1
      MOV R2,#00
KEY1: LCALL TM_DISP_2
      MOV P2,#0FFH
      MOV A,P2
      ORL A,#01
      CPL A
      JZ KEY1

KEY2: JNB ACC.1,KEY3
      JNB P2.1,$
      INC R1

      INC R2
      CJNE R2,#03,L13
      MOV R1,#DSPBUF+1
      MOV R2,#00

 L13: MOV 60H,R1
      SJMP KEY1
KEY3: JNB ACC.2,KEY4
      JNB P2.2,$
      MOV A,@R1
      CJNE R1,#41H,L1
      CJNE A,#09,LL
      SJMP KEY5
  L1: CJNE R1,#42H,L2
      MOV A,@R1
      CJNE A,#09,LL
      SJMP KEY5
  L2: CJNE R1,#43H,L3
      CJNE A,#09,LL

KEY5: MOV @R1,#00
  L3: SJMP KEY1
  LL: INC A
      MOV @R1,A
  L6: SJMP KEY1
KEY4: JNB ACC.3,KEY1
      JNB P2.3,$
      MOV 30H,41H
      MOV 31H,42H
      MOV 32H,43H
      ACALL DTOB
KKEY1:RET

     DTOB:SETB RS0
          SETB RS1
          MOV A,31H
          MOV B,#10
          MUL AB
          ADD A,32H
          MOV 33H,A
          MOV 34H,#00
          MOV R6,30H
          CJNE R6,#00,JT2
          SJMP JT22
     JT2: MOV A,33H
          ADD A,#100
          MOV 33H,A
          MOV A,34H
          ADDC A,#00
          MOV 34H,A
          DJNZ R6,JT2
     JT22:CLR RS1
          CLR RS0
          RET

  DTOB1:  SETB RS0
          SETB RS1
          MOV A,42H
          MOV B,#10
          MUL AB
          ADD A,43H
          MOV 44H,A
          MOV 45H,#00
          MOV R6,41H
          CJNE R6,#00,JJT2
          SJMP JJT22
    JJT2: MOV A,44H
          ADD A,#100
          MOV 44H,A
          MOV A,45H
          ADDC A,#00
          MOV 45H,A
          DJNZ R6,JJT2
   JJT22: CLR RS1
          CLR RS0
          RET
WR_18B20: MOV R2,#08H
         CLR C
         SETB DQ
         MOV R3,#02H
         DJNZ R3,$
         NOP
    WR1: CLR DQ
         MOV R3,#03H
         DJNZ R3,$
         RRC A
         MOV DQ,C
         MOV R3,#20
         DJNZ R3,$
         SETB DQ
         MOV R3,#03H
         DJNZ R3,$
         DJNZ R2,WR1
         SETB DQ
         RET
RD_18B20: MOV R4,#02H
          MOV R1,#22H
     RE0: MOV R2,#08H
     RE1: CLR C
          SETB DQ
          NOP
          CLR DQ
          NOP
          NOP
          SETB DQ
          MOV R3,#01H
          DJNZ R3,$
          MOV C,DQ
          MOV R3,#010H
          DJNZ R3,$
          RRC A
          DJNZ R2,RE1
          MOV @R1,A
          DEC R1
          DJNZ R4,RE0
          RET
INI_18B20: SETB DQ
           NOP
           CLR DQ
           MOV R4,#150
           DJNZ R4,$
          ;LCALL TM_DISP
          ;LCALL TM_DISP
           SETB DQ
      TS0: MOV R4,#19H
           JNB DQ,TS1
           DJNZ R4,TS0
           SJMP TS2
      TS1: SETB FLAG
           SJMP TS3
      TS2: CLR FLAG
           SJMP TS4
      TS3: ;LCALL TM_DISP
           MOV R4,#120
           DJNZ R4,$
      TS4: SETB DQ
           RET
DELAY8ms: MOV R6,#2H
      KL1: MOV R7,#80H

      KL2: DJNZ R7,KL2
          DJNZ R6,KL1
          RET

GET_TM: SETB DQ
    S1: LCALL INI_18B20
        JB FLAG,S2
        SJMP S1
    S2: MOV R4,#10H
        DJNZ R4,$
        MOV A,#0CCH
        LCALL WR_18B20
        MOV A,#44H
        LCALL WR_18B20
        MOV R4,#0ffH
    S3: LCALL TM_DISP
        DJNZ R4,S3
    S4: LCALL INI_18B20
        JB FLAG,S5
        SJMP S4
    S5: MOV A,#0CCH
        LCALL WR_18B20
        MOV A,#0BEH
        LCALL WR_18B20
        LCALL RD_18B20
        LCALL INI_18B20
        MOV R4,#10H
    S6: LCALL TM_DISP
        DJNZ R4,S6
    S7: RET
TM_COV: MOV A,#0F0H
        ANL A,TM_L
        SWAP A
        MOV TM_NUM,A
        MOV A,TM_H
        ANL A,#07H
        SWAP A
        ORL A,TM_NUM
        MOV TM_NUM,A
        MOV R0,#DSPBUF
        JNB 0FH,SING
        MOV @R0,#0BH
        CPL A
        CLR ACC.7
        ADD A,#01H
        MOV TM_NUM,A
        SJMP SING1
  SING: MOV @R0,#0AH
 SING1: MOV B,#10
        DIV AB
        INC R0
        MOV @R0,A
        INC R0
        MOV A,B
        MOV @R0,A
        INC R0
        MOV A,#00H
        JNB 13H,DOT1
        ADD A,#50
  DOT1: JNB 12H,DOT2
        ADD A,#25
  DOT2: JNB 11H,DOT3
        ADD A,#12
  DOT3: JNB 10H,DOT4
        ADD A,#6
  DOT4: MOV B,#10
        DIV AB
        MOV @R0,A
        RET
TM_DISP: CLR RS1
         CLR RS0
         MOV DPTR,#TAB
         MOV R0,#DSPBUF
         MOV B,#0FEH
         MOV R5,#04
   DIP1: MOV A,@R0
         MOV P0,#0FFH
         MOV P1,#0FFH
         MOVC A,@A+DPTR
         CJNE R5,#02,DIP2
         ANL A,#7FH
   DIP2: MOV P0,A
         MOV A,B
         MOV P1,A
         RL A
         MOV B,A
         LCALL DELAY8ms
         INC R0
         DJNZ R5,DIP1
         RET
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
TM_DISP_1: CLR RS1
         CLR RS0
         MOV DPTR,#TAB
         MOV R0,#DSPBUF
         MOV B,#0FEH
         MOV R5,#04
 DDIP4:  MOV A,R0
         MOV P0,#0FFH
         MOV P1,#0FFH
         CJNE A,60H,DDIP1
         MOV A,#0FFH
         SJMP DDIP3
  DDIP1: MOV A,@R0
         MOVC A,@A+DPTR
  DDIP3: CJNE R5,#02,DDIP2
         ANL A,#7FH
  DDIP2: MOV P0,A
         MOV A,B
         MOV P1,A
         RL A
         MOV B,A
         LCALL DELAY8ms
         INC R0
         DJNZ R5,DDIP4
         RET
 ;;;;;;;;;;;;;;;;;;;;;
 TM_DISP_2: MOV R4,#10H
  KS4: LCALL TM_DISP
      DJNZ R4,KS4
      MOV R4,#1FH
  KS5: LCALL TM_DISP_1
      DJNZ R4,KS5
      RET
TAB:
DB 0C0H,0F9H,0A4H,0B0H,99H,92H,82H,0F8H,80H,90H,0FFH,0CFH
END

```

# 附录二  硬件电路图

![图10-8 硬件电路图](http://my.gunplan.top/static/yj1.png)
# 摘 要

本设计基于基于STC89C52RC单片机的温度控制系统的工作原理和设计方法。本文介绍了控制系统的硬件部分，包括：温度检测电路，温度控制电路，显示电路。单片机处理信号线单片机对信号进行相应处理，以达到温度控制的目的。该文档还重点介绍了采用模块化结构的软件设计部分。介绍了该控制系统的硬件部分会在文中写出，包括的模块是：数字管显示程序，键盘扫描和按键处理程序，温度信号处理程序，继电器控制程序和过热报警程序。同时，还包括系统中复杂的电路设计等方式。主程序，读取温度子程序，键处理程序，LCD显示程序和数据存储程序。该控制系统可以实时存储相关的温度数据并记录当前的时间。系统程序主要包括主程序，读出温度子程序，处理轮转子程序，转换温度计算子程序、按键处理结构、LCD显示程序以及数据存储程序等。



**关键词：AT89C51，单片机 ，DS18B20温度芯片，温度控制**  



# Abstract

This design uses STC89C52RC single-chip microcomputer as the core of the working principle and design method of temperature control system. The temperature signal is collected by the temperature chip DS18B20 and transmitted to the single-chip microcomputer as a digital signal. This article introduces the hardware part of the control system, including: temperature detection circuit, temperature control circuit, display circuit. The single chip microcomputer processes the signals accordingly to achieve the purpose of temperature control. The single chip microcomputer processes the signals accordingly to achieve the purpose of temperature control. The paper also focouses on the software design part, which adopts a modular structure. The main modules are: digital tube display prog random access memory, keyboard scanning and key processing prog random access memory, temperature signal processing prog random access Memory, relay control prog, random access memory, and over-temperature alarm pr ocess. The control system can store relevant temperature data in real time and record the current time. The system prog random access memory mainly includes a main prog random access memory, a readout temperature subprog random access memory, a calculation temperature subprog random Access memory, a key processing prog random access memory, an LCD display prog random access memory, and a data storage prog random access memory.



----




# 第1章 绪 论

## 1.1 温度控制系统研究的目的和重要性

在人类历史上，环境温度起着极其重要的作用。环境温度是工业生产中最常见的工艺参数之一。每个物理变化和每个化学反应过程都与温度密切相关。因此，温度控制是生产自动化中的重要任务。随着社会的发展，科学技术的进步以及温度测量设备在各个领域的使用，智能化是现代温度控制系统发展的主要组成部分。尤其是近年来，温度控制系统已经应用于人们生活的各个方面，但是温度控制一直是一个尚未发展的领域，但这是一个与人类息息相关的世纪之久的问题。在这种实际情况下，温度控制系统的设计具有广阔的应用前景和重要性。

此结构是为室温控制系统设计的，控制对象是室温。温度控制通常用于日常生活和工业领域，例如用于冷室，洗澡池，酵母池，电源和其他地方的温度控制。过去，温度控制是手动进行的，没有给予足够的重视。实际上，在许多地方都必须很好地调节温度。鉴于此问题，此系统设计的目的是创建一个可使其自身适应设定温度的系统。它被广泛使用，功能强大，小巧美观，易于携带。这是一种实用且廉价的控制系统。

## 1.2 温度控制系统研究概况

国外对温度控制技术的研究始于1970年代。首先，使用模拟组合仪器来收集现场信息并执行指令，记录和控制。分布式控制系统出现在1980年代后期。目前正在开发用于计算机数据采集的控制系统的集成多因素控制系统。当前，温度测量和控制技术在全球不同国家中迅速发展，并且一些国家正在朝着完全自动化和无人值守的方向发展。

中国对温度测量和控制技术的研究相对较晚，始于1980年代。中国工程师和技术人员已经吸收了工业化国家对温度测量和控制技术的吸收，从而掌握了室内温度的微机控制技术。该技术仅限于控制环境中的单个温度因子。中国温度测控设备的计算机应用一般处于从消化吸收阶段，易应用阶段到实用化，全面应用阶段的过渡和发展。从技术上讲，大多数情况下都存在由单片机控制的单参数单回路系统，并且没有真正的集成多参数控制系统。与工业化国家相比，差距很大。我国温度测控的现状还远远没有达到工业化水平。生产中仍有很多困扰我们的问题。设备支持能力差，工业化程度低，环境控制落后，软件和硬件资源无法共享和可靠。缺点，例如不良性行为。

##  1.3 温度传感器技术

传感器技术是现代信息技术的主要内容之一，信息技术包括计算机技术、通信技术和传感器技术。计算机和通信技术发展极快，相当成熟，而传感器应用技术因为需要使用模拟技术，而模拟技术还有很多问题难以解决，因此传感器应用技术也有待进一步发展。为了适应现代科学技术的发展，世界总舵国家都把传感器技术列为现代的关键技术之一。通常将能把非电量转换为电量的器件称为传感器，其实质上是一种功能块，作用是将来自外界的各种信号转换成电信号。它是实现测试与自动控制系统的首要环节。如果没有传感器对原始参数进行精确可靠地测量，那么无论是信号转换或信息处理，或者最佳数据的显示和控制都将无法实现。 

温度传感器，使用范围广，数量多，居各种传感器之手。温度传感器的发展大致经历了以下三个阶段：传统的分立式温度传感器（含敏感元件），主要输能够进行非电量和电量之间的转换；模拟集成温度传感器/控制器；智能温度传感器。目前，国际上新型温度传感器正从模拟式向数字式、集成化、智能化及网络化的方向发展。温度传感器按传感器与被测介质的接触方式可分为接触式温度传感器和非接触式温度传感器两大类，其中，接触式温度传感器的测温元件与被测对象要有良好的热接触，通过热传导及对流原理达到热平衡，这个示值即为被测对象的温度。这种测温方法精度比较高，并可测量物体内部的温度分布。但对于运动的、热容量比较小的及对感温元件有腐蚀作用的对象，这种方法将会产生很大的误差。非接触测温的测温元件与被测对象互不接触。常用的是辐射热交换原理。此种测温方法的主要特点是可测量运动状态的小目标及热容量小或变化迅速的对象，也可测量温度场的温度分布，但受环境的影响比较大。 

温度传感器的发展大致可分为以下几种：  
1. 热电偶传感器。热点偶传感器是工业测量中应用最广泛的一种温度传感器，它与被测对象直接接触，不受中间介质的影响，具有较高的精度；测量范围广，可从-50℃～1600℃进行连续测量，特殊的热电偶如金,铁,镍,铬最低可测到-269℃，钨,铼最高可达2800℃。
2. 模拟集成温度传感器。采用硅半导体集成工艺制成的，因此亦称硅传感器或单片集成温度传感器。模拟集成温度传感器是在20世纪80年代问世的，它将温度传感器集成在一个芯片上、可完成温度测量及模拟信号输出等功能。模拟集成温度传感器的主要特点是：功能单一、测温误差小、价格低、响应速度快、传输距离远、体积小、微功耗等，适合远距离测温，不需要进行非线性校准，外围电路简单。
3. 光纤传感器。光纤测温技术可分为两类:全辐射测温法，单辐射测温法，双波长测温法，多波长测温法等。特点是：光纤挠性好、透光谱段宽、传输损耗低，无论是就地使用或远传均十分方便而且光纤直径小，可以单根、成束、Y型或阵列方式使用，结构布置简单且体积小。缺点是：测量起来困难,难于实现较高的精度，工艺比较复杂,且造价高，推广应用有一定困难。
4. 半导体吸收式光纤温度传感器。半导体吸收式光纤温度传感器是利用了半导体材料的吸收光谱随温度变化的特性实现的。一种传光型光纤温度传感器，是指在光纤传感系统中，光纤仅作为光波的传输通路，而利用其它如光学式或机械式的敏感元件来感受被测温度的变化。在这类传感器中，半导体吸收式光纤温度传感器是研究得比较深入的一种。
5. 智能温度传感器。智能温度传感器(亦称数字温度传感器）是在20世纪90年代中期问世的。它是微电子技术、计算机技术和自动测试技术（ATE）的结晶。目前，国际上已开发出多种智能温度传感器系列产品。智能温度传感器内部包含温度传感器、A/D传感器、信号处理器、存储器（或寄存器）和接口电路。有的产品还带多路选择器、中央控制器（中央处理单元）、随机存取存储器（随机存取存储器）和只读存储器（只读存储器）。智能温度传感器能输出温度数据及相关的温度控制量，适配各种微控制器（M中央处理单元），并且可通过软件来实现测试功能，即智能化取决于软件的开发水平。

随着科学技术的不断进步与发展，温度传感器的种类日益繁多，数字温度传感器更因适用于各种微处理器接口组成的自动温度控制系统具有可以克服模拟传感器与微处理器接口时需要信号调理电路和A/D转换器的弊端等优点，被广泛应用于工业控制、电子测温计、医疗仪器等各种温度控制系统中。其中，比较有代表性的数字温度传感器有DS18B20、MAX6575、DS1722、MAX6635等。相比较而言，传统的温度检测以热敏电阻为温度敏感元件，热敏电阻成本低，但需要后续信号处理电路，而且热敏电阻的可靠性相对较差，测量温度的准确度低，检测系统的精度差。数字式温度传感器的种类也不少，并且在实际工程设计中具有上述诸多优点。
# 第2章 系统总体方案设计

## 2.1 系统工作原理

单片机温度控制系统是以AT89C51单片机为控制核心，辅以采样反馈电路，驱动电路，晶闸管主电路对电炉炉温进行控制的微机控制系统。系统的原理框图如图2-1所示，其基本控制原理为: 用键盘将温度的设定值送入单片机，并在发光二极管显示，启动运行后，通过信号采集电路将温度信号采集到后，送入单片机系统进行PID 控制运算，将控制量输出，改变可控硅管的接通时间便可改变加热丝功率，以达到调节温度的目的控制电阻炉的加热。

当由于环境温度变化太剧烈或由于加热或降温设备出现故障，或者温度传感头出现故障导致在一段时间内不能将环境温度调整到规定的温度限内的时候，单片机通过三极管驱动扬声器发出警笛声。 

![图1-1 第一个方案](http://my.gunplan.top/static/1.0.0.PNG)

图1-1为第一个设计方案，该方案的工作原理简述如下：

1. 锯齿波是由单结晶体管BT和R1，R2，R3，W1和C1组成的张驰震荡产生，然后经射极跟随器V1、R4输出。
2.  控制电压（Uk）与锯齿波电压进行电流叠加后送到V2的基极，合成电压为Us，当Us>0（0.7）时V2导通，Us<0，则V2截止。
3.  由V2、V3以及R8、R9、DW1组成一直流开关，当V2基极电压Ube2>0(0.7)，V2导通，Ube3接近零电位，V3截止，直流开关导通。输出24V直流电压。
4.  过零脉冲的输出，由同步变压器TB，整流桥D1及R10，R11组成一削波同步电源，这个电源与直流开关的输出电压共同去控制V4与V5。只有当直流开关导通期间，V4截止，V4、V5基电极和发射极之间才有工作电压，才能工作在期间，同步电压每次过零时，V4截止，其集电极输出正电压，使V5由截止转导通，经脉冲变压器输出触发脉冲而此脉冲使晶闸管T在需要导通的时刻导通。

在直流开关导通期间使出连续的正弦波控制电压Uk的大小决定了直流开关导通时间的长短，也就决定了在设定周期内导通的周波数，从而可输出功率的调节。显然，控制电压Uk越大，则导通的周波数就越多，输出的功率也就越大，电阻炉的温度也就越高，反之，电阻炉的温度就越低。
闭环控制自动调温的基本指导思想是在系统中增设温度传感器和温度调节器，温度传感器的基本功能是检测电炉的实际温度，并变换成电压讯号和炉温控制电压Uk进行比较，根据两者差值的大小（Δe=Uk-Uft）和变化方向（即△e为正还是为负），通过调节器进行相反方向的调节，使调节器的输出控制直流开关导通时间的长短，从而使设定周期内晶闸管的导通周波数增大或者减小，相应的电炉温度升高一点或者减小一点。采取这种控制方式，可以使炉温在较小的范围内变化，控制精度高。
方案二：为了使得电路的简单化，采用单片机作为控制核心来设计本课题，温度信号采集使用温度传感器DS18B20，温度控制的基本思想为：通过采集到的温度与标准温度之间的差值来控制加热电阻丝的通电时间长短，从而起到恒温控制的目的。方案二的设计框图如下图所示：

![图1-2](http://my.gunplan.top/static/1.0.0.PNG)

本方案采用单片机作为控制核心，使用温度传感器进行温度采集，通过将采集到的温度与标准设定温度之间的差值进行温度控制，从而使得温度维持在标准设定温度。本方案设计成本低，具有具有较高的可靠性，对于系统动态性能与稳定要求不是很高的场合非常的合适。

单片机温度控制系统是以AT89C51单片机为控制核心，辅以采样反馈电路，驱动电路，晶闸管主电路对电炉炉温进行控制的微机控制系统。系统的原理框图如图2-1所示，其基本控制原理为: 用键盘将温度的设定值送入单片机，并在LED显示，启动运行后，通过信号采集电路将温度信号采集到后，送入单片机系统进行PID 控制运算，将控制量输出，改变可控硅管的接通时间便可改变加热丝功率，以达到调节温度的目的控制电阻炉的加热。

当由于环境温度变化太剧烈或由于加热或降温设备出现故障，或者温度传感头出现故障导致在一段时间内不能将环境温度调整到规定的温度限内的时候，单片机通过三极管驱动扬声器发出警笛声。

## 2.2 系统功能介绍

本设计是对房间温度进行检测与控制，设计的温度控制系统实现了基本的温度控制功能：当温度低于设定的温度时，系统自动通过PWM启动加热装置，使温度上升。当温度高于设定的温度时，停止加热。三位数码管及时显示温度，精确到小数点后一位。  
本文设计的温度控制系统具有如下功能：

1. 通过温度芯片DS18B20采集温度，并以数字信号的方式传送给单片机。
2. 四位数码管动态实时显示房间温度，显示精度0.10C。
3. 三个按键实现标准温度的设定。
4. 利用PWM实现温度的控制。



# 第3章系统硬件电路设计

![图3-1电路硬件图](http://my.gunplan.top/static/2.0.1.png)

该解决方案使用AT89C51为核心处理芯片，芯片DS18B20测量内部温度，通过发送信号传输总线到MCU，并且和一个4位LED显示管温度。偏差用于控制电阻丝导通/截止时间的长度。实现恒温控制的界面的最终想法是最终想法。

## 3.1 各模块设计

### 3.1.1 温度传感器电路

本文在课题教学研究中所采用的的温度传感器一般可以分为采用一个美国两个单线的四位数字小型环境温度传感器例如ds18b20。该稳压传感器4.7k##hz该传感器用于输出稳压信号的上和下拉稳压电阻直接通过连接输入到一个微控制器的一个p1.0引脚。

半导体温度传感器DS18B20产生Dalalas数字温度传感器，多并行总线技术。该器件在小型集成电路芯片上制造温度敏感的半导体器件、 A / D 转换器、存储器等。在对本设计中的温度传感器进行多次比较和考虑之后，选择了单线数字设备DS18B20，主要是由于以下原因：

1. 该检测系统的主要特点功能是：在一个允许温度范围的工作检测温度是-55℃〜+125℃，±0.5度的工作温度和在测量值的精度是5℃。温度函数转换器高精度。9至12变量，温度检测值数据可以被直接转换成一个串行16位的非二进制的或数字输出形式的数据输出;最大输入时间频率转变精度为12位测量精度转变为750ms;它们都可以通过一条数据线被直接供电，具有超低电源功耗。
2. 系统进行成本：由于我国计算机信息技术和微电子科学技术的发展，新型企业大规模集成电路设计越来越具有强大，体积变得小是越来越会发生的，价格也会下跌。DS18B20提交空间与普通晶体管之间几乎没有本质区别的，价格只有约$1。
3. 降低系统总线技术操作复杂度：由于设备ds18b20是单总线测量设备，微处理器与之进行接口时只不过需要至少占用在校学生一个模拟i/o口，一根模拟总线测量方式线就可以同时连接数十个设备ds18b20，温度管理进行总线测量方法完全无需任何模拟企业外部网络控制元件，因此，与传统模拟工业生物温度传感器中的网络系统相比，可以测量得到大大幅度增加以及减少系统布线调试次数，降低温度管理系统的技术复杂性，减少重大工程项目的基础建设工作量。
4. 减少系统的引线调试和日常维护：由于大量减少的系统引线数量可以不会引起一些小的事情，大量使用减少接线的工程数量，减少接线工程数量产生的引线施工成本量大大降低，系统的内部布线过程复杂度的降低调试和日常维护另一方面，因为系统引线接口数量的减少产生的故障数量大大下降，使得整个系统中的接口工作变得简单许多，给系统的日常调试工作带来更多方便，之所以认为dsl8820是全方位数字化的元器件，故障基本不会同时发生，干扰性的和可抗性强，因此为了让整个系统的在整个日常生活中而所进行需要保证正常工作的维护任务大大减少，为了更好保证系统可用性而所进行的日常维护相关工作保证正常系统运行的维护工作。

ds18b20温度控制系统传感器引线技术通常存在一个小的引线，引线上的数量通常是3，并且我们可以确定不在一个企业内部：一个单线程的数据网络信息传输包括系统总线数据端口vvdq、外部数据电源线vdd和公共网络地址总线端口gnd。ds18b20有2种直流供电的工作方法：其一种就是采用杜邦线的直流供电电压模式。此时，vdd被完全接地。当它开始产生能量空闲时，它通过内部一个电容器线路来让它存储剩余电量用从外部数据线路中获得剩余能量并用来让它完成整个温度功率转换，相应的当它完成整个温度功率转换的持续时间也会更长。在这种应用情况下，使用一个单片机的一个矩形i/o输出端口让它来自动拉起一个ds18b20总线。另一种模式是外部温度电源连接模式(vdd电源连接+5v)，完成外部温度变化测量的时候相应操作时间短。

在本设计项目中我也可以直接采用由大学生企业提供的并不在相关企业内部的各种电子信息流的流动强度及其发展计算方式等来进行设计实现。cds18b20传感器与驱动单片机的接口连接，其内部接口集成电路设计方案如软件图2-2所示。

![图2-2外部电路](http://my.gunplan.top/static/003.jpg)

### 3.1.2 通用键盘显示电路设计

![图2-3外部电路](http://my.gunplan.top/static/003.jpg)

所示，ale时钟脉冲可以作为一个时钟同步电路8279，从而与示意图的两个时钟脉冲同步。2-3。8279芯片的控制中断电路控制输出信号irqr连接到一个控制单片机的一个p1-1引脚。缓冲器输入地址是将寄存器中的a0连接输入到整个单片机的一个p2-5引脚，ae的缓冲信号则是连接到整个单片机的一个p2-6引脚。读写器和信号数据线缆分别和两个单片机的信号读写器和信号数据线缆来进行连接相连。8279芯片的外部数据传递运输线路由d0-d7与整个单片机的外部数据线直接相连进行相应的连接。

来自8279芯片和AT89C51芯片的许多信号是一致的，可以直接级联，这非常容易控制。8279芯片的8位数据线进行直接连接到AT89C51芯片的P0端口。读取和写入信号连接到89C51的读取和写入信号。 AT89C51锁存信号ALE连接到8279 CLK，在内部分频后，会产生一个公共的非外部时钟脉冲。8279芯片的端子请求信号由反相器反转，然后连接到AT89C51的P1.1端口。 AT89C51的三个可寻址寄存器只需要两个地址即可寻址，即命令/状态寄存器地址和数据寄存器的地址值。8279芯片中与地址相关的信号是A0和芯片选择信号。您的连接直接确定寄存器地址在哪里。一旦确定了硬件电路，就确定了寄存器的地址。

发光驱动二极管的色号发光驱动效率和显示颜色分别取决于每个制造商的材料，如果出现没有什么意外情况是可以使用egred色号，出现其他意外情况可以使用reyellow或是egreen色号。发光电子二极管又称发光电子二极管主要是利用智能电子技术通过测量管理系统控制测量仪表中简单而常用的进入输出一个控制装置，通常说它可以直接用于用来指示一个机器的工作状态或其他相关企业服务信息。具有系统功耗低、配置灵活、接口方便、价格低廉、使用寿命长、对各种电子管直流的流动强度和电势差异性要求低、易于手动实现连接多种电路等多大优点。

液晶电视显示器本身是被动电子显示器，它本身不向外调节发出一种具有一定粒子性的主动电磁波，只需向外调节其发出一种具有一定粒子性的被动电磁波的频率数量。目前，常用的彩色液晶信息显示器通常是根据中国的而液晶对于信息显示失真率的问题总是按克列拉斯效应的基本原理设计制成的，它通常可以通过同时获得一个位于黑色信息发展初始背景上的一个白色初始字符或一个白色初始背景上的一个黑色初始字符的方式显示不同信息形式。便携式检测仪器主要用于电力测量和分析控制和检测智能动力电池中的电力，考虑到低损耗功率的应用要求，经常我们需要同时使用的就是液晶电视显示器，重量轻，功耗低的而且体积小，因此，广泛作为采用的检测手段。但是必须需要借助外来的灯光进行显示。阴极红外射线图形显像管这种显示器虽然可以同时显示多种图形，但显示界面更复杂，成本更高。

在多路显示温度自动巡检仪中只要您需要同时显示4位的和数字两种形式的显示温度和检测路数，可以不必考虑使用某种价格较高的荧光阴极或红射线液晶显像管;4位数字发光光电二极管的实际工作频率电子在直流的波动强度一般为240ma左右，由于需要使用一个交流电源进行供电，足以完全提供四位发光光电二极管液晶显示器所使用需要的最大功率，对于四位发光光电二极管而言，仅有4位，体积也很小，这样比较符合发光光电二极管和四位液晶电视显示器的诸多性能特点，本检测系统建议选择四位发光光电二极管液晶显示器。

键盘设计是一组多按键的整体组合。其主要工作功能之一是实时控制操作系统的正常工作运行状态，向系统接口输入大量数据和发出命令。有两种键盘类型：标准编码数字键盘和非标准编码数字键盘。

除了单个按键之外，编码器的键盘系统还包括一个用于自动生成键码的多个硬件控制电路、抖动控制电路、多个击键和多个按键之间移动时的保护器等电路。每按一个数字键，就表示可以自动重新生成这个数字键的键码。同时还会产生一个脉冲控制信号，通知系统中央处理控制单元进行接收。这种单片键盘使用方便，接口使用程序简单，但由于需要使用更多的相关硬件集成电路，价格也会变得更高，一般来说单片机键盘应用在该系统中的应用不是非常多。

非按列编码数字键盘仅由按行矩阵排列和非按列排行矩阵两种形式的编码键盘所组成。按键的抖动作用主要是简单地停止连接或自动断开触点，按键的触点抖动、按键软件代码的自动形成和每个按键的自动识别都必须是由按键软件操作来自动完成的。由于其价格经济并且实用，在各种单片机硬件应用管理系统中已经得到广泛应用。

上述一系列比较之后，它应该是非编码键盘。

P0端口： P0端口为8位漏极级开路双向 I/O 端口，每个引脚可吸收8TTL 栅极电子流的强度。当端口 P1的引脚首次写入1时，它被定义为高阻输入。P0可用于非内部程序数据存储器，可以定义为数据/地址的第八位。在 FIASH 编程中，P0作为原始代码输入端口。检查 FIASH 时，P0输出原始代码，必须拉起 P0的外部。

端口设置p1：端口设置p1是一个8位双向模拟i/o输出端口，内部分别提供上或下拉输出电阻。端口强度p1缓冲区强度可以达到接收进入输出4ttl门口的电子负载流的最大强度。p1端口的写入管脚板在写入1后，内部拉高，可以直接作为数据输入。当一个端口上的p1从外部被下拉到低稳压电平时，它将达到输出一个电子到直流的最大强度，这可能是由于内部上压下拉。在执行可以被擦除的非读写数据存储器程序编程和数据验证程序过程中，p1端口通常作为第8个输入地址被程序接收。

p2端口：p2端口是它是一个内部上和下拉稳压电阻的8位双向模拟i/o端口。p2端口栅极缓冲器引脚可以用来接收和控制输出4个ttttl栅极缓冲电子的直流的缓冲强度，当一个端口缓冲p2被直接写入"1"时，其引脚被内部上和下拉栅极电阻拉高并可以用作缓冲输入。因此，当它被直接用作电流输入时，端口位于p2的引脚被外部电压拉低到位于输出端的电子负载流的最大强度。这可能是由于内部上下牵拉的原因缘故。当p2端口，用于外部执行程序数据存储器或外部程序数据处理存储器同时访问的16位数据地址，输出时的端口相当p28的8位地址。读出和存储写入外部输出数据时在存储器输入地址8时，p2端口作为输出数据内容在特殊寄存功能下的寄存器。p2端口在整个闪存硬件编程和数据验证系统工作期间使它可以同时接收高八位存储地址以及存储信号和闪存控制器在系统中的信号。

p3端口：p3端口引脚为8个双向直流i/o控制端口，带有内部上压下拉控制电阻，可同时接收和控制输出4个在tttl栅极上的电子到直流的最大强度。当两个p3端口开始写入"1"时，它们在内部被迅速拉升并达到高水平并且被用作信号输入。作为一个输入，由于外部下拉低，p3端口将由于上下下拉而达到输出一个电子负载流的最大强度(ill)。

p3端口如果可以使用作为at89c51的一些特殊控制功能的通用接口也是完全可以的，如下面列表所示：

管脚备选功能

：-：：-：

P3.0 RXD (串行输入)

P3.1 TXD (串行输出)

P3.2/INT0(外部中断0)

P3.3/INT1(外部中断1)

P3.4 T0(定时器0外部输入)

p3.5t1(外部微波信号定时器1外部微波信号发出输入)

P3.6/WR (外部数据存储器写门)

P3.7/RD (外部数据存储器读取频闪)

p3端口同时它也可以用来接收一些主要的可用于总线进行射频闪烁信号编程和射频编程性能验证的射频控制电路信号。

rst：振荡器的复位字节输入。当外部振荡微处理器重置为一个器件时，在两个机器工作周期内保持一个rst引脚的高电平。ale/prog：当振荡器访问一个企业外部的数据网络存储器时，使用网络地址锁存器引脚所允许的外部输出正脉冲信号的高电平来对锁存网络地址的位置和状态进行复位字节。此引脚主要用于在振荡器的闪存脉冲编程期间通过脉冲输入用于闪存编程的脉冲。在通常的，周期性脉冲输出的ale正脉冲信号的恒定脉冲频率大约为1/6振荡器的频率。因此，它们实际上可以跳过一个用作外部脉冲输出的周期性脉冲或跳过一个用于定时目的。但是应该注意的是每一次都需要指出的一点是，外部的数据存储器，这将被用于跳过一个新的ale脉冲。如果振荡器需要禁用一个alert的复位字节输出，可以在振荡器的sfr8eh地址上重新设置0。此时，ale只需要执行一个movr，movd指令为一个新的ale。另外，该引脚被略微拉高。如果外部微处理器在外部脉冲执行的状态ale禁止，则该引脚的设置无效。

psen：外部的应用程序例如数据包和存储器的编程代码包含指令集的选择和数据通门控制信号。在外部软件程序执行的指令代码流在提取中的指令外部程序中的数据流在存储器系统中的每个代码提取指令值在提取期间，每个外部程序机器执行周期有效两次/psen。但是，访问外部应用程序例如数据库和存储器时，这两个有效的/psen的控制信号通常可能不会同时一起出现。

ea/vpp：这是用于保证当/ea端口器继续工作保持低稳压电位，这期间的外部应用程序相同存储器(0000h-ffffh)，无论它的存储器类型是否与内部的应用程序相同存储器。需要特别注意，当外部应用程序开始使用加密的文件方法1时，/ea中的存储器端口会自动锁定内部以用于防止文件重置;同时当/ea端口的继续运行保持正常的最高位时，这里的内部应用程序没有内存。该引脚还同时可以作为用于在不对闪存进行编程期间用于应用12v值的闪存进行编程的备用电源(vpp)。

xtal1：反向控制电路主要用来进行控制振荡信号放大器的时钟输入和内部时钟输出是用来进行控制系统的内部时钟质量管理工作以及辅助系统控制反向电路的外部驱动控制器的输入。

XTAL2：来自反向振荡器的输出。

### 3.1.3 振荡器特性

xtal1和外部xtal2分别提供的是片内反相放大器的脉冲信号输入和振荡器输出。该系列反向放大器的设备可以直接配置为片内的振荡器。石晶振荡和陶瓷振荡均可广泛采用。如果放大器使用外部的时钟源脉冲驱动的设备，则放大器不应需要连接xtal2。对内部的时钟源脉冲信号的多余脉冲输入信号需要通过两频的分频脉冲触发，因此放大器对外部时钟源脉冲信号的所需脉冲的宽度没有严格的要求，但是必须注意保证时钟源脉冲的频率高低和电平的所需脉冲宽度。

### 3.1.4 芯片擦除

通过快速组合正确的两个锁定保存位芯片控制电阻信号并同时将它保持在比ale引脚低10ms，可以轻松快速完成整个程序pe-rom两个芯片控制阵列和三个用于锁定保存位的两个芯片控制电阻被擦除。在重复执行一个芯片用于锁定内存位置的电擦删删除的每个操作中，代码中的数据元组被允许重复执行写入"1"，并且必须在执行芯片锁存重复执行写入一个可编程非零时空函数存储器的字节之前，它才能重复执行此位电擦除后的操作。

此外，at89c51配备了固定的逻辑，可以从低频动态到零的频率静态，支持两种软件模式和可选的自动关机中断模式。系统在空闲时中央控制单元软件自动停止振荡器的工作。然而，随机存取的存储器，定时器，计数器，串行接口和振荡器中断系统继续保持正常工作。在这种关机中断模式下，将自动保存随机存取存储器的所有内容，并自动冻结振荡器，并自动停用所需要使用的其他硬件和芯片振荡器的功能，直到振荡器下一次所使用的硬件振荡器复位完成为止。

许多尚不了解51单片机的互联网用户会遇到以下问题：书籍和在线教程中的AT89S51是什么?8051、89C51等，但没听说过89S51。

在这里，剛刚刚入門的单片机新人应该先阐明一下单片机实际使用的一些产品和理念。mcs-51微控制器单片机是基于美国英特公司于1980年推出的一款单片机产品。其典型的产品理念为8031(芯片无内置的程序和存储器，实际的使用已从单片机市场上完全淘汰)，8051(通用芯片设计采用hmos，功耗为630mw，是89c51的5倍)日期根据实际的使用)。但是到目前为止，8751和其他的通用芯片产品仍然可能是完全兼容的，包括mcs-51核心处理器系列和微控制器(目前已全部停产89s51、89c51等)。在加州理工大学和计算机职业技术学校的单片机培训课程和文档中，mcs-51微控制器仍然可以用作基础理论和学习的一个重要代表。

在一些技术文档中，8051甚至被广泛称为是mcs-51系列中的mcu。8051是早期最典型的单片机代表。由于对mcs-51单片机的深刻历史意义，许多微控制器公司都推出了许多兼容这一系列的单片机，这也就意味着他们的内核确实已经存在于mcs-51。它已经成为8位微控制器的一个标准。

其他飞利浦公司的51mcu产品与51mcs-51核心处理器兼容。相同的微控制器程序，在每个飞利浦微控制器设计制造商的产品和硬件上所需要执行的程序和结果可能是相同的，例如，我们常说的89c51，如飞利浦的at89c51(已宣布停产)，89s51，飞利浦(简称飞利浦)和l公司的winbond(winbond)等。已停产的微控制器是飞利浦atmel公司的单片机和at89c51单片机。同时，许多微控制器功能在原始的基础上已经得到了很大的改进，例如b.时钟。闪存越好(程序中只读存储器的所有内容至少一次可以反复重写1000次)。对于只读存储器(一次只能写入)，at89c51的存储器性能远远地要优于8051。

关于目前的市场营销，pic单片机制造商阵营对89c51提出了强烈的质疑。89c51最严重的问题是存在技术缺陷之一就是添加更多isp(在线更新应用程序)的功能目前是不被认为能夠广泛使用的。因此需要通过添加更多isp功能等新功能之后才能在市场上继续使用。mcs-51图例。在这种的情况下，89s51取代了89c51。目前，89s51依然已经变成了单片机市场中大多数人民的选择之中的一个绝大部分。目前市场份额最大的atmel已经宣布停止了生产新的at89c51，将其产品改用全新的at89s51。89s51进行了一系列技术上的改进。89s51采用全新的0.35标注，可有效控制单片机制造基本的成本，改善产品功能，增强市场竞争力。89sxx可以成为兼容89cxx等51系列单片机的芯片。同时，atmel不再需要接受89c的大量订单。你在目前市场上所能看到的89c51实际上已经是atmel以前停止生产的大量库存。

## 3.2 AT89C51单片机简介

at89c51是一个os8-bit微处理器(fpeam只读存储器-flashprog随机存取只读存储器fpram和一个可自动擦除随机存取只读数据的存储器)，俗称嵌入式微控制器。该设计原件是采用基于atmel的高密度非易失性只读存储器的制造技术设计制造，与符合行业标准的atmcs-51指令集与输出引脚指令集是兼容的并可以一直连接到。由于多功能8位中央处理器和闪存指令集结合在一个独立的单芯片中，atmel的at89c51是一个高效的嵌入式微控制器，它为许多的嵌入式控制系统应用提供了一个灵活和廉价的解决方案。

![3-8硬件电路图](http://my.gunplan.top/static/3.2.png)

at89c51可由一个atmel公司的控制器在线进行编程，用于嵌入式温度数据采集和嵌入式数据通信。at89c51是一款低成本功耗、高性能的cmos8位嵌入式单片机，其中主要包含了可通过重复自动擦除1000次的闪存和具有8k字节的isp(指令系统内的prog随机存取程序和存储器matlable)的嵌入式闪存只读程序和存储器，该芯片元器件主要采用了基于atmel的一种高密度、非易失性的嵌入式存储技术设计制造，兼容了标准的mcs-53指令系统和80c51引脚的结构。该系列芯片元器件集成了一个通用的8位中央处理器和一个isp的嵌入式闪存存储单元，功能强大的微型嵌入式计算机的at89c51可以为许多嵌入式控制和管理系统的应用和分析指令系统的发展历程提供一些具有降低生产成本和经济效益的解决问题的方案。at89c51具有以下的特点：40针、4k字节闪存片上应用程序数据存储器、128字节随机存取应用程序数据存储器(随机存取数据存储器)、32个外部双向数据输入/外部输出(i/o)串行通信端口，5个串行中断优先级，2个串行中断优先级嵌套中断，2个16位的可编程定时计数器，2个全双工串行通信控制端口，watchdog(wdt)控制电路，片上时钟振荡器。

at89c51有三个并行的i/o口，p0：p0.0~p0.7，p1.0~p1.7，p2.0~p2.7。此外，当没有片上或外部存储器时，p0端口可以用作公共i/o的端口，当主机使用外部或片上存储器时，p0端口也可以直接用作地址数据线/端口或数据线。p1端口也可以直接作为一个通用的公共i/o端口，p1.0、p1.1、p1.5~p1.7也可以具有特殊的端口功能，如表3.4所示。当主机没有片外存储器时，p2端口可以直接用作公共的i/o端口，当主机使用外部存储器时，p2端口也可以直接用作高8位地址。

|引脚特殊功能

：-：：-：

P1.0 T2：定时器

P1.1 T2EX：定时器

P1.5 MOSI：用于在线编程(ISP)

P1.6 MOSI：用于在线编程(ISP)

P1.7 SCK：用于在线编程(ISP)

表3.4at89c51p1端口的特殊控制功能

引脚特殊功能

：-：：-：

P3.0 RXD (串行端口输入)

P3.1 TXD (串行端口输入)

P3.2 INT0(外部中断输入0)

P3.3 INT1(外部中断输入1)

P3.4 T0(定时器0外部输入)

p3.5t1(外部定时器1外部定时信号发出输入)

P3.6 WR (外部数据存储器写控制)

p3.7rd(外部的数据存储器对外部读取和控制)

表3.5 AT89C51 P3端口的特殊功能

这个房间的温度监控系统主要使用单片机进行通讯和温度检测。 P3.0接受DS18B20。 P0端口用于设计温度显示界面。微控制器和控制电路共享一个外部时钟，使用一个片上存储器并具有上电复位功能。单片机的最小系统如图3.2.1所示：

[图3.2.1 SCM 最小系系统(http：//my.gunplan.top/static/3.2.1.png)

## 3.3 8279芯片简介

### 3.3.1 引脚介绍

8279采用单5V电源供电，40脚封装。

DB0~DB7：双向数据总线，用来传送8279与中央处理单元之间的数据和命令。

clk：时钟的输入数据线，用于时钟产生的具有内部定时的时钟脉冲。

复位：复位输入线，复位后8279设置在字符显示的左输入端，两个按键锁定的设置为接触回弹式，程序需要将时钟输入线的预分频器信号设置为31，并且保证复位后的信号在高电平下有效。

CS：芯片选择输入线，低电平有效，CS 端低电平时单片机可读写8279

A0：缓冲区低地址。当 A0为高电平时，表示数据总线是命令或状态。当 A0低时，表示数据总线是数据总线。

研发：通过读取控制器将信号发送到输入数据总线，低电平有效，读出数据缓冲区，并将内部数据发送到外部数据总线。

WR：写信号输入线，低电平激活，读出缓冲器并将数据从外部数据总线写入8279的缓冲器。

RL2-140-VCCRL3-239-RL 1

CLK-338-RL 0

IRQ-437-CNTL/STB

RL4-536-SHIFT

RL5-635-SL 3

RL6-734-SL 2

RL7-833-SL 1

RESRT-932-SL 0

RD-1031-OUT B0

WR-1130-OUT B1

DB0-1229-OUT B2

DB1-1328-OUT B3

DB2-1427-OUT A0

DB3-1526-OUT A1

DB4-1625-OUT A2

DB5-1724-OUT A3

DB6-1823-BD

DB7-1922-CS

VSS-2021-A0

irq：中断请求的正确输出和执行，高级有效。在这种键盘自动中断工作模式下，当每次出现的从fifo/sensor随机存取的在该存储器中间没有任何数据时，中间的断线由一个低电平线转变为一个新的高电平，每次键盘中断时由从fifo/sensor随机存取的该存储器的所有数据被自动读出，断开的检测线路降至较低的水平。如果随机存取的存储器中仍然存有信息，该行将再次变为一个较高水平。在线路和传感器正常工作的模式下，每当随机检测到线路和传感器的信号发生变化时，中断线就可能会逐渐变高。

sl0~sl3：视频扫描线缆可用于实时连接和自动扫描任何按键或光开关、传感器或光阵列和触摸显示器或屏幕上的任何数字，可编程或支持视频可编解码。

rl0~rl7：按键返回扫描线通过按钮或传感器的开关与返回扫描线进行连接。上拉按压电路一般设置在相应的返回扫描线内部，以使返回线保持在高水平。只有当一次按压电路关闭时，相应的按键和返回线才会自动转变为一个低电平;当一次无按键闭合时，均保持在较高电平。

shift：这是换位驱动开关的主要功能。当一个换档电压开关自动闭合时，它被一个换位电压开关自动拉至较低的相位电压电流水平。同时在每当未按时接下一个好的换档电压开关时，换档电压开关的整个输入电压状态必须保持在一个好的高电平。在正常的自动键盘扫描模式下，按键自动关闭，按键的操作位置和自动换位键的开关和所输入的操作状态一起由自动键盘扫描存储。

cntl/stb：自动高电平电源关闭当用户打开一个cntl/stb的电源开关时，它将自动将其拉低，否则将始终无法保持一个好的高电平。对于所有使用鼠标键盘输入的操作模式，该行通常被用作选择控制输入。例如当用户按下按钮时，按钮的数据位置与所有控制输入状态的数据存储在一起的数据位置相同。在选通控制输入的模式下，通常需要选择它，并将按钮的数据位置存储在一个fifo随机存取的存储器中。

outa3〜outa0和一个outb3〜outb0：显示数据输出一个8位端口a和一个8位端口b。这两个端口之间既可以独立进行控制，也是一个可以单独视为8位的端口。

bd：使用数字数据空间的长度显示。此命令输出的一个信号结果可以直接用于在一个两位数字的字符转换期间进行显示一个空格，或者你也可以通过使用"显示空格"的一个命令行来控制一个信号在显示空格一个字符的转换空间进行显示。

VCC：+5V电源输入线。

VSS：地线输入线。

### 3.3.2 8279的编程方法

8279按其控制功能块的大小可以细分为：显示器和键盘控制功能块;工作和显示控制功能块;工作和控制处理器功能块;键盘控制接口和中央处理器功能块控制功能块主要包含手动控制和时间寄存器，定时和自动控制，扫描和计数器三个组成部分，它主要的功能是用于控制显示器和键盘的工作和显示控制功能块。

控制和时间数据寄存器：一种用于存储键盘和中央控制单元的通用编程语言控制命令。当8279中央处理器的程序人员确定了键盘和显示器的工作状态模式以及其他显示器工作的条件时，首先将命令键和控制数据放置在一个数据总线上，然后使用命令a0=1，wr=0cs=0并将所有的命令和键数据保存在wr沿边缘增加了控制和显示器的时间数据寄存器，并对其进行解码以方便创建适当的命令控制功能。

定时和计数器控制：它通常包含一个基本的键盘定时和计数器。第一个定时计数器控制是一个分频系数范围为2-31的预定时器。我们可以通过应用程序控制其预设的分频系数，以使内部的频率为100khz，这样的频率可能至少会导致5.1ms。包括键盘阵列扫描时间和10.3毫秒的反跳扫描时间。其他的计数器对该基本的频率扫描时间进行了划分，并为我们提供适当的键，行，键盘阵列扫描和显示键盘扫描时间。

扫描键盘计数器：用于扫描键盘的计数器主要有两种基本编码工作的模式。在基本编码计数器工作的模式下，计数器为键盘提供一个二进制的计数器。在外部软件输出引脚sl0-sl3之后，可以为用于扫描键盘的计数器提供二进制的扫描计数器功能，并在外部软件解码后进行显示。在此工作模式下，扫描键盘计数器对最低有效值的两位进行解码，并且输出引脚sl0-sl3输出1分之4的二进制解码信号，以对键盘的显示器和用于扫描键盘的二进制扫描计数器进行解码。

键盘功能块包括：返回缓冲区、键盘弹跳和控制、8x8 FIFO 传感器随机存取存储器、 FIFO/传感器随机存取存储器状态。

#### 返回抖动缓冲器与鼠标键盘的抖动反向起跳及抖动控制

八个返回行由返回缓冲区缓冲。在键盘工作模式下，逐个检测这些行，找出行键中已关闭的键。如果回弹电路检测到钥匙关闭，则等待10.3ms，然后记录钥匙是否仍然关闭。如果仍然关闭，则矩阵中 key 的行地址和列地址以及 SHIFT 和 CNTL 的状态一起发送到 FIFO 随机存取存储器，并且 FIFO 随机存取存储器中的数据格式如下：

D7 D6 D5 D4 D3 D2 D1 D0

CNTL SHIFT SCAN RET URN

数据的进行格式中，最高位为shicntl，次高位为shift状态，d5-d3来自不同的扫描线上电子的计数器，d2-d0来自中国传感器返回一个电子计数器，扫描线电子计数器和一个回扫线电子计数器的开关值分别可以直接反映正在输出被传感器按下开关键的行，列的开关值，如果在一个传感器的阵列中，返回行上的开关数据直接进入与正在输出被扫描的传感器阵列相对应的一个传感器随机存取电子存储器阵列中的行，这样，每个传感器开关的数量和位置直接被传感器反映为一个传感器随机存取电子存储器的开关位置。

#### FIFO/传感器随机存取存储器

8x8随机存取存储器是键盘模式和选通模式下的先进先出(FIFO)存储器。每条新的信息都是按顺序写的，然后按照写的顺序读出来。当传感器阵列扫描时，存储器被用作传感器随机存取存储器。此时，随机存取存储器中的每一行存储传感器阵列中相应行的状态。

#### FIF0/传感器随机存取存储器状态

在使用键盘或门控的错误模式下，fifo中的状态阵列跟踪信号表示fifo中的状态字符数注意它到底是"满"还是"空"，过多的传感器写入或读取被状态逻辑认为可能是错误，当传感器fifo不为空时，状态阵列跟踪逻辑就会提供一个用于中断传感器应用程序irq的信号。在特殊的传感器状态阵列扫描模式下，如果一个有效的传感器状态发生改变，irq信号可能是一个有效的传感器高电平。fifo表示状态字的低3位表示fifo模式中的传感器字符数，fu位表示一个fifo随机存取的存储器已满;o(超过donmn)du位表示超限错误，即传感器试图将另一个传感器的字符发送到完整的传感器fifo;u(done下)du位表示null错误，即传感器试图写入或读取空的传感器fifo。s/f有两种的含义：在特殊的传感器扫描模式下，s/f的含义是指一个传感器随机存取的存储器中至少可能包含一个指示传感器是否闭合的指示，在特殊的错误模式下，s/f位是一个传感器错误的标志，指示了是否传感器发生了多通道同时写入或关闭的错误，du位表示错误显示随机存取的存储器尚未完全可用，因为"清除显示"或"清除全部"的命令已经无法完成其他未被消除的操作。

显示随机寄存器块的功能块主要包括：16x8显示随机寄存器，16x8显示随机存取地址存储器，显示随机地址存取寄存器)

#### 显示随机存取存储器和显示寄存器

8279内部缓存显示器同样具有16x8的缓存形式自动显示随机存取的数据存储器，通过自动显示一个寄存器和两个四位端口0uta0-3，0utbo-3来自动显示刷新外部存储器的数据显示，显示器同样可以是使用的大都是8段数码管或者是白炽灯，也可以有外部显示器同样可以是使用的大都是8段管或数码管，显示随机存取的数据存储器也同样可以是使用的大都是16x8的形式显示缓存形式，也就是可以直接构成两个16x4的随机存取数据存储器的形式，显示随机存取的存储器字节可由中央处理单元存储器进行数据的读写，被处理单元读写的随机存取的存储器字节的读写地址由随机显示读写地址的寄存器进行指示.数据显示[地址寄存器保存当前中央处理单元存储器的读或写随机取出的存储器字节读写地址，以及正在随机显示着的那两个4位半字节的存储器地址，读写的地址由当前中央处理单元的命令[存储器编程]，也就是可以设置为每次处理单元读写后存储器地址自动加1的一种工作更新方式，在处理单元设置了正确的存储器工作更新方式后，显示随机存取存储器的数据也可由中央处理单元存储器读出，半字节存储器a和半字节b的存储器地址自动由8279更新，以适应由中央处理单元存储器送入的随机存取数据，a和b半字节可独立的送入，也就是可以单独作为一个字节的送入，随中央处理单元所需要设置的工作更新方式而定。

#### I/O 接口功能块

8279通过i/o缓冲器控制与四行中央处理部分控制单元的系统总线网络接口8279，i/o控制部分主要使用cs。a0，rd，wr和四行的中央处理部分控制单元8279之间的单向控制数据是交换的，数据和缓冲器信号是双向控制数据交换的通道，所述控制单元的信号和缓冲器是如下的双向控制数据交换之间的逻辑关系：

CS A0 WR RD 状态

\-----

10--中央处理单元从8279读状态

0101中央处理单元向8279写状态

10--中央处理单元从8279读数据

001-中央处理单元向8279写数据

1 X 数据缓冲区输出处于三种状态

x为任意数(0或1)

\###3.3.38279的操作

如前所述，8279可以完全适应各种手机键盘和电脑显示器的不同功能和工作的方式，由于8279中各个命令功能块的各种工作方式是完全可编程的，用户完全可以根据自己的工作要求，用向8279写命令字的各种编程方法对8279的各种工作方式和功能块进行编程，从上表中我们可以清楚地看出，只要执行命令cs=0同时wr=0=1，然后你们就可以将命令字写到8279，并在命令wr的上升沿将相应的命令程序驱动到8279。

对于中央处理器，8279只有两个端口地址，一个是用于查看和读写处理器的命令和数字的状态(cs=0，a0=1)，一个端口地址用于查看和读写处理器的数据(cs=0，a0=0)，但对于编程语言命令和字代码有很多类型。在8279中给出了区分学校和企业不同的温度命令字的方法主要是对处理器命令和字代码的高3位(d7，d6，d5)和低5位进行了分析和编码，而低5位主要是用于理解命令字的实际含义和教学内容。

#### 8279的编程命令

键盘/显示器方式设置

最高位最低位

--

命令代码000 D D K K K

其中DD为显示方式，KKK为键盘方式

DD的表示：

编码功能

\--

008个8位字符显示-左端传入

01168位字符显示-左输入

1088位字符显示-右输入

1116个8位字符显示-右端送入

所谓左端送

编码功能

\--

000编码扫描键盘-2键连锁

001译码扫描键盘-2键连锁

010编码扫描键盘-N键巡回

011译码扫描键盘-N键巡回

100编码扫描传感器阵列

101译码扫描传感器阵列

110选通输入，编码显示扫描

111选通输入，译码显示扫描

钥匙链和2，其中N是一个关键电路8279双键盘键被按下两次处理，编码和在两个扫描链轮和显示器被解码形成扫描扫描SL0-SL3。

程序时钟

命令代码001 P P P P P

此命令用于确定定时和分频控制中每个预标量的分频控制系数。命令代码ppppp功率系数可以直接形成一个数字2-31。预标准测量也可以在外部没有所述时钟预定频率的情况下来进行，所述基频，得到内部，如果100khz的选择的基本时钟预定频率，能够外部时钟获得与所述时钟频率预定的恢复时间扫描，分频相关的因子;在预定的复位时钟脉冲后100khz如果没有外部时钟被自动馈送到码31自动。

读FIF0/传感器随机存取存储器

命令代码：010 AI X A X =任意

该读取命令主要用于确定中央处理器选择需要读取后续操作的存储器对象分别是8279中的哪一个fif0/来自传感器随机存取的存储器，并且主要用于传感器确定8个随机存取的存储器字节阵列中的哪一个被传感器读取，其中第一个aaa表示中央处理器选择了需要后续读取的行，ai自动为该行添加1个相同的特征位，并且这两者在传统的键盘扫描模式下的数据是不存在直接相关的，对于每次传感器后续的读取8279，数据存储器会按照与传感器数据首次读取时输入的fif0相同的后续读取顺序自动将数据发送出去。从传感器的fifo开始读取所有数据进行后续的读取，直到传感器写入新的命令。在来自传感器随机存取阵列的实施例中，aaa传感器选择了一线来自传感器8个的随机存取的存储器行如果ai=1，来自传感器的下一次后续读取将被读的随机存取数据送到存储器的下一行。

读显示器随机存取存储器

命令代码：011 AI A A A A

中央处理控制单元对8279写此读取命令，则我们确定了一个中央处理控制单元以一个显示器随机存取的一个存储器位作为数据源缓存地址位来进行随机读取的操作，其中的aaaaa为一个显示器随机存取一个存储器的一个数据源缓存地址，ai的行为自动依次加1特征位，若其中ai=1，则每一次读取第一行随机存取的一个存储器之后[第一行行为显示器的数据地址]自动依次加1。

写显示器随机存取存储器

命令代码：100 AI A A A A

中央处理单元将此命令写入8279，它规定下一步将写入8279的显示随机存取存储器。寻址模式和自动加1功能与读显示随机存取存储器相同。

显示器写入禁止/空格

命令代码：101 X IW IW BL BL X=任意

A B A B

此显示命令主要用于同时屏蔽a或b两个显示端口的输出并重新显示其显示的区域。如果将其中两个显示端口用作两行4位的显示，则必须同时屏蔽4位之一，以使对方发送的信息不会直接影响另一半。iw是该端口被屏蔽的功能位。如果为显示端口设置了显示命令iw=1，则该显示端口被此命令所屏蔽。空格显示请特别注意，b0对应于c0和d0，而d0和bl是应于iwensei，则此显示端口将重新显示空格。如果要以单个8位的输出命令格式为该端口创建重新显示的区域，则必须为端口设置两个d0和bl的标志以使该端口的显示完全保持空白。

消除

命令代码：110 CD CD CD CF CA

此数据清除格式命令主要就是用于按一定的数据格式顺序进行数据清除，它显示随机存取器的数据格式存储器的两个fif0状态，其中a和cd分别用于指定一个需要进行清除的数据格式：

CD CD CD

0 X 全"0"(x为任意)

10 AB =16进制

1020(0 O 100000)

11全册"1"

当显示为"1"(或 CA =1)时，允许清除显示

cf显示器清除cd和fifo的状态(其中包括广告和中断)。如果显示cf=1，则显示器清除cd和fif0状态，并重置中断线。传感器直接随机访问存储器的显示也始终被设置为第0行。ca始终被显示器清除，并且其显示效果与cd对应，当显示ca=1时，cf可以进行合成，使用显示器的cd和fif0指定的随机清除存储器格式进行清除。此时显示器的随机访问存储器的状态已经被清除。cd插孔还可以重新设置同步内部的时序。显示期间将自动清除随机存取访问存储器(约16us)。无法被重写。同时，在此期间，fifo的最高有效位设置为"1"。当显示广告的随机存取访问存储器再次恢复可用时，它将自动进行重置。

中断结束/出错方式设置

命令代码：111 E X X X X X=任意

当一个阵列传感器，该命令使IRQ线变低，并且允许写入随机存取存储器(通过位置传感器的变化来检测，IRQ线可具有增加的，这样做防止了信息写入再次随机存取存储器之前其复位)。在 N 键电路模式下，如果 E 位被编程为"1"，芯片电路将以特殊的错误模式运行。

主要用于检查 N 键巡视模式特殊错误模式下的多次按键。如果在一个反弹周期内按下两个键，则可以视为同时多次按下，并建立一个错误标志以防止进一步写入 FIF0，并设置中断(如中断设置)。错误进行标志设计可以被 FIFO 状态字命令读取，CF =1的清除命令我们可以通过重置错误信息标志。

1. 锯齿波由两个单晶二极管bt和r1、r2、r3、w1和c1组成的单晶管张驰振荡器锯齿波产生，然后通过单晶管发射极跟随张驰振荡器将锯齿波输出。

2. 控制电势差(Uk)和锯齿波电势差与电子流的强度叠加，送至 v2基极。综合电势差是我们。当 Us>0(0.7)时，V2打开，Us <0，则 V2结束。

3. V2，V3和R8，R9，DW1流开关已经被组成，当基极电位差V2 Ube2>0(0.7)，V2被接通时，接近零电势差Ube3，V3被关闭，直流开关是打开。

4. 过零脉冲的控制输出由削波同步电源变压器晶闸管tb、整流桥变压器d1、r10和直流开关r11组成的削波整流桥同步变压器电源，它与直流开关的两个输出电势差一起分别用来控制v4和发射器的v5。只有当发射器的dc直流开关发射器打开时，v4才使发射器关闭，并且由于v4和发射器的v5基极电极与两个发射器之间存在一个工作电势差，因此它使发射器可以在此期间正常工作。当每次发射器的同步电势差过零时，v4关断，其集电极和输出存在一个正电势差，这就可以使得v5从发射器的截止开关开始接通，通过这个脉冲使同步变压器的输出触发一个过零脉冲，并且这个触发脉冲可以使变压器晶闸管t在需要发射器导通的时候导通。

直流开关导通时，连续正弦波控制电势差uk的大小决定了直流开关的导通持续时间的长短，这也直接决定了在电阻炉设定的直流开关周期内可以传导的直流开关周期和次数，因此，可以合理地调整直流开关输出的功率。显然，控制电势差uk越大，它可以传导的直流开关周期和次数越多，输出的功率越大，电阻炉的直流开关温度越高。相反，电阻炉的直流开关温度越低。

自动电炉闭环系统温度自动调节的基本设计思想是在热电炉系统中自动添加温度传感器和相应的温度自动控制器。温度传感器的温度调节基本功能主要是通过检测自动热电炉的实际工作温度，将其信号转换为电势差的控制信号，并且我们比较了电炉相应温度控制装置uk的电势差。这种差异的变化大小(e=uk-uft)和电势差变化的方向(即e是正还是负)由温度控制器沿晶闸管相反的输入控制方向自动设置，以便温度控制器的输出信号控制导晶闸管接通的方向和长度。直流晶闸管开关的输入控制接通的时间，使得在一定温度和时间内的设置，晶闸管的输入控制接通电流频率有所增加或流量减少，而使得电炉的相应直流温度控制装置有所频率增加或流量减少。利用这种电势差控制温度的方法，可以在很小的电势差范围内自动改变炉温，并且控制精度高。

方案二：为了更好地可以有效简化控制电路，采用先进的单片机恒温控制技术可以作为一个恒温控制系统和企业的核心单片机来进行设计本文的课题。温度传感器ds18b20用于对温度传感信号的采集。方案二控温的基本设计思想主要是：通过传感器采集的电阻丝温度与单片机标准传感器温度的差值，控制恒温发热系统中电阻丝的数量和持续时间，从而最终达到对恒温发热系统控制的主要目的。控温方案二的单片机设计电路框图结构如下图所示：

![2.2方案二设计框图](http：//my gunplan.top/static/003.jpg)

本解决方案以先进的单片机为温度控制的核心，利用温度传感器自动采集计算机温度，通过传感器采集的计算机温度与单片机标准传感器设定计算机温度之差的距离来测量和控制温度，使得温度始终保持在单片机标准传感器设定的温度。该解决方案设计制作成本低，可靠性高，非常适用于计算机系统的动态控制性能和系统稳定性对温度要求不是很高的应用场合。

## 3.4传感器接口电路设计

### 3.4.1温度数据采集电路

ds18b20是基于dallassemiconductorcorporation的一个网络数字温度传感器。与其他的温度传感器连接方式相比，ds18b20具有以下的功能：当网络连接到如上所述微处理器的唯一单线路的接口模式中，只有一个端口可以被用于直接实现一个微处理器和ds18b20之间的双向通信的线路。

ds18b20支持独立的多点温度网络。几个节点ds18b20可以仅在三条线上通过并联进行连接，以方便地实现基于互联网的多点温度的测量。ds18b20不一定需要外围的组件。所有的传感器集成元件和温度信号转换集成电路都可以像普通的晶体管一样直接集成在单个温度集成电路中。传感器的温度测量范围一般为55〜125°c，温度集成电路测量的固有温度和分辨率范围为0.5°c。温度测量的结果直接传感器输出一个9位数字的温度测量信号，并直接通过"初始化总线"接口串行发送到传感器的中央控制单元。同时，可以直接发送crcr的温度校验码，具有较强的温度抗干扰和自动纠错的功能。温度测量的结果以9位数字的模式串行传输。

尽管ds18b20具有简单的嵌入式温度自动测量和控制系统，较高的分辨率和温度测量的精度，方便的网络连接以及较少的线路和资源占用等诸多优点，但在实际的应用中还是应该充分考虑以下的几个方面：

1. 尽管操作系统的硬件很简单，但我们还是需要相对复杂的软件处理器来对其进行温度补偿。由于ds18b20与其他微处理器之间的读写串行编程需要数据同时传输，因此必须注意保证在读写串行编程期间的连续读写编程时间，否则将是无法对读取进行温度补偿测量的结果。

2. ds18b20的可靠性相关数据未提及任何连接到单个总线的微处理器ds18b20的数量。这很容易就会导致一个错误的假设，即微处理器可以在总线上连接任意数量的总线ds18b20，而在实际的应用中并非如此。如果一条单个总线上微处理器连接了8个以上的总线ds18b20，则几乎没有必要考虑解决单个总线微处理器的可靠性和总线驱动问题以及我们在设计多点温度控制和测量传感器系统时所需要注意和考虑的一些问题。

3. 连接长度的限制是指采用连接长度为ads18b20的信号总线的电缆。由于它具有信号电缆的稳定性和电子电缆的阻挡比较大等特性，如果距离太大，信号传输幅度也会有所降低。如果在测试中普通信号电缆的双绞线传输电缆的长度明显地超过50m，则表示温度降低或读取数据不正确。如果将普通信号总线的电缆改为带屏蔽普通信号电缆的数据传输双绞线，则正常的总线通信数据传输距离应该可以轻松地达到150m。

ds18b20提供两种不同类型的器件封装：pr-35和pdsoic。引脚的顺序排列如下下表3.1所示。该软件封装操作系统中实际上已经使用了基于pr-35软件包的封装工具包。尽管如此，dds18b20仅用于提供一个返回9位温度数字的一个温度测量值，如如下图3.1.2所示。

管脚管脚定义说明

：-：：-：：-：

8脚SOIC 3脚PR-35

21 GND地

12 I/O 数据输入

83 VCC电源

34567 NC空脚

表3-1 DS18B20管脚排列

图3.1.2ds18b20温度值的表示计算方法

d9为低字节的符号位，0为正，1为负，高字节(d10~d15)的其他位用二进制符号位的补码或扩展位形式进行了表示;d0~d8为数据位，以二进制数据位的补码或扩展形式进行表示。如下表3.2显示了数值与温度之间的非线性关系。

温度测量数据(二位位十六进制)数据(十六进制)

：-：：-：：-：

+125000000001111101000FAH

+2500000000001100100032H

+0.500000000000000010001H

000000000000000000000H

+0.51111111111111111 FFFFH

-251111111111001110 FFCEH

-551111111110010010 FF92

表3.2 DS18B20值与温度的关系

由于房间的环境温度不能为负，因此系统不会考虑负温度。这样，您在选择硬件时就可以使用市售组件，而不必使用工业组件，从而可以大大降低成本。读取温度信息后，微控制器仅需要将低字节(D0〜D8)发送到主机和控制电路。

### 3.4.2发光二极管显示接口电气设计

选择的系统控制方式是四路开关室温动态实时传感器显示，显示精度0.1℃。具体的电路原理图所示如图3.2：

![3-2硬件电路图](http：//my.gunplan.top/static/3.2.png)

### 3.4.3发光二极管数码管

发光二极管显示器即为新型发光二极管显示器，具有数据显示醒目、成本低、配置灵活、接口可以方便等特点，单片机电源管理控制系统在应用数据管理操作系统的设计中常用它来直接显示电源管理操作系统的日常工作生活的状态和过程中所采集的数据在信息网络中所输入的数值等。

根据大屏幕发光点阵二极管的排列和结构不同，可将大屏幕发光点阵二极管显示器划分为大屏幕发光二极管点阵数码管和大屏幕发光二极管点阵数码显示器。大屏幕发光二极管点阵数码管主要就是用于在屏幕上显示英文数字和一些英文字母和图形符号，发光二极管点阵显示器同样可以在屏幕上显示英文数字、字母、男人和图形等。大屏幕发光点阵二极管数字点阵显示虽然点阵显示灵活，但它们主要占用的是单片微型计算机系统的软硬件资源比大屏幕发光二极管点阵数码管显示器要多得多。除了使用指定的程序，大屏幕发光点阵数码管显示器或led点阵显示器主要用于请求特殊的点阵显示场合，几乎所有的微型计算机系统应用点阵显示系统都使用大屏幕发光二极管数字点阵显示。

数字管理的显示系统主要有两种显示模式，包括静态数据管理显示程序模式和动态显示程序模式。静态数据管理显示的程序非常不复杂，静态数据管理显示系统的程序模式设计起来非常简单，占用cpu的内存时间很少。仅需要当系统的显示字符串发生更改时才可以调用动态显示程序。但是，硬件和集成电路很多。每个八位数字晶体管都至少必须需要一个8位i/o电源输出输入端口，一个8位限流电源输出驱动器和8个8位限流输出电阻。通常偶尔也可能会需要使用少量的圆形数码管。发光二极管的应用由于静态扫描显示器需要使用较少的电子管组件，并且需要使用更多的静态数字组件与电子管组件在显示器之间进行切换很麻烦。为了有效简化了电路并且大大降低了成本，系统设计使用了一种动态扫描数字显示的方法。

动态扫描显示模式的工作原理是分别打开每个显示器，即一次仅显示一位。为了使用户看到所有的显示器都已显示，必须加快每个显示器的照明周期(增加扫描频率)。通过使用人眼的视觉残留效果，可以实现与连续显示所有显示器相同的效果。动态扫描显示电路如图3.2.2所示：

![图3.2.2动态扫描图](http：//my.gunplan.top/static/003.jpg)

## 3.5 温度控制电路的设计

![图3.2.2温度控制电路](http://my.gunplan.top/static/3.3.png)

通过正确设置开关元件脉冲的宽度来我们可以控制三端双向的可控硅开关元件的开启和脉冲关闭。当伴随着脉冲宽度的增加(脉冲占空比增加)时，三端双向的可控硅开关元件的脉冲导通加热时间和温度延长，电阻丝的开关元件加热的时间也延长，温度也升高。相反，如果我们减小了脉冲的宽度(相当于减小脉冲占空比)，则双向可控硅的脉冲导通加热时间和温度缩短，电阻丝的开关元件加热时间和温度缩短，从而大大降低了元件的温度。

以此方法来控制温度的恒定不变。

## 3.6 脉宽调制

### 3.6.1 脉宽调制的介绍

pwm是高电平脉冲方波宽度调制的一个英文缩写。高比的方波的第一个时间段被简单地称为高电平的占空比，例如，一秒钟高电平和的50%1第二个是占空比的pwm波的脉冲宽度调制(pwm)的定义低电平在各种开关电源中被广泛使用的一个术语。。这个词是根据开关稳压的控制工作方式进行定义和分类的。除pwm混合型外，还有开关调制pfm型和脉宽调制pwm和一种pfm混合型。波的脉宽调制(pwm)的定义开关稳压电路的定义是在设计和控制开关稳压系统的电路设计中在输出的频率可以与低电平保持一个不变的频率情况下，通过电势差的反馈电路来控制和调节其输出的占空比，从而使使用者能够更好地达到维护社会稳定和发展控制输出电势差的主要目的。

脉冲信号宽度的调制(pwm)技术是一种非常有效的可以利用微处理器的模拟数字脉冲信号输出来实现控制和模拟集成电路的一种技术，它被广泛的应用于从电力测量，控制和无线通信系统到电力的智能转换许多应用领域。

### 3.6.2 基本原理

随着我国电子信息技术的发展，出现了多种 PWM 技术，包括：相电势差控制 PWM 、脉冲信号宽度 PWM 方法、随机 PWM 、 SPWM 方法、线电势差控制 PWM 等，然而，镍氢动力电池使用智能手机充电器设计采用的脉冲时间宽度 PWM 方法，以等脉宽的脉冲串作为 PWM 波形，通过不断改变一个脉冲串的周期可进行分析调制，可以同时通过这些改变传统脉冲的宽度或占空比来调节电势差，并且我们可以选择通过研究采用学生适当的控制管理方法来实现协调地改变电势差和频率。

模拟信号的时间值和分辨率可以通过不断的发展变化，对其时间和变化幅度的时间值和分辨率没有必要进行严格的限制。9v模拟信号电池同时也是一种智能模拟设备，因为它的输出电势差不完全一定等于9v，而是随着一定时间而变化，并且同时也可以取任何真实值。类似的地，从模拟信号电池内部吸收的电子流的数量和强度不可能局限于任何一组模拟信号可能的真实值范围。智能模拟信号和传统数字信号的最大区别主要在于后者的真实值范围只能在数字信号预定的任何一组可能的值内，例如，在{0v的电子集合中，5v}。

模拟电势差和收音机电子流的强度控制可直接地应用于扬声器的控制，例如模拟控制汽车和收音机的音量。在简单的控制模拟电势差和收音机中，音量旋钮通过连接扬声器得到可变电阻。当扬声器拧动音量旋钮时，电阻值随之变大或相应地变小;流过这个强度和电阻的电子流的强度也随之增大或相应地减小，从而通过改变扬声器驱动收音机和扬声器的电子流的强度和电阻值，使得音量旋钮相应地随之变大或相应变小。与其他无线电一样，模拟扬声器电路的音量输出与扬声器输入成一个线性的比例。

在简单的需要模拟一个立体声的收音机中，音量控制系统的旋钮与收音机连接时会用到一些可变电阻。其中之一的问题是由于模拟电路倾向于随时间进行漂移，因此难以进行调整。只有可以帮助解决这个复杂问题的精密模拟电路体积可以非常大，体积庞大(尤其是比如老式的家用立体声音量控制设备)和昂贵。精密模拟电路还可能产生严重的热量，其产生的功耗与电路中的工作元件两端的电势差与工作元件电子流的扰动强度的乘积大小成正比。精密模拟电路也肯定可能对于噪声敏感，任何的扰动或者产生的噪声都肯定可能会直接改变工作元件电子流的强度值。

通过对模拟控制电路进行数字控制，可以大量减少控制系统的设计成本和系统功耗的降低。此外，许多的微控制器和dsp已经在日本和中国的芯片上包含了dspwm控制器，这样就使得通过数字进行控制的设备实现自己的功能变得完全可以更加的具有容易。

脉冲宽度调制信号的设计思想

该对象的脉宽调制信号为方波，设定周期为1 s。它的产生将时间计数器设置为10 ms时序，然后通过寄存器R3控制脉冲宽度调制信号的周期。此主题仅具有模拟效果，并且对准确性没有过多要求，因此将1s周期划分为100。在相等的部分中，计时器设置为10 ms，计时器在R3中启动的频率为100。

寄存器r2中需要存储的数据是根据脉冲检测控制电路和数据控制电路进行转换的数字。r2中存储的数据值是用于分别控制一个脉冲系统的信号和1s内一个高电平的脉冲时间的长度。这样我们也就可以从寄存器的p2.6口检测得到用于定义一个周期可调和进行高电平的脉冲时间可调的寄存器来控制脉冲系统的信号。

### 3.6.4 脉宽调制信号的作用

脉冲宽度调制信号从P3.0端口输出。从P3.0端口输出的方波信号连接到三端双向可控硅开关的控制连接，以控制TRIAC的接通和关断。如果方波在一段时间内以高电平出现，则双向可控硅的占空比变长，即加热元件散发的热量更多。简而言之，加热元件释放的能级由方波在一个周期内变高的时间确定。

### 3.6.5 脉冲宽度调制优点

pwm的最大好处的其中之一个特点就是从信号处理器到受控系统的数字信号都是保持数字形式的，没有对数模信号进行的变换。这样保持了数字形式的数模信号最大限度地减少了噪声的产生和影响。数字噪声的大量产生主要是因为只有在其强度足以准确地阐述信号上升沿或信号下降沿跳变的强度时候，数字信号的稳定性才可能会被受到影响。

除了使用指定的程序，大屏幕可以使用点阵数字显示器或led数字显示器。为了请求特殊的显示场合，几乎所有的微型数字计算机或者应用显示系统都使用发光二极管进行数字显示。这些模拟信号可以转换到pwm信号可是它们可以大幅度地增加传输信号距离的范围和长度。在高频接收端，可以直接滤除经过调制的高频方波，并通过适当的rc或lc模拟网络将传输信号的频率恢复到最为模拟的形式。

总之，pwm不仅省钱、占地面积被大量使用节约、抗震和降低噪声的使用性能强，而且同时也成为是一种非常值得许多专业建筑工程师在许多不同类型的建筑设计和工业应用中广泛研究使用的有效解决技术。

 # 第4章 系统软件设计

在微机测控系统中，软件与硬件同样重要。硬件是系统的躯体，软件则是灵魂，当系统的硬件电路设计好之后，系统的主要功能还是要靠软件来实现，而且软件的设计在很大程度上决定了测控系统的性能。为了满足系统的要求，编制软件时一般要符合以下基本要求：  

1. 易理解性、易维护性。通常是指软件系统容易阅读和理解，容易发现和纠正错误，容易修改和补充。由于生产过程自动化程度的不断提高，测控系统的结构日趋复杂，设计人员很难在短时间内就对整个系统理解无误，软件的设计与调试不可能一次完成，有些问题是在运行中逐步暴露出来，这就要求编制的软件容易理解和修改。在软件的设计方法中，结构化设计是最好的一种设计方法，这种设计方法是由整体到局部，然后再由局部到细节，先考虑整个系统所要实现的功能，确定整体目标，然后把这个目标分成一个个的任务。任务中可以分成若干个子任务，送样逐层细分，逐个实现。本仪表就是采用这种模块化的设计方法。这样不但使得设计目标明确、思路清晰，而且在检错、调试时也很方便。当出现问题时，可以根据问题的种类和现象来判断是哪一部分出的问题，很容易找出故障所在和故障原因。同时，采用模块化程序结构设计方案，对于系统功能的扩充和修改也提供了很大的方便。
2. 实时性是电子测量系统的普遍要求，即要求系统及时响应外部事件的发生，并及时给出处理结果。近年来，由于硬件的集成度与运算速度的提高，配合相应的软件，实时性比较容易满足设计要求；
3. 准确性对整个系统具有重要意义，尤其是测量系统，系统要进行一定量的运算，算法的正确性和准确性对结果有着直接的影响，因此在算法的选择、计算的精度等方面都要符合设计的要求；
4. 可靠性是系统软件最重要的指标之一，作为能够稳定运行的系统，抗干扰技术的应用是必不可少的，最起码的要求是在软件受到干扰出现异常时，系统还能恢复正常工作。结合上述编制系统软件的基本要求，首先讨论软件的设计思想。

在微机测控系统中，软件的重要性与硬件设置同样重要。硬件是躯体，软件是灵魂，当系统的硬件电路确定之后，系统的主要功能还要靠软件来实现。如果说硬件决定了产品的造价，那么在硬件搭配合理的前提下软件在很大程度上就决定了产品的性能。

## 4.1 软件设计思想

为了满足系统的要求，编制软件时必须符合以下基本要求: 

易理解性、易维护性。通常是指软件系统容易阅读和理解，容易发现和纠正错误，容易修改和补充。由于生产过程自动化程度的不断提高，测控系统的结构日趋复杂，设计人员很难在短时间内就对整个系统理解无误，软件的设计与调试不可能。

一次完成，有些问题是在运行中逐步暴露出来，这就要求编制的软件容易理解和修改。在软件的设计方法中，结构化设计是最好的一种设计方法，这种设计方法是由整体到局部，然后再由局部到细节，先考虑整个系统所要实现的功能，确定整体目标，然后把这个目标分成一个个的任务。任务中可以分成若干个子任务，送样逐层细分，逐个实现。本仪表就是采用这种模块化的设计方法。这样不但使得设计目标明确、思路清晰，而且在检错、调试时也很方便。当出现问题时，可以根据问题的种类和现象来判断是哪一部分出的问题，很容易找出故障所在和故障原因。同时，采用模块化程序结构设计方案，对于系统功能的扩充和修改也提供了很大的方便。

实时性。实时性是本系统的基本要求。即要求系统及时响应外部事件的发生，并及时给出处理结果。近年来，由于硬件的集成度与速度的提高，配合相应的软件，实时性容易满足要求，特别是对于汇编语言编制的软件。  

1. 可测试性。系统软件的可测试性具有两方面的含义:其一是指比较容易地制定出测试准则，并根据这些准则对软件进行测定；其二是软件设计完成后，首先在模拟环境下运行，经过静态分析和动态仿真运行，证明准确无误后才可投入实际运行。  
2. 准确性。准确性对整个系统具有重要意义。系统要进行大量运算，算法的正确性和准确性问题对控制结果有直接影响，因此在算法选择、位数选择方面要适合要求。
3. 可靠性。可靠性是系统软件最重要的指标之一，它要求两方面的意义:第一是运行参数环境发生变化时，软件都能可靠运行并给出正确结果，也就是要求软件具有自适应性:第二是在环境恶劣干扰严重情况下，软件必须保证也能可靠运行，这对整个系统尤为重要。



## 4.2 软件组成

由于整个系统软件相对比较庞大，为了便于编写、调试、修改和增删，系统软件的编制采用了模块化的设计。即整个控制软件由许多独立的小模块组成，它们之间通过软件接口连接，遵循模块内部数据关系紧凑，模块之间数据关系松散的原则，按功能形成模块化结构。

系统的软件主要由主程序模块、数据采集模块、数据处理模块、控制算法模块等组成。主模块的功能是为其余几个模块构建整体框架及初始化工作；数据采集模块的作用是将A／D转换的数字量采集并储存到存储器中；数据处理模块是将采集到的数据进行一系列的处理，其中最重要的是数字滤波程序：控制算法模块完成控制系统的PID运算并且输出控制量。

下面就介绍本系统几个主要的程序模块。

## 4.3 程序结构分析

**主程序调用了4个子程序，分别是温度传感器读取程序，数码管显示程序、键盘扫描及按键处理程序、温度信号处理程序。**

* 键盘扫描电路及按键处理程序：实现键盘的输入按键的识别及进入相应的程序。
* 温度信号处理程序：对温度芯片送过来的数据进行处理，进行判断和显示。
* 数码管显示程序：向数码的显示送数，控制系统的显示部分。




## 4.4 数据处理模块

数据处理模块负责处理A／D转换后的数字量。其中最重要的环节是数字滤波，所以这里主要讨论系统采用的数字滤波程序。

###  4.4.1 数字滤波

模拟信号都必须经过A／D转换后才能为单片机接受，如果模拟信号受到扰动影响，将使A／D转换结果偏离真实值。因此仅仅对模拟量采样一次，我们是无法确定该结果是否可信的，必须经过多次采样，得到一个A／D转换的数据序列，通过某种处理后，才能得到一个可信度较高的结果。这种从数据序列中提取逼近真值数据的软件算法，通常称为数字滤波算法。

数字滤波克服了模拟滤波器的不足，它与模拟滤波器相比具有以下几个方面的优点:  

1. 由于数字滤波是用程序实现的，因而不需要增加硬件设备，而且可以多个输入通道共用一个滤波程序
2. 由于数字滤波不需要硬件设备，因而可靠性高、稳定性好，各回路之间不存在阻抗匹配等问题
3. 数字滤波可以对频率很低(如O．01HZ)的信号实现滤波，克服了模拟滤波器的缺陷，而且通过改

变数字滤波程序，可以实现不同的滤波方法或改变滤波参数，这比改变模拟滤波器的硬件要更灵活方便。

常用的数字滤波方法有程序判断滤波法、中值滤波法、算术平均滤波法、一阶滞后滤波法、去极值平均滤波法等等，下面简要介绍这几种数字滤波方法。

1. 程序判断滤波法首先要从经验出发，定出一个目标参数最大可能的变化范围。每次采样后都和上次的有效采样值进行比较，如果变化幅度不超过经验值，本次采样有效，否则，本次采样值应视为干扰而放弃，以上次采样值为准。该算法适用于变化缓慢的物理参数的采样过程，如湿度、液位等。
2. 中值滤波法对目标参数连续进行若干次采样，然后将这些采样进行排序，选取中间位置的采样值为有效值。对于变化较为剧烈的参数，此滤波方法不宜采用。
3. 算术平均滤波法是对目标参数进行连续采样，然后求其算术平均值作为有效采样值。该算法适用于抑制随机干扰。采样次数越大，平滑效果越好，但系统的灵敏度要下降。算术平均滤波不能将明显的脉冲干扰消除，只是将其影响削弱。

## 4.5 子程序设计

设计总体程序框图如下，总体程序由主程序，按键子程序，温度获取子程序三部分组成。  
读出温度子程序的主要功能包括初始化,判断DS18B20是否存在,若存在则进行一系列的读操,作若不存在则返回。

### 4.5.1 读出温度子程序

![图4-6 程序结构图](http://my.gunplan.top/static/4.2.1.PNG)

### 4.5.2 LED数码显示管程序

![图4-6 发光二级 数码显示管程序](http://my.gunplan.top/static/4.2.2.PNG)

### 4.5.3 键盘扫描及按键处理子程序

![图4-7  键盘扫描及按键处理子程序](http://my.gunplan.top/static/4.2.3.PNG)


## 4.6 显示处理

显示处理模块主要完成人机交互作用，具体实现将采样温度值、设定温度值以字符的形式通过液晶显示出来。本系统使用HTl621作为显示驱动器。HTl621是128点内存映象和多功能驱动器。附录中给出了显示处理模块的源程序。

# 第5章 系统软件调试

## 5.1 目测

1. 有无短路处。
2. 对照电路图看有无接错、漏接处。
3. 有无虚焊处。
4. 元件是否都对

## 5.2 硬件调试

首先应进行上电前的准备。为了防止硬件的损坏，应在电路板上电前进行电路检查，包括：对芯片的焊接方向进行检查，对芯片的引脚进行短路和断路检查。

在经过检查确认芯片的焊接没有任何问题的情况下，进行上电检查，在电源打开后，先判断电路是否存在异常，如出现芯片过热等现象，应及时切断电源，检查电路故障。在上电无异常状况的前提下，可以用万用表和示波器进行测量。首先测量电源芯片的输出电压是否正常，然后用示波器分别测量各个主要芯片电源引脚，察看电源的波形情况，如有纹波，则在预先留出的位置上焊上退耦电容以消除纹波，保证芯片工作正常。电源测量完毕后，进一步用示波器测量有源晶振的输出脚，其输出是频率为8MHz的波形(非方波，类似正弦波)。在确定晶振起振后，按住复位键，使单片机始终保持在复位状态，同时测量其各个引脚的电平情况，并同数据手册上表述的复位时的芯片引脚状态进行比对，由此可判断单片机是否正常。确认单片机正常之后就可以通过仿真器连接用户板进行调试。

## 5.3 软件的调试

由于软件的编写都是根据各个模块进行的，我们在进行软件的系统模拟调试时应，先确认硬件的接口标记是否在软件程序中一一对应，而且要检测所编写的软件有没有知识性的错误。在觉得基本没有问题后我们通过电脑将程序编译进入系统核心AT89S52单片机，检验软件与硬件各部分是否协调的工作。出现问题时我们要耐心的检查程序并作出适当的修改，直到软件系统的完全契合硬件电路，那我们软件就调试成功了。

1. 测试环境
   环境温度28摄氏度，室内面积20平方米
   测试仪器：数字万用表，温度计0----100摄氏度

2. 测试方法
   使系统运行，采用温度计同时测量室内度变化情况，得出系统测量的温度。

3. 测试结果
   设定温度由0摄氏度到40摄氏度
   标定温差<=1摄氏度   调节时间  15s（具体视现场情况）
   静态误差<=0.5摄氏度   最大超调量1摄氏度

4. 通过测试分析，对于实际室内的温度控制，可以再提出以下 2 点方法 :
   Ⅰ增加传感器个数，对各个温度传感器采集的数据进行求算术平均，可得到较为准确的温度值。
   Ⅱ对实际室内的温度控制，可采用功率较大的电炉，并且通过风扇对箱内温度进行充分搅和降温设备可采用空气压缩机等制冷设备。 

5. 通过实验测试和分析，发现虽然传感器的温度采集精度最高可得到 0.06 ℃，但测试得到的数据最小间隔为 0.03 ℃ 。通过分析，当对浮点数求平均处理时，遇到同一时刻两个传感头采集的温度相差不大，使 0.06 ℃ 时求出平均温度变为 0.03 ℃ 为了解该数据是否真实，可采用一个高精度的数字温度计测试，发现读出的值与其基本一致，由此推断如果在同一时间增加采集温度的个数，则可以进一步提高温度的精度。 

    

## 5.4 注意事项

1. 测驱动电路的过程中发现数码管不能正常显示的情况，经检验发现主要是由于接触不良的问题。其中包括线的接触不良和芯片的接触不良，在实验过程中，数码管有几段时隐时现。用万用表检测发现有线接触不良，重焊后就可正常显示。而芯片接触不良用万用表欧姆档检测有几个引脚本该相通的地方却未通，其解决方法为把芯片拔出正对万能板孔均匀用力插入。
2. 由于焊接时的大意损坏了元件，在调试是我们怎么都找不到问题的所在，我们是用排除法一个一个元件的测试的找出损坏的元件，重新换上新的元件，故障得以解决。
3. 还有关于程序调试过程中出现的问题。执行程序是发现程序执行不稳定，排除软件的错误外，经老师的指导才发现单片机的EA管脚没有接地。因为次程序只用到片内程序存储器，所以在程序执行时一定要把管脚接的，这样程序才能只执行片内的，不然程序会乱跳，从而导致程序执行不稳定。
4. 接三极管的过程中，发现电路不管程序是什么，数码管都是显示8字，经查除发现原来是三极管的极端弄错了，从新调整极端顺序。
5. 在电路调试时由于我们选用的是对射型的光电传感器由于没正对好使的调试一度中断，最后我们通过反复的调试解决了问题
6. 调试时由于线路的繁杂，没有仔细的找到对应部分的线路，使的调试的结果与预期出现很大的误差，我们通过梳理线路后就调试成功了并达到了预期的效果。
7. 在调试时几个模块的电路调试都不是很好，我们就要对线路的硬件连接做仔细的检查，调试的时候我们首先要确定连接的电路没有错误，各个元件管脚间没有虚连，那样我们的调试才会更顺利。# 结束语

这个最后的项目设计对我很有帮助的。这种设计使我对在大学学习的知识有了全面的了解和深入的思考，并让我对所学的知识以及思考和编写最终设计综合游戏的能力有所了解和提升。最后，我完成了这项任务。撰写论文的过程也是学习专业知识的过程的一个重要的阶段。它使我能够使用现有的专业基础知识来设计，分析和解决理论或实践问题，并将知识转化为实践技能培训。我已经掌握了运用自己的知识来解决实际问题的能力。

通过这个最终设计的结果，我发现只有提高理论水平，才能将教科书的知识和实践结合起来，理论知识可以为教学实践服务，以提高我的实践能力。这个设计非常有意义。我有很多经验。通过这个最后的项目，我们知道了理论与实践之间的距离，将理论与实践相结合的重要性，并且我们已经学到了很多我们无法从书本中学到的知识。

我们的学习不仅应以书籍为基础的限制，而且还应以解决理论和实践中的实际问题为目标和导向，而且还应结合实践去具体分析。理论问题是实践问题，问题解决是课程研究。学生本身就是作为专家来看待。用手解决问题比用大脑解决问题更深刻。学习应要求理论与实践相结合。理论问题也是实际问题。这种方法不仅有助于完成理论知识的巩固，而且将有助于推进实践，解决实际问题，并增强我们服务和解决问题的能力。

总的来说，这个最终的设计使我学到了很多东西。这是大学的最后也是最重要的一课。它对我们的未来产生深远的影响，具有十分重要的意义。





# 参考文献

[1] 李伯成.基于MCS-51单片机的嵌入式系统设计.电子工业出版社.2004  
[2] 宗光华,李大寨.多单片机系统应用技术.国防工业出版社.2003  
[3] 胡学海.单片机原理及应用系统设计. 电子工业出版社.2005  
[4] 孙育才,王荣兴,孙华芳.ATMEL新型AT89S52系列单片机及其应用.清华大学  
   出版社.2005  
[5] 于京,张景璐.51系列单片机C程序设计与应用案例.中国电力出版社.2006  
[6] 蔡杏山.Protel 99 SE 电路设计.人民邮电出版社. 2007  
[7] 杨小川.Protel DXP 设计指导教程. 清华大学出版社.2003  
[8]  李晓荃. 单片机原理与应用[M].  电子工业出版社，2000年8月  
[9]  何立民.  AVR单片机原理与接口技术[M]. 北京航空航天大学出版社，2002  
[10]  杨帮文. 新型继电器实用手册[M]. 北京人民邮电出版社.2004  
[11] 何希才.传感器及其应用电路[M].北京:电子工业出版社,2001.131-135  
[12] 丁镇生.传感器及传感技术应用[M].北京:电子工业出版社,1998.  
[13] 王家桢.传感器与变送器[M].北京:清华大学出版社,1996.  
[14] 曾巧媛.单片机原理及应用[M].北京：电子工业出版社.2002  
[15] 何力民.单片机高级教程[M].北京：北京航空大学出版社.2000  
[16] 金发庆.传感器技术与应用[M].北京：北京机械工业出版社.2000  
[17] Katsuhiko Ogata．Moden Control Engineering．Publishing house of electronics industry，2000：1 96—202.  
[18] Microchip 24C01B/02B 8 位PIC®单片机产品手册[ED/OL].  
[19] Borko H，Bernier C L．Indexing concepts and methods .New York:Academic .
[20] Dallas products data Book[M]，1999.  
[21] Maxim products data Book[M]，2001.  
[22] Shao Jianlong, He Chun. Design of a Portable Popular Multifunctional Development System for 8051 Single-chip Microprocessor Family [J].   Computer Engineering and Applications, 2003.13.
      




# 致 谢

本课题的完成中，我得到了很多人的帮助，在此表示衷心的感谢!

首先感谢我的指导老师高老师，我的课题是在他的指导和帮助下完成的，他深厚的理论功底和严谨的治学态度以及高度的敬业精神使我受益非浅，对我课题的完成起到了至关重要的作用。
经过这次毕业设计，使我觉得不论从理论知识还是从实际操纵中都学到了不少知识，我想归纳起来，主要有以下四个方面：  

* 经过这次毕业设计，它让我接触更多平时没接触的科学仪器设备、元器件以及获得相关的仪器调试经验，同时我也发现自己在这方面很多不足之处。体会到理论知识对实践有很大的知道作用，她让我知道，只有在正确的理论指引下，才能设计出合乎实际需要的硬件电路。
* 学会了高效率的查阅资料、运用工具书、医用网络查找资料。我发现，在我们所使用的书籍上有些知识在实际应用中其实不是十分理想，各种参数都需要自己去调整。偶尔还会遇到错误的资料现象，这就要求我们应更加注重实践环节。
* 在毕业设计中，我们应当注意重点与细节的关系。
* 失败不可怕，只要不趴下，昂首向前走，希望总会有的。
* 同组同学相互包容，彼此合作，取长补短，才能铸就最后的成功。可以说这次毕业设计是对所学知识的一次运用和检阅，同时对自学能力提出很高的要求，所以平时的学习离开思考，就是严重的错误，我们学习不应该有偏科现象，各方面知识都要接触，这样做才能为毕业设计打下基石。  

最后,我要感谢的母校东北石油大学大学,为我提供的良好的学习与发展环境。感谢我的指导教师高新成给予我帮助，感谢母校开放、公正的言论环境,现代、实用的学习环境,舒适、便捷的生活环境让我顺利度过了人生的关键三年。愿所有校园里认识的,不认识的；来过的,走过的……愿你们珍惜握在手里的现在,抓住机遇,拥有一个美好的明天。





# 附录一 程序

程序如下:

```assembly
TM_NUM EQU 23H
TM_L EQU 22H
TM_H EQU 21H
DSPBUF EQU 40H
DQ BIT P2.0
FLAG BIT 00H
ORG 0000H
AJMP MAIN
ORG 000BH
AJMP __INTT0__
ORG 30H
MAIN: MOV SP,#070H
      MOV TMOD,#02H
      MOV IE,#82H
      MOV TH0,#6
      MOV TL0,#6
      MOV R2,#04
      MOV R1,#40H
 LL1: MOV @R1,#00
      INC R1
      DJNZ R2,LL1
      SETB RS0
      MOV R2,#00
      MOV R3,#00
      MOV R4,#00
      MOV R5,#00
      MOV 6FH,#00H
      CLR RS0
      CLR P3.0
      MOV 30H,#02
      MOV 31H,#06
      MOV 32H,#0
      LCALL CHEWEN
__INSTANCE__:CLR TR0
      SETB P2.1
      JB P2.1,K3
      LCALL KKEY
   K3:CLR 01H
      MOV R2,44H
      CJNE R2,#00,K2
      SJMP K7
   K2:CPL P3.0
      MOV R3,#30
   K1:LCALL TM_DISP
      DJNZ R3,K1
      DJNZ R2,K2
   K7:MOV R2,45H
      CJNE R2,#00,K4
      SJMP K6
   K4:MOV R4,#255
  K44:CPL P3.0
      MOV R3,#30
   K5:LCALL TM_DISP
      DJNZ R3,K5
      DJNZ R4,K44
      DEC R2
      CJNE R2,#00,K4
  K6: CLR P3.0
      LCALL CHEWEN
      SETB TR0
MAIN2:JB 01H, __INSTANCE__
      LCALL TM_DISP
      SJMP MAIN2
CHEWEN:CLR RS1
       CLR RS0
      LCALL GET_TM
      LCALL TM_COV
      LCALL DTOB
      LCALL DTOB1
      CLR C
      MOV A,33H
      SUBB A,44H
      MOV 44H,A
      MOV A,34H
      SUBB A,45H
      MOV 45H,A
      RET

    __INTT0__:PUSH ACC
          PUSH B
          SETB RS0
          INC R2
          CJNE R2,#100,__JT0__
          INC 6FH
    
          MOV A,6FH
          CJNE A,#20,__JT0__
          MOV 6FH,#00H
          INC R3
          MOV R2,#00H
          CJNE R3,#2,__JT0__
          SETB 01H
          MOV R3,#00
    
     __JT0__: CLR RS0
          POP B
          POP ACC
          RETI


KKEY: MOV R2,#00
      MOV R4,#0AH
 KS2: LCALL TM_DISP
      DJNZ R4,KS2
      SETB P2.1
      JB P2.1,KKEY1
      JNB P2.1,$
      MOV 60H,#DSPBUF+1
      MOV R1,#DSPBUF+1
      MOV R2,#00
KEY1: LCALL TM_DISP_2
      MOV P2,#0FFH
      MOV A,P2
      ORL A,#01
      CPL A
      JZ KEY1

KEY2: JNB ACC.1,KEY3
      JNB P2.1,$
      INC R1

      INC R2
      CJNE R2,#03,L13
      MOV R1,#DSPBUF+1
      MOV R2,#00

 L13: MOV 60H,R1
      SJMP KEY1
KEY3: JNB ACC.2,KEY4
      JNB P2.2,$
      MOV A,@R1
      CJNE R1,#41H,L1
      CJNE A,#09,LL
      SJMP KEY5
  L1: CJNE R1,#42H,L2
      MOV A,@R1
      CJNE A,#09,LL
      SJMP KEY5
  L2: CJNE R1,#43H,L3
      CJNE A,#09,LL

KEY5: MOV @R1,#00
  L3: SJMP KEY1
  LL: INC A
      MOV @R1,A
  L6: SJMP KEY1
KEY4: JNB ACC.3,KEY1
      JNB P2.3,$
      MOV 30H,41H
      MOV 31H,42H
      MOV 32H,43H
      ACALL DTOB
KKEY1:RET

     DTOB:SETB RS0
          SETB RS1
          MOV A,31H
          MOV B,#10
          MUL AB
          ADD A,32H
          MOV 33H,A
          MOV 34H,#00
          MOV R6,30H
          CJNE R6,#00,JT2
          SJMP JT22
     JT2: MOV A,33H
          ADD A,#100
          MOV 33H,A
          MOV A,34H
          ADDC A,#00
          MOV 34H,A
          DJNZ R6,JT2
     JT22:CLR RS1
          CLR RS0
          RET

  DTOB1:  SETB RS0
          SETB RS1
          MOV A,42H
          MOV B,#10
          MUL AB
          ADD A,43H
          MOV 44H,A
          MOV 45H,#00
          MOV R6,41H
          CJNE R6,#00,JJT2
          SJMP JJT22
    JJT2: MOV A,44H
          ADD A,#100
          MOV 44H,A
          MOV A,45H
          ADDC A,#00
          MOV 45H,A
          DJNZ R6,JJT2
   JJT22: CLR RS1
          CLR RS0
          RET
WR_18B20: MOV R2,#08H
         CLR C
         SETB DQ
         MOV R3,#02H
         DJNZ R3,$
         NOP
    WR1: CLR DQ
         MOV R3,#03H
         DJNZ R3,$
         RRC A
         MOV DQ,C
         MOV R3,#20
         DJNZ R3,$
         SETB DQ
         MOV R3,#03H
         DJNZ R3,$
         DJNZ R2,WR1
         SETB DQ
         RET
RD_18B20: MOV R4,#02H
          MOV R1,#22H
     RE0: MOV R2,#08H
     RE1: CLR C
          SETB DQ
          NOP
          CLR DQ
          NOP
          NOP
          SETB DQ
          MOV R3,#01H
          DJNZ R3,$
          MOV C,DQ
          MOV R3,#010H
          DJNZ R3,$
          RRC A
          DJNZ R2,RE1
          MOV @R1,A
          DEC R1
          DJNZ R4,RE0
          RET
INI_18B20: SETB DQ
           NOP
           CLR DQ
           MOV R4,#150
           DJNZ R4,$
          ;LCALL TM_DISP
          ;LCALL TM_DISP
           SETB DQ
      TS0: MOV R4,#19H
           JNB DQ,TS1
           DJNZ R4,TS0
           SJMP TS2
      TS1: SETB FLAG
           SJMP TS3
      TS2: CLR FLAG
           SJMP TS4
      TS3: ;LCALL TM_DISP
           MOV R4,#120
           DJNZ R4,$
      TS4: SETB DQ
           RET
DELAY8ms: MOV R6,#2H
      KL1: MOV R7,#80H

      KL2: DJNZ R7,KL2
          DJNZ R6,KL1
          RET

GET_TM: SETB DQ
    S1: LCALL INI_18B20
        JB FLAG,S2
        SJMP S1
    S2: MOV R4,#10H
        DJNZ R4,$
        MOV A,#0CCH
        LCALL WR_18B20
        MOV A,#44H
        LCALL WR_18B20
        MOV R4,#0ffH
    S3: LCALL TM_DISP
        DJNZ R4,S3
    S4: LCALL INI_18B20
        JB FLAG,S5
        SJMP S4
    S5: MOV A,#0CCH
        LCALL WR_18B20
        MOV A,#0BEH
        LCALL WR_18B20
        LCALL RD_18B20
        LCALL INI_18B20
        MOV R4,#10H
    S6: LCALL TM_DISP
        DJNZ R4,S6
    S7: RET
TM_COV: MOV A,#0F0H
        ANL A,TM_L
        SWAP A
        MOV TM_NUM,A
        MOV A,TM_H
        ANL A,#07H
        SWAP A
        ORL A,TM_NUM
        MOV TM_NUM,A
        MOV R0,#DSPBUF
        JNB 0FH,SING
        MOV @R0,#0BH
        CPL A
        CLR ACC.7
        ADD A,#01H
        MOV TM_NUM,A
        SJMP SING1
  SING: MOV @R0,#0AH
 SING1: MOV B,#10
        DIV AB
        INC R0
        MOV @R0,A
        INC R0
        MOV A,B
        MOV @R0,A
        INC R0
        MOV A,#00H
        JNB 13H,DOT1
        ADD A,#50
  DOT1: JNB 12H,DOT2
        ADD A,#25
  DOT2: JNB 11H,DOT3
        ADD A,#12
  DOT3: JNB 10H,DOT4
        ADD A,#6
  DOT4: MOV B,#10
        DIV AB
        MOV @R0,A
        RET
TM_DISP: CLR RS1
         CLR RS0
         MOV DPTR,#TAB
         MOV R0,#DSPBUF
         MOV B,#0FEH
         MOV R5,#04
   DIP1: MOV A,@R0
         MOV P0,#0FFH
         MOV P1,#0FFH
         MOVC A,@A+DPTR
         CJNE R5,#02,DIP2
         ANL A,#7FH
   DIP2: MOV P0,A
         MOV A,B
         MOV P1,A
         RL A
         MOV B,A
         LCALL DELAY8ms
         INC R0
         DJNZ R5,DIP1
         RET
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
TM_DISP_1: CLR RS1
         CLR RS0
         MOV DPTR,#TAB
         MOV R0,#DSPBUF
         MOV B,#0FEH
         MOV R5,#04
 DDIP4:  MOV A,R0
         MOV P0,#0FFH
         MOV P1,#0FFH
         CJNE A,60H,DDIP1
         MOV A,#0FFH
         SJMP DDIP3
  DDIP1: MOV A,@R0
         MOVC A,@A+DPTR
  DDIP3: CJNE R5,#02,DDIP2
         ANL A,#7FH
  DDIP2: MOV P0,A
         MOV A,B
         MOV P1,A
         RL A
         MOV B,A
         LCALL DELAY8ms
         INC R0
         DJNZ R5,DDIP4
         RET
 ;;;;;;;;;;;;;;;;;;;;;
 TM_DISP_2: MOV R4,#10H
  KS4: LCALL TM_DISP
      DJNZ R4,KS4
      MOV R4,#1FH
  KS5: LCALL TM_DISP_1
      DJNZ R4,KS5
      RET
TAB:
DB 0C0H,0F9H,0A4H,0B0H,99H,92H,82H,0F8H,80H,90H,0FFH,0CFH
END

```

# 附录二  硬件电路图

![图10-8 硬件电路图](http://my.gunplan.top/static/yj1.png)
# 摘 要

本设计基于基于STC89C52RC单片机的温度控制系统的工作原理和设计方法。本文介绍了控制系统的硬件部分，包括：温度检测电路，温度控制电路，显示电路。单片机处理信号线单片机对信号进行相应处理，以达到温度控制的目的。该文档还重点介绍了采用模块化结构的软件设计部分。介绍了该控制系统的硬件部分会在文中写出，包括的模块是：数字管显示程序，键盘扫描和按键处理程序，温度信号处理程序，继电器控制程序和过热报警程序。同时，还包括系统中复杂的电路设计等方式。主程序，读取温度子程序，键处理程序，LCD显示程序和数据存储程序。该控制系统可以实时存储相关的温度数据并记录当前的时间。系统程序主要包括主程序，读出温度子程序，处理轮转子程序，转换温度计算子程序、按键处理结构、LCD显示程序以及数据存储程序等。



**关键词：AT89C51，单片机 ，DS18B20温度芯片，温度控制**  



# Abstract

This design uses STC89C52RC single-chip microcomputer as the core of the working principle and design method of temperature control system. The temperature signal is collected by the temperature chip DS18B20 and transmitted to the single-chip microcomputer as a digital signal. This article introduces the hardware part of the control system, including: temperature detection circuit, temperature control circuit, display circuit. The single chip microcomputer processes the signals accordingly to achieve the purpose of temperature control. The single chip microcomputer processes the signals accordingly to achieve the purpose of temperature control. The paper also focouses on the software design part, which adopts a modular structure. The main modules are: digital tube display prog random access memory, keyboard scanning and key processing prog random access memory, temperature signal processing prog random access Memory, relay control prog, random access memory, and over-temperature alarm pr ocess. The control system can store relevant temperature data in real time and record the current time. The system prog random access memory mainly includes a main prog random access memory, a readout temperature subprog random access memory, a calculation temperature subprog random Access memory, a key processing prog random access memory, an LCD display prog random access memory, and a data storage prog random access memory.



----




# 第1章 绪 论

## 1.1 温度控制系统研究的目的和重要性

在人类历史上，环境温度起着极其重要的作用。环境温度是工业生产中最常见的工艺参数之一。每个物理变化和每个化学反应过程都与温度密切相关。因此，温度控制是生产自动化中的重要任务。随着社会的发展，科学技术的进步以及温度测量设备在各个领域的使用，智能化是现代温度控制系统发展的主要组成部分。尤其是近年来，温度控制系统已经应用于人们生活的各个方面，但是温度控制一直是一个尚未发展的领域，但这是一个与人类息息相关的世纪之久的问题。在这种实际情况下，温度控制系统的设计具有广阔的应用前景和重要性。

此结构是为室温控制系统设计的，控制对象是室温。温度控制通常用于日常生活和工业领域，例如用于冷室，洗澡池，酵母池，电源和其他地方的温度控制。过去，温度控制是手动进行的，没有给予足够的重视。实际上，在许多地方都必须很好地调节温度。鉴于此问题，此系统设计的目的是创建一个可使其自身适应设定温度的系统。它被广泛使用，功能强大，小巧美观，易于携带。这是一种实用且廉价的控制系统。

## 1.2 温度控制系统研究概况

国外对温度控制技术的研究始于1970年代。首先，使用模拟组合仪器来收集现场信息并执行指令，记录和控制。分布式控制系统出现在1980年代后期。目前正在开发用于计算机数据采集的控制系统的集成多因素控制系统。当前，温度测量和控制技术在全球不同国家中迅速发展，并且一些国家正在朝着完全自动化和无人值守的方向发展。

中国对温度测量和控制技术的研究相对较晚，始于1980年代。中国工程师和技术人员已经吸收了工业化国家对温度测量和控制技术的吸收，从而掌握了室内温度的微机控制技术。该技术仅限于控制环境中的单个温度因子。中国温度测控设备的计算机应用一般处于从消化吸收阶段，易应用阶段到实用化，全面应用阶段的过渡和发展。从技术上讲，大多数情况下都存在由单片机控制的单参数单回路系统，并且没有真正的集成多参数控制系统。与工业化国家相比，差距很大。我国温度测控的现状还远远没有达到工业化水平。生产中仍有很多困扰我们的问题。设备支持能力差，工业化程度低，环境控制落后，软件和硬件资源无法共享和可靠。缺点，例如不良性行为。

##  1.3 温度传感器技术

传感器技术是现代信息技术的主要内容之一，信息技术包括计算机技术、通信技术和传感器技术。计算机和通信技术发展极快，相当成熟，而传感器应用技术因为需要使用模拟技术，而模拟技术还有很多问题难以解决，因此传感器应用技术也有待进一步发展。为了适应现代科学技术的发展，世界总舵国家都把传感器技术列为现代的关键技术之一。通常将能把非电量转换为电量的器件称为传感器，其实质上是一种功能块，作用是将来自外界的各种信号转换成电信号。它是实现测试与自动控制系统的首要环节。如果没有传感器对原始参数进行精确可靠地测量，那么无论是信号转换或信息处理，或者最佳数据的显示和控制都将无法实现。 

温度传感器，使用范围广，数量多，居各种传感器之手。温度传感器的发展大致经历了以下三个阶段：传统的分立式温度传感器（含敏感元件），主要输能够进行非电量和电量之间的转换；模拟集成温度传感器/控制器；智能温度传感器。目前，国际上新型温度传感器正从模拟式向数字式、集成化、智能化及网络化的方向发展。温度传感器按传感器与被测介质的接触方式可分为接触式温度传感器和非接触式温度传感器两大类，其中，接触式温度传感器的测温元件与被测对象要有良好的热接触，通过热传导及对流原理达到热平衡，这个示值即为被测对象的温度。这种测温方法精度比较高，并可测量物体内部的温度分布。但对于运动的、热容量比较小的及对感温元件有腐蚀作用的对象，这种方法将会产生很大的误差。非接触测温的测温元件与被测对象互不接触。常用的是辐射热交换原理。此种测温方法的主要特点是可测量运动状态的小目标及热容量小或变化迅速的对象，也可测量温度场的温度分布，但受环境的影响比较大。 

温度传感器的发展大致可分为以下几种：  
1. 热电偶传感器。热点偶传感器是工业测量中应用最广泛的一种温度传感器，它与被测对象直接接触，不受中间介质的影响，具有较高的精度；测量范围广，可从-50℃～1600℃进行连续测量，特殊的热电偶如金,铁,镍,铬最低可测到-269℃，钨,铼最高可达2800℃。
2. 模拟集成温度传感器。采用硅半导体集成工艺制成的，因此亦称硅传感器或单片集成温度传感器。模拟集成温度传感器是在20世纪80年代问世的，它将温度传感器集成在一个芯片上、可完成温度测量及模拟信号输出等功能。模拟集成温度传感器的主要特点是：功能单一、测温误差小、价格低、响应速度快、传输距离远、体积小、微功耗等，适合远距离测温，不需要进行非线性校准，外围电路简单。
3. 光纤传感器。光纤测温技术可分为两类:全辐射测温法，单辐射测温法，双波长测温法，多波长测温法等。特点是：光纤挠性好、透光谱段宽、传输损耗低，无论是就地使用或远传均十分方便而且光纤直径小，可以单根、成束、Y型或阵列方式使用，结构布置简单且体积小。缺点是：测量起来困难,难于实现较高的精度，工艺比较复杂,且造价高，推广应用有一定困难。
4. 半导体吸收式光纤温度传感器。半导体吸收式光纤温度传感器是利用了半导体材料的吸收光谱随温度变化的特性实现的。一种传光型光纤温度传感器，是指在光纤传感系统中，光纤仅作为光波的传输通路，而利用其它如光学式或机械式的敏感元件来感受被测温度的变化。在这类传感器中，半导体吸收式光纤温度传感器是研究得比较深入的一种。
5. 智能温度传感器。智能温度传感器(亦称数字温度传感器）是在20世纪90年代中期问世的。它是微电子技术、计算机技术和自动测试技术（ATE）的结晶。目前，国际上已开发出多种智能温度传感器系列产品。智能温度传感器内部包含温度传感器、A/D传感器、信号处理器、存储器（或寄存器）和接口电路。有的产品还带多路选择器、中央控制器（中央处理单元）、随机存取存储器（随机存取存储器）和只读存储器（只读存储器）。智能温度传感器能输出温度数据及相关的温度控制量，适配各种微控制器（M中央处理单元），并且可通过软件来实现测试功能，即智能化取决于软件的开发水平。

随着科学技术的不断进步与发展，温度传感器的种类日益繁多，数字温度传感器更因适用于各种微处理器接口组成的自动温度控制系统具有可以克服模拟传感器与微处理器接口时需要信号调理电路和A/D转换器的弊端等优点，被广泛应用于工业控制、电子测温计、医疗仪器等各种温度控制系统中。其中，比较有代表性的数字温度传感器有DS18B20、MAX6575、DS1722、MAX6635等。相比较而言，传统的温度检测以热敏电阻为温度敏感元件，热敏电阻成本低，但需要后续信号处理电路，而且热敏电阻的可靠性相对较差，测量温度的准确度低，检测系统的精度差。数字式温度传感器的种类也不少，并且在实际工程设计中具有上述诸多优点。
# 第2章 系统总体方案设计

## 2.1 系统工作原理

单片机温度控制系统是以AT89C51单片机为控制核心，辅以采样反馈电路，驱动电路，晶闸管主电路对电炉炉温进行控制的微机控制系统。系统的原理框图如图2-1所示，其基本控制原理为: 用键盘将温度的设定值送入单片机，并在发光二极管显示，启动运行后，通过信号采集电路将温度信号采集到后，送入单片机系统进行PID 控制运算，将控制量输出，改变可控硅管的接通时间便可改变加热丝功率，以达到调节温度的目的控制电阻炉的加热。

当由于环境温度变化太剧烈或由于加热或降温设备出现故障，或者温度传感头出现故障导致在一段时间内不能将环境温度调整到规定的温度限内的时候，单片机通过三极管驱动扬声器发出警笛声。 

![图1-1 第一个方案](http://my.gunplan.top/static/1.0.0.PNG)

图1-1为第一个设计方案，该方案的工作原理简述如下：

1. 锯齿波是由单结晶体管BT和R1，R2，R3，W1和C1组成的张驰震荡产生，然后经射极跟随器V1、R4输出。
2.  控制电压（Uk）与锯齿波电压进行电流叠加后送到V2的基极，合成电压为Us，当Us>0（0.7）时V2导通，Us<0，则V2截止。
3.  由V2、V3以及R8、R9、DW1组成一直流开关，当V2基极电压Ube2>0(0.7)，V2导通，Ube3接近零电位，V3截止，直流开关导通。输出24V直流电压。
4.  过零脉冲的输出，由同步变压器TB，整流桥D1及R10，R11组成一削波同步电源，这个电源与直流开关的输出电压共同去控制V4与V5。只有当直流开关导通期间，V4截止，V4、V5基电极和发射极之间才有工作电压，才能工作在期间，同步电压每次过零时，V4截止，其集电极输出正电压，使V5由截止转导通，经脉冲变压器输出触发脉冲而此脉冲使晶闸管T在需要导通的时刻导通。

在直流开关导通期间使出连续的正弦波控制电压Uk的大小决定了直流开关导通时间的长短，也就决定了在设定周期内导通的周波数，从而可输出功率的调节。显然，控制电压Uk越大，则导通的周波数就越多，输出的功率也就越大，电阻炉的温度也就越高，反之，电阻炉的温度就越低。
闭环控制自动调温的基本指导思想是在系统中增设温度传感器和温度调节器，温度传感器的基本功能是检测电炉的实际温度，并变换成电压讯号和炉温控制电压Uk进行比较，根据两者差值的大小（Δe=Uk-Uft）和变化方向（即△e为正还是为负），通过调节器进行相反方向的调节，使调节器的输出控制直流开关导通时间的长短，从而使设定周期内晶闸管的导通周波数增大或者减小，相应的电炉温度升高一点或者减小一点。采取这种控制方式，可以使炉温在较小的范围内变化，控制精度高。
方案二：为了使得电路的简单化，采用单片机作为控制核心来设计本课题，温度信号采集使用温度传感器DS18B20，温度控制的基本思想为：通过采集到的温度与标准温度之间的差值来控制加热电阻丝的通电时间长短，从而起到恒温控制的目的。方案二的设计框图如下图所示：

![图1-2](http://my.gunplan.top/static/1.0.0.PNG)

本方案采用单片机作为控制核心，使用温度传感器进行温度采集，通过将采集到的温度与标准设定温度之间的差值进行温度控制，从而使得温度维持在标准设定温度。本方案设计成本低，具有具有较高的可靠性，对于系统动态性能与稳定要求不是很高的场合非常的合适。

单片机温度控制系统是以AT89C51单片机为控制核心，辅以采样反馈电路，驱动电路，晶闸管主电路对电炉炉温进行控制的微机控制系统。系统的原理框图如图2-1所示，其基本控制原理为: 用键盘将温度的设定值送入单片机，并在LED显示，启动运行后，通过信号采集电路将温度信号采集到后，送入单片机系统进行PID 控制运算，将控制量输出，改变可控硅管的接通时间便可改变加热丝功率，以达到调节温度的目的控制电阻炉的加热。

当由于环境温度变化太剧烈或由于加热或降温设备出现故障，或者温度传感头出现故障导致在一段时间内不能将环境温度调整到规定的温度限内的时候，单片机通过三极管驱动扬声器发出警笛声。

## 2.2 系统功能介绍

本设计是对房间温度进行检测与控制，设计的温度控制系统实现了基本的温度控制功能：当温度低于设定的温度时，系统自动通过PWM启动加热装置，使温度上升。当温度高于设定的温度时，停止加热。三位数码管及时显示温度，精确到小数点后一位。  
本文设计的温度控制系统具有如下功能：

1. 通过温度芯片DS18B20采集温度，并以数字信号的方式传送给单片机。
2. 四位数码管动态实时显示房间温度，显示精度0.10C。
3. 三个按键实现标准温度的设定。
4. 利用PWM实现温度的控制。



# 第3章系统硬件电路设计

![图3-1电路硬件图](http://my.gunplan.top/static/2.0.1.png)

该解决方案使用AT89C51为核心处理芯片，芯片DS18B20测量内部温度，通过发送信号传输总线到MCU，并且和一个4位LED显示管温度。偏差用于控制电阻丝导通/截止时间的长度。实现恒温控制的界面的最终想法是最终想法。

## 3.1 各模块设计

### 3.1.1 温度传感器电路

本文在课题教学研究中所采用的的温度传感器一般可以分为采用一个美国两个单线的四位数字小型环境温度传感器例如ds18b20。该稳压传感器4.7k##hz该传感器用于输出稳压信号的上和下拉稳压电阻直接通过连接输入到一个微控制器的一个p1.0引脚。

半导体温度传感器DS18B20产生Dalalas数字温度传感器，多并行总线技术。该器件在小型集成电路芯片上制造温度敏感的半导体器件、 A / D 转换器、存储器等。在对本设计中的温度传感器进行多次比较和考虑之后，选择了单线数字设备DS18B20，主要是由于以下原因：

1. 该检测系统的主要特点功能是：在一个允许温度范围的工作检测温度是-55℃〜+125℃，±0.5度的工作温度和在测量值的精度是5℃。温度函数转换器高精度。9至12变量，温度检测值数据可以被直接转换成一个串行16位的非二进制的或数字输出形式的数据输出;最大输入时间频率转变精度为12位测量精度转变为750ms;它们都可以通过一条数据线被直接供电，具有超低电源功耗。
2. 系统进行成本：由于我国计算机信息技术和微电子科学技术的发展，新型企业大规模集成电路设计越来越具有强大，体积变得小是越来越会发生的，价格也会下跌。DS18B20提交空间与普通晶体管之间几乎没有本质区别的，价格只有约$1。
3. 降低系统总线技术操作复杂度：由于设备ds18b20是单总线测量设备，微处理器与之进行接口时只不过需要至少占用在校学生一个模拟i/o口，一根模拟总线测量方式线就可以同时连接数十个设备ds18b20，温度管理进行总线测量方法完全无需任何模拟企业外部网络控制元件，因此，与传统模拟工业生物温度传感器中的网络系统相比，可以测量得到大大幅度增加以及减少系统布线调试次数，降低温度管理系统的技术复杂性，减少重大工程项目的基础建设工作量。
4. 减少系统的引线调试和日常维护：由于大量减少的系统引线数量可以不会引起一些小的事情，大量使用减少接线的工程数量，减少接线工程数量产生的引线施工成本量大大降低，系统的内部布线过程复杂度的降低调试和日常维护另一方面，因为系统引线接口数量的减少产生的故障数量大大下降，使得整个系统中的接口工作变得简单许多，给系统的日常调试工作带来更多方便，之所以认为dsl8820是全方位数字化的元器件，故障基本不会同时发生，干扰性的和可抗性强，因此为了让整个系统的在整个日常生活中而所进行需要保证正常工作的维护任务大大减少，为了更好保证系统可用性而所进行的日常维护相关工作保证正常系统运行的维护工作。

ds18b20温度控制系统传感器引线技术通常存在一个小的引线，引线上的数量通常是3，并且我们可以确定不在一个企业内部：一个单线程的数据网络信息传输包括系统总线数据端口vvdq、外部数据电源线vdd和公共网络地址总线端口gnd。ds18b20有2种直流供电的工作方法：其一种就是采用杜邦线的直流供电电压模式。此时，vdd被完全接地。当它开始产生能量空闲时，它通过内部一个电容器线路来让它存储剩余电量用从外部数据线路中获得剩余能量并用来让它完成整个温度功率转换，相应的当它完成整个温度功率转换的持续时间也会更长。在这种应用情况下，使用一个单片机的一个矩形i/o输出端口让它来自动拉起一个ds18b20总线。另一种模式是外部温度电源连接模式(vdd电源连接+5v)，完成外部温度变化测量的时候相应操作时间短。

在本设计项目中我也可以直接采用由大学生企业提供的并不在相关企业内部的各种电子信息流的流动强度及其发展计算方式等来进行设计实现。cds18b20传感器与驱动单片机的接口连接，其内部接口集成电路设计方案如软件图2-2所示。

![图2-2外部电路](http://my.gunplan.top/static/003.jpg)

### 3.1.2 通用键盘显示电路设计

![图2-3外部电路](http://my.gunplan.top/static/003.jpg)

所示，ale时钟脉冲可以作为一个时钟同步电路8279，从而与示意图的两个时钟脉冲同步。2-3。8279芯片的控制中断电路控制输出信号irqr连接到一个控制单片机的一个p1-1引脚。缓冲器输入地址是将寄存器中的a0连接输入到整个单片机的一个p2-5引脚，ae的缓冲信号则是连接到整个单片机的一个p2-6引脚。读写器和信号数据线缆分别和两个单片机的信号读写器和信号数据线缆来进行连接相连。8279芯片的外部数据传递运输线路由d0-d7与整个单片机的外部数据线直接相连进行相应的连接。

来自8279芯片和AT89C51芯片的许多信号是一致的，可以直接级联，这非常容易控制。8279芯片的8位数据线进行直接连接到AT89C51芯片的P0端口。读取和写入信号连接到89C51的读取和写入信号。 AT89C51锁存信号ALE连接到8279 CLK，在内部分频后，会产生一个公共的非外部时钟脉冲。8279芯片的端子请求信号由反相器反转，然后连接到AT89C51的P1.1端口。 AT89C51的三个可寻址寄存器只需要两个地址即可寻址，即命令/状态寄存器地址和数据寄存器的地址值。8279芯片中与地址相关的信号是A0和芯片选择信号。您的连接直接确定寄存器地址在哪里。一旦确定了硬件电路，就确定了寄存器的地址。

发光驱动二极管的色号发光驱动效率和显示颜色分别取决于每个制造商的材料，如果出现没有什么意外情况是可以使用egred色号，出现其他意外情况可以使用reyellow或是egreen色号。发光电子二极管又称发光电子二极管主要是利用智能电子技术通过测量管理系统控制测量仪表中简单而常用的进入输出一个控制装置，通常说它可以直接用于用来指示一个机器的工作状态或其他相关企业服务信息。具有系统功耗低、配置灵活、接口方便、价格低廉、使用寿命长、对各种电子管直流的流动强度和电势差异性要求低、易于手动实现连接多种电路等多大优点。

液晶电视显示器本身是被动电子显示器，它本身不向外调节发出一种具有一定粒子性的主动电磁波，只需向外调节其发出一种具有一定粒子性的被动电磁波的频率数量。目前，常用的彩色液晶信息显示器通常是根据中国的而液晶对于信息显示失真率的问题总是按克列拉斯效应的基本原理设计制成的，它通常可以通过同时获得一个位于黑色信息发展初始背景上的一个白色初始字符或一个白色初始背景上的一个黑色初始字符的方式显示不同信息形式。便携式检测仪器主要用于电力测量和分析控制和检测智能动力电池中的电力，考虑到低损耗功率的应用要求，经常我们需要同时使用的就是液晶电视显示器，重量轻，功耗低的而且体积小，因此，广泛作为采用的检测手段。但是必须需要借助外来的灯光进行显示。阴极红外射线图形显像管这种显示器虽然可以同时显示多种图形，但显示界面更复杂，成本更高。

在多路显示温度自动巡检仪中只要您需要同时显示4位的和数字两种形式的显示温度和检测路数，可以不必考虑使用某种价格较高的荧光阴极或红射线液晶显像管;4位数字发光光电二极管的实际工作频率电子在直流的波动强度一般为240ma左右，由于需要使用一个交流电源进行供电，足以完全提供四位发光光电二极管液晶显示器所使用需要的最大功率，对于四位发光光电二极管而言，仅有4位，体积也很小，这样比较符合发光光电二极管和四位液晶电视显示器的诸多性能特点，本检测系统建议选择四位发光光电二极管液晶显示器。

键盘设计是一组多按键的整体组合。其主要工作功能之一是实时控制操作系统的正常工作运行状态，向系统接口输入大量数据和发出命令。有两种键盘类型：标准编码数字键盘和非标准编码数字键盘。

除了单个按键之外，编码器的键盘系统还包括一个用于自动生成键码的多个硬件控制电路、抖动控制电路、多个击键和多个按键之间移动时的保护器等电路。每按一个数字键，就表示可以自动重新生成这个数字键的键码。同时还会产生一个脉冲控制信号，通知系统中央处理控制单元进行接收。这种单片键盘使用方便，接口使用程序简单，但由于需要使用更多的相关硬件集成电路，价格也会变得更高，一般来说单片机键盘应用在该系统中的应用不是非常多。

非按列编码数字键盘仅由按行矩阵排列和非按列排行矩阵两种形式的编码键盘所组成。按键的抖动作用主要是简单地停止连接或自动断开触点，按键的触点抖动、按键软件代码的自动形成和每个按键的自动识别都必须是由按键软件操作来自动完成的。由于其价格经济并且实用，在各种单片机硬件应用管理系统中已经得到广泛应用。

上述一系列比较之后，它应该是非编码键盘。

P0端口： P0端口为8位漏极级开路双向 I/O 端口，每个引脚可吸收8TTL 栅极电子流的强度。当端口 P1的引脚首次写入1时，它被定义为高阻输入。P0可用于非内部程序数据存储器，可以定义为数据/地址的第八位。在 FIASH 编程中，P0作为原始代码输入端口。检查 FIASH 时，P0输出原始代码，必须拉起 P0的外部。

端口设置p1：端口设置p1是一个8位双向模拟i/o输出端口，内部分别提供上或下拉输出电阻。端口强度p1缓冲区强度可以达到接收进入输出4ttl门口的电子负载流的最大强度。p1端口的写入管脚板在写入1后，内部拉高，可以直接作为数据输入。当一个端口上的p1从外部被下拉到低稳压电平时，它将达到输出一个电子到直流的最大强度，这可能是由于内部上压下拉。在执行可以被擦除的非读写数据存储器程序编程和数据验证程序过程中，p1端口通常作为第8个输入地址被程序接收。

p2端口：p2端口是它是一个内部上和下拉稳压电阻的8位双向模拟i/o端口。p2端口栅极缓冲器引脚可以用来接收和控制输出4个ttttl栅极缓冲电子的直流的缓冲强度，当一个端口缓冲p2被直接写入"1"时，其引脚被内部上和下拉栅极电阻拉高并可以用作缓冲输入。因此，当它被直接用作电流输入时，端口位于p2的引脚被外部电压拉低到位于输出端的电子负载流的最大强度。这可能是由于内部上下牵拉的原因缘故。当p2端口，用于外部执行程序数据存储器或外部程序数据处理存储器同时访问的16位数据地址，输出时的端口相当p28的8位地址。读出和存储写入外部输出数据时在存储器输入地址8时，p2端口作为输出数据内容在特殊寄存功能下的寄存器。p2端口在整个闪存硬件编程和数据验证系统工作期间使它可以同时接收高八位存储地址以及存储信号和闪存控制器在系统中的信号。

p3端口：p3端口引脚为8个双向直流i/o控制端口，带有内部上压下拉控制电阻，可同时接收和控制输出4个在tttl栅极上的电子到直流的最大强度。当两个p3端口开始写入"1"时，它们在内部被迅速拉升并达到高水平并且被用作信号输入。作为一个输入，由于外部下拉低，p3端口将由于上下下拉而达到输出一个电子负载流的最大强度(ill)。

p3端口如果可以使用作为at89c51的一些特殊控制功能的通用接口也是完全可以的，如下面列表所示：

管脚备选功能

：-：：-：

P3.0 RXD (串行输入)

P3.1 TXD (串行输出)

P3.2/INT0(外部中断0)

P3.3/INT1(外部中断1)

P3.4 T0(定时器0外部输入)

p3.5t1(外部微波信号定时器1外部微波信号发出输入)

P3.6/WR (外部数据存储器写门)

P3.7/RD (外部数据存储器读取频闪)

p3端口同时它也可以用来接收一些主要的可用于总线进行射频闪烁信号编程和射频编程性能验证的射频控制电路信号。

rst：振荡器的复位字节输入。当外部振荡微处理器重置为一个器件时，在两个机器工作周期内保持一个rst引脚的高电平。ale/prog：当振荡器访问一个企业外部的数据网络存储器时，使用网络地址锁存器引脚所允许的外部输出正脉冲信号的高电平来对锁存网络地址的位置和状态进行复位字节。此引脚主要用于在振荡器的闪存脉冲编程期间通过脉冲输入用于闪存编程的脉冲。在通常的，周期性脉冲输出的ale正脉冲信号的恒定脉冲频率大约为1/6振荡器的频率。因此，它们实际上可以跳过一个用作外部脉冲输出的周期性脉冲或跳过一个用于定时目的。但是应该注意的是每一次都需要指出的一点是，外部的数据存储器，这将被用于跳过一个新的ale脉冲。如果振荡器需要禁用一个alert的复位字节输出，可以在振荡器的sfr8eh地址上重新设置0。此时，ale只需要执行一个movr，movd指令为一个新的ale。另外，该引脚被略微拉高。如果外部微处理器在外部脉冲执行的状态ale禁止，则该引脚的设置无效。

psen：外部的应用程序例如数据包和存储器的编程代码包含指令集的选择和数据通门控制信号。在外部软件程序执行的指令代码流在提取中的指令外部程序中的数据流在存储器系统中的每个代码提取指令值在提取期间，每个外部程序机器执行周期有效两次/psen。但是，访问外部应用程序例如数据库和存储器时，这两个有效的/psen的控制信号通常可能不会同时一起出现。

ea/vpp：这是用于保证当/ea端口器继续工作保持低稳压电位，这期间的外部应用程序相同存储器(0000h-ffffh)，无论它的存储器类型是否与内部的应用程序相同存储器。需要特别注意，当外部应用程序开始使用加密的文件方法1时，/ea中的存储器端口会自动锁定内部以用于防止文件重置;同时当/ea端口的继续运行保持正常的最高位时，这里的内部应用程序没有内存。该引脚还同时可以作为用于在不对闪存进行编程期间用于应用12v值的闪存进行编程的备用电源(vpp)。

xtal1：反向控制电路主要用来进行控制振荡信号放大器的时钟输入和内部时钟输出是用来进行控制系统的内部时钟质量管理工作以及辅助系统控制反向电路的外部驱动控制器的输入。

XTAL2：来自反向振荡器的输出。

### 3.1.3 振荡器特性

xtal1和外部xtal2分别提供的是片内反相放大器的脉冲信号输入和振荡器输出。该系列反向放大器的设备可以直接配置为片内的振荡器。石晶振荡和陶瓷振荡均可广泛采用。如果放大器使用外部的时钟源脉冲驱动的设备，则放大器不应需要连接xtal2。对内部的时钟源脉冲信号的多余脉冲输入信号需要通过两频的分频脉冲触发，因此放大器对外部时钟源脉冲信号的所需脉冲的宽度没有严格的要求，但是必须注意保证时钟源脉冲的频率高低和电平的所需脉冲宽度。

### 3.1.4 芯片擦除

通过快速组合正确的两个锁定保存位芯片控制电阻信号并同时将它保持在比ale引脚低10ms，可以轻松快速完成整个程序pe-rom两个芯片控制阵列和三个用于锁定保存位的两个芯片控制电阻被擦除。在重复执行一个芯片用于锁定内存位置的电擦删删除的每个操作中，代码中的数据元组被允许重复执行写入"1"，并且必须在执行芯片锁存重复执行写入一个可编程非零时空函数存储器的字节之前，它才能重复执行此位电擦除后的操作。

此外，at89c51配备了固定的逻辑，可以从低频动态到零的频率静态，支持两种软件模式和可选的自动关机中断模式。系统在空闲时中央控制单元软件自动停止振荡器的工作。然而，随机存取的存储器，定时器，计数器，串行接口和振荡器中断系统继续保持正常工作。在这种关机中断模式下，将自动保存随机存取存储器的所有内容，并自动冻结振荡器，并自动停用所需要使用的其他硬件和芯片振荡器的功能，直到振荡器下一次所使用的硬件振荡器复位完成为止。

许多尚不了解51单片机的互联网用户会遇到以下问题：书籍和在线教程中的AT89S51是什么?8051、89C51等，但没听说过89S51。

在这里，剛刚刚入門的单片机新人应该先阐明一下单片机实际使用的一些产品和理念。mcs-51微控制器单片机是基于美国英特公司于1980年推出的一款单片机产品。其典型的产品理念为8031(芯片无内置的程序和存储器，实际的使用已从单片机市场上完全淘汰)，8051(通用芯片设计采用hmos，功耗为630mw，是89c51的5倍)日期根据实际的使用)。但是到目前为止，8751和其他的通用芯片产品仍然可能是完全兼容的，包括mcs-51核心处理器系列和微控制器(目前已全部停产89s51、89c51等)。在加州理工大学和计算机职业技术学校的单片机培训课程和文档中，mcs-51微控制器仍然可以用作基础理论和学习的一个重要代表。

在一些技术文档中，8051甚至被广泛称为是mcs-51系列中的mcu。8051是早期最典型的单片机代表。由于对mcs-51单片机的深刻历史意义，许多微控制器公司都推出了许多兼容这一系列的单片机，这也就意味着他们的内核确实已经存在于mcs-51。它已经成为8位微控制器的一个标准。

其他飞利浦公司的51mcu产品与51mcs-51核心处理器兼容。相同的微控制器程序，在每个飞利浦微控制器设计制造商的产品和硬件上所需要执行的程序和结果可能是相同的，例如，我们常说的89c51，如飞利浦的at89c51(已宣布停产)，89s51，飞利浦(简称飞利浦)和l公司的winbond(winbond)等。已停产的微控制器是飞利浦atmel公司的单片机和at89c51单片机。同时，许多微控制器功能在原始的基础上已经得到了很大的改进，例如b.时钟。闪存越好(程序中只读存储器的所有内容至少一次可以反复重写1000次)。对于只读存储器(一次只能写入)，at89c51的存储器性能远远地要优于8051。

关于目前的市场营销，pic单片机制造商阵营对89c51提出了强烈的质疑。89c51最严重的问题是存在技术缺陷之一就是添加更多isp(在线更新应用程序)的功能目前是不被认为能夠广泛使用的。因此需要通过添加更多isp功能等新功能之后才能在市场上继续使用。mcs-51图例。在这种的情况下，89s51取代了89c51。目前，89s51依然已经变成了单片机市场中大多数人民的选择之中的一个绝大部分。目前市场份额最大的atmel已经宣布停止了生产新的at89c51，将其产品改用全新的at89s51。89s51进行了一系列技术上的改进。89s51采用全新的0.35标注，可有效控制单片机制造基本的成本，改善产品功能，增强市场竞争力。89sxx可以成为兼容89cxx等51系列单片机的芯片。同时，atmel不再需要接受89c的大量订单。你在目前市场上所能看到的89c51实际上已经是atmel以前停止生产的大量库存。

## 3.2 AT89C51单片机简介

at89c51是一个os8-bit微处理器(fpeam只读存储器-flashprog随机存取只读存储器fpram和一个可自动擦除随机存取只读数据的存储器)，俗称嵌入式微控制器。该设计原件是采用基于atmel的高密度非易失性只读存储器的制造技术设计制造，与符合行业标准的atmcs-51指令集与输出引脚指令集是兼容的并可以一直连接到。由于多功能8位中央处理器和闪存指令集结合在一个独立的单芯片中，atmel的at89c51是一个高效的嵌入式微控制器，它为许多的嵌入式控制系统应用提供了一个灵活和廉价的解决方案。

![3-8硬件电路图](http://my.gunplan.top/static/3.2.png)

at89c51可由一个atmel公司的控制器在线进行编程，用于嵌入式温度数据采集和嵌入式数据通信。at89c51是一款低成本功耗、高性能的cmos8位嵌入式单片机，其中主要包含了可通过重复自动擦除1000次的闪存和具有8k字节的isp(指令系统内的prog随机存取程序和存储器matlable)的嵌入式闪存只读程序和存储器，该芯片元器件主要采用了基于atmel的一种高密度、非易失性的嵌入式存储技术设计制造，兼容了标准的mcs-53指令系统和80c51引脚的结构。该系列芯片元器件集成了一个通用的8位中央处理器和一个isp的嵌入式闪存存储单元，功能强大的微型嵌入式计算机的at89c51可以为许多嵌入式控制和管理系统的应用和分析指令系统的发展历程提供一些具有降低生产成本和经济效益的解决问题的方案。at89c51具有以下的特点：40针、4k字节闪存片上应用程序数据存储器、128字节随机存取应用程序数据存储器(随机存取数据存储器)、32个外部双向数据输入/外部输出(i/o)串行通信端口，5个串行中断优先级，2个串行中断优先级嵌套中断，2个16位的可编程定时计数器，2个全双工串行通信控制端口，watchdog(wdt)控制电路，片上时钟振荡器。

at89c51有三个并行的i/o口，p0：p0.0~p0.7，p1.0~p1.7，p2.0~p2.7。此外，当没有片上或外部存储器时，p0端口可以用作公共i/o的端口，当主机使用外部或片上存储器时，p0端口也可以直接用作地址数据线/端口或数据线。p1端口也可以直接作为一个通用的公共i/o端口，p1.0、p1.1、p1.5~p1.7也可以具有特殊的端口功能，如表3.4所示。当主机没有片外存储器时，p2端口可以直接用作公共的i/o端口，当主机使用外部存储器时，p2端口也可以直接用作高8位地址。

|引脚特殊功能

：-：：-：

P1.0 T2：定时器

P1.1 T2EX：定时器

P1.5 MOSI：用于在线编程(ISP)

P1.6 MOSI：用于在线编程(ISP)

P1.7 SCK：用于在线编程(ISP)

表3.4at89c51p1端口的特殊控制功能

引脚特殊功能

：-：：-：

P3.0 RXD (串行端口输入)

P3.1 TXD (串行端口输入)

P3.2 INT0(外部中断输入0)

P3.3 INT1(外部中断输入1)

P3.4 T0(定时器0外部输入)

p3.5t1(外部定时器1外部定时信号发出输入)

P3.6 WR (外部数据存储器写控制)

p3.7rd(外部的数据存储器对外部读取和控制)

表3.5 AT89C51 P3端口的特殊功能

这个房间的温度监控系统主要使用单片机进行通讯和温度检测。 P3.0接受DS18B20。 P0端口用于设计温度显示界面。微控制器和控制电路共享一个外部时钟，使用一个片上存储器并具有上电复位功能。单片机的最小系统如图3.2.1所示：

[图3.2.1 SCM 最小系系统(http：//my.gunplan.top/static/3.2.1.png)

## 3.3 8279芯片简介

### 3.3.1 引脚介绍

8279采用单5V电源供电，40脚封装。

DB0~DB7：双向数据总线，用来传送8279与中央处理单元之间的数据和命令。

clk：时钟的输入数据线，用于时钟产生的具有内部定时的时钟脉冲。

复位：复位输入线，复位后8279设置在字符显示的左输入端，两个按键锁定的设置为接触回弹式，程序需要将时钟输入线的预分频器信号设置为31，并且保证复位后的信号在高电平下有效。

CS：芯片选择输入线，低电平有效，CS 端低电平时单片机可读写8279

A0：缓冲区低地址。当 A0为高电平时，表示数据总线是命令或状态。当 A0低时，表示数据总线是数据总线。

研发：通过读取控制器将信号发送到输入数据总线，低电平有效，读出数据缓冲区，并将内部数据发送到外部数据总线。

WR：写信号输入线，低电平激活，读出缓冲器并将数据从外部数据总线写入8279的缓冲器。

RL2-140-VCCRL3-239-RL 1

CLK-338-RL 0

IRQ-437-CNTL/STB

RL4-536-SHIFT

RL5-635-SL 3

RL6-734-SL 2

RL7-833-SL 1

RESRT-932-SL 0

RD-1031-OUT B0

WR-1130-OUT B1

DB0-1229-OUT B2

DB1-1328-OUT B3

DB2-1427-OUT A0

DB3-1526-OUT A1

DB4-1625-OUT A2

DB5-1724-OUT A3

DB6-1823-BD

DB7-1922-CS

VSS-2021-A0

irq：中断请求的正确输出和执行，高级有效。在这种键盘自动中断工作模式下，当每次出现的从fifo/sensor随机存取的在该存储器中间没有任何数据时，中间的断线由一个低电平线转变为一个新的高电平，每次键盘中断时由从fifo/sensor随机存取的该存储器的所有数据被自动读出，断开的检测线路降至较低的水平。如果随机存取的存储器中仍然存有信息，该行将再次变为一个较高水平。在线路和传感器正常工作的模式下，每当随机检测到线路和传感器的信号发生变化时，中断线就可能会逐渐变高。

sl0~sl3：视频扫描线缆可用于实时连接和自动扫描任何按键或光开关、传感器或光阵列和触摸显示器或屏幕上的任何数字，可编程或支持视频可编解码。

rl0~rl7：按键返回扫描线通过按钮或传感器的开关与返回扫描线进行连接。上拉按压电路一般设置在相应的返回扫描线内部，以使返回线保持在高水平。只有当一次按压电路关闭时，相应的按键和返回线才会自动转变为一个低电平;当一次无按键闭合时，均保持在较高电平。

shift：这是换位驱动开关的主要功能。当一个换档电压开关自动闭合时，它被一个换位电压开关自动拉至较低的相位电压电流水平。同时在每当未按时接下一个好的换档电压开关时，换档电压开关的整个输入电压状态必须保持在一个好的高电平。在正常的自动键盘扫描模式下，按键自动关闭，按键的操作位置和自动换位键的开关和所输入的操作状态一起由自动键盘扫描存储。

cntl/stb：自动高电平电源关闭当用户打开一个cntl/stb的电源开关时，它将自动将其拉低，否则将始终无法保持一个好的高电平。对于所有使用鼠标键盘输入的操作模式，该行通常被用作选择控制输入。例如当用户按下按钮时，按钮的数据位置与所有控制输入状态的数据存储在一起的数据位置相同。在选通控制输入的模式下，通常需要选择它，并将按钮的数据位置存储在一个fifo随机存取的存储器中。

outa3〜outa0和一个outb3〜outb0：显示数据输出一个8位端口a和一个8位端口b。这两个端口之间既可以独立进行控制，也是一个可以单独视为8位的端口。

bd：使用数字数据空间的长度显示。此命令输出的一个信号结果可以直接用于在一个两位数字的字符转换期间进行显示一个空格，或者你也可以通过使用"显示空格"的一个命令行来控制一个信号在显示空格一个字符的转换空间进行显示。

VCC：+5V电源输入线。

VSS：地线输入线。

### 3.3.2 8279的编程方法

8279按其控制功能块的大小可以细分为：显示器和键盘控制功能块;工作和显示控制功能块;工作和控制处理器功能块;键盘控制接口和中央处理器功能块控制功能块主要包含手动控制和时间寄存器，定时和自动控制，扫描和计数器三个组成部分，它主要的功能是用于控制显示器和键盘的工作和显示控制功能块。

控制和时间数据寄存器：一种用于存储键盘和中央控制单元的通用编程语言控制命令。当8279中央处理器的程序人员确定了键盘和显示器的工作状态模式以及其他显示器工作的条件时，首先将命令键和控制数据放置在一个数据总线上，然后使用命令a0=1，wr=0cs=0并将所有的命令和键数据保存在wr沿边缘增加了控制和显示器的时间数据寄存器，并对其进行解码以方便创建适当的命令控制功能。

定时和计数器控制：它通常包含一个基本的键盘定时和计数器。第一个定时计数器控制是一个分频系数范围为2-31的预定时器。我们可以通过应用程序控制其预设的分频系数，以使内部的频率为100khz，这样的频率可能至少会导致5.1ms。包括键盘阵列扫描时间和10.3毫秒的反跳扫描时间。其他的计数器对该基本的频率扫描时间进行了划分，并为我们提供适当的键，行，键盘阵列扫描和显示键盘扫描时间。

扫描键盘计数器：用于扫描键盘的计数器主要有两种基本编码工作的模式。在基本编码计数器工作的模式下，计数器为键盘提供一个二进制的计数器。在外部软件输出引脚sl0-sl3之后，可以为用于扫描键盘的计数器提供二进制的扫描计数器功能，并在外部软件解码后进行显示。在此工作模式下，扫描键盘计数器对最低有效值的两位进行解码，并且输出引脚sl0-sl3输出1分之4的二进制解码信号，以对键盘的显示器和用于扫描键盘的二进制扫描计数器进行解码。

键盘功能块包括：返回缓冲区、键盘弹跳和控制、8x8 FIFO 传感器随机存取存储器、 FIFO/传感器随机存取存储器状态。

#### 返回抖动缓冲器与鼠标键盘的抖动反向起跳及抖动控制

八个返回行由返回缓冲区缓冲。在键盘工作模式下，逐个检测这些行，找出行键中已关闭的键。如果回弹电路检测到钥匙关闭，则等待10.3ms，然后记录钥匙是否仍然关闭。如果仍然关闭，则矩阵中 key 的行地址和列地址以及 SHIFT 和 CNTL 的状态一起发送到 FIFO 随机存取存储器，并且 FIFO 随机存取存储器中的数据格式如下：

D7 D6 D5 D4 D3 D2 D1 D0

CNTL SHIFT SCAN RET URN

数据的进行格式中，最高位为shicntl，次高位为shift状态，d5-d3来自不同的扫描线上电子的计数器，d2-d0来自中国传感器返回一个电子计数器，扫描线电子计数器和一个回扫线电子计数器的开关值分别可以直接反映正在输出被传感器按下开关键的行，列的开关值，如果在一个传感器的阵列中，返回行上的开关数据直接进入与正在输出被扫描的传感器阵列相对应的一个传感器随机存取电子存储器阵列中的行，这样，每个传感器开关的数量和位置直接被传感器反映为一个传感器随机存取电子存储器的开关位置。

#### FIFO/传感器随机存取存储器

8x8随机存取存储器是键盘模式和选通模式下的先进先出(FIFO)存储器。每条新的信息都是按顺序写的，然后按照写的顺序读出来。当传感器阵列扫描时，存储器被用作传感器随机存取存储器。此时，随机存取存储器中的每一行存储传感器阵列中相应行的状态。

#### FIF0/传感器随机存取存储器状态

在使用键盘或门控的错误模式下，fifo中的状态阵列跟踪信号表示fifo中的状态字符数注意它到底是"满"还是"空"，过多的传感器写入或读取被状态逻辑认为可能是错误，当传感器fifo不为空时，状态阵列跟踪逻辑就会提供一个用于中断传感器应用程序irq的信号。在特殊的传感器状态阵列扫描模式下，如果一个有效的传感器状态发生改变，irq信号可能是一个有效的传感器高电平。fifo表示状态字的低3位表示fifo模式中的传感器字符数，fu位表示一个fifo随机存取的存储器已满;o(超过donmn)du位表示超限错误，即传感器试图将另一个传感器的字符发送到完整的传感器fifo;u(done下)du位表示null错误，即传感器试图写入或读取空的传感器fifo。s/f有两种的含义：在特殊的传感器扫描模式下，s/f的含义是指一个传感器随机存取的存储器中至少可能包含一个指示传感器是否闭合的指示，在特殊的错误模式下，s/f位是一个传感器错误的标志，指示了是否传感器发生了多通道同时写入或关闭的错误，du位表示错误显示随机存取的存储器尚未完全可用，因为"清除显示"或"清除全部"的命令已经无法完成其他未被消除的操作。

显示随机寄存器块的功能块主要包括：16x8显示随机寄存器，16x8显示随机存取地址存储器，显示随机地址存取寄存器)

#### 显示随机存取存储器和显示寄存器

8279内部缓存显示器同样具有16x8的缓存形式自动显示随机存取的数据存储器，通过自动显示一个寄存器和两个四位端口0uta0-3，0utbo-3来自动显示刷新外部存储器的数据显示，显示器同样可以是使用的大都是8段数码管或者是白炽灯，也可以有外部显示器同样可以是使用的大都是8段管或数码管，显示随机存取的数据存储器也同样可以是使用的大都是16x8的形式显示缓存形式，也就是可以直接构成两个16x4的随机存取数据存储器的形式，显示随机存取的存储器字节可由中央处理单元存储器进行数据的读写，被处理单元读写的随机存取的存储器字节的读写地址由随机显示读写地址的寄存器进行指示.数据显示[地址寄存器保存当前中央处理单元存储器的读或写随机取出的存储器字节读写地址，以及正在随机显示着的那两个4位半字节的存储器地址，读写的地址由当前中央处理单元的命令[存储器编程]，也就是可以设置为每次处理单元读写后存储器地址自动加1的一种工作更新方式，在处理单元设置了正确的存储器工作更新方式后，显示随机存取存储器的数据也可由中央处理单元存储器读出，半字节存储器a和半字节b的存储器地址自动由8279更新，以适应由中央处理单元存储器送入的随机存取数据，a和b半字节可独立的送入，也就是可以单独作为一个字节的送入，随中央处理单元所需要设置的工作更新方式而定。

#### I/O 接口功能块

8279通过i/o缓冲器控制与四行中央处理部分控制单元的系统总线网络接口8279，i/o控制部分主要使用cs。a0，rd，wr和四行的中央处理部分控制单元8279之间的单向控制数据是交换的，数据和缓冲器信号是双向控制数据交换的通道，所述控制单元的信号和缓冲器是如下的双向控制数据交换之间的逻辑关系：

CS A0 WR RD 状态

\-----

10--中央处理单元从8279读状态

0101中央处理单元向8279写状态

10--中央处理单元从8279读数据

001-中央处理单元向8279写数据

1 X 数据缓冲区输出处于三种状态

x为任意数(0或1)

\###3.3.38279的操作

如前所述，8279可以完全适应各种手机键盘和电脑显示器的不同功能和工作的方式，由于8279中各个命令功能块的各种工作方式是完全可编程的，用户完全可以根据自己的工作要求，用向8279写命令字的各种编程方法对8279的各种工作方式和功能块进行编程，从上表中我们可以清楚地看出，只要执行命令cs=0同时wr=0=1，然后你们就可以将命令字写到8279，并在命令wr的上升沿将相应的命令程序驱动到8279。

对于中央处理器，8279只有两个端口地址，一个是用于查看和读写处理器的命令和数字的状态(cs=0，a0=1)，一个端口地址用于查看和读写处理器的数据(cs=0，a0=0)，但对于编程语言命令和字代码有很多类型。在8279中给出了区分学校和企业不同的温度命令字的方法主要是对处理器命令和字代码的高3位(d7，d6，d5)和低5位进行了分析和编码，而低5位主要是用于理解命令字的实际含义和教学内容。

#### 8279的编程命令

键盘/显示器方式设置

最高位最低位

--

命令代码000 D D K K K

其中DD为显示方式，KKK为键盘方式

DD的表示：

编码功能

\--

008个8位字符显示-左端传入

01168位字符显示-左输入

1088位字符显示-右输入

1116个8位字符显示-右端送入

所谓左端送

编码功能

\--

000编码扫描键盘-2键连锁

001译码扫描键盘-2键连锁

010编码扫描键盘-N键巡回

011译码扫描键盘-N键巡回

100编码扫描传感器阵列

101译码扫描传感器阵列

110选通输入，编码显示扫描

111选通输入，译码显示扫描

钥匙链和2，其中N是一个关键电路8279双键盘键被按下两次处理，编码和在两个扫描链轮和显示器被解码形成扫描扫描SL0-SL3。

程序时钟

命令代码001 P P P P P

此命令用于确定定时和分频控制中每个预标量的分频控制系数。命令代码ppppp功率系数可以直接形成一个数字2-31。预标准测量也可以在外部没有所述时钟预定频率的情况下来进行，所述基频，得到内部，如果100khz的选择的基本时钟预定频率，能够外部时钟获得与所述时钟频率预定的恢复时间扫描，分频相关的因子;在预定的复位时钟脉冲后100khz如果没有外部时钟被自动馈送到码31自动。

读FIF0/传感器随机存取存储器

命令代码：010 AI X A X =任意

该读取命令主要用于确定中央处理器选择需要读取后续操作的存储器对象分别是8279中的哪一个fif0/来自传感器随机存取的存储器，并且主要用于传感器确定8个随机存取的存储器字节阵列中的哪一个被传感器读取，其中第一个aaa表示中央处理器选择了需要后续读取的行，ai自动为该行添加1个相同的特征位，并且这两者在传统的键盘扫描模式下的数据是不存在直接相关的，对于每次传感器后续的读取8279，数据存储器会按照与传感器数据首次读取时输入的fif0相同的后续读取顺序自动将数据发送出去。从传感器的fifo开始读取所有数据进行后续的读取，直到传感器写入新的命令。在来自传感器随机存取阵列的实施例中，aaa传感器选择了一线来自传感器8个的随机存取的存储器行如果ai=1，来自传感器的下一次后续读取将被读的随机存取数据送到存储器的下一行。

读显示器随机存取存储器

命令代码：011 AI A A A A

中央处理控制单元对8279写此读取命令，则我们确定了一个中央处理控制单元以一个显示器随机存取的一个存储器位作为数据源缓存地址位来进行随机读取的操作，其中的aaaaa为一个显示器随机存取一个存储器的一个数据源缓存地址，ai的行为自动依次加1特征位，若其中ai=1，则每一次读取第一行随机存取的一个存储器之后[第一行行为显示器的数据地址]自动依次加1。

写显示器随机存取存储器

命令代码：100 AI A A A A

中央处理单元将此命令写入8279，它规定下一步将写入8279的显示随机存取存储器。寻址模式和自动加1功能与读显示随机存取存储器相同。

显示器写入禁止/空格

命令代码：101 X IW IW BL BL X=任意

A B A B

此显示命令主要用于同时屏蔽a或b两个显示端口的输出并重新显示其显示的区域。如果将其中两个显示端口用作两行4位的显示，则必须同时屏蔽4位之一，以使对方发送的信息不会直接影响另一半。iw是该端口被屏蔽的功能位。如果为显示端口设置了显示命令iw=1，则该显示端口被此命令所屏蔽。空格显示请特别注意，b0对应于c0和d0，而d0和bl是应于iwensei，则此显示端口将重新显示空格。如果要以单个8位的输出命令格式为该端口创建重新显示的区域，则必须为端口设置两个d0和bl的标志以使该端口的显示完全保持空白。

消除

命令代码：110 CD CD CD CF CA

此数据清除格式命令主要就是用于按一定的数据格式顺序进行数据清除，它显示随机存取器的数据格式存储器的两个fif0状态，其中a和cd分别用于指定一个需要进行清除的数据格式：

CD CD CD

0 X 全"0"(x为任意)

10 AB =16进制

1020(0 O 100000)

11全册"1"

当显示为"1"(或 CA =1)时，允许清除显示

cf显示器清除cd和fifo的状态(其中包括广告和中断)。如果显示cf=1，则显示器清除cd和fif0状态，并重置中断线。传感器直接随机访问存储器的显示也始终被设置为第0行。ca始终被显示器清除，并且其显示效果与cd对应，当显示ca=1时，cf可以进行合成，使用显示器的cd和fif0指定的随机清除存储器格式进行清除。此时显示器的随机访问存储器的状态已经被清除。cd插孔还可以重新设置同步内部的时序。显示期间将自动清除随机存取访问存储器(约16us)。无法被重写。同时，在此期间，fifo的最高有效位设置为"1"。当显示广告的随机存取访问存储器再次恢复可用时，它将自动进行重置。

中断结束/出错方式设置

命令代码：111 E X X X X X=任意

当一个阵列传感器，该命令使IRQ线变低，并且允许写入随机存取存储器(通过位置传感器的变化来检测，IRQ线可具有增加的，这样做防止了信息写入再次随机存取存储器之前其复位)。在 N 键电路模式下，如果 E 位被编程为"1"，芯片电路将以特殊的错误模式运行。

主要用于检查 N 键巡视模式特殊错误模式下的多次按键。如果在一个反弹周期内按下两个键，则可以视为同时多次按下，并建立一个错误标志以防止进一步写入 FIF0，并设置中断(如中断设置)。错误进行标志设计可以被 FIFO 状态字命令读取，CF =1的清除命令我们可以通过重置错误信息标志。

1. 锯齿波由两个单晶二极管bt和r1、r2、r3、w1和c1组成的单晶管张驰振荡器锯齿波产生，然后通过单晶管发射极跟随张驰振荡器将锯齿波输出。

2. 控制电势差(Uk)和锯齿波电势差与电子流的强度叠加，送至 v2基极。综合电势差是我们。当 Us>0(0.7)时，V2打开，Us <0，则 V2结束。

3. V2，V3和R8，R9，DW1流开关已经被组成，当基极电位差V2 Ube2>0(0.7)，V2被接通时，接近零电势差Ube3，V3被关闭，直流开关是打开。

4. 过零脉冲的控制输出由削波同步电源变压器晶闸管tb、整流桥变压器d1、r10和直流开关r11组成的削波整流桥同步变压器电源，它与直流开关的两个输出电势差一起分别用来控制v4和发射器的v5。只有当发射器的dc直流开关发射器打开时，v4才使发射器关闭，并且由于v4和发射器的v5基极电极与两个发射器之间存在一个工作电势差，因此它使发射器可以在此期间正常工作。当每次发射器的同步电势差过零时，v4关断，其集电极和输出存在一个正电势差，这就可以使得v5从发射器的截止开关开始接通，通过这个脉冲使同步变压器的输出触发一个过零脉冲，并且这个触发脉冲可以使变压器晶闸管t在需要发射器导通的时候导通。

直流开关导通时，连续正弦波控制电势差uk的大小决定了直流开关的导通持续时间的长短，这也直接决定了在电阻炉设定的直流开关周期内可以传导的直流开关周期和次数，因此，可以合理地调整直流开关输出的功率。显然，控制电势差uk越大，它可以传导的直流开关周期和次数越多，输出的功率越大，电阻炉的直流开关温度越高。相反，电阻炉的直流开关温度越低。

自动电炉闭环系统温度自动调节的基本设计思想是在热电炉系统中自动添加温度传感器和相应的温度自动控制器。温度传感器的温度调节基本功能主要是通过检测自动热电炉的实际工作温度，将其信号转换为电势差的控制信号，并且我们比较了电炉相应温度控制装置uk的电势差。这种差异的变化大小(e=uk-uft)和电势差变化的方向(即e是正还是负)由温度控制器沿晶闸管相反的输入控制方向自动设置，以便温度控制器的输出信号控制导晶闸管接通的方向和长度。直流晶闸管开关的输入控制接通的时间，使得在一定温度和时间内的设置，晶闸管的输入控制接通电流频率有所增加或流量减少，而使得电炉的相应直流温度控制装置有所频率增加或流量减少。利用这种电势差控制温度的方法，可以在很小的电势差范围内自动改变炉温，并且控制精度高。

方案二：为了更好地可以有效简化控制电路，采用先进的单片机恒温控制技术可以作为一个恒温控制系统和企业的核心单片机来进行设计本文的课题。温度传感器ds18b20用于对温度传感信号的采集。方案二控温的基本设计思想主要是：通过传感器采集的电阻丝温度与单片机标准传感器温度的差值，控制恒温发热系统中电阻丝的数量和持续时间，从而最终达到对恒温发热系统控制的主要目的。控温方案二的单片机设计电路框图结构如下图所示：

![2.2方案二设计框图](http：//my gunplan.top/static/003.jpg)

本解决方案以先进的单片机为温度控制的核心，利用温度传感器自动采集计算机温度，通过传感器采集的计算机温度与单片机标准传感器设定计算机温度之差的距离来测量和控制温度，使得温度始终保持在单片机标准传感器设定的温度。该解决方案设计制作成本低，可靠性高，非常适用于计算机系统的动态控制性能和系统稳定性对温度要求不是很高的应用场合。

## 3.4传感器接口电路设计

### 3.4.1温度数据采集电路

ds18b20是基于dallassemiconductorcorporation的一个网络数字温度传感器。与其他的温度传感器连接方式相比，ds18b20具有以下的功能：当网络连接到如上所述微处理器的唯一单线路的接口模式中，只有一个端口可以被用于直接实现一个微处理器和ds18b20之间的双向通信的线路。

ds18b20支持独立的多点温度网络。几个节点ds18b20可以仅在三条线上通过并联进行连接，以方便地实现基于互联网的多点温度的测量。ds18b20不一定需要外围的组件。所有的传感器集成元件和温度信号转换集成电路都可以像普通的晶体管一样直接集成在单个温度集成电路中。传感器的温度测量范围一般为55〜125°c，温度集成电路测量的固有温度和分辨率范围为0.5°c。温度测量的结果直接传感器输出一个9位数字的温度测量信号，并直接通过"初始化总线"接口串行发送到传感器的中央控制单元。同时，可以直接发送crcr的温度校验码，具有较强的温度抗干扰和自动纠错的功能。温度测量的结果以9位数字的模式串行传输。

尽管ds18b20具有简单的嵌入式温度自动测量和控制系统，较高的分辨率和温度测量的精度，方便的网络连接以及较少的线路和资源占用等诸多优点，但在实际的应用中还是应该充分考虑以下的几个方面：

1. 尽管操作系统的硬件很简单，但我们还是需要相对复杂的软件处理器来对其进行温度补偿。由于ds18b20与其他微处理器之间的读写串行编程需要数据同时传输，因此必须注意保证在读写串行编程期间的连续读写编程时间，否则将是无法对读取进行温度补偿测量的结果。

2. ds18b20的可靠性相关数据未提及任何连接到单个总线的微处理器ds18b20的数量。这很容易就会导致一个错误的假设，即微处理器可以在总线上连接任意数量的总线ds18b20，而在实际的应用中并非如此。如果一条单个总线上微处理器连接了8个以上的总线ds18b20，则几乎没有必要考虑解决单个总线微处理器的可靠性和总线驱动问题以及我们在设计多点温度控制和测量传感器系统时所需要注意和考虑的一些问题。

3. 连接长度的限制是指采用连接长度为ads18b20的信号总线的电缆。由于它具有信号电缆的稳定性和电子电缆的阻挡比较大等特性，如果距离太大，信号传输幅度也会有所降低。如果在测试中普通信号电缆的双绞线传输电缆的长度明显地超过50m，则表示温度降低或读取数据不正确。如果将普通信号总线的电缆改为带屏蔽普通信号电缆的数据传输双绞线，则正常的总线通信数据传输距离应该可以轻松地达到150m。

ds18b20提供两种不同类型的器件封装：pr-35和pdsoic。引脚的顺序排列如下下表3.1所示。该软件封装操作系统中实际上已经使用了基于pr-35软件包的封装工具包。尽管如此，dds18b20仅用于提供一个返回9位温度数字的一个温度测量值，如如下图3.1.2所示。

管脚管脚定义说明

：-：：-：：-：

8脚SOIC 3脚PR-35

21 GND地

12 I/O 数据输入

83 VCC电源

34567 NC空脚

表3-1 DS18B20管脚排列

图3.1.2ds18b20温度值的表示计算方法

d9为低字节的符号位，0为正，1为负，高字节(d10~d15)的其他位用二进制符号位的补码或扩展位形式进行了表示;d0~d8为数据位，以二进制数据位的补码或扩展形式进行表示。如下表3.2显示了数值与温度之间的非线性关系。

温度测量数据(二位位十六进制)数据(十六进制)

：-：：-：：-：

+125000000001111101000FAH

+2500000000001100100032H

+0.500000000000000010001H

000000000000000000000H

+0.51111111111111111 FFFFH

-251111111111001110 FFCEH

-551111111110010010 FF92

表3.2 DS18B20值与温度的关系

由于房间的环境温度不能为负，因此系统不会考虑负温度。这样，您在选择硬件时就可以使用市售组件，而不必使用工业组件，从而可以大大降低成本。读取温度信息后，微控制器仅需要将低字节(D0〜D8)发送到主机和控制电路。

### 3.4.2发光二极管显示接口电气设计

选择的系统控制方式是四路开关室温动态实时传感器显示，显示精度0.1℃。具体的电路原理图所示如图3.2：

![3-2硬件电路图](http：//my.gunplan.top/static/3.2.png)

### 3.4.3发光二极管数码管

发光二极管显示器即为新型发光二极管显示器，具有数据显示醒目、成本低、配置灵活、接口可以方便等特点，单片机电源管理控制系统在应用数据管理操作系统的设计中常用它来直接显示电源管理操作系统的日常工作生活的状态和过程中所采集的数据在信息网络中所输入的数值等。

根据大屏幕发光点阵二极管的排列和结构不同，可将大屏幕发光点阵二极管显示器划分为大屏幕发光二极管点阵数码管和大屏幕发光二极管点阵数码显示器。大屏幕发光二极管点阵数码管主要就是用于在屏幕上显示英文数字和一些英文字母和图形符号，发光二极管点阵显示器同样可以在屏幕上显示英文数字、字母、男人和图形等。大屏幕发光点阵二极管数字点阵显示虽然点阵显示灵活，但它们主要占用的是单片微型计算机系统的软硬件资源比大屏幕发光二极管点阵数码管显示器要多得多。除了使用指定的程序，大屏幕发光点阵数码管显示器或led点阵显示器主要用于请求特殊的点阵显示场合，几乎所有的微型计算机系统应用点阵显示系统都使用大屏幕发光二极管数字点阵显示。

数字管理的显示系统主要有两种显示模式，包括静态数据管理显示程序模式和动态显示程序模式。静态数据管理显示的程序非常不复杂，静态数据管理显示系统的程序模式设计起来非常简单，占用cpu的内存时间很少。仅需要当系统的显示字符串发生更改时才可以调用动态显示程序。但是，硬件和集成电路很多。每个八位数字晶体管都至少必须需要一个8位i/o电源输出输入端口，一个8位限流电源输出驱动器和8个8位限流输出电阻。通常偶尔也可能会需要使用少量的圆形数码管。发光二极管的应用由于静态扫描显示器需要使用较少的电子管组件，并且需要使用更多的静态数字组件与电子管组件在显示器之间进行切换很麻烦。为了有效简化了电路并且大大降低了成本，系统设计使用了一种动态扫描数字显示的方法。

动态扫描显示模式的工作原理是分别打开每个显示器，即一次仅显示一位。为了使用户看到所有的显示器都已显示，必须加快每个显示器的照明周期(增加扫描频率)。通过使用人眼的视觉残留效果，可以实现与连续显示所有显示器相同的效果。动态扫描显示电路如图3.2.2所示：

![图3.2.2动态扫描图](http：//my.gunplan.top/static/003.jpg)

## 3.5 温度控制电路的设计

![图3.2.2温度控制电路](http://my.gunplan.top/static/3.3.png)

通过正确设置开关元件脉冲的宽度来我们可以控制三端双向的可控硅开关元件的开启和脉冲关闭。当伴随着脉冲宽度的增加(脉冲占空比增加)时，三端双向的可控硅开关元件的脉冲导通加热时间和温度延长，电阻丝的开关元件加热的时间也延长，温度也升高。相反，如果我们减小了脉冲的宽度(相当于减小脉冲占空比)，则双向可控硅的脉冲导通加热时间和温度缩短，电阻丝的开关元件加热时间和温度缩短，从而大大降低了元件的温度。

以此方法来控制温度的恒定不变。

## 3.6 脉宽调制

### 3.6.1 脉宽调制的介绍

pwm是高电平脉冲方波宽度调制的一个英文缩写。高比的方波的第一个时间段被简单地称为高电平的占空比，例如，一秒钟高电平和的50%1第二个是占空比的pwm波的脉冲宽度调制(pwm)的定义低电平在各种开关电源中被广泛使用的一个术语。。这个词是根据开关稳压的控制工作方式进行定义和分类的。除pwm混合型外，还有开关调制pfm型和脉宽调制pwm和一种pfm混合型。波的脉宽调制(pwm)的定义开关稳压电路的定义是在设计和控制开关稳压系统的电路设计中在输出的频率可以与低电平保持一个不变的频率情况下，通过电势差的反馈电路来控制和调节其输出的占空比，从而使使用者能够更好地达到维护社会稳定和发展控制输出电势差的主要目的。

脉冲信号宽度的调制(pwm)技术是一种非常有效的可以利用微处理器的模拟数字脉冲信号输出来实现控制和模拟集成电路的一种技术，它被广泛的应用于从电力测量，控制和无线通信系统到电力的智能转换许多应用领域。

### 3.6.2 基本原理

随着我国电子信息技术的发展，出现了多种 PWM 技术，包括：相电势差控制 PWM 、脉冲信号宽度 PWM 方法、随机 PWM 、 SPWM 方法、线电势差控制 PWM 等，然而，镍氢动力电池使用智能手机充电器设计采用的脉冲时间宽度 PWM 方法，以等脉宽的脉冲串作为 PWM 波形，通过不断改变一个脉冲串的周期可进行分析调制，可以同时通过这些改变传统脉冲的宽度或占空比来调节电势差，并且我们可以选择通过研究采用学生适当的控制管理方法来实现协调地改变电势差和频率。

模拟信号的时间值和分辨率可以通过不断的发展变化，对其时间和变化幅度的时间值和分辨率没有必要进行严格的限制。9v模拟信号电池同时也是一种智能模拟设备，因为它的输出电势差不完全一定等于9v，而是随着一定时间而变化，并且同时也可以取任何真实值。类似的地，从模拟信号电池内部吸收的电子流的数量和强度不可能局限于任何一组模拟信号可能的真实值范围。智能模拟信号和传统数字信号的最大区别主要在于后者的真实值范围只能在数字信号预定的任何一组可能的值内，例如，在{0v的电子集合中，5v}。

模拟电势差和收音机电子流的强度控制可直接地应用于扬声器的控制，例如模拟控制汽车和收音机的音量。在简单的控制模拟电势差和收音机中，音量旋钮通过连接扬声器得到可变电阻。当扬声器拧动音量旋钮时，电阻值随之变大或相应地变小;流过这个强度和电阻的电子流的强度也随之增大或相应地减小，从而通过改变扬声器驱动收音机和扬声器的电子流的强度和电阻值，使得音量旋钮相应地随之变大或相应变小。与其他无线电一样，模拟扬声器电路的音量输出与扬声器输入成一个线性的比例。

在简单的需要模拟一个立体声的收音机中，音量控制系统的旋钮与收音机连接时会用到一些可变电阻。其中之一的问题是由于模拟电路倾向于随时间进行漂移，因此难以进行调整。只有可以帮助解决这个复杂问题的精密模拟电路体积可以非常大，体积庞大(尤其是比如老式的家用立体声音量控制设备)和昂贵。精密模拟电路还可能产生严重的热量，其产生的功耗与电路中的工作元件两端的电势差与工作元件电子流的扰动强度的乘积大小成正比。精密模拟电路也肯定可能对于噪声敏感，任何的扰动或者产生的噪声都肯定可能会直接改变工作元件电子流的强度值。

通过对模拟控制电路进行数字控制，可以大量减少控制系统的设计成本和系统功耗的降低。此外，许多的微控制器和dsp已经在日本和中国的芯片上包含了dspwm控制器，这样就使得通过数字进行控制的设备实现自己的功能变得完全可以更加的具有容易。

脉冲宽度调制信号的设计思想

该对象的脉宽调制信号为方波，设定周期为1 s。它的产生将时间计数器设置为10 ms时序，然后通过寄存器R3控制脉冲宽度调制信号的周期。此主题仅具有模拟效果，并且对准确性没有过多要求，因此将1s周期划分为100。在相等的部分中，计时器设置为10 ms，计时器在R3中启动的频率为100。

寄存器r2中需要存储的数据是根据脉冲检测控制电路和数据控制电路进行转换的数字。r2中存储的数据值是用于分别控制一个脉冲系统的信号和1s内一个高电平的脉冲时间的长度。这样我们也就可以从寄存器的p2.6口检测得到用于定义一个周期可调和进行高电平的脉冲时间可调的寄存器来控制脉冲系统的信号。

### 3.6.4 脉宽调制信号的作用

脉冲宽度调制信号从P3.0端口输出。从P3.0端口输出的方波信号连接到三端双向可控硅开关的控制连接，以控制TRIAC的接通和关断。如果方波在一段时间内以高电平出现，则双向可控硅的占空比变长，即加热元件散发的热量更多。简而言之，加热元件释放的能级由方波在一个周期内变高的时间确定。

### 3.6.5 脉冲宽度调制优点

pwm的最大好处的其中之一个特点就是从信号处理器到受控系统的数字信号都是保持数字形式的，没有对数模信号进行的变换。这样保持了数字形式的数模信号最大限度地减少了噪声的产生和影响。数字噪声的大量产生主要是因为只有在其强度足以准确地阐述信号上升沿或信号下降沿跳变的强度时候，数字信号的稳定性才可能会被受到影响。

除了使用指定的程序，大屏幕可以使用点阵数字显示器或led数字显示器。为了请求特殊的显示场合，几乎所有的微型数字计算机或者应用显示系统都使用发光二极管进行数字显示。这些模拟信号可以转换到pwm信号可是它们可以大幅度地增加传输信号距离的范围和长度。在高频接收端，可以直接滤除经过调制的高频方波，并通过适当的rc或lc模拟网络将传输信号的频率恢复到最为模拟的形式。

总之，pwm不仅省钱、占地面积被大量使用节约、抗震和降低噪声的使用性能强，而且同时也成为是一种非常值得许多专业建筑工程师在许多不同类型的建筑设计和工业应用中广泛研究使用的有效解决技术。

 # 第4章 系统软件设计

在微机测控系统中，软件与硬件同样重要。硬件是系统的躯体，软件则是灵魂，当系统的硬件电路设计好之后，系统的主要功能还是要靠软件来实现，而且软件的设计在很大程度上决定了测控系统的性能。为了满足系统的要求，编制软件时一般要符合以下基本要求：  

1. 易理解性、易维护性。通常是指软件系统容易阅读和理解，容易发现和纠正错误，容易修改和补充。由于生产过程自动化程度的不断提高，测控系统的结构日趋复杂，设计人员很难在短时间内就对整个系统理解无误，软件的设计与调试不可能一次完成，有些问题是在运行中逐步暴露出来，这就要求编制的软件容易理解和修改。在软件的设计方法中，结构化设计是最好的一种设计方法，这种设计方法是由整体到局部，然后再由局部到细节，先考虑整个系统所要实现的功能，确定整体目标，然后把这个目标分成一个个的任务。任务中可以分成若干个子任务，送样逐层细分，逐个实现。本仪表就是采用这种模块化的设计方法。这样不但使得设计目标明确、思路清晰，而且在检错、调试时也很方便。当出现问题时，可以根据问题的种类和现象来判断是哪一部分出的问题，很容易找出故障所在和故障原因。同时，采用模块化程序结构设计方案，对于系统功能的扩充和修改也提供了很大的方便。
2. 实时性是电子测量系统的普遍要求，即要求系统及时响应外部事件的发生，并及时给出处理结果。近年来，由于硬件的集成度与运算速度的提高，配合相应的软件，实时性比较容易满足设计要求；
3. 准确性对整个系统具有重要意义，尤其是测量系统，系统要进行一定量的运算，算法的正确性和准确性对结果有着直接的影响，因此在算法的选择、计算的精度等方面都要符合设计的要求；
4. 可靠性是系统软件最重要的指标之一，作为能够稳定运行的系统，抗干扰技术的应用是必不可少的，最起码的要求是在软件受到干扰出现异常时，系统还能恢复正常工作。结合上述编制系统软件的基本要求，首先讨论软件的设计思想。

在微机测控系统中，软件的重要性与硬件设置同样重要。硬件是躯体，软件是灵魂，当系统的硬件电路确定之后，系统的主要功能还要靠软件来实现。如果说硬件决定了产品的造价，那么在硬件搭配合理的前提下软件在很大程度上就决定了产品的性能。

## 4.1 软件设计思想

为了满足系统的要求，编制软件时必须符合以下基本要求: 

易理解性、易维护性。通常是指软件系统容易阅读和理解，容易发现和纠正错误，容易修改和补充。由于生产过程自动化程度的不断提高，测控系统的结构日趋复杂，设计人员很难在短时间内就对整个系统理解无误，软件的设计与调试不可能。

一次完成，有些问题是在运行中逐步暴露出来，这就要求编制的软件容易理解和修改。在软件的设计方法中，结构化设计是最好的一种设计方法，这种设计方法是由整体到局部，然后再由局部到细节，先考虑整个系统所要实现的功能，确定整体目标，然后把这个目标分成一个个的任务。任务中可以分成若干个子任务，送样逐层细分，逐个实现。本仪表就是采用这种模块化的设计方法。这样不但使得设计目标明确、思路清晰，而且在检错、调试时也很方便。当出现问题时，可以根据问题的种类和现象来判断是哪一部分出的问题，很容易找出故障所在和故障原因。同时，采用模块化程序结构设计方案，对于系统功能的扩充和修改也提供了很大的方便。

实时性。实时性是本系统的基本要求。即要求系统及时响应外部事件的发生，并及时给出处理结果。近年来，由于硬件的集成度与速度的提高，配合相应的软件，实时性容易满足要求，特别是对于汇编语言编制的软件。  

1. 可测试性。系统软件的可测试性具有两方面的含义:其一是指比较容易地制定出测试准则，并根据这些准则对软件进行测定；其二是软件设计完成后，首先在模拟环境下运行，经过静态分析和动态仿真运行，证明准确无误后才可投入实际运行。  
2. 准确性。准确性对整个系统具有重要意义。系统要进行大量运算，算法的正确性和准确性问题对控制结果有直接影响，因此在算法选择、位数选择方面要适合要求。
3. 可靠性。可靠性是系统软件最重要的指标之一，它要求两方面的意义:第一是运行参数环境发生变化时，软件都能可靠运行并给出正确结果，也就是要求软件具有自适应性:第二是在环境恶劣干扰严重情况下，软件必须保证也能可靠运行，这对整个系统尤为重要。



## 4.2 软件组成

由于整个系统软件相对比较庞大，为了便于编写、调试、修改和增删，系统软件的编制采用了模块化的设计。即整个控制软件由许多独立的小模块组成，它们之间通过软件接口连接，遵循模块内部数据关系紧凑，模块之间数据关系松散的原则，按功能形成模块化结构。

系统的软件主要由主程序模块、数据采集模块、数据处理模块、控制算法模块等组成。主模块的功能是为其余几个模块构建整体框架及初始化工作；数据采集模块的作用是将A／D转换的数字量采集并储存到存储器中；数据处理模块是将采集到的数据进行一系列的处理，其中最重要的是数字滤波程序：控制算法模块完成控制系统的PID运算并且输出控制量。

下面就介绍本系统几个主要的程序模块。

## 4.3 程序结构分析

**主程序调用了4个子程序，分别是温度传感器读取程序，数码管显示程序、键盘扫描及按键处理程序、温度信号处理程序。**

* 键盘扫描电路及按键处理程序：实现键盘的输入按键的识别及进入相应的程序。
* 温度信号处理程序：对温度芯片送过来的数据进行处理，进行判断和显示。
* 数码管显示程序：向数码的显示送数，控制系统的显示部分。




## 4.4 数据处理模块

数据处理模块负责处理A／D转换后的数字量。其中最重要的环节是数字滤波，所以这里主要讨论系统采用的数字滤波程序。

###  4.4.1 数字滤波

模拟信号都必须经过A／D转换后才能为单片机接受，如果模拟信号受到扰动影响，将使A／D转换结果偏离真实值。因此仅仅对模拟量采样一次，我们是无法确定该结果是否可信的，必须经过多次采样，得到一个A／D转换的数据序列，通过某种处理后，才能得到一个可信度较高的结果。这种从数据序列中提取逼近真值数据的软件算法，通常称为数字滤波算法。

数字滤波克服了模拟滤波器的不足，它与模拟滤波器相比具有以下几个方面的优点:  

1. 由于数字滤波是用程序实现的，因而不需要增加硬件设备，而且可以多个输入通道共用一个滤波程序
2. 由于数字滤波不需要硬件设备，因而可靠性高、稳定性好，各回路之间不存在阻抗匹配等问题
3. 数字滤波可以对频率很低(如O．01HZ)的信号实现滤波，克服了模拟滤波器的缺陷，而且通过改

变数字滤波程序，可以实现不同的滤波方法或改变滤波参数，这比改变模拟滤波器的硬件要更灵活方便。

常用的数字滤波方法有程序判断滤波法、中值滤波法、算术平均滤波法、一阶滞后滤波法、去极值平均滤波法等等，下面简要介绍这几种数字滤波方法。

1. 程序判断滤波法首先要从经验出发，定出一个目标参数最大可能的变化范围。每次采样后都和上次的有效采样值进行比较，如果变化幅度不超过经验值，本次采样有效，否则，本次采样值应视为干扰而放弃，以上次采样值为准。该算法适用于变化缓慢的物理参数的采样过程，如湿度、液位等。
2. 中值滤波法对目标参数连续进行若干次采样，然后将这些采样进行排序，选取中间位置的采样值为有效值。对于变化较为剧烈的参数，此滤波方法不宜采用。
3. 算术平均滤波法是对目标参数进行连续采样，然后求其算术平均值作为有效采样值。该算法适用于抑制随机干扰。采样次数越大，平滑效果越好，但系统的灵敏度要下降。算术平均滤波不能将明显的脉冲干扰消除，只是将其影响削弱。

## 4.5 子程序设计

设计总体程序框图如下，总体程序由主程序，按键子程序，温度获取子程序三部分组成。  
读出温度子程序的主要功能包括初始化,判断DS18B20是否存在,若存在则进行一系列的读操,作若不存在则返回。

### 4.5.1 读出温度子程序

![图4-6 程序结构图](http://my.gunplan.top/static/4.2.1.PNG)

### 4.5.2 LED数码显示管程序

![图4-6 发光二级 数码显示管程序](http://my.gunplan.top/static/4.2.2.PNG)

### 4.5.3 键盘扫描及按键处理子程序

![图4-7  键盘扫描及按键处理子程序](http://my.gunplan.top/static/4.2.3.PNG)


## 4.6 显示处理

显示处理模块主要完成人机交互作用，具体实现将采样温度值、设定温度值以字符的形式通过液晶显示出来。本系统使用HTl621作为显示驱动器。HTl621是128点内存映象和多功能驱动器。附录中给出了显示处理模块的源程序。

# 第5章 系统软件调试

## 5.1 目测

1. 有无短路处。
2. 对照电路图看有无接错、漏接处。
3. 有无虚焊处。
4. 元件是否都对

## 5.2 硬件调试

首先应进行上电前的准备。为了防止硬件的损坏，应在电路板上电前进行电路检查，包括：对芯片的焊接方向进行检查，对芯片的引脚进行短路和断路检查。

在经过检查确认芯片的焊接没有任何问题的情况下，进行上电检查，在电源打开后，先判断电路是否存在异常，如出现芯片过热等现象，应及时切断电源，检查电路故障。在上电无异常状况的前提下，可以用万用表和示波器进行测量。首先测量电源芯片的输出电压是否正常，然后用示波器分别测量各个主要芯片电源引脚，察看电源的波形情况，如有纹波，则在预先留出的位置上焊上退耦电容以消除纹波，保证芯片工作正常。电源测量完毕后，进一步用示波器测量有源晶振的输出脚，其输出是频率为8MHz的波形(非方波，类似正弦波)。在确定晶振起振后，按住复位键，使单片机始终保持在复位状态，同时测量其各个引脚的电平情况，并同数据手册上表述的复位时的芯片引脚状态进行比对，由此可判断单片机是否正常。确认单片机正常之后就可以通过仿真器连接用户板进行调试。

## 5.3 软件的调试

由于软件的编写都是根据各个模块进行的，我们在进行软件的系统模拟调试时应，先确认硬件的接口标记是否在软件程序中一一对应，而且要检测所编写的软件有没有知识性的错误。在觉得基本没有问题后我们通过电脑将程序编译进入系统核心AT89S52单片机，检验软件与硬件各部分是否协调的工作。出现问题时我们要耐心的检查程序并作出适当的修改，直到软件系统的完全契合硬件电路，那我们软件就调试成功了。

1. 测试环境
   环境温度28摄氏度，室内面积20平方米
   测试仪器：数字万用表，温度计0----100摄氏度

2. 测试方法
   使系统运行，采用温度计同时测量室内度变化情况，得出系统测量的温度。

3. 测试结果
   设定温度由0摄氏度到40摄氏度
   标定温差<=1摄氏度   调节时间  15s（具体视现场情况）
   静态误差<=0.5摄氏度   最大超调量1摄氏度

4. 通过测试分析，对于实际室内的温度控制，可以再提出以下 2 点方法 :
   Ⅰ增加传感器个数，对各个温度传感器采集的数据进行求算术平均，可得到较为准确的温度值。
   Ⅱ对实际室内的温度控制，可采用功率较大的电炉，并且通过风扇对箱内温度进行充分搅和降温设备可采用空气压缩机等制冷设备。 

5. 通过实验测试和分析，发现虽然传感器的温度采集精度最高可得到 0.06 ℃，但测试得到的数据最小间隔为 0.03 ℃ 。通过分析，当对浮点数求平均处理时，遇到同一时刻两个传感头采集的温度相差不大，使 0.06 ℃ 时求出平均温度变为 0.03 ℃ 为了解该数据是否真实，可采用一个高精度的数字温度计测试，发现读出的值与其基本一致，由此推断如果在同一时间增加采集温度的个数，则可以进一步提高温度的精度。 

    

## 5.4 注意事项

1. 测驱动电路的过程中发现数码管不能正常显示的情况，经检验发现主要是由于接触不良的问题。其中包括线的接触不良和芯片的接触不良，在实验过程中，数码管有几段时隐时现。用万用表检测发现有线接触不良，重焊后就可正常显示。而芯片接触不良用万用表欧姆档检测有几个引脚本该相通的地方却未通，其解决方法为把芯片拔出正对万能板孔均匀用力插入。
2. 由于焊接时的大意损坏了元件，在调试是我们怎么都找不到问题的所在，我们是用排除法一个一个元件的测试的找出损坏的元件，重新换上新的元件，故障得以解决。
3. 还有关于程序调试过程中出现的问题。执行程序是发现程序执行不稳定，排除软件的错误外，经老师的指导才发现单片机的EA管脚没有接地。因为次程序只用到片内程序存储器，所以在程序执行时一定要把管脚接的，这样程序才能只执行片内的，不然程序会乱跳，从而导致程序执行不稳定。
4. 接三极管的过程中，发现电路不管程序是什么，数码管都是显示8字，经查除发现原来是三极管的极端弄错了，从新调整极端顺序。
5. 在电路调试时由于我们选用的是对射型的光电传感器由于没正对好使的调试一度中断，最后我们通过反复的调试解决了问题
6. 调试时由于线路的繁杂，没有仔细的找到对应部分的线路，使的调试的结果与预期出现很大的误差，我们通过梳理线路后就调试成功了并达到了预期的效果。
7. 在调试时几个模块的电路调试都不是很好，我们就要对线路的硬件连接做仔细的检查，调试的时候我们首先要确定连接的电路没有错误，各个元件管脚间没有虚连，那样我们的调试才会更顺利。# 结束语

这个最后的项目设计对我很有帮助的。这种设计使我对在大学学习的知识有了全面的了解和深入的思考，并让我对所学的知识以及思考和编写最终设计综合游戏的能力有所了解和提升。最后，我完成了这项任务。撰写论文的过程也是学习专业知识的过程的一个重要的阶段。它使我能够使用现有的专业基础知识来设计，分析和解决理论或实践问题，并将知识转化为实践技能培训。我已经掌握了运用自己的知识来解决实际问题的能力。

通过这个最终设计的结果，我发现只有提高理论水平，才能将教科书的知识和实践结合起来，理论知识可以为教学实践服务，以提高我的实践能力。这个设计非常有意义。我有很多经验。通过这个最后的项目，我们知道了理论与实践之间的距离，将理论与实践相结合的重要性，并且我们已经学到了很多我们无法从书本中学到的知识。

我们的学习不仅应以书籍为基础的限制，而且还应以解决理论和实践中的实际问题为目标和导向，而且还应结合实践去具体分析。理论问题是实践问题，问题解决是课程研究。学生本身就是作为专家来看待。用手解决问题比用大脑解决问题更深刻。学习应要求理论与实践相结合。理论问题也是实际问题。这种方法不仅有助于完成理论知识的巩固，而且将有助于推进实践，解决实际问题，并增强我们服务和解决问题的能力。

总的来说，这个最终的设计使我学到了很多东西。这是大学的最后也是最重要的一课。它对我们的未来产生深远的影响，具有十分重要的意义。





# 参考文献

[1] 李伯成.基于MCS-51单片机的嵌入式系统设计.电子工业出版社.2004  
[2] 宗光华,李大寨.多单片机系统应用技术.国防工业出版社.2003  
[3] 胡学海.单片机原理及应用系统设计. 电子工业出版社.2005  
[4] 孙育才,王荣兴,孙华芳.ATMEL新型AT89S52系列单片机及其应用.清华大学  
   出版社.2005  
[5] 于京,张景璐.51系列单片机C程序设计与应用案例.中国电力出版社.2006  
[6] 蔡杏山.Protel 99 SE 电路设计.人民邮电出版社. 2007  
[7] 杨小川.Protel DXP 设计指导教程. 清华大学出版社.2003  
[8]  李晓荃. 单片机原理与应用[M].  电子工业出版社，2000年8月  
[9]  何立民.  AVR单片机原理与接口技术[M]. 北京航空航天大学出版社，2002  
[10]  杨帮文. 新型继电器实用手册[M]. 北京人民邮电出版社.2004  
[11] 何希才.传感器及其应用电路[M].北京:电子工业出版社,2001.131-135  
[12] 丁镇生.传感器及传感技术应用[M].北京:电子工业出版社,1998.  
[13] 王家桢.传感器与变送器[M].北京:清华大学出版社,1996.  
[14] 曾巧媛.单片机原理及应用[M].北京：电子工业出版社.2002  
[15] 何力民.单片机高级教程[M].北京：北京航空大学出版社.2000  
[16] 金发庆.传感器技术与应用[M].北京：北京机械工业出版社.2000  
[17] Katsuhiko Ogata．Moden Control Engineering．Publishing house of electronics industry，2000：1 96—202.  
[18] Microchip 24C01B/02B 8 位PIC®单片机产品手册[ED/OL].  
[19] Borko H，Bernier C L．Indexing concepts and methods .New York:Academic .
[20] Dallas products data Book[M]，1999.  
[21] Maxim products data Book[M]，2001.  
[22] Shao Jianlong, He Chun. Design of a Portable Popular Multifunctional Development System for 8051 Single-chip Microprocessor Family [J].   Computer Engineering and Applications, 2003.13.
      




# 致 谢

本课题的完成中，我得到了很多人的帮助，在此表示衷心的感谢!

首先感谢我的指导老师高老师，我的课题是在他的指导和帮助下完成的，他深厚的理论功底和严谨的治学态度以及高度的敬业精神使我受益非浅，对我课题的完成起到了至关重要的作用。
经过这次毕业设计，使我觉得不论从理论知识还是从实际操纵中都学到了不少知识，我想归纳起来，主要有以下四个方面：  

* 经过这次毕业设计，它让我接触更多平时没接触的科学仪器设备、元器件以及获得相关的仪器调试经验，同时我也发现自己在这方面很多不足之处。体会到理论知识对实践有很大的知道作用，她让我知道，只有在正确的理论指引下，才能设计出合乎实际需要的硬件电路。
* 学会了高效率的查阅资料、运用工具书、医用网络查找资料。我发现，在我们所使用的书籍上有些知识在实际应用中其实不是十分理想，各种参数都需要自己去调整。偶尔还会遇到错误的资料现象，这就要求我们应更加注重实践环节。
* 在毕业设计中，我们应当注意重点与细节的关系。
* 失败不可怕，只要不趴下，昂首向前走，希望总会有的。
* 同组同学相互包容，彼此合作，取长补短，才能铸就最后的成功。可以说这次毕业设计是对所学知识的一次运用和检阅，同时对自学能力提出很高的要求，所以平时的学习离开思考，就是严重的错误，我们学习不应该有偏科现象，各方面知识都要接触，这样做才能为毕业设计打下基石。  

最后,我要感谢的母校东北石油大学大学,为我提供的良好的学习与发展环境。感谢我的指导教师高新成给予我帮助，感谢母校开放、公正的言论环境,现代、实用的学习环境,舒适、便捷的生活环境让我顺利度过了人生的关键三年。愿所有校园里认识的,不认识的；来过的,走过的……愿你们珍惜握在手里的现在,抓住机遇,拥有一个美好的明天。





# 附录一 程序

程序如下:

```assembly
TM_NUM EQU 23H
TM_L EQU 22H
TM_H EQU 21H
DSPBUF EQU 40H
DQ BIT P2.0
FLAG BIT 00H
ORG 0000H
AJMP MAIN
ORG 000BH
AJMP __INTT0__
ORG 30H
MAIN: MOV SP,#070H
      MOV TMOD,#02H
      MOV IE,#82H
      MOV TH0,#6
      MOV TL0,#6
      MOV R2,#04
      MOV R1,#40H
 LL1: MOV @R1,#00
      INC R1
      DJNZ R2,LL1
      SETB RS0
      MOV R2,#00
      MOV R3,#00
      MOV R4,#00
      MOV R5,#00
      MOV 6FH,#00H
      CLR RS0
      CLR P3.0
      MOV 30H,#02
      MOV 31H,#06
      MOV 32H,#0
      LCALL CHEWEN
__INSTANCE__:CLR TR0
      SETB P2.1
      JB P2.1,K3
      LCALL KKEY
   K3:CLR 01H
      MOV R2,44H
      CJNE R2,#00,K2
      SJMP K7
   K2:CPL P3.0
      MOV R3,#30
   K1:LCALL TM_DISP
      DJNZ R3,K1
      DJNZ R2,K2
   K7:MOV R2,45H
      CJNE R2,#00,K4
      SJMP K6
   K4:MOV R4,#255
  K44:CPL P3.0
      MOV R3,#30
   K5:LCALL TM_DISP
      DJNZ R3,K5
      DJNZ R4,K44
      DEC R2
      CJNE R2,#00,K4
  K6: CLR P3.0
      LCALL CHEWEN
      SETB TR0
MAIN2:JB 01H, __INSTANCE__
      LCALL TM_DISP
      SJMP MAIN2
CHEWEN:CLR RS1
       CLR RS0
      LCALL GET_TM
      LCALL TM_COV
      LCALL DTOB
      LCALL DTOB1
      CLR C
      MOV A,33H
      SUBB A,44H
      MOV 44H,A
      MOV A,34H
      SUBB A,45H
      MOV 45H,A
      RET

    __INTT0__:PUSH ACC
          PUSH B
          SETB RS0
          INC R2
          CJNE R2,#100,__JT0__
          INC 6FH
    
          MOV A,6FH
          CJNE A,#20,__JT0__
          MOV 6FH,#00H
          INC R3
          MOV R2,#00H
          CJNE R3,#2,__JT0__
          SETB 01H
          MOV R3,#00
    
     __JT0__: CLR RS0
          POP B
          POP ACC
          RETI


KKEY: MOV R2,#00
      MOV R4,#0AH
 KS2: LCALL TM_DISP
      DJNZ R4,KS2
      SETB P2.1
      JB P2.1,KKEY1
      JNB P2.1,$
      MOV 60H,#DSPBUF+1
      MOV R1,#DSPBUF+1
      MOV R2,#00
KEY1: LCALL TM_DISP_2
      MOV P2,#0FFH
      MOV A,P2
      ORL A,#01
      CPL A
      JZ KEY1

KEY2: JNB ACC.1,KEY3
      JNB P2.1,$
      INC R1

      INC R2
      CJNE R2,#03,L13
      MOV R1,#DSPBUF+1
      MOV R2,#00

 L13: MOV 60H,R1
      SJMP KEY1
KEY3: JNB ACC.2,KEY4
      JNB P2.2,$
      MOV A,@R1
      CJNE R1,#41H,L1
      CJNE A,#09,LL
      SJMP KEY5
  L1: CJNE R1,#42H,L2
      MOV A,@R1
      CJNE A,#09,LL
      SJMP KEY5
  L2: CJNE R1,#43H,L3
      CJNE A,#09,LL

KEY5: MOV @R1,#00
  L3: SJMP KEY1
  LL: INC A
      MOV @R1,A
  L6: SJMP KEY1
KEY4: JNB ACC.3,KEY1
      JNB P2.3,$
      MOV 30H,41H
      MOV 31H,42H
      MOV 32H,43H
      ACALL DTOB
KKEY1:RET

     DTOB:SETB RS0
          SETB RS1
          MOV A,31H
          MOV B,#10
          MUL AB
          ADD A,32H
          MOV 33H,A
          MOV 34H,#00
          MOV R6,30H
          CJNE R6,#00,JT2
          SJMP JT22
     JT2: MOV A,33H
          ADD A,#100
          MOV 33H,A
          MOV A,34H
          ADDC A,#00
          MOV 34H,A
          DJNZ R6,JT2
     JT22:CLR RS1
          CLR RS0
          RET

  DTOB1:  SETB RS0
          SETB RS1
          MOV A,42H
          MOV B,#10
          MUL AB
          ADD A,43H
          MOV 44H,A
          MOV 45H,#00
          MOV R6,41H
          CJNE R6,#00,JJT2
          SJMP JJT22
    JJT2: MOV A,44H
          ADD A,#100
          MOV 44H,A
          MOV A,45H
          ADDC A,#00
          MOV 45H,A
          DJNZ R6,JJT2
   JJT22: CLR RS1
          CLR RS0
          RET
WR_18B20: MOV R2,#08H
         CLR C
         SETB DQ
         MOV R3,#02H
         DJNZ R3,$
         NOP
    WR1: CLR DQ
         MOV R3,#03H
         DJNZ R3,$
         RRC A
         MOV DQ,C
         MOV R3,#20
         DJNZ R3,$
         SETB DQ
         MOV R3,#03H
         DJNZ R3,$
         DJNZ R2,WR1
         SETB DQ
         RET
RD_18B20: MOV R4,#02H
          MOV R1,#22H
     RE0: MOV R2,#08H
     RE1: CLR C
          SETB DQ
          NOP
          CLR DQ
          NOP
          NOP
          SETB DQ
          MOV R3,#01H
          DJNZ R3,$
          MOV C,DQ
          MOV R3,#010H
          DJNZ R3,$
          RRC A
          DJNZ R2,RE1
          MOV @R1,A
          DEC R1
          DJNZ R4,RE0
          RET
INI_18B20: SETB DQ
           NOP
           CLR DQ
           MOV R4,#150
           DJNZ R4,$
          ;LCALL TM_DISP
          ;LCALL TM_DISP
           SETB DQ
      TS0: MOV R4,#19H
           JNB DQ,TS1
           DJNZ R4,TS0
           SJMP TS2
      TS1: SETB FLAG
           SJMP TS3
      TS2: CLR FLAG
           SJMP TS4
      TS3: ;LCALL TM_DISP
           MOV R4,#120
           DJNZ R4,$
      TS4: SETB DQ
           RET
DELAY8ms: MOV R6,#2H
      KL1: MOV R7,#80H

      KL2: DJNZ R7,KL2
          DJNZ R6,KL1
          RET

GET_TM: SETB DQ
    S1: LCALL INI_18B20
        JB FLAG,S2
        SJMP S1
    S2: MOV R4,#10H
        DJNZ R4,$
        MOV A,#0CCH
        LCALL WR_18B20
        MOV A,#44H
        LCALL WR_18B20
        MOV R4,#0ffH
    S3: LCALL TM_DISP
        DJNZ R4,S3
    S4: LCALL INI_18B20
        JB FLAG,S5
        SJMP S4
    S5: MOV A,#0CCH
        LCALL WR_18B20
        MOV A,#0BEH
        LCALL WR_18B20
        LCALL RD_18B20
        LCALL INI_18B20
        MOV R4,#10H
    S6: LCALL TM_DISP
        DJNZ R4,S6
    S7: RET
TM_COV: MOV A,#0F0H
        ANL A,TM_L
        SWAP A
        MOV TM_NUM,A
        MOV A,TM_H
        ANL A,#07H
        SWAP A
        ORL A,TM_NUM
        MOV TM_NUM,A
        MOV R0,#DSPBUF
        JNB 0FH,SING
        MOV @R0,#0BH
        CPL A
        CLR ACC.7
        ADD A,#01H
        MOV TM_NUM,A
        SJMP SING1
  SING: MOV @R0,#0AH
 SING1: MOV B,#10
        DIV AB
        INC R0
        MOV @R0,A
        INC R0
        MOV A,B
        MOV @R0,A
        INC R0
        MOV A,#00H
        JNB 13H,DOT1
        ADD A,#50
  DOT1: JNB 12H,DOT2
        ADD A,#25
  DOT2: JNB 11H,DOT3
        ADD A,#12
  DOT3: JNB 10H,DOT4
        ADD A,#6
  DOT4: MOV B,#10
        DIV AB
        MOV @R0,A
        RET
TM_DISP: CLR RS1
         CLR RS0
         MOV DPTR,#TAB
         MOV R0,#DSPBUF
         MOV B,#0FEH
         MOV R5,#04
   DIP1: MOV A,@R0
         MOV P0,#0FFH
         MOV P1,#0FFH
         MOVC A,@A+DPTR
         CJNE R5,#02,DIP2
         ANL A,#7FH
   DIP2: MOV P0,A
         MOV A,B
         MOV P1,A
         RL A
         MOV B,A
         LCALL DELAY8ms
         INC R0
         DJNZ R5,DIP1
         RET
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
TM_DISP_1: CLR RS1
         CLR RS0
         MOV DPTR,#TAB
         MOV R0,#DSPBUF
         MOV B,#0FEH
         MOV R5,#04
 DDIP4:  MOV A,R0
         MOV P0,#0FFH
         MOV P1,#0FFH
         CJNE A,60H,DDIP1
         MOV A,#0FFH
         SJMP DDIP3
  DDIP1: MOV A,@R0
         MOVC A,@A+DPTR
  DDIP3: CJNE R5,#02,DDIP2
         ANL A,#7FH
  DDIP2: MOV P0,A
         MOV A,B
         MOV P1,A
         RL A
         MOV B,A
         LCALL DELAY8ms
         INC R0
         DJNZ R5,DDIP4
         RET
 ;;;;;;;;;;;;;;;;;;;;;
 TM_DISP_2: MOV R4,#10H
  KS4: LCALL TM_DISP
      DJNZ R4,KS4
      MOV R4,#1FH
  KS5: LCALL TM_DISP_1
      DJNZ R4,KS5
      RET
TAB:
DB 0C0H,0F9H,0A4H,0B0H,99H,92H,82H,0F8H,80H,90H,0FFH,0CFH
END

```

# 附录二  硬件电路图

![图10-8 硬件电路图](http://my.gunplan.top/static/yj1.png)
# 摘 要

本设计基于基于STC89C52RC单片机的温度控制系统的工作原理和设计方法。本文介绍了控制系统的硬件部分，包括：温度检测电路，温度控制电路，显示电路。单片机处理信号线单片机对信号进行相应处理，以达到温度控制的目的。该文档还重点介绍了采用模块化结构的软件设计部分。介绍了该控制系统的硬件部分会在文中写出，包括的模块是：数字管显示程序，键盘扫描和按键处理程序，温度信号处理程序，继电器控制程序和过热报警程序。同时，还包括系统中复杂的电路设计等方式。主程序，读取温度子程序，键处理程序，LCD显示程序和数据存储程序。该控制系统可以实时存储相关的温度数据并记录当前的时间。系统程序主要包括主程序，读出温度子程序，处理轮转子程序，转换温度计算子程序、按键处理结构、LCD显示程序以及数据存储程序等。



**关键词：AT89C51，单片机 ，DS18B20温度芯片，温度控制**  



# Abstract

This design uses STC89C52RC single-chip microcomputer as the core of the working principle and design method of temperature control system. The temperature signal is collected by the temperature chip DS18B20 and transmitted to the single-chip microcomputer as a digital signal. This article introduces the hardware part of the control system, including: temperature detection circuit, temperature control circuit, display circuit. The single chip microcomputer processes the signals accordingly to achieve the purpose of temperature control. The single chip microcomputer processes the signals accordingly to achieve the purpose of temperature control. The paper also focouses on the software design part, which adopts a modular structure. The main modules are: digital tube display prog random access memory, keyboard scanning and key processing prog random access memory, temperature signal processing prog random access Memory, relay control prog, random access memory, and over-temperature alarm pr ocess. The control system can store relevant temperature data in real time and record the current time. The system prog random access memory mainly includes a main prog random access memory, a readout temperature subprog random access memory, a calculation temperature subprog random Access memory, a key processing prog random access memory, an LCD display prog random access memory, and a data storage prog random access memory.



----




# 第1章 绪 论

## 1.1 温度控制系统研究的目的和重要性

在人类历史上，环境温度起着极其重要的作用。环境温度是工业生产中最常见的工艺参数之一。每个物理变化和每个化学反应过程都与温度密切相关。因此，温度控制是生产自动化中的重要任务。随着社会的发展，科学技术的进步以及温度测量设备在各个领域的使用，智能化是现代温度控制系统发展的主要组成部分。尤其是近年来，温度控制系统已经应用于人们生活的各个方面，但是温度控制一直是一个尚未发展的领域，但这是一个与人类息息相关的世纪之久的问题。在这种实际情况下，温度控制系统的设计具有广阔的应用前景和重要性。

此结构是为室温控制系统设计的，控制对象是室温。温度控制通常用于日常生活和工业领域，例如用于冷室，洗澡池，酵母池，电源和其他地方的温度控制。过去，温度控制是手动进行的，没有给予足够的重视。实际上，在许多地方都必须很好地调节温度。鉴于此问题，此系统设计的目的是创建一个可使其自身适应设定温度的系统。它被广泛使用，功能强大，小巧美观，易于携带。这是一种实用且廉价的控制系统。

## 1.2 温度控制系统研究概况

国外对温度控制技术的研究始于1970年代。首先，使用模拟组合仪器来收集现场信息并执行指令，记录和控制。分布式控制系统出现在1980年代后期。目前正在开发用于计算机数据采集的控制系统的集成多因素控制系统。当前，温度测量和控制技术在全球不同国家中迅速发展，并且一些国家正在朝着完全自动化和无人值守的方向发展。

中国对温度测量和控制技术的研究相对较晚，始于1980年代。中国工程师和技术人员已经吸收了工业化国家对温度测量和控制技术的吸收，从而掌握了室内温度的微机控制技术。该技术仅限于控制环境中的单个温度因子。中国温度测控设备的计算机应用一般处于从消化吸收阶段，易应用阶段到实用化，全面应用阶段的过渡和发展。从技术上讲，大多数情况下都存在由单片机控制的单参数单回路系统，并且没有真正的集成多参数控制系统。与工业化国家相比，差距很大。我国温度测控的现状还远远没有达到工业化水平。生产中仍有很多困扰我们的问题。设备支持能力差，工业化程度低，环境控制落后，软件和硬件资源无法共享和可靠。缺点，例如不良性行为。

##  1.3 温度传感器技术

传感器技术是现代信息技术的主要内容之一，信息技术包括计算机技术、通信技术和传感器技术。计算机和通信技术发展极快，相当成熟，而传感器应用技术因为需要使用模拟技术，而模拟技术还有很多问题难以解决，因此传感器应用技术也有待进一步发展。为了适应现代科学技术的发展，世界总舵国家都把传感器技术列为现代的关键技术之一。通常将能把非电量转换为电量的器件称为传感器，其实质上是一种功能块，作用是将来自外界的各种信号转换成电信号。它是实现测试与自动控制系统的首要环节。如果没有传感器对原始参数进行精确可靠地测量，那么无论是信号转换或信息处理，或者最佳数据的显示和控制都将无法实现。 

温度传感器，使用范围广，数量多，居各种传感器之手。温度传感器的发展大致经历了以下三个阶段：传统的分立式温度传感器（含敏感元件），主要输能够进行非电量和电量之间的转换；模拟集成温度传感器/控制器；智能温度传感器。目前，国际上新型温度传感器正从模拟式向数字式、集成化、智能化及网络化的方向发展。温度传感器按传感器与被测介质的接触方式可分为接触式温度传感器和非接触式温度传感器两大类，其中，接触式温度传感器的测温元件与被测对象要有良好的热接触，通过热传导及对流原理达到热平衡，这个示值即为被测对象的温度。这种测温方法精度比较高，并可测量物体内部的温度分布。但对于运动的、热容量比较小的及对感温元件有腐蚀作用的对象，这种方法将会产生很大的误差。非接触测温的测温元件与被测对象互不接触。常用的是辐射热交换原理。此种测温方法的主要特点是可测量运动状态的小目标及热容量小或变化迅速的对象，也可测量温度场的温度分布，但受环境的影响比较大。 

温度传感器的发展大致可分为以下几种：  
1. 热电偶传感器。热点偶传感器是工业测量中应用最广泛的一种温度传感器，它与被测对象直接接触，不受中间介质的影响，具有较高的精度；测量范围广，可从-50℃～1600℃进行连续测量，特殊的热电偶如金,铁,镍,铬最低可测到-269℃，钨,铼最高可达2800℃。
2. 模拟集成温度传感器。采用硅半导体集成工艺制成的，因此亦称硅传感器或单片集成温度传感器。模拟集成温度传感器是在20世纪80年代问世的，它将温度传感器集成在一个芯片上、可完成温度测量及模拟信号输出等功能。模拟集成温度传感器的主要特点是：功能单一、测温误差小、价格低、响应速度快、传输距离远、体积小、微功耗等，适合远距离测温，不需要进行非线性校准，外围电路简单。
3. 光纤传感器。光纤测温技术可分为两类:全辐射测温法，单辐射测温法，双波长测温法，多波长测温法等。特点是：光纤挠性好、透光谱段宽、传输损耗低，无论是就地使用或远传均十分方便而且光纤直径小，可以单根、成束、Y型或阵列方式使用，结构布置简单且体积小。缺点是：测量起来困难,难于实现较高的精度，工艺比较复杂,且造价高，推广应用有一定困难。
4. 半导体吸收式光纤温度传感器。半导体吸收式光纤温度传感器是利用了半导体材料的吸收光谱随温度变化的特性实现的。一种传光型光纤温度传感器，是指在光纤传感系统中，光纤仅作为光波的传输通路，而利用其它如光学式或机械式的敏感元件来感受被测温度的变化。在这类传感器中，半导体吸收式光纤温度传感器是研究得比较深入的一种。
5. 智能温度传感器。智能温度传感器(亦称数字温度传感器）是在20世纪90年代中期问世的。它是微电子技术、计算机技术和自动测试技术（ATE）的结晶。目前，国际上已开发出多种智能温度传感器系列产品。智能温度传感器内部包含温度传感器、A/D传感器、信号处理器、存储器（或寄存器）和接口电路。有的产品还带多路选择器、中央控制器（中央处理单元）、随机存取存储器（随机存取存储器）和只读存储器（只读存储器）。智能温度传感器能输出温度数据及相关的温度控制量，适配各种微控制器（M中央处理单元），并且可通过软件来实现测试功能，即智能化取决于软件的开发水平。

随着科学技术的不断进步与发展，温度传感器的种类日益繁多，数字温度传感器更因适用于各种微处理器接口组成的自动温度控制系统具有可以克服模拟传感器与微处理器接口时需要信号调理电路和A/D转换器的弊端等优点，被广泛应用于工业控制、电子测温计、医疗仪器等各种温度控制系统中。其中，比较有代表性的数字温度传感器有DS18B20、MAX6575、DS1722、MAX6635等。相比较而言，传统的温度检测以热敏电阻为温度敏感元件，热敏电阻成本低，但需要后续信号处理电路，而且热敏电阻的可靠性相对较差，测量温度的准确度低，检测系统的精度差。数字式温度传感器的种类也不少，并且在实际工程设计中具有上述诸多优点。
# 第2章 系统总体方案设计

## 2.1 系统工作原理

单片机温度控制系统是以AT89C51单片机为控制核心，辅以采样反馈电路，驱动电路，晶闸管主电路对电炉炉温进行控制的微机控制系统。系统的原理框图如图2-1所示，其基本控制原理为: 用键盘将温度的设定值送入单片机，并在发光二极管显示，启动运行后，通过信号采集电路将温度信号采集到后，送入单片机系统进行PID 控制运算，将控制量输出，改变可控硅管的接通时间便可改变加热丝功率，以达到调节温度的目的控制电阻炉的加热。

当由于环境温度变化太剧烈或由于加热或降温设备出现故障，或者温度传感头出现故障导致在一段时间内不能将环境温度调整到规定的温度限内的时候，单片机通过三极管驱动扬声器发出警笛声。 

![图1-1 第一个方案](http://my.gunplan.top/static/1.0.0.PNG)

图1-1为第一个设计方案，该方案的工作原理简述如下：

1. 锯齿波是由单结晶体管BT和R1，R2，R3，W1和C1组成的张驰震荡产生，然后经射极跟随器V1、R4输出。
2.  控制电压（Uk）与锯齿波电压进行电流叠加后送到V2的基极，合成电压为Us，当Us>0（0.7）时V2导通，Us<0，则V2截止。
3.  由V2、V3以及R8、R9、DW1组成一直流开关，当V2基极电压Ube2>0(0.7)，V2导通，Ube3接近零电位，V3截止，直流开关导通。输出24V直流电压。
4.  过零脉冲的输出，由同步变压器TB，整流桥D1及R10，R11组成一削波同步电源，这个电源与直流开关的输出电压共同去控制V4与V5。只有当直流开关导通期间，V4截止，V4、V5基电极和发射极之间才有工作电压，才能工作在期间，同步电压每次过零时，V4截止，其集电极输出正电压，使V5由截止转导通，经脉冲变压器输出触发脉冲而此脉冲使晶闸管T在需要导通的时刻导通。

在直流开关导通期间使出连续的正弦波控制电压Uk的大小决定了直流开关导通时间的长短，也就决定了在设定周期内导通的周波数，从而可输出功率的调节。显然，控制电压Uk越大，则导通的周波数就越多，输出的功率也就越大，电阻炉的温度也就越高，反之，电阻炉的温度就越低。
闭环控制自动调温的基本指导思想是在系统中增设温度传感器和温度调节器，温度传感器的基本功能是检测电炉的实际温度，并变换成电压讯号和炉温控制电压Uk进行比较，根据两者差值的大小（Δe=Uk-Uft）和变化方向（即△e为正还是为负），通过调节器进行相反方向的调节，使调节器的输出控制直流开关导通时间的长短，从而使设定周期内晶闸管的导通周波数增大或者减小，相应的电炉温度升高一点或者减小一点。采取这种控制方式，可以使炉温在较小的范围内变化，控制精度高。
方案二：为了使得电路的简单化，采用单片机作为控制核心来设计本课题，温度信号采集使用温度传感器DS18B20，温度控制的基本思想为：通过采集到的温度与标准温度之间的差值来控制加热电阻丝的通电时间长短，从而起到恒温控制的目的。方案二的设计框图如下图所示：

![图1-2](http://my.gunplan.top/static/1.0.0.PNG)

本方案采用单片机作为控制核心，使用温度传感器进行温度采集，通过将采集到的温度与标准设定温度之间的差值进行温度控制，从而使得温度维持在标准设定温度。本方案设计成本低，具有具有较高的可靠性，对于系统动态性能与稳定要求不是很高的场合非常的合适。

单片机温度控制系统是以AT89C51单片机为控制核心，辅以采样反馈电路，驱动电路，晶闸管主电路对电炉炉温进行控制的微机控制系统。系统的原理框图如图2-1所示，其基本控制原理为: 用键盘将温度的设定值送入单片机，并在LED显示，启动运行后，通过信号采集电路将温度信号采集到后，送入单片机系统进行PID 控制运算，将控制量输出，改变可控硅管的接通时间便可改变加热丝功率，以达到调节温度的目的控制电阻炉的加热。

当由于环境温度变化太剧烈或由于加热或降温设备出现故障，或者温度传感头出现故障导致在一段时间内不能将环境温度调整到规定的温度限内的时候，单片机通过三极管驱动扬声器发出警笛声。

## 2.2 系统功能介绍

本设计是对房间温度进行检测与控制，设计的温度控制系统实现了基本的温度控制功能：当温度低于设定的温度时，系统自动通过PWM启动加热装置，使温度上升。当温度高于设定的温度时，停止加热。三位数码管及时显示温度，精确到小数点后一位。  
本文设计的温度控制系统具有如下功能：

1. 通过温度芯片DS18B20采集温度，并以数字信号的方式传送给单片机。
2. 四位数码管动态实时显示房间温度，显示精度0.10C。
3. 三个按键实现标准温度的设定。
4. 利用PWM实现温度的控制。



# 第3章系统硬件电路设计

![图3-1电路硬件图](http://my.gunplan.top/static/2.0.1.png)

该解决方案使用AT89C51为核心处理芯片，芯片DS18B20测量内部温度，通过发送信号传输总线到MCU，并且和一个4位LED显示管温度。偏差用于控制电阻丝导通/截止时间的长度。实现恒温控制的界面的最终想法是最终想法。

## 3.1 各模块设计

### 3.1.1 温度传感器电路

本文在课题教学研究中所采用的的温度传感器一般可以分为采用一个美国两个单线的四位数字小型环境温度传感器例如ds18b20。该稳压传感器4.7k##hz该传感器用于输出稳压信号的上和下拉稳压电阻直接通过连接输入到一个微控制器的一个p1.0引脚。

半导体温度传感器DS18B20产生Dalalas数字温度传感器，多并行总线技术。该器件在小型集成电路芯片上制造温度敏感的半导体器件、 A / D 转换器、存储器等。在对本设计中的温度传感器进行多次比较和考虑之后，选择了单线数字设备DS18B20，主要是由于以下原因：

1. 该检测系统的主要特点功能是：在一个允许温度范围的工作检测温度是-55℃〜+125℃，±0.5度的工作温度和在测量值的精度是5℃。温度函数转换器高精度。9至12变量，温度检测值数据可以被直接转换成一个串行16位的非二进制的或数字输出形式的数据输出;最大输入时间频率转变精度为12位测量精度转变为750ms;它们都可以通过一条数据线被直接供电，具有超低电源功耗。
2. 系统进行成本：由于我国计算机信息技术和微电子科学技术的发展，新型企业大规模集成电路设计越来越具有强大，体积变得小是越来越会发生的，价格也会下跌。DS18B20提交空间与普通晶体管之间几乎没有本质区别的，价格只有约$1。
3. 降低系统总线技术操作复杂度：由于设备ds18b20是单总线测量设备，微处理器与之进行接口时只不过需要至少占用在校学生一个模拟i/o口，一根模拟总线测量方式线就可以同时连接数十个设备ds18b20，温度管理进行总线测量方法完全无需任何模拟企业外部网络控制元件，因此，与传统模拟工业生物温度传感器中的网络系统相比，可以测量得到大大幅度增加以及减少系统布线调试次数，降低温度管理系统的技术复杂性，减少重大工程项目的基础建设工作量。
4. 减少系统的引线调试和日常维护：由于大量减少的系统引线数量可以不会引起一些小的事情，大量使用减少接线的工程数量，减少接线工程数量产生的引线施工成本量大大降低，系统的内部布线过程复杂度的降低调试和日常维护另一方面，因为系统引线接口数量的减少产生的故障数量大大下降，使得整个系统中的接口工作变得简单许多，给系统的日常调试工作带来更多方便，之所以认为dsl8820是全方位数字化的元器件，故障基本不会同时发生，干扰性的和可抗性强，因此为了让整个系统的在整个日常生活中而所进行需要保证正常工作的维护任务大大减少，为了更好保证系统可用性而所进行的日常维护相关工作保证正常系统运行的维护工作。

ds18b20温度控制系统传感器引线技术通常存在一个小的引线，引线上的数量通常是3，并且我们可以确定不在一个企业内部：一个单线程的数据网络信息传输包括系统总线数据端口vvdq、外部数据电源线vdd和公共网络地址总线端口gnd。ds18b20有2种直流供电的工作方法：其一种就是采用杜邦线的直流供电电压模式。此时，vdd被完全接地。当它开始产生能量空闲时，它通过内部一个电容器线路来让它存储剩余电量用从外部数据线路中获得剩余能量并用来让它完成整个温度功率转换，相应的当它完成整个温度功率转换的持续时间也会更长。在这种应用情况下，使用一个单片机的一个矩形i/o输出端口让它来自动拉起一个ds18b20总线。另一种模式是外部温度电源连接模式(vdd电源连接+5v)，完成外部温度变化测量的时候相应操作时间短。

在本设计项目中我也可以直接采用由大学生企业提供的并不在相关企业内部的各种电子信息流的流动强度及其发展计算方式等来进行设计实现。cds18b20传感器与驱动单片机的接口连接，其内部接口集成电路设计方案如软件图2-2所示。

![图2-2外部电路](http://my.gunplan.top/static/003.jpg)

### 3.1.2 通用键盘显示电路设计

![图2-3外部电路](http://my.gunplan.top/static/003.jpg)

所示，ale时钟脉冲可以作为一个时钟同步电路8279，从而与示意图的两个时钟脉冲同步。2-3。8279芯片的控制中断电路控制输出信号irqr连接到一个控制单片机的一个p1-1引脚。缓冲器输入地址是将寄存器中的a0连接输入到整个单片机的一个p2-5引脚，ae的缓冲信号则是连接到整个单片机的一个p2-6引脚。读写器和信号数据线缆分别和两个单片机的信号读写器和信号数据线缆来进行连接相连。8279芯片的外部数据传递运输线路由d0-d7与整个单片机的外部数据线直接相连进行相应的连接。

来自8279芯片和AT89C51芯片的许多信号是一致的，可以直接级联，这非常容易控制。8279芯片的8位数据线进行直接连接到AT89C51芯片的P0端口。读取和写入信号连接到89C51的读取和写入信号。 AT89C51锁存信号ALE连接到8279 CLK，在内部分频后，会产生一个公共的非外部时钟脉冲。8279芯片的端子请求信号由反相器反转，然后连接到AT89C51的P1.1端口。 AT89C51的三个可寻址寄存器只需要两个地址即可寻址，即命令/状态寄存器地址和数据寄存器的地址值。8279芯片中与地址相关的信号是A0和芯片选择信号。您的连接直接确定寄存器地址在哪里。一旦确定了硬件电路，就确定了寄存器的地址。

发光驱动二极管的色号发光驱动效率和显示颜色分别取决于每个制造商的材料，如果出现没有什么意外情况是可以使用egred色号，出现其他意外情况可以使用reyellow或是egreen色号。发光电子二极管又称发光电子二极管主要是利用智能电子技术通过测量管理系统控制测量仪表中简单而常用的进入输出一个控制装置，通常说它可以直接用于用来指示一个机器的工作状态或其他相关企业服务信息。具有系统功耗低、配置灵活、接口方便、价格低廉、使用寿命长、对各种电子管直流的流动强度和电势差异性要求低、易于手动实现连接多种电路等多大优点。

液晶电视显示器本身是被动电子显示器，它本身不向外调节发出一种具有一定粒子性的主动电磁波，只需向外调节其发出一种具有一定粒子性的被动电磁波的频率数量。目前，常用的彩色液晶信息显示器通常是根据中国的而液晶对于信息显示失真率的问题总是按克列拉斯效应的基本原理设计制成的，它通常可以通过同时获得一个位于黑色信息发展初始背景上的一个白色初始字符或一个白色初始背景上的一个黑色初始字符的方式显示不同信息形式。便携式检测仪器主要用于电力测量和分析控制和检测智能动力电池中的电力，考虑到低损耗功率的应用要求，经常我们需要同时使用的就是液晶电视显示器，重量轻，功耗低的而且体积小，因此，广泛作为采用的检测手段。但是必须需要借助外来的灯光进行显示。阴极红外射线图形显像管这种显示器虽然可以同时显示多种图形，但显示界面更复杂，成本更高。

在多路显示温度自动巡检仪中只要您需要同时显示4位的和数字两种形式的显示温度和检测路数，可以不必考虑使用某种价格较高的荧光阴极或红射线液晶显像管;4位数字发光光电二极管的实际工作频率电子在直流的波动强度一般为240ma左右，由于需要使用一个交流电源进行供电，足以完全提供四位发光光电二极管液晶显示器所使用需要的最大功率，对于四位发光光电二极管而言，仅有4位，体积也很小，这样比较符合发光光电二极管和四位液晶电视显示器的诸多性能特点，本检测系统建议选择四位发光光电二极管液晶显示器。

键盘设计是一组多按键的整体组合。其主要工作功能之一是实时控制操作系统的正常工作运行状态，向系统接口输入大量数据和发出命令。有两种键盘类型：标准编码数字键盘和非标准编码数字键盘。

除了单个按键之外，编码器的键盘系统还包括一个用于自动生成键码的多个硬件控制电路、抖动控制电路、多个击键和多个按键之间移动时的保护器等电路。每按一个数字键，就表示可以自动重新生成这个数字键的键码。同时还会产生一个脉冲控制信号，通知系统中央处理控制单元进行接收。这种单片键盘使用方便，接口使用程序简单，但由于需要使用更多的相关硬件集成电路，价格也会变得更高，一般来说单片机键盘应用在该系统中的应用不是非常多。

非按列编码数字键盘仅由按行矩阵排列和非按列排行矩阵两种形式的编码键盘所组成。按键的抖动作用主要是简单地停止连接或自动断开触点，按键的触点抖动、按键软件代码的自动形成和每个按键的自动识别都必须是由按键软件操作来自动完成的。由于其价格经济并且实用，在各种单片机硬件应用管理系统中已经得到广泛应用。

上述一系列比较之后，它应该是非编码键盘。

P0端口： P0端口为8位漏极级开路双向 I/O 端口，每个引脚可吸收8TTL 栅极电子流的强度。当端口 P1的引脚首次写入1时，它被定义为高阻输入。P0可用于非内部程序数据存储器，可以定义为数据/地址的第八位。在 FIASH 编程中，P0作为原始代码输入端口。检查 FIASH 时，P0输出原始代码，必须拉起 P0的外部。

端口设置p1：端口设置p1是一个8位双向模拟i/o输出端口，内部分别提供上或下拉输出电阻。端口强度p1缓冲区强度可以达到接收进入输出4ttl门口的电子负载流的最大强度。p1端口的写入管脚板在写入1后，内部拉高，可以直接作为数据输入。当一个端口上的p1从外部被下拉到低稳压电平时，它将达到输出一个电子到直流的最大强度，这可能是由于内部上压下拉。在执行可以被擦除的非读写数据存储器程序编程和数据验证程序过程中，p1端口通常作为第8个输入地址被程序接收。

p2端口：p2端口是它是一个内部上和下拉稳压电阻的8位双向模拟i/o端口。p2端口栅极缓冲器引脚可以用来接收和控制输出4个ttttl栅极缓冲电子的直流的缓冲强度，当一个端口缓冲p2被直接写入"1"时，其引脚被内部上和下拉栅极电阻拉高并可以用作缓冲输入。因此，当它被直接用作电流输入时，端口位于p2的引脚被外部电压拉低到位于输出端的电子负载流的最大强度。这可能是由于内部上下牵拉的原因缘故。当p2端口，用于外部执行程序数据存储器或外部程序数据处理存储器同时访问的16位数据地址，输出时的端口相当p28的8位地址。读出和存储写入外部输出数据时在存储器输入地址8时，p2端口作为输出数据内容在特殊寄存功能下的寄存器。p2端口在整个闪存硬件编程和数据验证系统工作期间使它可以同时接收高八位存储地址以及存储信号和闪存控制器在系统中的信号。

p3端口：p3端口引脚为8个双向直流i/o控制端口，带有内部上压下拉控制电阻，可同时接收和控制输出4个在tttl栅极上的电子到直流的最大强度。当两个p3端口开始写入"1"时，它们在内部被迅速拉升并达到高水平并且被用作信号输入。作为一个输入，由于外部下拉低，p3端口将由于上下下拉而达到输出一个电子负载流的最大强度(ill)。

p3端口如果可以使用作为at89c51的一些特殊控制功能的通用接口也是完全可以的，如下面列表所示：

管脚备选功能

：-：：-：

P3.0 RXD (串行输入)

P3.1 TXD (串行输出)

P3.2/INT0(外部中断0)

P3.3/INT1(外部中断1)

P3.4 T0(定时器0外部输入)

p3.5t1(外部微波信号定时器1外部微波信号发出输入)

P3.6/WR (外部数据存储器写门)

P3.7/RD (外部数据存储器读取频闪)

p3端口同时它也可以用来接收一些主要的可用于总线进行射频闪烁信号编程和射频编程性能验证的射频控制电路信号。

rst：振荡器的复位字节输入。当外部振荡微处理器重置为一个器件时，在两个机器工作周期内保持一个rst引脚的高电平。ale/prog：当振荡器访问一个企业外部的数据网络存储器时，使用网络地址锁存器引脚所允许的外部输出正脉冲信号的高电平来对锁存网络地址的位置和状态进行复位字节。此引脚主要用于在振荡器的闪存脉冲编程期间通过脉冲输入用于闪存编程的脉冲。在通常的，周期性脉冲输出的ale正脉冲信号的恒定脉冲频率大约为1/6振荡器的频率。因此，它们实际上可以跳过一个用作外部脉冲输出的周期性脉冲或跳过一个用于定时目的。但是应该注意的是每一次都需要指出的一点是，外部的数据存储器，这将被用于跳过一个新的ale脉冲。如果振荡器需要禁用一个alert的复位字节输出，可以在振荡器的sfr8eh地址上重新设置0。此时，ale只需要执行一个movr，movd指令为一个新的ale。另外，该引脚被略微拉高。如果外部微处理器在外部脉冲执行的状态ale禁止，则该引脚的设置无效。

psen：外部的应用程序例如数据包和存储器的编程代码包含指令集的选择和数据通门控制信号。在外部软件程序执行的指令代码流在提取中的指令外部程序中的数据流在存储器系统中的每个代码提取指令值在提取期间，每个外部程序机器执行周期有效两次/psen。但是，访问外部应用程序例如数据库和存储器时，这两个有效的/psen的控制信号通常可能不会同时一起出现。

ea/vpp：这是用于保证当/ea端口器继续工作保持低稳压电位，这期间的外部应用程序相同存储器(0000h-ffffh)，无论它的存储器类型是否与内部的应用程序相同存储器。需要特别注意，当外部应用程序开始使用加密的文件方法1时，/ea中的存储器端口会自动锁定内部以用于防止文件重置;同时当/ea端口的继续运行保持正常的最高位时，这里的内部应用程序没有内存。该引脚还同时可以作为用于在不对闪存进行编程期间用于应用12v值的闪存进行编程的备用电源(vpp)。

xtal1：反向控制电路主要用来进行控制振荡信号放大器的时钟输入和内部时钟输出是用来进行控制系统的内部时钟质量管理工作以及辅助系统控制反向电路的外部驱动控制器的输入。

XTAL2：来自反向振荡器的输出。

### 3.1.3 振荡器特性

xtal1和外部xtal2分别提供的是片内反相放大器的脉冲信号输入和振荡器输出。该系列反向放大器的设备可以直接配置为片内的振荡器。石晶振荡和陶瓷振荡均可广泛采用。如果放大器使用外部的时钟源脉冲驱动的设备，则放大器不应需要连接xtal2。对内部的时钟源脉冲信号的多余脉冲输入信号需要通过两频的分频脉冲触发，因此放大器对外部时钟源脉冲信号的所需脉冲的宽度没有严格的要求，但是必须注意保证时钟源脉冲的频率高低和电平的所需脉冲宽度。

### 3.1.4 芯片擦除

通过快速组合正确的两个锁定保存位芯片控制电阻信号并同时将它保持在比ale引脚低10ms，可以轻松快速完成整个程序pe-rom两个芯片控制阵列和三个用于锁定保存位的两个芯片控制电阻被擦除。在重复执行一个芯片用于锁定内存位置的电擦删删除的每个操作中，代码中的数据元组被允许重复执行写入"1"，并且必须在执行芯片锁存重复执行写入一个可编程非零时空函数存储器的字节之前，它才能重复执行此位电擦除后的操作。

此外，at89c51配备了固定的逻辑，可以从低频动态到零的频率静态，支持两种软件模式和可选的自动关机中断模式。系统在空闲时中央控制单元软件自动停止振荡器的工作。然而，随机存取的存储器，定时器，计数器，串行接口和振荡器中断系统继续保持正常工作。在这种关机中断模式下，将自动保存随机存取存储器的所有内容，并自动冻结振荡器，并自动停用所需要使用的其他硬件和芯片振荡器的功能，直到振荡器下一次所使用的硬件振荡器复位完成为止。

许多尚不了解51单片机的互联网用户会遇到以下问题：书籍和在线教程中的AT89S51是什么?8051、89C51等，但没听说过89S51。

在这里，剛刚刚入門的单片机新人应该先阐明一下单片机实际使用的一些产品和理念。mcs-51微控制器单片机是基于美国英特公司于1980年推出的一款单片机产品。其典型的产品理念为8031(芯片无内置的程序和存储器，实际的使用已从单片机市场上完全淘汰)，8051(通用芯片设计采用hmos，功耗为630mw，是89c51的5倍)日期根据实际的使用)。但是到目前为止，8751和其他的通用芯片产品仍然可能是完全兼容的，包括mcs-51核心处理器系列和微控制器(目前已全部停产89s51、89c51等)。在加州理工大学和计算机职业技术学校的单片机培训课程和文档中，mcs-51微控制器仍然可以用作基础理论和学习的一个重要代表。

在一些技术文档中，8051甚至被广泛称为是mcs-51系列中的mcu。8051是早期最典型的单片机代表。由于对mcs-51单片机的深刻历史意义，许多微控制器公司都推出了许多兼容这一系列的单片机，这也就意味着他们的内核确实已经存在于mcs-51。它已经成为8位微控制器的一个标准。

其他飞利浦公司的51mcu产品与51mcs-51核心处理器兼容。相同的微控制器程序，在每个飞利浦微控制器设计制造商的产品和硬件上所需要执行的程序和结果可能是相同的，例如，我们常说的89c51，如飞利浦的at89c51(已宣布停产)，89s51，飞利浦(简称飞利浦)和l公司的winbond(winbond)等。已停产的微控制器是飞利浦atmel公司的单片机和at89c51单片机。同时，许多微控制器功能在原始的基础上已经得到了很大的改进，例如b.时钟。闪存越好(程序中只读存储器的所有内容至少一次可以反复重写1000次)。对于只读存储器(一次只能写入)，at89c51的存储器性能远远地要优于8051。

关于目前的市场营销，pic单片机制造商阵营对89c51提出了强烈的质疑。89c51最严重的问题是存在技术缺陷之一就是添加更多isp(在线更新应用程序)的功能目前是不被认为能夠广泛使用的。因此需要通过添加更多isp功能等新功能之后才能在市场上继续使用。mcs-51图例。在这种的情况下，89s51取代了89c51。目前，89s51依然已经变成了单片机市场中大多数人民的选择之中的一个绝大部分。目前市场份额最大的atmel已经宣布停止了生产新的at89c51，将其产品改用全新的at89s51。89s51进行了一系列技术上的改进。89s51采用全新的0.35标注，可有效控制单片机制造基本的成本，改善产品功能，增强市场竞争力。89sxx可以成为兼容89cxx等51系列单片机的芯片。同时，atmel不再需要接受89c的大量订单。你在目前市场上所能看到的89c51实际上已经是atmel以前停止生产的大量库存。

## 3.2 AT89C51单片机简介

at89c51是一个os8-bit微处理器(fpeam只读存储器-flashprog随机存取只读存储器fpram和一个可自动擦除随机存取只读数据的存储器)，俗称嵌入式微控制器。该设计原件是采用基于atmel的高密度非易失性只读存储器的制造技术设计制造，与符合行业标准的atmcs-51指令集与输出引脚指令集是兼容的并可以一直连接到。由于多功能8位中央处理器和闪存指令集结合在一个独立的单芯片中，atmel的at89c51是一个高效的嵌入式微控制器，它为许多的嵌入式控制系统应用提供了一个灵活和廉价的解决方案。

![3-8硬件电路图](http://my.gunplan.top/static/3.2.png)

at89c51可由一个atmel公司的控制器在线进行编程，用于嵌入式温度数据采集和嵌入式数据通信。at89c51是一款低成本功耗、高性能的cmos8位嵌入式单片机，其中主要包含了可通过重复自动擦除1000次的闪存和具有8k字节的isp(指令系统内的prog随机存取程序和存储器matlable)的嵌入式闪存只读程序和存储器，该芯片元器件主要采用了基于atmel的一种高密度、非易失性的嵌入式存储技术设计制造，兼容了标准的mcs-53指令系统和80c51引脚的结构。该系列芯片元器件集成了一个通用的8位中央处理器和一个isp的嵌入式闪存存储单元，功能强大的微型嵌入式计算机的at89c51可以为许多嵌入式控制和管理系统的应用和分析指令系统的发展历程提供一些具有降低生产成本和经济效益的解决问题的方案。at89c51具有以下的特点：40针、4k字节闪存片上应用程序数据存储器、128字节随机存取应用程序数据存储器(随机存取数据存储器)、32个外部双向数据输入/外部输出(i/o)串行通信端口，5个串行中断优先级，2个串行中断优先级嵌套中断，2个16位的可编程定时计数器，2个全双工串行通信控制端口，watchdog(wdt)控制电路，片上时钟振荡器。

at89c51有三个并行的i/o口，p0：p0.0~p0.7，p1.0~p1.7，p2.0~p2.7。此外，当没有片上或外部存储器时，p0端口可以用作公共i/o的端口，当主机使用外部或片上存储器时，p0端口也可以直接用作地址数据线/端口或数据线。p1端口也可以直接作为一个通用的公共i/o端口，p1.0、p1.1、p1.5~p1.7也可以具有特殊的端口功能，如表3.4所示。当主机没有片外存储器时，p2端口可以直接用作公共的i/o端口，当主机使用外部存储器时，p2端口也可以直接用作高8位地址。

|引脚特殊功能

：-：：-：

P1.0 T2：定时器

P1.1 T2EX：定时器

P1.5 MOSI：用于在线编程(ISP)

P1.6 MOSI：用于在线编程(ISP)

P1.7 SCK：用于在线编程(ISP)

表3.4at89c51p1端口的特殊控制功能

引脚特殊功能

：-：：-：

P3.0 RXD (串行端口输入)

P3.1 TXD (串行端口输入)

P3.2 INT0(外部中断输入0)

P3.3 INT1(外部中断输入1)

P3.4 T0(定时器0外部输入)

p3.5t1(外部定时器1外部定时信号发出输入)

P3.6 WR (外部数据存储器写控制)

p3.7rd(外部的数据存储器对外部读取和控制)

表3.5 AT89C51 P3端口的特殊功能

这个房间的温度监控系统主要使用单片机进行通讯和温度检测。 P3.0接受DS18B20。 P0端口用于设计温度显示界面。微控制器和控制电路共享一个外部时钟，使用一个片上存储器并具有上电复位功能。单片机的最小系统如图3.2.1所示：

[图3.2.1 SCM 最小系系统(http：//my.gunplan.top/static/3.2.1.png)

## 3.3 8279芯片简介

### 3.3.1 引脚介绍

8279采用单5V电源供电，40脚封装。

DB0~DB7：双向数据总线，用来传送8279与中央处理单元之间的数据和命令。

clk：时钟的输入数据线，用于时钟产生的具有内部定时的时钟脉冲。

复位：复位输入线，复位后8279设置在字符显示的左输入端，两个按键锁定的设置为接触回弹式，程序需要将时钟输入线的预分频器信号设置为31，并且保证复位后的信号在高电平下有效。

CS：芯片选择输入线，低电平有效，CS 端低电平时单片机可读写8279

A0：缓冲区低地址。当 A0为高电平时，表示数据总线是命令或状态。当 A0低时，表示数据总线是数据总线。

研发：通过读取控制器将信号发送到输入数据总线，低电平有效，读出数据缓冲区，并将内部数据发送到外部数据总线。

WR：写信号输入线，低电平激活，读出缓冲器并将数据从外部数据总线写入8279的缓冲器。

RL2-140-VCCRL3-239-RL 1

CLK-338-RL 0

IRQ-437-CNTL/STB

RL4-536-SHIFT

RL5-635-SL 3

RL6-734-SL 2

RL7-833-SL 1

RESRT-932-SL 0

RD-1031-OUT B0

WR-1130-OUT B1

DB0-1229-OUT B2

DB1-1328-OUT B3

DB2-1427-OUT A0

DB3-1526-OUT A1

DB4-1625-OUT A2

DB5-1724-OUT A3

DB6-1823-BD

DB7-1922-CS

VSS-2021-A0

irq：中断请求的正确输出和执行，高级有效。在这种键盘自动中断工作模式下，当每次出现的从fifo/sensor随机存取的在该存储器中间没有任何数据时，中间的断线由一个低电平线转变为一个新的高电平，每次键盘中断时由从fifo/sensor随机存取的该存储器的所有数据被自动读出，断开的检测线路降至较低的水平。如果随机存取的存储器中仍然存有信息，该行将再次变为一个较高水平。在线路和传感器正常工作的模式下，每当随机检测到线路和传感器的信号发生变化时，中断线就可能会逐渐变高。

sl0~sl3：视频扫描线缆可用于实时连接和自动扫描任何按键或光开关、传感器或光阵列和触摸显示器或屏幕上的任何数字，可编程或支持视频可编解码。

rl0~rl7：按键返回扫描线通过按钮或传感器的开关与返回扫描线进行连接。上拉按压电路一般设置在相应的返回扫描线内部，以使返回线保持在高水平。只有当一次按压电路关闭时，相应的按键和返回线才会自动转变为一个低电平;当一次无按键闭合时，均保持在较高电平。

shift：这是换位驱动开关的主要功能。当一个换档电压开关自动闭合时，它被一个换位电压开关自动拉至较低的相位电压电流水平。同时在每当未按时接下一个好的换档电压开关时，换档电压开关的整个输入电压状态必须保持在一个好的高电平。在正常的自动键盘扫描模式下，按键自动关闭，按键的操作位置和自动换位键的开关和所输入的操作状态一起由自动键盘扫描存储。

cntl/stb：自动高电平电源关闭当用户打开一个cntl/stb的电源开关时，它将自动将其拉低，否则将始终无法保持一个好的高电平。对于所有使用鼠标键盘输入的操作模式，该行通常被用作选择控制输入。例如当用户按下按钮时，按钮的数据位置与所有控制输入状态的数据存储在一起的数据位置相同。在选通控制输入的模式下，通常需要选择它，并将按钮的数据位置存储在一个fifo随机存取的存储器中。

outa3〜outa0和一个outb3〜outb0：显示数据输出一个8位端口a和一个8位端口b。这两个端口之间既可以独立进行控制，也是一个可以单独视为8位的端口。

bd：使用数字数据空间的长度显示。此命令输出的一个信号结果可以直接用于在一个两位数字的字符转换期间进行显示一个空格，或者你也可以通过使用"显示空格"的一个命令行来控制一个信号在显示空格一个字符的转换空间进行显示。

VCC：+5V电源输入线。

VSS：地线输入线。

### 3.3.2 8279的编程方法

8279按其控制功能块的大小可以细分为：显示器和键盘控制功能块;工作和显示控制功能块;工作和控制处理器功能块;键盘控制接口和中央处理器功能块控制功能块主要包含手动控制和时间寄存器，定时和自动控制，扫描和计数器三个组成部分，它主要的功能是用于控制显示器和键盘的工作和显示控制功能块。

控制和时间数据寄存器：一种用于存储键盘和中央控制单元的通用编程语言控制命令。当8279中央处理器的程序人员确定了键盘和显示器的工作状态模式以及其他显示器工作的条件时，首先将命令键和控制数据放置在一个数据总线上，然后使用命令a0=1，wr=0cs=0并将所有的命令和键数据保存在wr沿边缘增加了控制和显示器的时间数据寄存器，并对其进行解码以方便创建适当的命令控制功能。

定时和计数器控制：它通常包含一个基本的键盘定时和计数器。第一个定时计数器控制是一个分频系数范围为2-31的预定时器。我们可以通过应用程序控制其预设的分频系数，以使内部的频率为100khz，这样的频率可能至少会导致5.1ms。包括键盘阵列扫描时间和10.3毫秒的反跳扫描时间。其他的计数器对该基本的频率扫描时间进行了划分，并为我们提供适当的键，行，键盘阵列扫描和显示键盘扫描时间。

扫描键盘计数器：用于扫描键盘的计数器主要有两种基本编码工作的模式。在基本编码计数器工作的模式下，计数器为键盘提供一个二进制的计数器。在外部软件输出引脚sl0-sl3之后，可以为用于扫描键盘的计数器提供二进制的扫描计数器功能，并在外部软件解码后进行显示。在此工作模式下，扫描键盘计数器对最低有效值的两位进行解码，并且输出引脚sl0-sl3输出1分之4的二进制解码信号，以对键盘的显示器和用于扫描键盘的二进制扫描计数器进行解码。

键盘功能块包括：返回缓冲区、键盘弹跳和控制、8x8 FIFO 传感器随机存取存储器、 FIFO/传感器随机存取存储器状态。

#### 返回抖动缓冲器与鼠标键盘的抖动反向起跳及抖动控制

八个返回行由返回缓冲区缓冲。在键盘工作模式下，逐个检测这些行，找出行键中已关闭的键。如果回弹电路检测到钥匙关闭，则等待10.3ms，然后记录钥匙是否仍然关闭。如果仍然关闭，则矩阵中 key 的行地址和列地址以及 SHIFT 和 CNTL 的状态一起发送到 FIFO 随机存取存储器，并且 FIFO 随机存取存储器中的数据格式如下：

D7 D6 D5 D4 D3 D2 D1 D0

CNTL SHIFT SCAN RET URN

数据的进行格式中，最高位为shicntl，次高位为shift状态，d5-d3来自不同的扫描线上电子的计数器，d2-d0来自中国传感器返回一个电子计数器，扫描线电子计数器和一个回扫线电子计数器的开关值分别可以直接反映正在输出被传感器按下开关键的行，列的开关值，如果在一个传感器的阵列中，返回行上的开关数据直接进入与正在输出被扫描的传感器阵列相对应的一个传感器随机存取电子存储器阵列中的行，这样，每个传感器开关的数量和位置直接被传感器反映为一个传感器随机存取电子存储器的开关位置。

#### FIFO/传感器随机存取存储器

8x8随机存取存储器是键盘模式和选通模式下的先进先出(FIFO)存储器。每条新的信息都是按顺序写的，然后按照写的顺序读出来。当传感器阵列扫描时，存储器被用作传感器随机存取存储器。此时，随机存取存储器中的每一行存储传感器阵列中相应行的状态。

#### FIF0/传感器随机存取存储器状态

在使用键盘或门控的错误模式下，fifo中的状态阵列跟踪信号表示fifo中的状态字符数注意它到底是"满"还是"空"，过多的传感器写入或读取被状态逻辑认为可能是错误，当传感器fifo不为空时，状态阵列跟踪逻辑就会提供一个用于中断传感器应用程序irq的信号。在特殊的传感器状态阵列扫描模式下，如果一个有效的传感器状态发生改变，irq信号可能是一个有效的传感器高电平。fifo表示状态字的低3位表示fifo模式中的传感器字符数，fu位表示一个fifo随机存取的存储器已满;o(超过donmn)du位表示超限错误，即传感器试图将另一个传感器的字符发送到完整的传感器fifo;u(done下)du位表示null错误，即传感器试图写入或读取空的传感器fifo。s/f有两种的含义：在特殊的传感器扫描模式下，s/f的含义是指一个传感器随机存取的存储器中至少可能包含一个指示传感器是否闭合的指示，在特殊的错误模式下，s/f位是一个传感器错误的标志，指示了是否传感器发生了多通道同时写入或关闭的错误，du位表示错误显示随机存取的存储器尚未完全可用，因为"清除显示"或"清除全部"的命令已经无法完成其他未被消除的操作。

显示随机寄存器块的功能块主要包括：16x8显示随机寄存器，16x8显示随机存取地址存储器，显示随机地址存取寄存器)

#### 显示随机存取存储器和显示寄存器

8279内部缓存显示器同样具有16x8的缓存形式自动显示随机存取的数据存储器，通过自动显示一个寄存器和两个四位端口0uta0-3，0utbo-3来自动显示刷新外部存储器的数据显示，显示器同样可以是使用的大都是8段数码管或者是白炽灯，也可以有外部显示器同样可以是使用的大都是8段管或数码管，显示随机存取的数据存储器也同样可以是使用的大都是16x8的形式显示缓存形式，也就是可以直接构成两个16x4的随机存取数据存储器的形式，显示随机存取的存储器字节可由中央处理单元存储器进行数据的读写，被处理单元读写的随机存取的存储器字节的读写地址由随机显示读写地址的寄存器进行指示.数据显示[地址寄存器保存当前中央处理单元存储器的读或写随机取出的存储器字节读写地址，以及正在随机显示着的那两个4位半字节的存储器地址，读写的地址由当前中央处理单元的命令[存储器编程]，也就是可以设置为每次处理单元读写后存储器地址自动加1的一种工作更新方式，在处理单元设置了正确的存储器工作更新方式后，显示随机存取存储器的数据也可由中央处理单元存储器读出，半字节存储器a和半字节b的存储器地址自动由8279更新，以适应由中央处理单元存储器送入的随机存取数据，a和b半字节可独立的送入，也就是可以单独作为一个字节的送入，随中央处理单元所需要设置的工作更新方式而定。

#### I/O 接口功能块

8279通过i/o缓冲器控制与四行中央处理部分控制单元的系统总线网络接口8279，i/o控制部分主要使用cs。a0，rd，wr和四行的中央处理部分控制单元8279之间的单向控制数据是交换的，数据和缓冲器信号是双向控制数据交换的通道，所述控制单元的信号和缓冲器是如下的双向控制数据交换之间的逻辑关系：

CS A0 WR RD 状态

\-----

10--中央处理单元从8279读状态

0101中央处理单元向8279写状态

10--中央处理单元从8279读数据

001-中央处理单元向8279写数据

1 X 数据缓冲区输出处于三种状态

x为任意数(0或1)

\###3.3.38279的操作

如前所述，8279可以完全适应各种手机键盘和电脑显示器的不同功能和工作的方式，由于8279中各个命令功能块的各种工作方式是完全可编程的，用户完全可以根据自己的工作要求，用向8279写命令字的各种编程方法对8279的各种工作方式和功能块进行编程，从上表中我们可以清楚地看出，只要执行命令cs=0同时wr=0=1，然后你们就可以将命令字写到8279，并在命令wr的上升沿将相应的命令程序驱动到8279。

对于中央处理器，8279只有两个端口地址，一个是用于查看和读写处理器的命令和数字的状态(cs=0，a0=1)，一个端口地址用于查看和读写处理器的数据(cs=0，a0=0)，但对于编程语言命令和字代码有很多类型。在8279中给出了区分学校和企业不同的温度命令字的方法主要是对处理器命令和字代码的高3位(d7，d6，d5)和低5位进行了分析和编码，而低5位主要是用于理解命令字的实际含义和教学内容。

#### 8279的编程命令

键盘/显示器方式设置

最高位最低位

--

命令代码000 D D K K K

其中DD为显示方式，KKK为键盘方式

DD的表示：

编码功能

\--

008个8位字符显示-左端传入

01168位字符显示-左输入

1088位字符显示-右输入

1116个8位字符显示-右端送入

所谓左端送

编码功能

\--

000编码扫描键盘-2键连锁

001译码扫描键盘-2键连锁

010编码扫描键盘-N键巡回

011译码扫描键盘-N键巡回

100编码扫描传感器阵列

101译码扫描传感器阵列

110选通输入，编码显示扫描

111选通输入，译码显示扫描

钥匙链和2，其中N是一个关键电路8279双键盘键被按下两次处理，编码和在两个扫描链轮和显示器被解码形成扫描扫描SL0-SL3。

程序时钟

命令代码001 P P P P P

此命令用于确定定时和分频控制中每个预标量的分频控制系数。命令代码ppppp功率系数可以直接形成一个数字2-31。预标准测量也可以在外部没有所述时钟预定频率的情况下来进行，所述基频，得到内部，如果100khz的选择的基本时钟预定频率，能够外部时钟获得与所述时钟频率预定的恢复时间扫描，分频相关的因子;在预定的复位时钟脉冲后100khz如果没有外部时钟被自动馈送到码31自动。

读FIF0/传感器随机存取存储器

命令代码：010 AI X A X =任意

该读取命令主要用于确定中央处理器选择需要读取后续操作的存储器对象分别是8279中的哪一个fif0/来自传感器随机存取的存储器，并且主要用于传感器确定8个随机存取的存储器字节阵列中的哪一个被传感器读取，其中第一个aaa表示中央处理器选择了需要后续读取的行，ai自动为该行添加1个相同的特征位，并且这两者在传统的键盘扫描模式下的数据是不存在直接相关的，对于每次传感器后续的读取8279，数据存储器会按照与传感器数据首次读取时输入的fif0相同的后续读取顺序自动将数据发送出去。从传感器的fifo开始读取所有数据进行后续的读取，直到传感器写入新的命令。在来自传感器随机存取阵列的实施例中，aaa传感器选择了一线来自传感器8个的随机存取的存储器行如果ai=1，来自传感器的下一次后续读取将被读的随机存取数据送到存储器的下一行。

读显示器随机存取存储器

命令代码：011 AI A A A A

中央处理控制单元对8279写此读取命令，则我们确定了一个中央处理控制单元以一个显示器随机存取的一个存储器位作为数据源缓存地址位来进行随机读取的操作，其中的aaaaa为一个显示器随机存取一个存储器的一个数据源缓存地址，ai的行为自动依次加1特征位，若其中ai=1，则每一次读取第一行随机存取的一个存储器之后[第一行行为显示器的数据地址]自动依次加1。

写显示器随机存取存储器

命令代码：100 AI A A A A

中央处理单元将此命令写入8279，它规定下一步将写入8279的显示随机存取存储器。寻址模式和自动加1功能与读显示随机存取存储器相同。

显示器写入禁止/空格

命令代码：101 X IW IW BL BL X=任意

A B A B

此显示命令主要用于同时屏蔽a或b两个显示端口的输出并重新显示其显示的区域。如果将其中两个显示端口用作两行4位的显示，则必须同时屏蔽4位之一，以使对方发送的信息不会直接影响另一半。iw是该端口被屏蔽的功能位。如果为显示端口设置了显示命令iw=1，则该显示端口被此命令所屏蔽。空格显示请特别注意，b0对应于c0和d0，而d0和bl是应于iwensei，则此显示端口将重新显示空格。如果要以单个8位的输出命令格式为该端口创建重新显示的区域，则必须为端口设置两个d0和bl的标志以使该端口的显示完全保持空白。

消除

命令代码：110 CD CD CD CF CA

此数据清除格式命令主要就是用于按一定的数据格式顺序进行数据清除，它显示随机存取器的数据格式存储器的两个fif0状态，其中a和cd分别用于指定一个需要进行清除的数据格式：

CD CD CD

0 X 全"0"(x为任意)

10 AB =16进制

1020(0 O 100000)

11全册"1"

当显示为"1"(或 CA =1)时，允许清除显示

cf显示器清除cd和fifo的状态(其中包括广告和中断)。如果显示cf=1，则显示器清除cd和fif0状态，并重置中断线。传感器直接随机访问存储器的显示也始终被设置为第0行。ca始终被显示器清除，并且其显示效果与cd对应，当显示ca=1时，cf可以进行合成，使用显示器的cd和fif0指定的随机清除存储器格式进行清除。此时显示器的随机访问存储器的状态已经被清除。cd插孔还可以重新设置同步内部的时序。显示期间将自动清除随机存取访问存储器(约16us)。无法被重写。同时，在此期间，fifo的最高有效位设置为"1"。当显示广告的随机存取访问存储器再次恢复可用时，它将自动进行重置。

中断结束/出错方式设置

命令代码：111 E X X X X X=任意

当一个阵列传感器，该命令使IRQ线变低，并且允许写入随机存取存储器(通过位置传感器的变化来检测，IRQ线可具有增加的，这样做防止了信息写入再次随机存取存储器之前其复位)。在 N 键电路模式下，如果 E 位被编程为"1"，芯片电路将以特殊的错误模式运行。

主要用于检查 N 键巡视模式特殊错误模式下的多次按键。如果在一个反弹周期内按下两个键，则可以视为同时多次按下，并建立一个错误标志以防止进一步写入 FIF0，并设置中断(如中断设置)。错误进行标志设计可以被 FIFO 状态字命令读取，CF =1的清除命令我们可以通过重置错误信息标志。

1. 锯齿波由两个单晶二极管bt和r1、r2、r3、w1和c1组成的单晶管张驰振荡器锯齿波产生，然后通过单晶管发射极跟随张驰振荡器将锯齿波输出。

2. 控制电势差(Uk)和锯齿波电势差与电子流的强度叠加，送至 v2基极。综合电势差是我们。当 Us>0(0.7)时，V2打开，Us <0，则 V2结束。

3. V2，V3和R8，R9，DW1流开关已经被组成，当基极电位差V2 Ube2>0(0.7)，V2被接通时，接近零电势差Ube3，V3被关闭，直流开关是打开。

4. 过零脉冲的控制输出由削波同步电源变压器晶闸管tb、整流桥变压器d1、r10和直流开关r11组成的削波整流桥同步变压器电源，它与直流开关的两个输出电势差一起分别用来控制v4和发射器的v5。只有当发射器的dc直流开关发射器打开时，v4才使发射器关闭，并且由于v4和发射器的v5基极电极与两个发射器之间存在一个工作电势差，因此它使发射器可以在此期间正常工作。当每次发射器的同步电势差过零时，v4关断，其集电极和输出存在一个正电势差，这就可以使得v5从发射器的截止开关开始接通，通过这个脉冲使同步变压器的输出触发一个过零脉冲，并且这个触发脉冲可以使变压器晶闸管t在需要发射器导通的时候导通。

直流开关导通时，连续正弦波控制电势差uk的大小决定了直流开关的导通持续时间的长短，这也直接决定了在电阻炉设定的直流开关周期内可以传导的直流开关周期和次数，因此，可以合理地调整直流开关输出的功率。显然，控制电势差uk越大，它可以传导的直流开关周期和次数越多，输出的功率越大，电阻炉的直流开关温度越高。相反，电阻炉的直流开关温度越低。

自动电炉闭环系统温度自动调节的基本设计思想是在热电炉系统中自动添加温度传感器和相应的温度自动控制器。温度传感器的温度调节基本功能主要是通过检测自动热电炉的实际工作温度，将其信号转换为电势差的控制信号，并且我们比较了电炉相应温度控制装置uk的电势差。这种差异的变化大小(e=uk-uft)和电势差变化的方向(即e是正还是负)由温度控制器沿晶闸管相反的输入控制方向自动设置，以便温度控制器的输出信号控制导晶闸管接通的方向和长度。直流晶闸管开关的输入控制接通的时间，使得在一定温度和时间内的设置，晶闸管的输入控制接通电流频率有所增加或流量减少，而使得电炉的相应直流温度控制装置有所频率增加或流量减少。利用这种电势差控制温度的方法，可以在很小的电势差范围内自动改变炉温，并且控制精度高。

方案二：为了更好地可以有效简化控制电路，采用先进的单片机恒温控制技术可以作为一个恒温控制系统和企业的核心单片机来进行设计本文的课题。温度传感器ds18b20用于对温度传感信号的采集。方案二控温的基本设计思想主要是：通过传感器采集的电阻丝温度与单片机标准传感器温度的差值，控制恒温发热系统中电阻丝的数量和持续时间，从而最终达到对恒温发热系统控制的主要目的。控温方案二的单片机设计电路框图结构如下图所示：

![2.2方案二设计框图](http：//my gunplan.top/static/003.jpg)

本解决方案以先进的单片机为温度控制的核心，利用温度传感器自动采集计算机温度，通过传感器采集的计算机温度与单片机标准传感器设定计算机温度之差的距离来测量和控制温度，使得温度始终保持在单片机标准传感器设定的温度。该解决方案设计制作成本低，可靠性高，非常适用于计算机系统的动态控制性能和系统稳定性对温度要求不是很高的应用场合。

## 3.4传感器接口电路设计

### 3.4.1温度数据采集电路

ds18b20是基于dallassemiconductorcorporation的一个网络数字温度传感器。与其他的温度传感器连接方式相比，ds18b20具有以下的功能：当网络连接到如上所述微处理器的唯一单线路的接口模式中，只有一个端口可以被用于直接实现一个微处理器和ds18b20之间的双向通信的线路。

ds18b20支持独立的多点温度网络。几个节点ds18b20可以仅在三条线上通过并联进行连接，以方便地实现基于互联网的多点温度的测量。ds18b20不一定需要外围的组件。所有的传感器集成元件和温度信号转换集成电路都可以像普通的晶体管一样直接集成在单个温度集成电路中。传感器的温度测量范围一般为55〜125°c，温度集成电路测量的固有温度和分辨率范围为0.5°c。温度测量的结果直接传感器输出一个9位数字的温度测量信号，并直接通过"初始化总线"接口串行发送到传感器的中央控制单元。同时，可以直接发送crcr的温度校验码，具有较强的温度抗干扰和自动纠错的功能。温度测量的结果以9位数字的模式串行传输。

尽管ds18b20具有简单的嵌入式温度自动测量和控制系统，较高的分辨率和温度测量的精度，方便的网络连接以及较少的线路和资源占用等诸多优点，但在实际的应用中还是应该充分考虑以下的几个方面：

1. 尽管操作系统的硬件很简单，但我们还是需要相对复杂的软件处理器来对其进行温度补偿。由于ds18b20与其他微处理器之间的读写串行编程需要数据同时传输，因此必须注意保证在读写串行编程期间的连续读写编程时间，否则将是无法对读取进行温度补偿测量的结果。

2. ds18b20的可靠性相关数据未提及任何连接到单个总线的微处理器ds18b20的数量。这很容易就会导致一个错误的假设，即微处理器可以在总线上连接任意数量的总线ds18b20，而在实际的应用中并非如此。如果一条单个总线上微处理器连接了8个以上的总线ds18b20，则几乎没有必要考虑解决单个总线微处理器的可靠性和总线驱动问题以及我们在设计多点温度控制和测量传感器系统时所需要注意和考虑的一些问题。

3. 连接长度的限制是指采用连接长度为ads18b20的信号总线的电缆。由于它具有信号电缆的稳定性和电子电缆的阻挡比较大等特性，如果距离太大，信号传输幅度也会有所降低。如果在测试中普通信号电缆的双绞线传输电缆的长度明显地超过50m，则表示温度降低或读取数据不正确。如果将普通信号总线的电缆改为带屏蔽普通信号电缆的数据传输双绞线，则正常的总线通信数据传输距离应该可以轻松地达到150m。

ds18b20提供两种不同类型的器件封装：pr-35和pdsoic。引脚的顺序排列如下下表3.1所示。该软件封装操作系统中实际上已经使用了基于pr-35软件包的封装工具包。尽管如此，dds18b20仅用于提供一个返回9位温度数字的一个温度测量值，如如下图3.1.2所示。

管脚管脚定义说明

：-：：-：：-：

8脚SOIC 3脚PR-35

21 GND地

12 I/O 数据输入

83 VCC电源

34567 NC空脚

表3-1 DS18B20管脚排列

图3.1.2ds18b20温度值的表示计算方法

d9为低字节的符号位，0为正，1为负，高字节(d10~d15)的其他位用二进制符号位的补码或扩展位形式进行了表示;d0~d8为数据位，以二进制数据位的补码或扩展形式进行表示。如下表3.2显示了数值与温度之间的非线性关系。

温度测量数据(二位位十六进制)数据(十六进制)

：-：：-：：-：

+125000000001111101000FAH

+2500000000001100100032H

+0.500000000000000010001H

000000000000000000000H

+0.51111111111111111 FFFFH

-251111111111001110 FFCEH

-551111111110010010 FF92

表3.2 DS18B20值与温度的关系

由于房间的环境温度不能为负，因此系统不会考虑负温度。这样，您在选择硬件时就可以使用市售组件，而不必使用工业组件，从而可以大大降低成本。读取温度信息后，微控制器仅需要将低字节(D0〜D8)发送到主机和控制电路。

### 3.4.2发光二极管显示接口电气设计

选择的系统控制方式是四路开关室温动态实时传感器显示，显示精度0.1℃。具体的电路原理图所示如图3.2：

![3-2硬件电路图](http：//my.gunplan.top/static/3.2.png)

### 3.4.3发光二极管数码管

发光二极管显示器即为新型发光二极管显示器，具有数据显示醒目、成本低、配置灵活、接口可以方便等特点，单片机电源管理控制系统在应用数据管理操作系统的设计中常用它来直接显示电源管理操作系统的日常工作生活的状态和过程中所采集的数据在信息网络中所输入的数值等。

根据大屏幕发光点阵二极管的排列和结构不同，可将大屏幕发光点阵二极管显示器划分为大屏幕发光二极管点阵数码管和大屏幕发光二极管点阵数码显示器。大屏幕发光二极管点阵数码管主要就是用于在屏幕上显示英文数字和一些英文字母和图形符号，发光二极管点阵显示器同样可以在屏幕上显示英文数字、字母、男人和图形等。大屏幕发光点阵二极管数字点阵显示虽然点阵显示灵活，但它们主要占用的是单片微型计算机系统的软硬件资源比大屏幕发光二极管点阵数码管显示器要多得多。除了使用指定的程序，大屏幕发光点阵数码管显示器或led点阵显示器主要用于请求特殊的点阵显示场合，几乎所有的微型计算机系统应用点阵显示系统都使用大屏幕发光二极管数字点阵显示。

数字管理的显示系统主要有两种显示模式，包括静态数据管理显示程序模式和动态显示程序模式。静态数据管理显示的程序非常不复杂，静态数据管理显示系统的程序模式设计起来非常简单，占用cpu的内存时间很少。仅需要当系统的显示字符串发生更改时才可以调用动态显示程序。但是，硬件和集成电路很多。每个八位数字晶体管都至少必须需要一个8位i/o电源输出输入端口，一个8位限流电源输出驱动器和8个8位限流输出电阻。通常偶尔也可能会需要使用少量的圆形数码管。发光二极管的应用由于静态扫描显示器需要使用较少的电子管组件，并且需要使用更多的静态数字组件与电子管组件在显示器之间进行切换很麻烦。为了有效简化了电路并且大大降低了成本，系统设计使用了一种动态扫描数字显示的方法。

动态扫描显示模式的工作原理是分别打开每个显示器，即一次仅显示一位。为了使用户看到所有的显示器都已显示，必须加快每个显示器的照明周期(增加扫描频率)。通过使用人眼的视觉残留效果，可以实现与连续显示所有显示器相同的效果。动态扫描显示电路如图3.2.2所示：

![图3.2.2动态扫描图](http：//my.gunplan.top/static/003.jpg)

## 3.5 温度控制电路的设计

![图3.2.2温度控制电路](http://my.gunplan.top/static/3.3.png)

通过正确设置开关元件脉冲的宽度来我们可以控制三端双向的可控硅开关元件的开启和脉冲关闭。当伴随着脉冲宽度的增加(脉冲占空比增加)时，三端双向的可控硅开关元件的脉冲导通加热时间和温度延长，电阻丝的开关元件加热的时间也延长，温度也升高。相反，如果我们减小了脉冲的宽度(相当于减小脉冲占空比)，则双向可控硅的脉冲导通加热时间和温度缩短，电阻丝的开关元件加热时间和温度缩短，从而大大降低了元件的温度。

以此方法来控制温度的恒定不变。

## 3.6 脉宽调制

### 3.6.1 脉宽调制的介绍

pwm是高电平脉冲方波宽度调制的一个英文缩写。高比的方波的第一个时间段被简单地称为高电平的占空比，例如，一秒钟高电平和的50%1第二个是占空比的pwm波的脉冲宽度调制(pwm)的定义低电平在各种开关电源中被广泛使用的一个术语。。这个词是根据开关稳压的控制工作方式进行定义和分类的。除pwm混合型外，还有开关调制pfm型和脉宽调制pwm和一种pfm混合型。波的脉宽调制(pwm)的定义开关稳压电路的定义是在设计和控制开关稳压系统的电路设计中在输出的频率可以与低电平保持一个不变的频率情况下，通过电势差的反馈电路来控制和调节其输出的占空比，从而使使用者能够更好地达到维护社会稳定和发展控制输出电势差的主要目的。

脉冲信号宽度的调制(pwm)技术是一种非常有效的可以利用微处理器的模拟数字脉冲信号输出来实现控制和模拟集成电路的一种技术，它被广泛的应用于从电力测量，控制和无线通信系统到电力的智能转换许多应用领域。

### 3.6.2 基本原理

随着我国电子信息技术的发展，出现了多种 PWM 技术，包括：相电势差控制 PWM 、脉冲信号宽度 PWM 方法、随机 PWM 、 SPWM 方法、线电势差控制 PWM 等，然而，镍氢动力电池使用智能手机充电器设计采用的脉冲时间宽度 PWM 方法，以等脉宽的脉冲串作为 PWM 波形，通过不断改变一个脉冲串的周期可进行分析调制，可以同时通过这些改变传统脉冲的宽度或占空比来调节电势差，并且我们可以选择通过研究采用学生适当的控制管理方法来实现协调地改变电势差和频率。

模拟信号的时间值和分辨率可以通过不断的发展变化，对其时间和变化幅度的时间值和分辨率没有必要进行严格的限制。9v模拟信号电池同时也是一种智能模拟设备，因为它的输出电势差不完全一定等于9v，而是随着一定时间而变化，并且同时也可以取任何真实值。类似的地，从模拟信号电池内部吸收的电子流的数量和强度不可能局限于任何一组模拟信号可能的真实值范围。智能模拟信号和传统数字信号的最大区别主要在于后者的真实值范围只能在数字信号预定的任何一组可能的值内，例如，在{0v的电子集合中，5v}。

模拟电势差和收音机电子流的强度控制可直接地应用于扬声器的控制，例如模拟控制汽车和收音机的音量。在简单的控制模拟电势差和收音机中，音量旋钮通过连接扬声器得到可变电阻。当扬声器拧动音量旋钮时，电阻值随之变大或相应地变小;流过这个强度和电阻的电子流的强度也随之增大或相应地减小，从而通过改变扬声器驱动收音机和扬声器的电子流的强度和电阻值，使得音量旋钮相应地随之变大或相应变小。与其他无线电一样，模拟扬声器电路的音量输出与扬声器输入成一个线性的比例。

在简单的需要模拟一个立体声的收音机中，音量控制系统的旋钮与收音机连接时会用到一些可变电阻。其中之一的问题是由于模拟电路倾向于随时间进行漂移，因此难以进行调整。只有可以帮助解决这个复杂问题的精密模拟电路体积可以非常大，体积庞大(尤其是比如老式的家用立体声音量控制设备)和昂贵。精密模拟电路还可能产生严重的热量，其产生的功耗与电路中的工作元件两端的电势差与工作元件电子流的扰动强度的乘积大小成正比。精密模拟电路也肯定可能对于噪声敏感，任何的扰动或者产生的噪声都肯定可能会直接改变工作元件电子流的强度值。

通过对模拟控制电路进行数字控制，可以大量减少控制系统的设计成本和系统功耗的降低。此外，许多的微控制器和dsp已经在日本和中国的芯片上包含了dspwm控制器，这样就使得通过数字进行控制的设备实现自己的功能变得完全可以更加的具有容易。

脉冲宽度调制信号的设计思想

该对象的脉宽调制信号为方波，设定周期为1 s。它的产生将时间计数器设置为10 ms时序，然后通过寄存器R3控制脉冲宽度调制信号的周期。此主题仅具有模拟效果，并且对准确性没有过多要求，因此将1s周期划分为100。在相等的部分中，计时器设置为10 ms，计时器在R3中启动的频率为100。

寄存器r2中需要存储的数据是根据脉冲检测控制电路和数据控制电路进行转换的数字。r2中存储的数据值是用于分别控制一个脉冲系统的信号和1s内一个高电平的脉冲时间的长度。这样我们也就可以从寄存器的p2.6口检测得到用于定义一个周期可调和进行高电平的脉冲时间可调的寄存器来控制脉冲系统的信号。

### 3.6.4 脉宽调制信号的作用

脉冲宽度调制信号从P3.0端口输出。从P3.0端口输出的方波信号连接到三端双向可控硅开关的控制连接，以控制TRIAC的接通和关断。如果方波在一段时间内以高电平出现，则双向可控硅的占空比变长，即加热元件散发的热量更多。简而言之，加热元件释放的能级由方波在一个周期内变高的时间确定。

### 3.6.5 脉冲宽度调制优点

pwm的最大好处的其中之一个特点就是从信号处理器到受控系统的数字信号都是保持数字形式的，没有对数模信号进行的变换。这样保持了数字形式的数模信号最大限度地减少了噪声的产生和影响。数字噪声的大量产生主要是因为只有在其强度足以准确地阐述信号上升沿或信号下降沿跳变的强度时候，数字信号的稳定性才可能会被受到影响。

除了使用指定的程序，大屏幕可以使用点阵数字显示器或led数字显示器。为了请求特殊的显示场合，几乎所有的微型数字计算机或者应用显示系统都使用发光二极管进行数字显示。这些模拟信号可以转换到pwm信号可是它们可以大幅度地增加传输信号距离的范围和长度。在高频接收端，可以直接滤除经过调制的高频方波，并通过适当的rc或lc模拟网络将传输信号的频率恢复到最为模拟的形式。

总之，pwm不仅省钱、占地面积被大量使用节约、抗震和降低噪声的使用性能强，而且同时也成为是一种非常值得许多专业建筑工程师在许多不同类型的建筑设计和工业应用中广泛研究使用的有效解决技术。

 # 第4章 系统软件设计

在微机测控系统中，软件与硬件同样重要。硬件是系统的躯体，软件则是灵魂，当系统的硬件电路设计好之后，系统的主要功能还是要靠软件来实现，而且软件的设计在很大程度上决定了测控系统的性能。为了满足系统的要求，编制软件时一般要符合以下基本要求：  

1. 易理解性、易维护性。通常是指软件系统容易阅读和理解，容易发现和纠正错误，容易修改和补充。由于生产过程自动化程度的不断提高，测控系统的结构日趋复杂，设计人员很难在短时间内就对整个系统理解无误，软件的设计与调试不可能一次完成，有些问题是在运行中逐步暴露出来，这就要求编制的软件容易理解和修改。在软件的设计方法中，结构化设计是最好的一种设计方法，这种设计方法是由整体到局部，然后再由局部到细节，先考虑整个系统所要实现的功能，确定整体目标，然后把这个目标分成一个个的任务。任务中可以分成若干个子任务，送样逐层细分，逐个实现。本仪表就是采用这种模块化的设计方法。这样不但使得设计目标明确、思路清晰，而且在检错、调试时也很方便。当出现问题时，可以根据问题的种类和现象来判断是哪一部分出的问题，很容易找出故障所在和故障原因。同时，采用模块化程序结构设计方案，对于系统功能的扩充和修改也提供了很大的方便。
2. 实时性是电子测量系统的普遍要求，即要求系统及时响应外部事件的发生，并及时给出处理结果。近年来，由于硬件的集成度与运算速度的提高，配合相应的软件，实时性比较容易满足设计要求；
3. 准确性对整个系统具有重要意义，尤其是测量系统，系统要进行一定量的运算，算法的正确性和准确性对结果有着直接的影响，因此在算法的选择、计算的精度等方面都要符合设计的要求；
4. 可靠性是系统软件最重要的指标之一，作为能够稳定运行的系统，抗干扰技术的应用是必不可少的，最起码的要求是在软件受到干扰出现异常时，系统还能恢复正常工作。结合上述编制系统软件的基本要求，首先讨论软件的设计思想。

在微机测控系统中，软件的重要性与硬件设置同样重要。硬件是躯体，软件是灵魂，当系统的硬件电路确定之后，系统的主要功能还要靠软件来实现。如果说硬件决定了产品的造价，那么在硬件搭配合理的前提下软件在很大程度上就决定了产品的性能。

## 4.1 软件设计思想

为了满足系统的要求，编制软件时必须符合以下基本要求: 

易理解性、易维护性。通常是指软件系统容易阅读和理解，容易发现和纠正错误，容易修改和补充。由于生产过程自动化程度的不断提高，测控系统的结构日趋复杂，设计人员很难在短时间内就对整个系统理解无误，软件的设计与调试不可能。

一次完成，有些问题是在运行中逐步暴露出来，这就要求编制的软件容易理解和修改。在软件的设计方法中，结构化设计是最好的一种设计方法，这种设计方法是由整体到局部，然后再由局部到细节，先考虑整个系统所要实现的功能，确定整体目标，然后把这个目标分成一个个的任务。任务中可以分成若干个子任务，送样逐层细分，逐个实现。本仪表就是采用这种模块化的设计方法。这样不但使得设计目标明确、思路清晰，而且在检错、调试时也很方便。当出现问题时，可以根据问题的种类和现象来判断是哪一部分出的问题，很容易找出故障所在和故障原因。同时，采用模块化程序结构设计方案，对于系统功能的扩充和修改也提供了很大的方便。

实时性。实时性是本系统的基本要求。即要求系统及时响应外部事件的发生，并及时给出处理结果。近年来，由于硬件的集成度与速度的提高，配合相应的软件，实时性容易满足要求，特别是对于汇编语言编制的软件。  

1. 可测试性。系统软件的可测试性具有两方面的含义:其一是指比较容易地制定出测试准则，并根据这些准则对软件进行测定；其二是软件设计完成后，首先在模拟环境下运行，经过静态分析和动态仿真运行，证明准确无误后才可投入实际运行。  
2. 准确性。准确性对整个系统具有重要意义。系统要进行大量运算，算法的正确性和准确性问题对控制结果有直接影响，因此在算法选择、位数选择方面要适合要求。
3. 可靠性。可靠性是系统软件最重要的指标之一，它要求两方面的意义:第一是运行参数环境发生变化时，软件都能可靠运行并给出正确结果，也就是要求软件具有自适应性:第二是在环境恶劣干扰严重情况下，软件必须保证也能可靠运行，这对整个系统尤为重要。



## 4.2 软件组成

由于整个系统软件相对比较庞大，为了便于编写、调试、修改和增删，系统软件的编制采用了模块化的设计。即整个控制软件由许多独立的小模块组成，它们之间通过软件接口连接，遵循模块内部数据关系紧凑，模块之间数据关系松散的原则，按功能形成模块化结构。

系统的软件主要由主程序模块、数据采集模块、数据处理模块、控制算法模块等组成。主模块的功能是为其余几个模块构建整体框架及初始化工作；数据采集模块的作用是将A／D转换的数字量采集并储存到存储器中；数据处理模块是将采集到的数据进行一系列的处理，其中最重要的是数字滤波程序：控制算法模块完成控制系统的PID运算并且输出控制量。

下面就介绍本系统几个主要的程序模块。

## 4.3 程序结构分析

**主程序调用了4个子程序，分别是温度传感器读取程序，数码管显示程序、键盘扫描及按键处理程序、温度信号处理程序。**

* 键盘扫描电路及按键处理程序：实现键盘的输入按键的识别及进入相应的程序。
* 温度信号处理程序：对温度芯片送过来的数据进行处理，进行判断和显示。
* 数码管显示程序：向数码的显示送数，控制系统的显示部分。




## 4.4 数据处理模块

数据处理模块负责处理A／D转换后的数字量。其中最重要的环节是数字滤波，所以这里主要讨论系统采用的数字滤波程序。

###  4.4.1 数字滤波

模拟信号都必须经过A／D转换后才能为单片机接受，如果模拟信号受到扰动影响，将使A／D转换结果偏离真实值。因此仅仅对模拟量采样一次，我们是无法确定该结果是否可信的，必须经过多次采样，得到一个A／D转换的数据序列，通过某种处理后，才能得到一个可信度较高的结果。这种从数据序列中提取逼近真值数据的软件算法，通常称为数字滤波算法。

数字滤波克服了模拟滤波器的不足，它与模拟滤波器相比具有以下几个方面的优点:  

1. 由于数字滤波是用程序实现的，因而不需要增加硬件设备，而且可以多个输入通道共用一个滤波程序
2. 由于数字滤波不需要硬件设备，因而可靠性高、稳定性好，各回路之间不存在阻抗匹配等问题
3. 数字滤波可以对频率很低(如O．01HZ)的信号实现滤波，克服了模拟滤波器的缺陷，而且通过改

变数字滤波程序，可以实现不同的滤波方法或改变滤波参数，这比改变模拟滤波器的硬件要更灵活方便。

常用的数字滤波方法有程序判断滤波法、中值滤波法、算术平均滤波法、一阶滞后滤波法、去极值平均滤波法等等，下面简要介绍这几种数字滤波方法。

1. 程序判断滤波法首先要从经验出发，定出一个目标参数最大可能的变化范围。每次采样后都和上次的有效采样值进行比较，如果变化幅度不超过经验值，本次采样有效，否则，本次采样值应视为干扰而放弃，以上次采样值为准。该算法适用于变化缓慢的物理参数的采样过程，如湿度、液位等。
2. 中值滤波法对目标参数连续进行若干次采样，然后将这些采样进行排序，选取中间位置的采样值为有效值。对于变化较为剧烈的参数，此滤波方法不宜采用。
3. 算术平均滤波法是对目标参数进行连续采样，然后求其算术平均值作为有效采样值。该算法适用于抑制随机干扰。采样次数越大，平滑效果越好，但系统的灵敏度要下降。算术平均滤波不能将明显的脉冲干扰消除，只是将其影响削弱。

## 4.5 子程序设计

设计总体程序框图如下，总体程序由主程序，按键子程序，温度获取子程序三部分组成。  
读出温度子程序的主要功能包括初始化,判断DS18B20是否存在,若存在则进行一系列的读操,作若不存在则返回。

### 4.5.1 读出温度子程序

![图4-6 程序结构图](http://my.gunplan.top/static/4.2.1.PNG)

### 4.5.2 LED数码显示管程序

![图4-6 发光二级 数码显示管程序](http://my.gunplan.top/static/4.2.2.PNG)

### 4.5.3 键盘扫描及按键处理子程序

![图4-7  键盘扫描及按键处理子程序](http://my.gunplan.top/static/4.2.3.PNG)


## 4.6 显示处理

显示处理模块主要完成人机交互作用，具体实现将采样温度值、设定温度值以字符的形式通过液晶显示出来。本系统使用HTl621作为显示驱动器。HTl621是128点内存映象和多功能驱动器。附录中给出了显示处理模块的源程序。

# 第5章 系统软件调试

## 5.1 目测

1. 有无短路处。
2. 对照电路图看有无接错、漏接处。
3. 有无虚焊处。
4. 元件是否都对

## 5.2 硬件调试

首先应进行上电前的准备。为了防止硬件的损坏，应在电路板上电前进行电路检查，包括：对芯片的焊接方向进行检查，对芯片的引脚进行短路和断路检查。

在经过检查确认芯片的焊接没有任何问题的情况下，进行上电检查，在电源打开后，先判断电路是否存在异常，如出现芯片过热等现象，应及时切断电源，检查电路故障。在上电无异常状况的前提下，可以用万用表和示波器进行测量。首先测量电源芯片的输出电压是否正常，然后用示波器分别测量各个主要芯片电源引脚，察看电源的波形情况，如有纹波，则在预先留出的位置上焊上退耦电容以消除纹波，保证芯片工作正常。电源测量完毕后，进一步用示波器测量有源晶振的输出脚，其输出是频率为8MHz的波形(非方波，类似正弦波)。在确定晶振起振后，按住复位键，使单片机始终保持在复位状态，同时测量其各个引脚的电平情况，并同数据手册上表述的复位时的芯片引脚状态进行比对，由此可判断单片机是否正常。确认单片机正常之后就可以通过仿真器连接用户板进行调试。

## 5.3 软件的调试

由于软件的编写都是根据各个模块进行的，我们在进行软件的系统模拟调试时应，先确认硬件的接口标记是否在软件程序中一一对应，而且要检测所编写的软件有没有知识性的错误。在觉得基本没有问题后我们通过电脑将程序编译进入系统核心AT89S52单片机，检验软件与硬件各部分是否协调的工作。出现问题时我们要耐心的检查程序并作出适当的修改，直到软件系统的完全契合硬件电路，那我们软件就调试成功了。

1. 测试环境
   环境温度28摄氏度，室内面积20平方米
   测试仪器：数字万用表，温度计0----100摄氏度

2. 测试方法
   使系统运行，采用温度计同时测量室内度变化情况，得出系统测量的温度。

3. 测试结果
   设定温度由0摄氏度到40摄氏度
   标定温差<=1摄氏度   调节时间  15s（具体视现场情况）
   静态误差<=0.5摄氏度   最大超调量1摄氏度

4. 通过测试分析，对于实际室内的温度控制，可以再提出以下 2 点方法 :
   Ⅰ增加传感器个数，对各个温度传感器采集的数据进行求算术平均，可得到较为准确的温度值。
   Ⅱ对实际室内的温度控制，可采用功率较大的电炉，并且通过风扇对箱内温度进行充分搅和降温设备可采用空气压缩机等制冷设备。 

5. 通过实验测试和分析，发现虽然传感器的温度采集精度最高可得到 0.06 ℃，但测试得到的数据最小间隔为 0.03 ℃ 。通过分析，当对浮点数求平均处理时，遇到同一时刻两个传感头采集的温度相差不大，使 0.06 ℃ 时求出平均温度变为 0.03 ℃ 为了解该数据是否真实，可采用一个高精度的数字温度计测试，发现读出的值与其基本一致，由此推断如果在同一时间增加采集温度的个数，则可以进一步提高温度的精度。 

    

## 5.4 注意事项

1. 测驱动电路的过程中发现数码管不能正常显示的情况，经检验发现主要是由于接触不良的问题。其中包括线的接触不良和芯片的接触不良，在实验过程中，数码管有几段时隐时现。用万用表检测发现有线接触不良，重焊后就可正常显示。而芯片接触不良用万用表欧姆档检测有几个引脚本该相通的地方却未通，其解决方法为把芯片拔出正对万能板孔均匀用力插入。
2. 由于焊接时的大意损坏了元件，在调试是我们怎么都找不到问题的所在，我们是用排除法一个一个元件的测试的找出损坏的元件，重新换上新的元件，故障得以解决。
3. 还有关于程序调试过程中出现的问题。执行程序是发现程序执行不稳定，排除软件的错误外，经老师的指导才发现单片机的EA管脚没有接地。因为次程序只用到片内程序存储器，所以在程序执行时一定要把管脚接的，这样程序才能只执行片内的，不然程序会乱跳，从而导致程序执行不稳定。
4. 接三极管的过程中，发现电路不管程序是什么，数码管都是显示8字，经查除发现原来是三极管的极端弄错了，从新调整极端顺序。
5. 在电路调试时由于我们选用的是对射型的光电传感器由于没正对好使的调试一度中断，最后我们通过反复的调试解决了问题
6. 调试时由于线路的繁杂，没有仔细的找到对应部分的线路，使的调试的结果与预期出现很大的误差，我们通过梳理线路后就调试成功了并达到了预期的效果。
7. 在调试时几个模块的电路调试都不是很好，我们就要对线路的硬件连接做仔细的检查，调试的时候我们首先要确定连接的电路没有错误，各个元件管脚间没有虚连，那样我们的调试才会更顺利。# 结束语

这个最后的项目设计对我很有帮助的。这种设计使我对在大学学习的知识有了全面的了解和深入的思考，并让我对所学的知识以及思考和编写最终设计综合游戏的能力有所了解和提升。最后，我完成了这项任务。撰写论文的过程也是学习专业知识的过程的一个重要的阶段。它使我能够使用现有的专业基础知识来设计，分析和解决理论或实践问题，并将知识转化为实践技能培训。我已经掌握了运用自己的知识来解决实际问题的能力。

通过这个最终设计的结果，我发现只有提高理论水平，才能将教科书的知识和实践结合起来，理论知识可以为教学实践服务，以提高我的实践能力。这个设计非常有意义。我有很多经验。通过这个最后的项目，我们知道了理论与实践之间的距离，将理论与实践相结合的重要性，并且我们已经学到了很多我们无法从书本中学到的知识。

我们的学习不仅应以书籍为基础的限制，而且还应以解决理论和实践中的实际问题为目标和导向，而且还应结合实践去具体分析。理论问题是实践问题，问题解决是课程研究。学生本身就是作为专家来看待。用手解决问题比用大脑解决问题更深刻。学习应要求理论与实践相结合。理论问题也是实际问题。这种方法不仅有助于完成理论知识的巩固，而且将有助于推进实践，解决实际问题，并增强我们服务和解决问题的能力。

总的来说，这个最终的设计使我学到了很多东西。这是大学的最后也是最重要的一课。它对我们的未来产生深远的影响，具有十分重要的意义。





# 参考文献

[1] 李伯成.基于MCS-51单片机的嵌入式系统设计.电子工业出版社.2004  
[2] 宗光华,李大寨.多单片机系统应用技术.国防工业出版社.2003  
[3] 胡学海.单片机原理及应用系统设计. 电子工业出版社.2005  
[4] 孙育才,王荣兴,孙华芳.ATMEL新型AT89S52系列单片机及其应用.清华大学  
   出版社.2005  
[5] 于京,张景璐.51系列单片机C程序设计与应用案例.中国电力出版社.2006  
[6] 蔡杏山.Protel 99 SE 电路设计.人民邮电出版社. 2007  
[7] 杨小川.Protel DXP 设计指导教程. 清华大学出版社.2003  
[8]  李晓荃. 单片机原理与应用[M].  电子工业出版社，2000年8月  
[9]  何立民.  AVR单片机原理与接口技术[M]. 北京航空航天大学出版社，2002  
[10]  杨帮文. 新型继电器实用手册[M]. 北京人民邮电出版社.2004  
[11] 何希才.传感器及其应用电路[M].北京:电子工业出版社,2001.131-135  
[12] 丁镇生.传感器及传感技术应用[M].北京:电子工业出版社,1998.  
[13] 王家桢.传感器与变送器[M].北京:清华大学出版社,1996.  
[14] 曾巧媛.单片机原理及应用[M].北京：电子工业出版社.2002  
[15] 何力民.单片机高级教程[M].北京：北京航空大学出版社.2000  
[16] 金发庆.传感器技术与应用[M].北京：北京机械工业出版社.2000  
[17] Katsuhiko Ogata．Moden Control Engineering．Publishing house of electronics industry，2000：1 96—202.  
[18] Microchip 24C01B/02B 8 位PIC®单片机产品手册[ED/OL].  
[19] Borko H，Bernier C L．Indexing concepts and methods .New York:Academic .
[20] Dallas products data Book[M]，1999.  
[21] Maxim products data Book[M]，2001.  
[22] Shao Jianlong, He Chun. Design of a Portable Popular Multifunctional Development System for 8051 Single-chip Microprocessor Family [J].   Computer Engineering and Applications, 2003.13.
      




# 致 谢

本课题的完成中，我得到了很多人的帮助，在此表示衷心的感谢!

首先感谢我的指导老师高老师，我的课题是在他的指导和帮助下完成的，他深厚的理论功底和严谨的治学态度以及高度的敬业精神使我受益非浅，对我课题的完成起到了至关重要的作用。
经过这次毕业设计，使我觉得不论从理论知识还是从实际操纵中都学到了不少知识，我想归纳起来，主要有以下四个方面：  

* 经过这次毕业设计，它让我接触更多平时没接触的科学仪器设备、元器件以及获得相关的仪器调试经验，同时我也发现自己在这方面很多不足之处。体会到理论知识对实践有很大的知道作用，她让我知道，只有在正确的理论指引下，才能设计出合乎实际需要的硬件电路。
* 学会了高效率的查阅资料、运用工具书、医用网络查找资料。我发现，在我们所使用的书籍上有些知识在实际应用中其实不是十分理想，各种参数都需要自己去调整。偶尔还会遇到错误的资料现象，这就要求我们应更加注重实践环节。
* 在毕业设计中，我们应当注意重点与细节的关系。
* 失败不可怕，只要不趴下，昂首向前走，希望总会有的。
* 同组同学相互包容，彼此合作，取长补短，才能铸就最后的成功。可以说这次毕业设计是对所学知识的一次运用和检阅，同时对自学能力提出很高的要求，所以平时的学习离开思考，就是严重的错误，我们学习不应该有偏科现象，各方面知识都要接触，这样做才能为毕业设计打下基石。  

最后,我要感谢的母校东北石油大学大学,为我提供的良好的学习与发展环境。感谢我的指导教师高新成给予我帮助，感谢母校开放、公正的言论环境,现代、实用的学习环境,舒适、便捷的生活环境让我顺利度过了人生的关键三年。愿所有校园里认识的,不认识的；来过的,走过的……愿你们珍惜握在手里的现在,抓住机遇,拥有一个美好的明天。





# 附录一 程序

程序如下:

```assembly
TM_NUM EQU 23H
TM_L EQU 22H
TM_H EQU 21H
DSPBUF EQU 40H
DQ BIT P2.0
FLAG BIT 00H
ORG 0000H
AJMP MAIN
ORG 000BH
AJMP __INTT0__
ORG 30H
MAIN: MOV SP,#070H
      MOV TMOD,#02H
      MOV IE,#82H
      MOV TH0,#6
      MOV TL0,#6
      MOV R2,#04
      MOV R1,#40H
 LL1: MOV @R1,#00
      INC R1
      DJNZ R2,LL1
      SETB RS0
      MOV R2,#00
      MOV R3,#00
      MOV R4,#00
      MOV R5,#00
      MOV 6FH,#00H
      CLR RS0
      CLR P3.0
      MOV 30H,#02
      MOV 31H,#06
      MOV 32H,#0
      LCALL CHEWEN
__INSTANCE__:CLR TR0
      SETB P2.1
      JB P2.1,K3
      LCALL KKEY
   K3:CLR 01H
      MOV R2,44H
      CJNE R2,#00,K2
      SJMP K7
   K2:CPL P3.0
      MOV R3,#30
   K1:LCALL TM_DISP
      DJNZ R3,K1
      DJNZ R2,K2
   K7:MOV R2,45H
      CJNE R2,#00,K4
      SJMP K6
   K4:MOV R4,#255
  K44:CPL P3.0
      MOV R3,#30
   K5:LCALL TM_DISP
      DJNZ R3,K5
      DJNZ R4,K44
      DEC R2
      CJNE R2,#00,K4
  K6: CLR P3.0
      LCALL CHEWEN
      SETB TR0
MAIN2:JB 01H, __INSTANCE__
      LCALL TM_DISP
      SJMP MAIN2
CHEWEN:CLR RS1
       CLR RS0
      LCALL GET_TM
      LCALL TM_COV
      LCALL DTOB
      LCALL DTOB1
      CLR C
      MOV A,33H
      SUBB A,44H
      MOV 44H,A
      MOV A,34H
      SUBB A,45H
      MOV 45H,A
      RET

    __INTT0__:PUSH ACC
          PUSH B
          SETB RS0
          INC R2
          CJNE R2,#100,__JT0__
          INC 6FH
    
          MOV A,6FH
          CJNE A,#20,__JT0__
          MOV 6FH,#00H
          INC R3
          MOV R2,#00H
          CJNE R3,#2,__JT0__
          SETB 01H
          MOV R3,#00
    
     __JT0__: CLR RS0
          POP B
          POP ACC
          RETI


KKEY: MOV R2,#00
      MOV R4,#0AH
 KS2: LCALL TM_DISP
      DJNZ R4,KS2
      SETB P2.1
      JB P2.1,KKEY1
      JNB P2.1,$
      MOV 60H,#DSPBUF+1
      MOV R1,#DSPBUF+1
      MOV R2,#00
KEY1: LCALL TM_DISP_2
      MOV P2,#0FFH
      MOV A,P2
      ORL A,#01
      CPL A
      JZ KEY1

KEY2: JNB ACC.1,KEY3
      JNB P2.1,$
      INC R1

      INC R2
      CJNE R2,#03,L13
      MOV R1,#DSPBUF+1
      MOV R2,#00

 L13: MOV 60H,R1
      SJMP KEY1
KEY3: JNB ACC.2,KEY4
      JNB P2.2,$
      MOV A,@R1
      CJNE R1,#41H,L1
      CJNE A,#09,LL
      SJMP KEY5
  L1: CJNE R1,#42H,L2
      MOV A,@R1
      CJNE A,#09,LL
      SJMP KEY5
  L2: CJNE R1,#43H,L3
      CJNE A,#09,LL

KEY5: MOV @R1,#00
  L3: SJMP KEY1
  LL: INC A
      MOV @R1,A
  L6: SJMP KEY1
KEY4: JNB ACC.3,KEY1
      JNB P2.3,$
      MOV 30H,41H
      MOV 31H,42H
      MOV 32H,43H
      ACALL DTOB
KKEY1:RET

     DTOB:SETB RS0
          SETB RS1
          MOV A,31H
          MOV B,#10
          MUL AB
          ADD A,32H
          MOV 33H,A
          MOV 34H,#00
          MOV R6,30H
          CJNE R6,#00,JT2
          SJMP JT22
     JT2: MOV A,33H
          ADD A,#100
          MOV 33H,A
          MOV A,34H
          ADDC A,#00
          MOV 34H,A
          DJNZ R6,JT2
     JT22:CLR RS1
          CLR RS0
          RET

  DTOB1:  SETB RS0
          SETB RS1
          MOV A,42H
          MOV B,#10
          MUL AB
          ADD A,43H
          MOV 44H,A
          MOV 45H,#00
          MOV R6,41H
          CJNE R6,#00,JJT2
          SJMP JJT22
    JJT2: MOV A,44H
          ADD A,#100
          MOV 44H,A
          MOV A,45H
          ADDC A,#00
          MOV 45H,A
          DJNZ R6,JJT2
   JJT22: CLR RS1
          CLR RS0
          RET
WR_18B20: MOV R2,#08H
         CLR C
         SETB DQ
         MOV R3,#02H
         DJNZ R3,$
         NOP
    WR1: CLR DQ
         MOV R3,#03H
         DJNZ R3,$
         RRC A
         MOV DQ,C
         MOV R3,#20
         DJNZ R3,$
         SETB DQ
         MOV R3,#03H
         DJNZ R3,$
         DJNZ R2,WR1
         SETB DQ
         RET
RD_18B20: MOV R4,#02H
          MOV R1,#22H
     RE0: MOV R2,#08H
     RE1: CLR C
          SETB DQ
          NOP
          CLR DQ
          NOP
          NOP
          SETB DQ
          MOV R3,#01H
          DJNZ R3,$
          MOV C,DQ
          MOV R3,#010H
          DJNZ R3,$
          RRC A
          DJNZ R2,RE1
          MOV @R1,A
          DEC R1
          DJNZ R4,RE0
          RET
INI_18B20: SETB DQ
           NOP
           CLR DQ
           MOV R4,#150
           DJNZ R4,$
          ;LCALL TM_DISP
          ;LCALL TM_DISP
           SETB DQ
      TS0: MOV R4,#19H
           JNB DQ,TS1
           DJNZ R4,TS0
           SJMP TS2
      TS1: SETB FLAG
           SJMP TS3
      TS2: CLR FLAG
           SJMP TS4
      TS3: ;LCALL TM_DISP
           MOV R4,#120
           DJNZ R4,$
      TS4: SETB DQ
           RET
DELAY8ms: MOV R6,#2H
      KL1: MOV R7,#80H

      KL2: DJNZ R7,KL2
          DJNZ R6,KL1
          RET

GET_TM: SETB DQ
    S1: LCALL INI_18B20
        JB FLAG,S2
        SJMP S1
    S2: MOV R4,#10H
        DJNZ R4,$
        MOV A,#0CCH
        LCALL WR_18B20
        MOV A,#44H
        LCALL WR_18B20
        MOV R4,#0ffH
    S3: LCALL TM_DISP
        DJNZ R4,S3
    S4: LCALL INI_18B20
        JB FLAG,S5
        SJMP S4
    S5: MOV A,#0CCH
        LCALL WR_18B20
        MOV A,#0BEH
        LCALL WR_18B20
        LCALL RD_18B20
        LCALL INI_18B20
        MOV R4,#10H
    S6: LCALL TM_DISP
        DJNZ R4,S6
    S7: RET
TM_COV: MOV A,#0F0H
        ANL A,TM_L
        SWAP A
        MOV TM_NUM,A
        MOV A,TM_H
        ANL A,#07H
        SWAP A
        ORL A,TM_NUM
        MOV TM_NUM,A
        MOV R0,#DSPBUF
        JNB 0FH,SING
        MOV @R0,#0BH
        CPL A
        CLR ACC.7
        ADD A,#01H
        MOV TM_NUM,A
        SJMP SING1
  SING: MOV @R0,#0AH
 SING1: MOV B,#10
        DIV AB
        INC R0
        MOV @R0,A
        INC R0
        MOV A,B
        MOV @R0,A
        INC R0
        MOV A,#00H
        JNB 13H,DOT1
        ADD A,#50
  DOT1: JNB 12H,DOT2
        ADD A,#25
  DOT2: JNB 11H,DOT3
        ADD A,#12
  DOT3: JNB 10H,DOT4
        ADD A,#6
  DOT4: MOV B,#10
        DIV AB
        MOV @R0,A
        RET
TM_DISP: CLR RS1
         CLR RS0
         MOV DPTR,#TAB
         MOV R0,#DSPBUF
         MOV B,#0FEH
         MOV R5,#04
   DIP1: MOV A,@R0
         MOV P0,#0FFH
         MOV P1,#0FFH
         MOVC A,@A+DPTR
         CJNE R5,#02,DIP2
         ANL A,#7FH
   DIP2: MOV P0,A
         MOV A,B
         MOV P1,A
         RL A
         MOV B,A
         LCALL DELAY8ms
         INC R0
         DJNZ R5,DIP1
         RET
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
TM_DISP_1: CLR RS1
         CLR RS0
         MOV DPTR,#TAB
         MOV R0,#DSPBUF
         MOV B,#0FEH
         MOV R5,#04
 DDIP4:  MOV A,R0
         MOV P0,#0FFH
         MOV P1,#0FFH
         CJNE A,60H,DDIP1
         MOV A,#0FFH
         SJMP DDIP3
  DDIP1: MOV A,@R0
         MOVC A,@A+DPTR
  DDIP3: CJNE R5,#02,DDIP2
         ANL A,#7FH
  DDIP2: MOV P0,A
         MOV A,B
         MOV P1,A
         RL A
         MOV B,A
         LCALL DELAY8ms
         INC R0
         DJNZ R5,DDIP4
         RET
 ;;;;;;;;;;;;;;;;;;;;;
 TM_DISP_2: MOV R4,#10H
  KS4: LCALL TM_DISP
      DJNZ R4,KS4
      MOV R4,#1FH
  KS5: LCALL TM_DISP_1
      DJNZ R4,KS5
      RET
TAB:
DB 0C0H,0F9H,0A4H,0B0H,99H,92H,82H,0F8H,80H,90H,0FFH,0CFH
END

```

# 附录二  硬件电路图

![图10-8 硬件电路图](http://my.gunplan.top/static/yj1.png)
# 摘 要

本设计基于基于STC89C52RC单片机的温度控制系统的工作原理和设计方法。本文介绍了控制系统的硬件部分，包括：温度检测电路，温度控制电路，显示电路。单片机处理信号线单片机对信号进行相应处理，以达到温度控制的目的。该文档还重点介绍了采用模块化结构的软件设计部分。介绍了该控制系统的硬件部分会在文中写出，包括的模块是：数字管显示程序，键盘扫描和按键处理程序，温度信号处理程序，继电器控制程序和过热报警程序。同时，还包括系统中复杂的电路设计等方式。主程序，读取温度子程序，键处理程序，LCD显示程序和数据存储程序。该控制系统可以实时存储相关的温度数据并记录当前的时间。系统程序主要包括主程序，读出温度子程序，处理轮转子程序，转换温度计算子程序、按键处理结构、LCD显示程序以及数据存储程序等。



**关键词：AT89C51，单片机 ，DS18B20温度芯片，温度控制**  



# Abstract

This design uses STC89C52RC single-chip microcomputer as the core of the working principle and design method of temperature control system. The temperature signal is collected by the temperature chip DS18B20 and transmitted to the single-chip microcomputer as a digital signal. This article introduces the hardware part of the control system, including: temperature detection circuit, temperature control circuit, display circuit. The single chip microcomputer processes the signals accordingly to achieve the purpose of temperature control. The single chip microcomputer processes the signals accordingly to achieve the purpose of temperature control. The paper also focouses on the software design part, which adopts a modular structure. The main modules are: digital tube display prog random access memory, keyboard scanning and key processing prog random access memory, temperature signal processing prog random access Memory, relay control prog, random access memory, and over-temperature alarm pr ocess. The control system can store relevant temperature data in real time and record the current time. The system prog random access memory mainly includes a main prog random access memory, a readout temperature subprog random access memory, a calculation temperature subprog random Access memory, a key processing prog random access memory, an LCD display prog random access memory, and a data storage prog random access memory.



----




# 第1章 绪 论

## 1.1 温度控制系统研究的目的和重要性

在人类历史上，环境温度起着极其重要的作用。环境温度是工业生产中最常见的工艺参数之一。每个物理变化和每个化学反应过程都与温度密切相关。因此，温度控制是生产自动化中的重要任务。随着社会的发展，科学技术的进步以及温度测量设备在各个领域的使用，智能化是现代温度控制系统发展的主要组成部分。尤其是近年来，温度控制系统已经应用于人们生活的各个方面，但是温度控制一直是一个尚未发展的领域，但这是一个与人类息息相关的世纪之久的问题。在这种实际情况下，温度控制系统的设计具有广阔的应用前景和重要性。

此结构是为室温控制系统设计的，控制对象是室温。温度控制通常用于日常生活和工业领域，例如用于冷室，洗澡池，酵母池，电源和其他地方的温度控制。过去，温度控制是手动进行的，没有给予足够的重视。实际上，在许多地方都必须很好地调节温度。鉴于此问题，此系统设计的目的是创建一个可使其自身适应设定温度的系统。它被广泛使用，功能强大，小巧美观，易于携带。这是一种实用且廉价的控制系统。

## 1.2 温度控制系统研究概况

国外对温度控制技术的研究始于1970年代。首先，使用模拟组合仪器来收集现场信息并执行指令，记录和控制。分布式控制系统出现在1980年代后期。目前正在开发用于计算机数据采集的控制系统的集成多因素控制系统。当前，温度测量和控制技术在全球不同国家中迅速发展，并且一些国家正在朝着完全自动化和无人值守的方向发展。

中国对温度测量和控制技术的研究相对较晚，始于1980年代。中国工程师和技术人员已经吸收了工业化国家对温度测量和控制技术的吸收，从而掌握了室内温度的微机控制技术。该技术仅限于控制环境中的单个温度因子。中国温度测控设备的计算机应用一般处于从消化吸收阶段，易应用阶段到实用化，全面应用阶段的过渡和发展。从技术上讲，大多数情况下都存在由单片机控制的单参数单回路系统，并且没有真正的集成多参数控制系统。与工业化国家相比，差距很大。我国温度测控的现状还远远没有达到工业化水平。生产中仍有很多困扰我们的问题。设备支持能力差，工业化程度低，环境控制落后，软件和硬件资源无法共享和可靠。缺点，例如不良性行为。

##  1.3 温度传感器技术

传感器技术是现代信息技术的主要内容之一，信息技术包括计算机技术、通信技术和传感器技术。计算机和通信技术发展极快，相当成熟，而传感器应用技术因为需要使用模拟技术，而模拟技术还有很多问题难以解决，因此传感器应用技术也有待进一步发展。为了适应现代科学技术的发展，世界总舵国家都把传感器技术列为现代的关键技术之一。通常将能把非电量转换为电量的器件称为传感器，其实质上是一种功能块，作用是将来自外界的各种信号转换成电信号。它是实现测试与自动控制系统的首要环节。如果没有传感器对原始参数进行精确可靠地测量，那么无论是信号转换或信息处理，或者最佳数据的显示和控制都将无法实现。 

温度传感器，使用范围广，数量多，居各种传感器之手。温度传感器的发展大致经历了以下三个阶段：传统的分立式温度传感器（含敏感元件），主要输能够进行非电量和电量之间的转换；模拟集成温度传感器/控制器；智能温度传感器。目前，国际上新型温度传感器正从模拟式向数字式、集成化、智能化及网络化的方向发展。温度传感器按传感器与被测介质的接触方式可分为接触式温度传感器和非接触式温度传感器两大类，其中，接触式温度传感器的测温元件与被测对象要有良好的热接触，通过热传导及对流原理达到热平衡，这个示值即为被测对象的温度。这种测温方法精度比较高，并可测量物体内部的温度分布。但对于运动的、热容量比较小的及对感温元件有腐蚀作用的对象，这种方法将会产生很大的误差。非接触测温的测温元件与被测对象互不接触。常用的是辐射热交换原理。此种测温方法的主要特点是可测量运动状态的小目标及热容量小或变化迅速的对象，也可测量温度场的温度分布，但受环境的影响比较大。 

温度传感器的发展大致可分为以下几种：  
1. 热电偶传感器。热点偶传感器是工业测量中应用最广泛的一种温度传感器，它与被测对象直接接触，不受中间介质的影响，具有较高的精度；测量范围广，可从-50℃～1600℃进行连续测量，特殊的热电偶如金,铁,镍,铬最低可测到-269℃，钨,铼最高可达2800℃。
2. 模拟集成温度传感器。采用硅半导体集成工艺制成的，因此亦称硅传感器或单片集成温度传感器。模拟集成温度传感器是在20世纪80年代问世的，它将温度传感器集成在一个芯片上、可完成温度测量及模拟信号输出等功能。模拟集成温度传感器的主要特点是：功能单一、测温误差小、价格低、响应速度快、传输距离远、体积小、微功耗等，适合远距离测温，不需要进行非线性校准，外围电路简单。
3. 光纤传感器。光纤测温技术可分为两类:全辐射测温法，单辐射测温法，双波长测温法，多波长测温法等。特点是：光纤挠性好、透光谱段宽、传输损耗低，无论是就地使用或远传均十分方便而且光纤直径小，可以单根、成束、Y型或阵列方式使用，结构布置简单且体积小。缺点是：测量起来困难,难于实现较高的精度，工艺比较复杂,且造价高，推广应用有一定困难。
4. 半导体吸收式光纤温度传感器。半导体吸收式光纤温度传感器是利用了半导体材料的吸收光谱随温度变化的特性实现的。一种传光型光纤温度传感器，是指在光纤传感系统中，光纤仅作为光波的传输通路，而利用其它如光学式或机械式的敏感元件来感受被测温度的变化。在这类传感器中，半导体吸收式光纤温度传感器是研究得比较深入的一种。
5. 智能温度传感器。智能温度传感器(亦称数字温度传感器）是在20世纪90年代中期问世的。它是微电子技术、计算机技术和自动测试技术（ATE）的结晶。目前，国际上已开发出多种智能温度传感器系列产品。智能温度传感器内部包含温度传感器、A/D传感器、信号处理器、存储器（或寄存器）和接口电路。有的产品还带多路选择器、中央控制器（中央处理单元）、随机存取存储器（随机存取存储器）和只读存储器（只读存储器）。智能温度传感器能输出温度数据及相关的温度控制量，适配各种微控制器（M中央处理单元），并且可通过软件来实现测试功能，即智能化取决于软件的开发水平。

随着科学技术的不断进步与发展，温度传感器的种类日益繁多，数字温度传感器更因适用于各种微处理器接口组成的自动温度控制系统具有可以克服模拟传感器与微处理器接口时需要信号调理电路和A/D转换器的弊端等优点，被广泛应用于工业控制、电子测温计、医疗仪器等各种温度控制系统中。其中，比较有代表性的数字温度传感器有DS18B20、MAX6575、DS1722、MAX6635等。相比较而言，传统的温度检测以热敏电阻为温度敏感元件，热敏电阻成本低，但需要后续信号处理电路，而且热敏电阻的可靠性相对较差，测量温度的准确度低，检测系统的精度差。数字式温度传感器的种类也不少，并且在实际工程设计中具有上述诸多优点。
# 第2章 系统总体方案设计

## 2.1 系统工作原理

单片机温度控制系统是以AT89C51单片机为控制核心，辅以采样反馈电路，驱动电路，晶闸管主电路对电炉炉温进行控制的微机控制系统。系统的原理框图如图2-1所示，其基本控制原理为: 用键盘将温度的设定值送入单片机，并在发光二极管显示，启动运行后，通过信号采集电路将温度信号采集到后，送入单片机系统进行PID 控制运算，将控制量输出，改变可控硅管的接通时间便可改变加热丝功率，以达到调节温度的目的控制电阻炉的加热。

当由于环境温度变化太剧烈或由于加热或降温设备出现故障，或者温度传感头出现故障导致在一段时间内不能将环境温度调整到规定的温度限内的时候，单片机通过三极管驱动扬声器发出警笛声。 

![图1-1 第一个方案](http://my.gunplan.top/static/1.0.0.PNG)

图1-1为第一个设计方案，该方案的工作原理简述如下：

1. 锯齿波是由单结晶体管BT和R1，R2，R3，W1和C1组成的张驰震荡产生，然后经射极跟随器V1、R4输出。
2.  控制电压（Uk）与锯齿波电压进行电流叠加后送到V2的基极，合成电压为Us，当Us>0（0.7）时V2导通，Us<0，则V2截止。
3.  由V2、V3以及R8、R9、DW1组成一直流开关，当V2基极电压Ube2>0(0.7)，V2导通，Ube3接近零电位，V3截止，直流开关导通。输出24V直流电压。
4.  过零脉冲的输出，由同步变压器TB，整流桥D1及R10，R11组成一削波同步电源，这个电源与直流开关的输出电压共同去控制V4与V5。只有当直流开关导通期间，V4截止，V4、V5基电极和发射极之间才有工作电压，才能工作在期间，同步电压每次过零时，V4截止，其集电极输出正电压，使V5由截止转导通，经脉冲变压器输出触发脉冲而此脉冲使晶闸管T在需要导通的时刻导通。

在直流开关导通期间使出连续的正弦波控制电压Uk的大小决定了直流开关导通时间的长短，也就决定了在设定周期内导通的周波数，从而可输出功率的调节。显然，控制电压Uk越大，则导通的周波数就越多，输出的功率也就越大，电阻炉的温度也就越高，反之，电阻炉的温度就越低。
闭环控制自动调温的基本指导思想是在系统中增设温度传感器和温度调节器，温度传感器的基本功能是检测电炉的实际温度，并变换成电压讯号和炉温控制电压Uk进行比较，根据两者差值的大小（Δe=Uk-Uft）和变化方向（即△e为正还是为负），通过调节器进行相反方向的调节，使调节器的输出控制直流开关导通时间的长短，从而使设定周期内晶闸管的导通周波数增大或者减小，相应的电炉温度升高一点或者减小一点。采取这种控制方式，可以使炉温在较小的范围内变化，控制精度高。
方案二：为了使得电路的简单化，采用单片机作为控制核心来设计本课题，温度信号采集使用温度传感器DS18B20，温度控制的基本思想为：通过采集到的温度与标准温度之间的差值来控制加热电阻丝的通电时间长短，从而起到恒温控制的目的。方案二的设计框图如下图所示：

![图1-2](http://my.gunplan.top/static/1.0.0.PNG)

本方案采用单片机作为控制核心，使用温度传感器进行温度采集，通过将采集到的温度与标准设定温度之间的差值进行温度控制，从而使得温度维持在标准设定温度。本方案设计成本低，具有具有较高的可靠性，对于系统动态性能与稳定要求不是很高的场合非常的合适。

单片机温度控制系统是以AT89C51单片机为控制核心，辅以采样反馈电路，驱动电路，晶闸管主电路对电炉炉温进行控制的微机控制系统。系统的原理框图如图2-1所示，其基本控制原理为: 用键盘将温度的设定值送入单片机，并在LED显示，启动运行后，通过信号采集电路将温度信号采集到后，送入单片机系统进行PID 控制运算，将控制量输出，改变可控硅管的接通时间便可改变加热丝功率，以达到调节温度的目的控制电阻炉的加热。

当由于环境温度变化太剧烈或由于加热或降温设备出现故障，或者温度传感头出现故障导致在一段时间内不能将环境温度调整到规定的温度限内的时候，单片机通过三极管驱动扬声器发出警笛声。

## 2.2 系统功能介绍

本设计是对房间温度进行检测与控制，设计的温度控制系统实现了基本的温度控制功能：当温度低于设定的温度时，系统自动通过PWM启动加热装置，使温度上升。当温度高于设定的温度时，停止加热。三位数码管及时显示温度，精确到小数点后一位。  
本文设计的温度控制系统具有如下功能：

1. 通过温度芯片DS18B20采集温度，并以数字信号的方式传送给单片机。
2. 四位数码管动态实时显示房间温度，显示精度0.10C。
3. 三个按键实现标准温度的设定。
4. 利用PWM实现温度的控制。



# 第3章系统硬件电路设计

![图3-1电路硬件图](http://my.gunplan.top/static/2.0.1.png)

该解决方案使用AT89C51为核心处理芯片，芯片DS18B20测量内部温度，通过发送信号传输总线到MCU，并且和一个4位LED显示管温度。偏差用于控制电阻丝导通/截止时间的长度。实现恒温控制的界面的最终想法是最终想法。

## 3.1 各模块设计

### 3.1.1 温度传感器电路

本文在课题教学研究中所采用的的温度传感器一般可以分为采用一个美国两个单线的四位数字小型环境温度传感器例如ds18b20。该稳压传感器4.7k##hz该传感器用于输出稳压信号的上和下拉稳压电阻直接通过连接输入到一个微控制器的一个p1.0引脚。

半导体温度传感器DS18B20产生Dalalas数字温度传感器，多并行总线技术。该器件在小型集成电路芯片上制造温度敏感的半导体器件、 A / D 转换器、存储器等。在对本设计中的温度传感器进行多次比较和考虑之后，选择了单线数字设备DS18B20，主要是由于以下原因：

1. 该检测系统的主要特点功能是：在一个允许温度范围的工作检测温度是-55℃〜+125℃，±0.5度的工作温度和在测量值的精度是5℃。温度函数转换器高精度。9至12变量，温度检测值数据可以被直接转换成一个串行16位的非二进制的或数字输出形式的数据输出;最大输入时间频率转变精度为12位测量精度转变为750ms;它们都可以通过一条数据线被直接供电，具有超低电源功耗。
2. 系统进行成本：由于我国计算机信息技术和微电子科学技术的发展，新型企业大规模集成电路设计越来越具有强大，体积变得小是越来越会发生的，价格也会下跌。DS18B20提交空间与普通晶体管之间几乎没有本质区别的，价格只有约$1。
3. 降低系统总线技术操作复杂度：由于设备ds18b20是单总线测量设备，微处理器与之进行接口时只不过需要至少占用在校学生一个模拟i/o口，一根模拟总线测量方式线就可以同时连接数十个设备ds18b20，温度管理进行总线测量方法完全无需任何模拟企业外部网络控制元件，因此，与传统模拟工业生物温度传感器中的网络系统相比，可以测量得到大大幅度增加以及减少系统布线调试次数，降低温度管理系统的技术复杂性，减少重大工程项目的基础建设工作量。
4. 减少系统的引线调试和日常维护：由于大量减少的系统引线数量可以不会引起一些小的事情，大量使用减少接线的工程数量，减少接线工程数量产生的引线施工成本量大大降低，系统的内部布线过程复杂度的降低调试和日常维护另一方面，因为系统引线接口数量的减少产生的故障数量大大下降，使得整个系统中的接口工作变得简单许多，给系统的日常调试工作带来更多方便，之所以认为dsl8820是全方位数字化的元器件，故障基本不会同时发生，干扰性的和可抗性强，因此为了让整个系统的在整个日常生活中而所进行需要保证正常工作的维护任务大大减少，为了更好保证系统可用性而所进行的日常维护相关工作保证正常系统运行的维护工作。

ds18b20温度控制系统传感器引线技术通常存在一个小的引线，引线上的数量通常是3，并且我们可以确定不在一个企业内部：一个单线程的数据网络信息传输包括系统总线数据端口vvdq、外部数据电源线vdd和公共网络地址总线端口gnd。ds18b20有2种直流供电的工作方法：其一种就是采用杜邦线的直流供电电压模式。此时，vdd被完全接地。当它开始产生能量空闲时，它通过内部一个电容器线路来让它存储剩余电量用从外部数据线路中获得剩余能量并用来让它完成整个温度功率转换，相应的当它完成整个温度功率转换的持续时间也会更长。在这种应用情况下，使用一个单片机的一个矩形i/o输出端口让它来自动拉起一个ds18b20总线。另一种模式是外部温度电源连接模式(vdd电源连接+5v)，完成外部温度变化测量的时候相应操作时间短。

在本设计项目中我也可以直接采用由大学生企业提供的并不在相关企业内部的各种电子信息流的流动强度及其发展计算方式等来进行设计实现。cds18b20传感器与驱动单片机的接口连接，其内部接口集成电路设计方案如软件图2-2所示。

![图2-2外部电路](http://my.gunplan.top/static/003.jpg)

### 3.1.2 通用键盘显示电路设计

![图2-3外部电路](http://my.gunplan.top/static/003.jpg)

所示，ale时钟脉冲可以作为一个时钟同步电路8279，从而与示意图的两个时钟脉冲同步。2-3。8279芯片的控制中断电路控制输出信号irqr连接到一个控制单片机的一个p1-1引脚。缓冲器输入地址是将寄存器中的a0连接输入到整个单片机的一个p2-5引脚，ae的缓冲信号则是连接到整个单片机的一个p2-6引脚。读写器和信号数据线缆分别和两个单片机的信号读写器和信号数据线缆来进行连接相连。8279芯片的外部数据传递运输线路由d0-d7与整个单片机的外部数据线直接相连进行相应的连接。

来自8279芯片和AT89C51芯片的许多信号是一致的，可以直接级联，这非常容易控制。8279芯片的8位数据线进行直接连接到AT89C51芯片的P0端口。读取和写入信号连接到89C51的读取和写入信号。 AT89C51锁存信号ALE连接到8279 CLK，在内部分频后，会产生一个公共的非外部时钟脉冲。8279芯片的端子请求信号由反相器反转，然后连接到AT89C51的P1.1端口。 AT89C51的三个可寻址寄存器只需要两个地址即可寻址，即命令/状态寄存器地址和数据寄存器的地址值。8279芯片中与地址相关的信号是A0和芯片选择信号。您的连接直接确定寄存器地址在哪里。一旦确定了硬件电路，就确定了寄存器的地址。

发光驱动二极管的色号发光驱动效率和显示颜色分别取决于每个制造商的材料，如果出现没有什么意外情况是可以使用egred色号，出现其他意外情况可以使用reyellow或是egreen色号。发光电子二极管又称发光电子二极管主要是利用智能电子技术通过测量管理系统控制测量仪表中简单而常用的进入输出一个控制装置，通常说它可以直接用于用来指示一个机器的工作状态或其他相关企业服务信息。具有系统功耗低、配置灵活、接口方便、价格低廉、使用寿命长、对各种电子管直流的流动强度和电势差异性要求低、易于手动实现连接多种电路等多大优点。

液晶电视显示器本身是被动电子显示器，它本身不向外调节发出一种具有一定粒子性的主动电磁波，只需向外调节其发出一种具有一定粒子性的被动电磁波的频率数量。目前，常用的彩色液晶信息显示器通常是根据中国的而液晶对于信息显示失真率的问题总是按克列拉斯效应的基本原理设计制成的，它通常可以通过同时获得一个位于黑色信息发展初始背景上的一个白色初始字符或一个白色初始背景上的一个黑色初始字符的方式显示不同信息形式。便携式检测仪器主要用于电力测量和分析控制和检测智能动力电池中的电力，考虑到低损耗功率的应用要求，经常我们需要同时使用的就是液晶电视显示器，重量轻，功耗低的而且体积小，因此，广泛作为采用的检测手段。但是必须需要借助外来的灯光进行显示。阴极红外射线图形显像管这种显示器虽然可以同时显示多种图形，但显示界面更复杂，成本更高。

在多路显示温度自动巡检仪中只要您需要同时显示4位的和数字两种形式的显示温度和检测路数，可以不必考虑使用某种价格较高的荧光阴极或红射线液晶显像管;4位数字发光光电二极管的实际工作频率电子在直流的波动强度一般为240ma左右，由于需要使用一个交流电源进行供电，足以完全提供四位发光光电二极管液晶显示器所使用需要的最大功率，对于四位发光光电二极管而言，仅有4位，体积也很小，这样比较符合发光光电二极管和四位液晶电视显示器的诸多性能特点，本检测系统建议选择四位发光光电二极管液晶显示器。

键盘设计是一组多按键的整体组合。其主要工作功能之一是实时控制操作系统的正常工作运行状态，向系统接口输入大量数据和发出命令。有两种键盘类型：标准编码数字键盘和非标准编码数字键盘。

除了单个按键之外，编码器的键盘系统还包括一个用于自动生成键码的多个硬件控制电路、抖动控制电路、多个击键和多个按键之间移动时的保护器等电路。每按一个数字键，就表示可以自动重新生成这个数字键的键码。同时还会产生一个脉冲控制信号，通知系统中央处理控制单元进行接收。这种单片键盘使用方便，接口使用程序简单，但由于需要使用更多的相关硬件集成电路，价格也会变得更高，一般来说单片机键盘应用在该系统中的应用不是非常多。

非按列编码数字键盘仅由按行矩阵排列和非按列排行矩阵两种形式的编码键盘所组成。按键的抖动作用主要是简单地停止连接或自动断开触点，按键的触点抖动、按键软件代码的自动形成和每个按键的自动识别都必须是由按键软件操作来自动完成的。由于其价格经济并且实用，在各种单片机硬件应用管理系统中已经得到广泛应用。

上述一系列比较之后，它应该是非编码键盘。

P0端口： P0端口为8位漏极级开路双向 I/O 端口，每个引脚可吸收8TTL 栅极电子流的强度。当端口 P1的引脚首次写入1时，它被定义为高阻输入。P0可用于非内部程序数据存储器，可以定义为数据/地址的第八位。在 FIASH 编程中，P0作为原始代码输入端口。检查 FIASH 时，P0输出原始代码，必须拉起 P0的外部。

端口设置p1：端口设置p1是一个8位双向模拟i/o输出端口，内部分别提供上或下拉输出电阻。端口强度p1缓冲区强度可以达到接收进入输出4ttl门口的电子负载流的最大强度。p1端口的写入管脚板在写入1后，内部拉高，可以直接作为数据输入。当一个端口上的p1从外部被下拉到低稳压电平时，它将达到输出一个电子到直流的最大强度，这可能是由于内部上压下拉。在执行可以被擦除的非读写数据存储器程序编程和数据验证程序过程中，p1端口通常作为第8个输入地址被程序接收。

p2端口：p2端口是它是一个内部上和下拉稳压电阻的8位双向模拟i/o端口。p2端口栅极缓冲器引脚可以用来接收和控制输出4个ttttl栅极缓冲电子的直流的缓冲强度，当一个端口缓冲p2被直接写入"1"时，其引脚被内部上和下拉栅极电阻拉高并可以用作缓冲输入。因此，当它被直接用作电流输入时，端口位于p2的引脚被外部电压拉低到位于输出端的电子负载流的最大强度。这可能是由于内部上下牵拉的原因缘故。当p2端口，用于外部执行程序数据存储器或外部程序数据处理存储器同时访问的16位数据地址，输出时的端口相当p28的8位地址。读出和存储写入外部输出数据时在存储器输入地址8时，p2端口作为输出数据内容在特殊寄存功能下的寄存器。p2端口在整个闪存硬件编程和数据验证系统工作期间使它可以同时接收高八位存储地址以及存储信号和闪存控制器在系统中的信号。

p3端口：p3端口引脚为8个双向直流i/o控制端口，带有内部上压下拉控制电阻，可同时接收和控制输出4个在tttl栅极上的电子到直流的最大强度。当两个p3端口开始写入"1"时，它们在内部被迅速拉升并达到高水平并且被用作信号输入。作为一个输入，由于外部下拉低，p3端口将由于上下下拉而达到输出一个电子负载流的最大强度(ill)。

p3端口如果可以使用作为at89c51的一些特殊控制功能的通用接口也是完全可以的，如下面列表所示：

管脚备选功能

：-：：-：

P3.0 RXD (串行输入)

P3.1 TXD (串行输出)

P3.2/INT0(外部中断0)

P3.3/INT1(外部中断1)

P3.4 T0(定时器0外部输入)

p3.5t1(外部微波信号定时器1外部微波信号发出输入)

P3.6/WR (外部数据存储器写门)

P3.7/RD (外部数据存储器读取频闪)

p3端口同时它也可以用来接收一些主要的可用于总线进行射频闪烁信号编程和射频编程性能验证的射频控制电路信号。

rst：振荡器的复位字节输入。当外部振荡微处理器重置为一个器件时，在两个机器工作周期内保持一个rst引脚的高电平。ale/prog：当振荡器访问一个企业外部的数据网络存储器时，使用网络地址锁存器引脚所允许的外部输出正脉冲信号的高电平来对锁存网络地址的位置和状态进行复位字节。此引脚主要用于在振荡器的闪存脉冲编程期间通过脉冲输入用于闪存编程的脉冲。在通常的，周期性脉冲输出的ale正脉冲信号的恒定脉冲频率大约为1/6振荡器的频率。因此，它们实际上可以跳过一个用作外部脉冲输出的周期性脉冲或跳过一个用于定时目的。但是应该注意的是每一次都需要指出的一点是，外部的数据存储器，这将被用于跳过一个新的ale脉冲。如果振荡器需要禁用一个alert的复位字节输出，可以在振荡器的sfr8eh地址上重新设置0。此时，ale只需要执行一个movr，movd指令为一个新的ale。另外，该引脚被略微拉高。如果外部微处理器在外部脉冲执行的状态ale禁止，则该引脚的设置无效。

psen：外部的应用程序例如数据包和存储器的编程代码包含指令集的选择和数据通门控制信号。在外部软件程序执行的指令代码流在提取中的指令外部程序中的数据流在存储器系统中的每个代码提取指令值在提取期间，每个外部程序机器执行周期有效两次/psen。但是，访问外部应用程序例如数据库和存储器时，这两个有效的/psen的控制信号通常可能不会同时一起出现。

ea/vpp：这是用于保证当/ea端口器继续工作保持低稳压电位，这期间的外部应用程序相同存储器(0000h-ffffh)，无论它的存储器类型是否与内部的应用程序相同存储器。需要特别注意，当外部应用程序开始使用加密的文件方法1时，/ea中的存储器端口会自动锁定内部以用于防止文件重置;同时当/ea端口的继续运行保持正常的最高位时，这里的内部应用程序没有内存。该引脚还同时可以作为用于在不对闪存进行编程期间用于应用12v值的闪存进行编程的备用电源(vpp)。

xtal1：反向控制电路主要用来进行控制振荡信号放大器的时钟输入和内部时钟输出是用来进行控制系统的内部时钟质量管理工作以及辅助系统控制反向电路的外部驱动控制器的输入。

XTAL2：来自反向振荡器的输出。

### 3.1.3 振荡器特性

xtal1和外部xtal2分别提供的是片内反相放大器的脉冲信号输入和振荡器输出。该系列反向放大器的设备可以直接配置为片内的振荡器。石晶振荡和陶瓷振荡均可广泛采用。如果放大器使用外部的时钟源脉冲驱动的设备，则放大器不应需要连接xtal2。对内部的时钟源脉冲信号的多余脉冲输入信号需要通过两频的分频脉冲触发，因此放大器对外部时钟源脉冲信号的所需脉冲的宽度没有严格的要求，但是必须注意保证时钟源脉冲的频率高低和电平的所需脉冲宽度。

### 3.1.4 芯片擦除

通过快速组合正确的两个锁定保存位芯片控制电阻信号并同时将它保持在比ale引脚低10ms，可以轻松快速完成整个程序pe-rom两个芯片控制阵列和三个用于锁定保存位的两个芯片控制电阻被擦除。在重复执行一个芯片用于锁定内存位置的电擦删删除的每个操作中，代码中的数据元组被允许重复执行写入"1"，并且必须在执行芯片锁存重复执行写入一个可编程非零时空函数存储器的字节之前，它才能重复执行此位电擦除后的操作。

此外，at89c51配备了固定的逻辑，可以从低频动态到零的频率静态，支持两种软件模式和可选的自动关机中断模式。系统在空闲时中央控制单元软件自动停止振荡器的工作。然而，随机存取的存储器，定时器，计数器，串行接口和振荡器中断系统继续保持正常工作。在这种关机中断模式下，将自动保存随机存取存储器的所有内容，并自动冻结振荡器，并自动停用所需要使用的其他硬件和芯片振荡器的功能，直到振荡器下一次所使用的硬件振荡器复位完成为止。

许多尚不了解51单片机的互联网用户会遇到以下问题：书籍和在线教程中的AT89S51是什么?8051、89C51等，但没听说过89S51。

在这里，剛刚刚入門的单片机新人应该先阐明一下单片机实际使用的一些产品和理念。mcs-51微控制器单片机是基于美国英特公司于1980年推出的一款单片机产品。其典型的产品理念为8031(芯片无内置的程序和存储器，实际的使用已从单片机市场上完全淘汰)，8051(通用芯片设计采用hmos，功耗为630mw，是89c51的5倍)日期根据实际的使用)。但是到目前为止，8751和其他的通用芯片产品仍然可能是完全兼容的，包括mcs-51核心处理器系列和微控制器(目前已全部停产89s51、89c51等)。在加州理工大学和计算机职业技术学校的单片机培训课程和文档中，mcs-51微控制器仍然可以用作基础理论和学习的一个重要代表。

在一些技术文档中，8051甚至被广泛称为是mcs-51系列中的mcu。8051是早期最典型的单片机代表。由于对mcs-51单片机的深刻历史意义，许多微控制器公司都推出了许多兼容这一系列的单片机，这也就意味着他们的内核确实已经存在于mcs-51。它已经成为8位微控制器的一个标准。

其他飞利浦公司的51mcu产品与51mcs-51核心处理器兼容。相同的微控制器程序，在每个飞利浦微控制器设计制造商的产品和硬件上所需要执行的程序和结果可能是相同的，例如，我们常说的89c51，如飞利浦的at89c51(已宣布停产)，89s51，飞利浦(简称飞利浦)和l公司的winbond(winbond)等。已停产的微控制器是飞利浦atmel公司的单片机和at89c51单片机。同时，许多微控制器功能在原始的基础上已经得到了很大的改进，例如b.时钟。闪存越好(程序中只读存储器的所有内容至少一次可以反复重写1000次)。对于只读存储器(一次只能写入)，at89c51的存储器性能远远地要优于8051。

关于目前的市场营销，pic单片机制造商阵营对89c51提出了强烈的质疑。89c51最严重的问题是存在技术缺陷之一就是添加更多isp(在线更新应用程序)的功能目前是不被认为能夠广泛使用的。因此需要通过添加更多isp功能等新功能之后才能在市场上继续使用。mcs-51图例。在这种的情况下，89s51取代了89c51。目前，89s51依然已经变成了单片机市场中大多数人民的选择之中的一个绝大部分。目前市场份额最大的atmel已经宣布停止了生产新的at89c51，将其产品改用全新的at89s51。89s51进行了一系列技术上的改进。89s51采用全新的0.35标注，可有效控制单片机制造基本的成本，改善产品功能，增强市场竞争力。89sxx可以成为兼容89cxx等51系列单片机的芯片。同时，atmel不再需要接受89c的大量订单。你在目前市场上所能看到的89c51实际上已经是atmel以前停止生产的大量库存。

## 3.2 AT89C51单片机简介

at89c51是一个os8-bit微处理器(fpeam只读存储器-flashprog随机存取只读存储器fpram和一个可自动擦除随机存取只读数据的存储器)，俗称嵌入式微控制器。该设计原件是采用基于atmel的高密度非易失性只读存储器的制造技术设计制造，与符合行业标准的atmcs-51指令集与输出引脚指令集是兼容的并可以一直连接到。由于多功能8位中央处理器和闪存指令集结合在一个独立的单芯片中，atmel的at89c51是一个高效的嵌入式微控制器，它为许多的嵌入式控制系统应用提供了一个灵活和廉价的解决方案。

![3-8硬件电路图](http://my.gunplan.top/static/3.2.png)

at89c51可由一个atmel公司的控制器在线进行编程，用于嵌入式温度数据采集和嵌入式数据通信。at89c51是一款低成本功耗、高性能的cmos8位嵌入式单片机，其中主要包含了可通过重复自动擦除1000次的闪存和具有8k字节的isp(指令系统内的prog随机存取程序和存储器matlable)的嵌入式闪存只读程序和存储器，该芯片元器件主要采用了基于atmel的一种高密度、非易失性的嵌入式存储技术设计制造，兼容了标准的mcs-53指令系统和80c51引脚的结构。该系列芯片元器件集成了一个通用的8位中央处理器和一个isp的嵌入式闪存存储单元，功能强大的微型嵌入式计算机的at89c51可以为许多嵌入式控制和管理系统的应用和分析指令系统的发展历程提供一些具有降低生产成本和经济效益的解决问题的方案。at89c51具有以下的特点：40针、4k字节闪存片上应用程序数据存储器、128字节随机存取应用程序数据存储器(随机存取数据存储器)、32个外部双向数据输入/外部输出(i/o)串行通信端口，5个串行中断优先级，2个串行中断优先级嵌套中断，2个16位的可编程定时计数器，2个全双工串行通信控制端口，watchdog(wdt)控制电路，片上时钟振荡器。

at89c51有三个并行的i/o口，p0：p0.0~p0.7，p1.0~p1.7，p2.0~p2.7。此外，当没有片上或外部存储器时，p0端口可以用作公共i/o的端口，当主机使用外部或片上存储器时，p0端口也可以直接用作地址数据线/端口或数据线。p1端口也可以直接作为一个通用的公共i/o端口，p1.0、p1.1、p1.5~p1.7也可以具有特殊的端口功能，如表3.4所示。当主机没有片外存储器时，p2端口可以直接用作公共的i/o端口，当主机使用外部存储器时，p2端口也可以直接用作高8位地址。

|引脚特殊功能

：-：：-：

P1.0 T2：定时器

P1.1 T2EX：定时器

P1.5 MOSI：用于在线编程(ISP)

P1.6 MOSI：用于在线编程(ISP)

P1.7 SCK：用于在线编程(ISP)

表3.4at89c51p1端口的特殊控制功能

引脚特殊功能

：-：：-：

P3.0 RXD (串行端口输入)

P3.1 TXD (串行端口输入)

P3.2 INT0(外部中断输入0)

P3.3 INT1(外部中断输入1)

P3.4 T0(定时器0外部输入)

p3.5t1(外部定时器1外部定时信号发出输入)

P3.6 WR (外部数据存储器写控制)

p3.7rd(外部的数据存储器对外部读取和控制)

表3.5 AT89C51 P3端口的特殊功能

这个房间的温度监控系统主要使用单片机进行通讯和温度检测。 P3.0接受DS18B20。 P0端口用于设计温度显示界面。微控制器和控制电路共享一个外部时钟，使用一个片上存储器并具有上电复位功能。单片机的最小系统如图3.2.1所示：

[图3.2.1 SCM 最小系系统(http：//my.gunplan.top/static/3.2.1.png)

## 3.3 8279芯片简介

### 3.3.1 引脚介绍

8279采用单5V电源供电，40脚封装。

DB0~DB7：双向数据总线，用来传送8279与中央处理单元之间的数据和命令。

clk：时钟的输入数据线，用于时钟产生的具有内部定时的时钟脉冲。

复位：复位输入线，复位后8279设置在字符显示的左输入端，两个按键锁定的设置为接触回弹式，程序需要将时钟输入线的预分频器信号设置为31，并且保证复位后的信号在高电平下有效。

CS：芯片选择输入线，低电平有效，CS 端低电平时单片机可读写8279

A0：缓冲区低地址。当 A0为高电平时，表示数据总线是命令或状态。当 A0低时，表示数据总线是数据总线。

研发：通过读取控制器将信号发送到输入数据总线，低电平有效，读出数据缓冲区，并将内部数据发送到外部数据总线。

WR：写信号输入线，低电平激活，读出缓冲器并将数据从外部数据总线写入8279的缓冲器。

RL2-140-VCCRL3-239-RL 1

CLK-338-RL 0

IRQ-437-CNTL/STB

RL4-536-SHIFT

RL5-635-SL 3

RL6-734-SL 2

RL7-833-SL 1

RESRT-932-SL 0

RD-1031-OUT B0

WR-1130-OUT B1

DB0-1229-OUT B2

DB1-1328-OUT B3

DB2-1427-OUT A0

DB3-1526-OUT A1

DB4-1625-OUT A2

DB5-1724-OUT A3

DB6-1823-BD

DB7-1922-CS

VSS-2021-A0

irq：中断请求的正确输出和执行，高级有效。在这种键盘自动中断工作模式下，当每次出现的从fifo/sensor随机存取的在该存储器中间没有任何数据时，中间的断线由一个低电平线转变为一个新的高电平，每次键盘中断时由从fifo/sensor随机存取的该存储器的所有数据被自动读出，断开的检测线路降至较低的水平。如果随机存取的存储器中仍然存有信息，该行将再次变为一个较高水平。在线路和传感器正常工作的模式下，每当随机检测到线路和传感器的信号发生变化时，中断线就可能会逐渐变高。

sl0~sl3：视频扫描线缆可用于实时连接和自动扫描任何按键或光开关、传感器或光阵列和触摸显示器或屏幕上的任何数字，可编程或支持视频可编解码。

rl0~rl7：按键返回扫描线通过按钮或传感器的开关与返回扫描线进行连接。上拉按压电路一般设置在相应的返回扫描线内部，以使返回线保持在高水平。只有当一次按压电路关闭时，相应的按键和返回线才会自动转变为一个低电平;当一次无按键闭合时，均保持在较高电平。

shift：这是换位驱动开关的主要功能。当一个换档电压开关自动闭合时，它被一个换位电压开关自动拉至较低的相位电压电流水平。同时在每当未按时接下一个好的换档电压开关时，换档电压开关的整个输入电压状态必须保持在一个好的高电平。在正常的自动键盘扫描模式下，按键自动关闭，按键的操作位置和自动换位键的开关和所输入的操作状态一起由自动键盘扫描存储。

cntl/stb：自动高电平电源关闭当用户打开一个cntl/stb的电源开关时，它将自动将其拉低，否则将始终无法保持一个好的高电平。对于所有使用鼠标键盘输入的操作模式，该行通常被用作选择控制输入。例如当用户按下按钮时，按钮的数据位置与所有控制输入状态的数据存储在一起的数据位置相同。在选通控制输入的模式下，通常需要选择它，并将按钮的数据位置存储在一个fifo随机存取的存储器中。

outa3〜outa0和一个outb3〜outb0：显示数据输出一个8位端口a和一个8位端口b。这两个端口之间既可以独立进行控制，也是一个可以单独视为8位的端口。

bd：使用数字数据空间的长度显示。此命令输出的一个信号结果可以直接用于在一个两位数字的字符转换期间进行显示一个空格，或者你也可以通过使用"显示空格"的一个命令行来控制一个信号在显示空格一个字符的转换空间进行显示。

VCC：+5V电源输入线。

VSS：地线输入线。

### 3.3.2 8279的编程方法

8279按其控制功能块的大小可以细分为：显示器和键盘控制功能块;工作和显示控制功能块;工作和控制处理器功能块;键盘控制接口和中央处理器功能块控制功能块主要包含手动控制和时间寄存器，定时和自动控制，扫描和计数器三个组成部分，它主要的功能是用于控制显示器和键盘的工作和显示控制功能块。

控制和时间数据寄存器：一种用于存储键盘和中央控制单元的通用编程语言控制命令。当8279中央处理器的程序人员确定了键盘和显示器的工作状态模式以及其他显示器工作的条件时，首先将命令键和控制数据放置在一个数据总线上，然后使用命令a0=1，wr=0cs=0并将所有的命令和键数据保存在wr沿边缘增加了控制和显示器的时间数据寄存器，并对其进行解码以方便创建适当的命令控制功能。

定时和计数器控制：它通常包含一个基本的键盘定时和计数器。第一个定时计数器控制是一个分频系数范围为2-31的预定时器。我们可以通过应用程序控制其预设的分频系数，以使内部的频率为100khz，这样的频率可能至少会导致5.1ms。包括键盘阵列扫描时间和10.3毫秒的反跳扫描时间。其他的计数器对该基本的频率扫描时间进行了划分，并为我们提供适当的键，行，键盘阵列扫描和显示键盘扫描时间。

扫描键盘计数器：用于扫描键盘的计数器主要有两种基本编码工作的模式。在基本编码计数器工作的模式下，计数器为键盘提供一个二进制的计数器。在外部软件输出引脚sl0-sl3之后，可以为用于扫描键盘的计数器提供二进制的扫描计数器功能，并在外部软件解码后进行显示。在此工作模式下，扫描键盘计数器对最低有效值的两位进行解码，并且输出引脚sl0-sl3输出1分之4的二进制解码信号，以对键盘的显示器和用于扫描键盘的二进制扫描计数器进行解码。

键盘功能块包括：返回缓冲区、键盘弹跳和控制、8x8 FIFO 传感器随机存取存储器、 FIFO/传感器随机存取存储器状态。

#### 返回抖动缓冲器与鼠标键盘的抖动反向起跳及抖动控制

八个返回行由返回缓冲区缓冲。在键盘工作模式下，逐个检测这些行，找出行键中已关闭的键。如果回弹电路检测到钥匙关闭，则等待10.3ms，然后记录钥匙是否仍然关闭。如果仍然关闭，则矩阵中 key 的行地址和列地址以及 SHIFT 和 CNTL 的状态一起发送到 FIFO 随机存取存储器，并且 FIFO 随机存取存储器中的数据格式如下：

D7 D6 D5 D4 D3 D2 D1 D0

CNTL SHIFT SCAN RET URN

数据的进行格式中，最高位为shicntl，次高位为shift状态，d5-d3来自不同的扫描线上电子的计数器，d2-d0来自中国传感器返回一个电子计数器，扫描线电子计数器和一个回扫线电子计数器的开关值分别可以直接反映正在输出被传感器按下开关键的行，列的开关值，如果在一个传感器的阵列中，返回行上的开关数据直接进入与正在输出被扫描的传感器阵列相对应的一个传感器随机存取电子存储器阵列中的行，这样，每个传感器开关的数量和位置直接被传感器反映为一个传感器随机存取电子存储器的开关位置。

#### FIFO/传感器随机存取存储器

8x8随机存取存储器是键盘模式和选通模式下的先进先出(FIFO)存储器。每条新的信息都是按顺序写的，然后按照写的顺序读出来。当传感器阵列扫描时，存储器被用作传感器随机存取存储器。此时，随机存取存储器中的每一行存储传感器阵列中相应行的状态。

#### FIF0/传感器随机存取存储器状态

在使用键盘或门控的错误模式下，fifo中的状态阵列跟踪信号表示fifo中的状态字符数注意它到底是"满"还是"空"，过多的传感器写入或读取被状态逻辑认为可能是错误，当传感器fifo不为空时，状态阵列跟踪逻辑就会提供一个用于中断传感器应用程序irq的信号。在特殊的传感器状态阵列扫描模式下，如果一个有效的传感器状态发生改变，irq信号可能是一个有效的传感器高电平。fifo表示状态字的低3位表示fifo模式中的传感器字符数，fu位表示一个fifo随机存取的存储器已满;o(超过donmn)du位表示超限错误，即传感器试图将另一个传感器的字符发送到完整的传感器fifo;u(done下)du位表示null错误，即传感器试图写入或读取空的传感器fifo。s/f有两种的含义：在特殊的传感器扫描模式下，s/f的含义是指一个传感器随机存取的存储器中至少可能包含一个指示传感器是否闭合的指示，在特殊的错误模式下，s/f位是一个传感器错误的标志，指示了是否传感器发生了多通道同时写入或关闭的错误，du位表示错误显示随机存取的存储器尚未完全可用，因为"清除显示"或"清除全部"的命令已经无法完成其他未被消除的操作。

显示随机寄存器块的功能块主要包括：16x8显示随机寄存器，16x8显示随机存取地址存储器，显示随机地址存取寄存器)

#### 显示随机存取存储器和显示寄存器

8279内部缓存显示器同样具有16x8的缓存形式自动显示随机存取的数据存储器，通过自动显示一个寄存器和两个四位端口0uta0-3，0utbo-3来自动显示刷新外部存储器的数据显示，显示器同样可以是使用的大都是8段数码管或者是白炽灯，也可以有外部显示器同样可以是使用的大都是8段管或数码管，显示随机存取的数据存储器也同样可以是使用的大都是16x8的形式显示缓存形式，也就是可以直接构成两个16x4的随机存取数据存储器的形式，显示随机存取的存储器字节可由中央处理单元存储器进行数据的读写，被处理单元读写的随机存取的存储器字节的读写地址由随机显示读写地址的寄存器进行指示.数据显示[地址寄存器保存当前中央处理单元存储器的读或写随机取出的存储器字节读写地址，以及正在随机显示着的那两个4位半字节的存储器地址，读写的地址由当前中央处理单元的命令[存储器编程]，也就是可以设置为每次处理单元读写后存储器地址自动加1的一种工作更新方式，在处理单元设置了正确的存储器工作更新方式后，显示随机存取存储器的数据也可由中央处理单元存储器读出，半字节存储器a和半字节b的存储器地址自动由8279更新，以适应由中央处理单元存储器送入的随机存取数据，a和b半字节可独立的送入，也就是可以单独作为一个字节的送入，随中央处理单元所需要设置的工作更新方式而定。

#### I/O 接口功能块

8279通过i/o缓冲器控制与四行中央处理部分控制单元的系统总线网络接口8279，i/o控制部分主要使用cs。a0，rd，wr和四行的中央处理部分控制单元8279之间的单向控制数据是交换的，数据和缓冲器信号是双向控制数据交换的通道，所述控制单元的信号和缓冲器是如下的双向控制数据交换之间的逻辑关系：

CS A0 WR RD 状态

\-----

10--中央处理单元从8279读状态

0101中央处理单元向8279写状态

10--中央处理单元从8279读数据

001-中央处理单元向8279写数据

1 X 数据缓冲区输出处于三种状态

x为任意数(0或1)

\###3.3.38279的操作

如前所述，8279可以完全适应各种手机键盘和电脑显示器的不同功能和工作的方式，由于8279中各个命令功能块的各种工作方式是完全可编程的，用户完全可以根据自己的工作要求，用向8279写命令字的各种编程方法对8279的各种工作方式和功能块进行编程，从上表中我们可以清楚地看出，只要执行命令cs=0同时wr=0=1，然后你们就可以将命令字写到8279，并在命令wr的上升沿将相应的命令程序驱动到8279。

对于中央处理器，8279只有两个端口地址，一个是用于查看和读写处理器的命令和数字的状态(cs=0，a0=1)，一个端口地址用于查看和读写处理器的数据(cs=0，a0=0)，但对于编程语言命令和字代码有很多类型。在8279中给出了区分学校和企业不同的温度命令字的方法主要是对处理器命令和字代码的高3位(d7，d6，d5)和低5位进行了分析和编码，而低5位主要是用于理解命令字的实际含义和教学内容。

#### 8279的编程命令

键盘/显示器方式设置

最高位最低位

--

命令代码000 D D K K K

其中DD为显示方式，KKK为键盘方式

DD的表示：

编码功能

\--

008个8位字符显示-左端传入

01168位字符显示-左输入

1088位字符显示-右输入

1116个8位字符显示-右端送入

所谓左端送

编码功能

\--

000编码扫描键盘-2键连锁

001译码扫描键盘-2键连锁

010编码扫描键盘-N键巡回

011译码扫描键盘-N键巡回

100编码扫描传感器阵列

101译码扫描传感器阵列

110选通输入，编码显示扫描

111选通输入，译码显示扫描

钥匙链和2，其中N是一个关键电路8279双键盘键被按下两次处理，编码和在两个扫描链轮和显示器被解码形成扫描扫描SL0-SL3。

程序时钟

命令代码001 P P P P P

此命令用于确定定时和分频控制中每个预标量的分频控制系数。命令代码ppppp功率系数可以直接形成一个数字2-31。预标准测量也可以在外部没有所述时钟预定频率的情况下来进行，所述基频，得到内部，如果100khz的选择的基本时钟预定频率，能够外部时钟获得与所述时钟频率预定的恢复时间扫描，分频相关的因子;在预定的复位时钟脉冲后100khz如果没有外部时钟被自动馈送到码31自动。

读FIF0/传感器随机存取存储器

命令代码：010 AI X A X =任意

该读取命令主要用于确定中央处理器选择需要读取后续操作的存储器对象分别是8279中的哪一个fif0/来自传感器随机存取的存储器，并且主要用于传感器确定8个随机存取的存储器字节阵列中的哪一个被传感器读取，其中第一个aaa表示中央处理器选择了需要后续读取的行，ai自动为该行添加1个相同的特征位，并且这两者在传统的键盘扫描模式下的数据是不存在直接相关的，对于每次传感器后续的读取8279，数据存储器会按照与传感器数据首次读取时输入的fif0相同的后续读取顺序自动将数据发送出去。从传感器的fifo开始读取所有数据进行后续的读取，直到传感器写入新的命令。在来自传感器随机存取阵列的实施例中，aaa传感器选择了一线来自传感器8个的随机存取的存储器行如果ai=1，来自传感器的下一次后续读取将被读的随机存取数据送到存储器的下一行。

读显示器随机存取存储器

命令代码：011 AI A A A A

中央处理控制单元对8279写此读取命令，则我们确定了一个中央处理控制单元以一个显示器随机存取的一个存储器位作为数据源缓存地址位来进行随机读取的操作，其中的aaaaa为一个显示器随机存取一个存储器的一个数据源缓存地址，ai的行为自动依次加1特征位，若其中ai=1，则每一次读取第一行随机存取的一个存储器之后[第一行行为显示器的数据地址]自动依次加1。

写显示器随机存取存储器

命令代码：100 AI A A A A

中央处理单元将此命令写入8279，它规定下一步将写入8279的显示随机存取存储器。寻址模式和自动加1功能与读显示随机存取存储器相同。

显示器写入禁止/空格

命令代码：101 X IW IW BL BL X=任意

A B A B

此显示命令主要用于同时屏蔽a或b两个显示端口的输出并重新显示其显示的区域。如果将其中两个显示端口用作两行4位的显示，则必须同时屏蔽4位之一，以使对方发送的信息不会直接影响另一半。iw是该端口被屏蔽的功能位。如果为显示端口设置了显示命令iw=1，则该显示端口被此命令所屏蔽。空格显示请特别注意，b0对应于c0和d0，而d0和bl是应于iwensei，则此显示端口将重新显示空格。如果要以单个8位的输出命令格式为该端口创建重新显示的区域，则必须为端口设置两个d0和bl的标志以使该端口的显示完全保持空白。

消除

命令代码：110 CD CD CD CF CA

此数据清除格式命令主要就是用于按一定的数据格式顺序进行数据清除，它显示随机存取器的数据格式存储器的两个fif0状态，其中a和cd分别用于指定一个需要进行清除的数据格式：

CD CD CD

0 X 全"0"(x为任意)

10 AB =16进制

1020(0 O 100000)

11全册"1"

当显示为"1"(或 CA =1)时，允许清除显示

cf显示器清除cd和fifo的状态(其中包括广告和中断)。如果显示cf=1，则显示器清除cd和fif0状态，并重置中断线。传感器直接随机访问存储器的显示也始终被设置为第0行。ca始终被显示器清除，并且其显示效果与cd对应，当显示ca=1时，cf可以进行合成，使用显示器的cd和fif0指定的随机清除存储器格式进行清除。此时显示器的随机访问存储器的状态已经被清除。cd插孔还可以重新设置同步内部的时序。显示期间将自动清除随机存取访问存储器(约16us)。无法被重写。同时，在此期间，fifo的最高有效位设置为"1"。当显示广告的随机存取访问存储器再次恢复可用时，它将自动进行重置。

中断结束/出错方式设置

命令代码：111 E X X X X X=任意

当一个阵列传感器，该命令使IRQ线变低，并且允许写入随机存取存储器(通过位置传感器的变化来检测，IRQ线可具有增加的，这样做防止了信息写入再次随机存取存储器之前其复位)。在 N 键电路模式下，如果 E 位被编程为"1"，芯片电路将以特殊的错误模式运行。

主要用于检查 N 键巡视模式特殊错误模式下的多次按键。如果在一个反弹周期内按下两个键，则可以视为同时多次按下，并建立一个错误标志以防止进一步写入 FIF0，并设置中断(如中断设置)。错误进行标志设计可以被 FIFO 状态字命令读取，CF =1的清除命令我们可以通过重置错误信息标志。

1. 锯齿波由两个单晶二极管bt和r1、r2、r3、w1和c1组成的单晶管张驰振荡器锯齿波产生，然后通过单晶管发射极跟随张驰振荡器将锯齿波输出。

2. 控制电势差(Uk)和锯齿波电势差与电子流的强度叠加，送至 v2基极。综合电势差是我们。当 Us>0(0.7)时，V2打开，Us <0，则 V2结束。

3. V2，V3和R8，R9，DW1流开关已经被组成，当基极电位差V2 Ube2>0(0.7)，V2被接通时，接近零电势差Ube3，V3被关闭，直流开关是打开。

4. 过零脉冲的控制输出由削波同步电源变压器晶闸管tb、整流桥变压器d1、r10和直流开关r11组成的削波整流桥同步变压器电源，它与直流开关的两个输出电势差一起分别用来控制v4和发射器的v5。只有当发射器的dc直流开关发射器打开时，v4才使发射器关闭，并且由于v4和发射器的v5基极电极与两个发射器之间存在一个工作电势差，因此它使发射器可以在此期间正常工作。当每次发射器的同步电势差过零时，v4关断，其集电极和输出存在一个正电势差，这就可以使得v5从发射器的截止开关开始接通，通过这个脉冲使同步变压器的输出触发一个过零脉冲，并且这个触发脉冲可以使变压器晶闸管t在需要发射器导通的时候导通。

直流开关导通时，连续正弦波控制电势差uk的大小决定了直流开关的导通持续时间的长短，这也直接决定了在电阻炉设定的直流开关周期内可以传导的直流开关周期和次数，因此，可以合理地调整直流开关输出的功率。显然，控制电势差uk越大，它可以传导的直流开关周期和次数越多，输出的功率越大，电阻炉的直流开关温度越高。相反，电阻炉的直流开关温度越低。

自动电炉闭环系统温度自动调节的基本设计思想是在热电炉系统中自动添加温度传感器和相应的温度自动控制器。温度传感器的温度调节基本功能主要是通过检测自动热电炉的实际工作温度，将其信号转换为电势差的控制信号，并且我们比较了电炉相应温度控制装置uk的电势差。这种差异的变化大小(e=uk-uft)和电势差变化的方向(即e是正还是负)由温度控制器沿晶闸管相反的输入控制方向自动设置，以便温度控制器的输出信号控制导晶闸管接通的方向和长度。直流晶闸管开关的输入控制接通的时间，使得在一定温度和时间内的设置，晶闸管的输入控制接通电流频率有所增加或流量减少，而使得电炉的相应直流温度控制装置有所频率增加或流量减少。利用这种电势差控制温度的方法，可以在很小的电势差范围内自动改变炉温，并且控制精度高。

方案二：为了更好地可以有效简化控制电路，采用先进的单片机恒温控制技术可以作为一个恒温控制系统和企业的核心单片机来进行设计本文的课题。温度传感器ds18b20用于对温度传感信号的采集。方案二控温的基本设计思想主要是：通过传感器采集的电阻丝温度与单片机标准传感器温度的差值，控制恒温发热系统中电阻丝的数量和持续时间，从而最终达到对恒温发热系统控制的主要目的。控温方案二的单片机设计电路框图结构如下图所示：

![2.2方案二设计框图](http：//my gunplan.top/static/003.jpg)

本解决方案以先进的单片机为温度控制的核心，利用温度传感器自动采集计算机温度，通过传感器采集的计算机温度与单片机标准传感器设定计算机温度之差的距离来测量和控制温度，使得温度始终保持在单片机标准传感器设定的温度。该解决方案设计制作成本低，可靠性高，非常适用于计算机系统的动态控制性能和系统稳定性对温度要求不是很高的应用场合。

## 3.4传感器接口电路设计

### 3.4.1温度数据采集电路

ds18b20是基于dallassemiconductorcorporation的一个网络数字温度传感器。与其他的温度传感器连接方式相比，ds18b20具有以下的功能：当网络连接到如上所述微处理器的唯一单线路的接口模式中，只有一个端口可以被用于直接实现一个微处理器和ds18b20之间的双向通信的线路。

ds18b20支持独立的多点温度网络。几个节点ds18b20可以仅在三条线上通过并联进行连接，以方便地实现基于互联网的多点温度的测量。ds18b20不一定需要外围的组件。所有的传感器集成元件和温度信号转换集成电路都可以像普通的晶体管一样直接集成在单个温度集成电路中。传感器的温度测量范围一般为55〜125°c，温度集成电路测量的固有温度和分辨率范围为0.5°c。温度测量的结果直接传感器输出一个9位数字的温度测量信号，并直接通过"初始化总线"接口串行发送到传感器的中央控制单元。同时，可以直接发送crcr的温度校验码，具有较强的温度抗干扰和自动纠错的功能。温度测量的结果以9位数字的模式串行传输。

尽管ds18b20具有简单的嵌入式温度自动测量和控制系统，较高的分辨率和温度测量的精度，方便的网络连接以及较少的线路和资源占用等诸多优点，但在实际的应用中还是应该充分考虑以下的几个方面：

1. 尽管操作系统的硬件很简单，但我们还是需要相对复杂的软件处理器来对其进行温度补偿。由于ds18b20与其他微处理器之间的读写串行编程需要数据同时传输，因此必须注意保证在读写串行编程期间的连续读写编程时间，否则将是无法对读取进行温度补偿测量的结果。

2. ds18b20的可靠性相关数据未提及任何连接到单个总线的微处理器ds18b20的数量。这很容易就会导致一个错误的假设，即微处理器可以在总线上连接任意数量的总线ds18b20，而在实际的应用中并非如此。如果一条单个总线上微处理器连接了8个以上的总线ds18b20，则几乎没有必要考虑解决单个总线微处理器的可靠性和总线驱动问题以及我们在设计多点温度控制和测量传感器系统时所需要注意和考虑的一些问题。

3. 连接长度的限制是指采用连接长度为ads18b20的信号总线的电缆。由于它具有信号电缆的稳定性和电子电缆的阻挡比较大等特性，如果距离太大，信号传输幅度也会有所降低。如果在测试中普通信号电缆的双绞线传输电缆的长度明显地超过50m，则表示温度降低或读取数据不正确。如果将普通信号总线的电缆改为带屏蔽普通信号电缆的数据传输双绞线，则正常的总线通信数据传输距离应该可以轻松地达到150m。

ds18b20提供两种不同类型的器件封装：pr-35和pdsoic。引脚的顺序排列如下下表3.1所示。该软件封装操作系统中实际上已经使用了基于pr-35软件包的封装工具包。尽管如此，dds18b20仅用于提供一个返回9位温度数字的一个温度测量值，如如下图3.1.2所示。

管脚管脚定义说明

：-：：-：：-：

8脚SOIC 3脚PR-35

21 GND地

12 I/O 数据输入

83 VCC电源

34567 NC空脚

表3-1 DS18B20管脚排列

图3.1.2ds18b20温度值的表示计算方法

d9为低字节的符号位，0为正，1为负，高字节(d10~d15)的其他位用二进制符号位的补码或扩展位形式进行了表示;d0~d8为数据位，以二进制数据位的补码或扩展形式进行表示。如下表3.2显示了数值与温度之间的非线性关系。

温度测量数据(二位位十六进制)数据(十六进制)

：-：：-：：-：

+125000000001111101000FAH

+2500000000001100100032H

+0.500000000000000010001H

000000000000000000000H

+0.51111111111111111 FFFFH

-251111111111001110 FFCEH

-551111111110010010 FF92

表3.2 DS18B20值与温度的关系

由于房间的环境温度不能为负，因此系统不会考虑负温度。这样，您在选择硬件时就可以使用市售组件，而不必使用工业组件，从而可以大大降低成本。读取温度信息后，微控制器仅需要将低字节(D0〜D8)发送到主机和控制电路。

### 3.4.2发光二极管显示接口电气设计

选择的系统控制方式是四路开关室温动态实时传感器显示，显示精度0.1℃。具体的电路原理图所示如图3.2：

![3-2硬件电路图](http：//my.gunplan.top/static/3.2.png)

### 3.4.3发光二极管数码管

发光二极管显示器即为新型发光二极管显示器，具有数据显示醒目、成本低、配置灵活、接口可以方便等特点，单片机电源管理控制系统在应用数据管理操作系统的设计中常用它来直接显示电源管理操作系统的日常工作生活的状态和过程中所采集的数据在信息网络中所输入的数值等。

根据大屏幕发光点阵二极管的排列和结构不同，可将大屏幕发光点阵二极管显示器划分为大屏幕发光二极管点阵数码管和大屏幕发光二极管点阵数码显示器。大屏幕发光二极管点阵数码管主要就是用于在屏幕上显示英文数字和一些英文字母和图形符号，发光二极管点阵显示器同样可以在屏幕上显示英文数字、字母、男人和图形等。大屏幕发光点阵二极管数字点阵显示虽然点阵显示灵活，但它们主要占用的是单片微型计算机系统的软硬件资源比大屏幕发光二极管点阵数码管显示器要多得多。除了使用指定的程序，大屏幕发光点阵数码管显示器或led点阵显示器主要用于请求特殊的点阵显示场合，几乎所有的微型计算机系统应用点阵显示系统都使用大屏幕发光二极管数字点阵显示。

数字管理的显示系统主要有两种显示模式，包括静态数据管理显示程序模式和动态显示程序模式。静态数据管理显示的程序非常不复杂，静态数据管理显示系统的程序模式设计起来非常简单，占用cpu的内存时间很少。仅需要当系统的显示字符串发生更改时才可以调用动态显示程序。但是，硬件和集成电路很多。每个八位数字晶体管都至少必须需要一个8位i/o电源输出输入端口，一个8位限流电源输出驱动器和8个8位限流输出电阻。通常偶尔也可能会需要使用少量的圆形数码管。发光二极管的应用由于静态扫描显示器需要使用较少的电子管组件，并且需要使用更多的静态数字组件与电子管组件在显示器之间进行切换很麻烦。为了有效简化了电路并且大大降低了成本，系统设计使用了一种动态扫描数字显示的方法。

动态扫描显示模式的工作原理是分别打开每个显示器，即一次仅显示一位。为了使用户看到所有的显示器都已显示，必须加快每个显示器的照明周期(增加扫描频率)。通过使用人眼的视觉残留效果，可以实现与连续显示所有显示器相同的效果。动态扫描显示电路如图3.2.2所示：

![图3.2.2动态扫描图](http：//my.gunplan.top/static/003.jpg)

## 3.5 温度控制电路的设计

![图3.2.2温度控制电路](http://my.gunplan.top/static/3.3.png)

通过正确设置开关元件脉冲的宽度来我们可以控制三端双向的可控硅开关元件的开启和脉冲关闭。当伴随着脉冲宽度的增加(脉冲占空比增加)时，三端双向的可控硅开关元件的脉冲导通加热时间和温度延长，电阻丝的开关元件加热的时间也延长，温度也升高。相反，如果我们减小了脉冲的宽度(相当于减小脉冲占空比)，则双向可控硅的脉冲导通加热时间和温度缩短，电阻丝的开关元件加热时间和温度缩短，从而大大降低了元件的温度。

以此方法来控制温度的恒定不变。

## 3.6 脉宽调制

### 3.6.1 脉宽调制的介绍

pwm是高电平脉冲方波宽度调制的一个英文缩写。高比的方波的第一个时间段被简单地称为高电平的占空比，例如，一秒钟高电平和的50%1第二个是占空比的pwm波的脉冲宽度调制(pwm)的定义低电平在各种开关电源中被广泛使用的一个术语。。这个词是根据开关稳压的控制工作方式进行定义和分类的。除pwm混合型外，还有开关调制pfm型和脉宽调制pwm和一种pfm混合型。波的脉宽调制(pwm)的定义开关稳压电路的定义是在设计和控制开关稳压系统的电路设计中在输出的频率可以与低电平保持一个不变的频率情况下，通过电势差的反馈电路来控制和调节其输出的占空比，从而使使用者能够更好地达到维护社会稳定和发展控制输出电势差的主要目的。

脉冲信号宽度的调制(pwm)技术是一种非常有效的可以利用微处理器的模拟数字脉冲信号输出来实现控制和模拟集成电路的一种技术，它被广泛的应用于从电力测量，控制和无线通信系统到电力的智能转换许多应用领域。

### 3.6.2 基本原理

随着我国电子信息技术的发展，出现了多种 PWM 技术，包括：相电势差控制 PWM 、脉冲信号宽度 PWM 方法、随机 PWM 、 SPWM 方法、线电势差控制 PWM 等，然而，镍氢动力电池使用智能手机充电器设计采用的脉冲时间宽度 PWM 方法，以等脉宽的脉冲串作为 PWM 波形，通过不断改变一个脉冲串的周期可进行分析调制，可以同时通过这些改变传统脉冲的宽度或占空比来调节电势差，并且我们可以选择通过研究采用学生适当的控制管理方法来实现协调地改变电势差和频率。

模拟信号的时间值和分辨率可以通过不断的发展变化，对其时间和变化幅度的时间值和分辨率没有必要进行严格的限制。9v模拟信号电池同时也是一种智能模拟设备，因为它的输出电势差不完全一定等于9v，而是随着一定时间而变化，并且同时也可以取任何真实值。类似的地，从模拟信号电池内部吸收的电子流的数量和强度不可能局限于任何一组模拟信号可能的真实值范围。智能模拟信号和传统数字信号的最大区别主要在于后者的真实值范围只能在数字信号预定的任何一组可能的值内，例如，在{0v的电子集合中，5v}。

模拟电势差和收音机电子流的强度控制可直接地应用于扬声器的控制，例如模拟控制汽车和收音机的音量。在简单的控制模拟电势差和收音机中，音量旋钮通过连接扬声器得到可变电阻。当扬声器拧动音量旋钮时，电阻值随之变大或相应地变小;流过这个强度和电阻的电子流的强度也随之增大或相应地减小，从而通过改变扬声器驱动收音机和扬声器的电子流的强度和电阻值，使得音量旋钮相应地随之变大或相应变小。与其他无线电一样，模拟扬声器电路的音量输出与扬声器输入成一个线性的比例。

在简单的需要模拟一个立体声的收音机中，音量控制系统的旋钮与收音机连接时会用到一些可变电阻。其中之一的问题是由于模拟电路倾向于随时间进行漂移，因此难以进行调整。只有可以帮助解决这个复杂问题的精密模拟电路体积可以非常大，体积庞大(尤其是比如老式的家用立体声音量控制设备)和昂贵。精密模拟电路还可能产生严重的热量，其产生的功耗与电路中的工作元件两端的电势差与工作元件电子流的扰动强度的乘积大小成正比。精密模拟电路也肯定可能对于噪声敏感，任何的扰动或者产生的噪声都肯定可能会直接改变工作元件电子流的强度值。

通过对模拟控制电路进行数字控制，可以大量减少控制系统的设计成本和系统功耗的降低。此外，许多的微控制器和dsp已经在日本和中国的芯片上包含了dspwm控制器，这样就使得通过数字进行控制的设备实现自己的功能变得完全可以更加的具有容易。

脉冲宽度调制信号的设计思想

该对象的脉宽调制信号为方波，设定周期为1 s。它的产生将时间计数器设置为10 ms时序，然后通过寄存器R3控制脉冲宽度调制信号的周期。此主题仅具有模拟效果，并且对准确性没有过多要求，因此将1s周期划分为100。在相等的部分中，计时器设置为10 ms，计时器在R3中启动的频率为100。

寄存器r2中需要存储的数据是根据脉冲检测控制电路和数据控制电路进行转换的数字。r2中存储的数据值是用于分别控制一个脉冲系统的信号和1s内一个高电平的脉冲时间的长度。这样我们也就可以从寄存器的p2.6口检测得到用于定义一个周期可调和进行高电平的脉冲时间可调的寄存器来控制脉冲系统的信号。

### 3.6.4 脉宽调制信号的作用

脉冲宽度调制信号从P3.0端口输出。从P3.0端口输出的方波信号连接到三端双向可控硅开关的控制连接，以控制TRIAC的接通和关断。如果方波在一段时间内以高电平出现，则双向可控硅的占空比变长，即加热元件散发的热量更多。简而言之，加热元件释放的能级由方波在一个周期内变高的时间确定。

### 3.6.5 脉冲宽度调制优点

pwm的最大好处的其中之一个特点就是从信号处理器到受控系统的数字信号都是保持数字形式的，没有对数模信号进行的变换。这样保持了数字形式的数模信号最大限度地减少了噪声的产生和影响。数字噪声的大量产生主要是因为只有在其强度足以准确地阐述信号上升沿或信号下降沿跳变的强度时候，数字信号的稳定性才可能会被受到影响。

除了使用指定的程序，大屏幕可以使用点阵数字显示器或led数字显示器。为了请求特殊的显示场合，几乎所有的微型数字计算机或者应用显示系统都使用发光二极管进行数字显示。这些模拟信号可以转换到pwm信号可是它们可以大幅度地增加传输信号距离的范围和长度。在高频接收端，可以直接滤除经过调制的高频方波，并通过适当的rc或lc模拟网络将传输信号的频率恢复到最为模拟的形式。

总之，pwm不仅省钱、占地面积被大量使用节约、抗震和降低噪声的使用性能强，而且同时也成为是一种非常值得许多专业建筑工程师在许多不同类型的建筑设计和工业应用中广泛研究使用的有效解决技术。

 # 第4章 系统软件设计

在微机测控系统中，软件与硬件同样重要。硬件是系统的躯体，软件则是灵魂，当系统的硬件电路设计好之后，系统的主要功能还是要靠软件来实现，而且软件的设计在很大程度上决定了测控系统的性能。为了满足系统的要求，编制软件时一般要符合以下基本要求：  

1. 易理解性、易维护性。通常是指软件系统容易阅读和理解，容易发现和纠正错误，容易修改和补充。由于生产过程自动化程度的不断提高，测控系统的结构日趋复杂，设计人员很难在短时间内就对整个系统理解无误，软件的设计与调试不可能一次完成，有些问题是在运行中逐步暴露出来，这就要求编制的软件容易理解和修改。在软件的设计方法中，结构化设计是最好的一种设计方法，这种设计方法是由整体到局部，然后再由局部到细节，先考虑整个系统所要实现的功能，确定整体目标，然后把这个目标分成一个个的任务。任务中可以分成若干个子任务，送样逐层细分，逐个实现。本仪表就是采用这种模块化的设计方法。这样不但使得设计目标明确、思路清晰，而且在检错、调试时也很方便。当出现问题时，可以根据问题的种类和现象来判断是哪一部分出的问题，很容易找出故障所在和故障原因。同时，采用模块化程序结构设计方案，对于系统功能的扩充和修改也提供了很大的方便。
2. 实时性是电子测量系统的普遍要求，即要求系统及时响应外部事件的发生，并及时给出处理结果。近年来，由于硬件的集成度与运算速度的提高，配合相应的软件，实时性比较容易满足设计要求；
3. 准确性对整个系统具有重要意义，尤其是测量系统，系统要进行一定量的运算，算法的正确性和准确性对结果有着直接的影响，因此在算法的选择、计算的精度等方面都要符合设计的要求；
4. 可靠性是系统软件最重要的指标之一，作为能够稳定运行的系统，抗干扰技术的应用是必不可少的，最起码的要求是在软件受到干扰出现异常时，系统还能恢复正常工作。结合上述编制系统软件的基本要求，首先讨论软件的设计思想。

在微机测控系统中，软件的重要性与硬件设置同样重要。硬件是躯体，软件是灵魂，当系统的硬件电路确定之后，系统的主要功能还要靠软件来实现。如果说硬件决定了产品的造价，那么在硬件搭配合理的前提下软件在很大程度上就决定了产品的性能。

## 4.1 软件设计思想

为了满足系统的要求，编制软件时必须符合以下基本要求: 

易理解性、易维护性。通常是指软件系统容易阅读和理解，容易发现和纠正错误，容易修改和补充。由于生产过程自动化程度的不断提高，测控系统的结构日趋复杂，设计人员很难在短时间内就对整个系统理解无误，软件的设计与调试不可能。

一次完成，有些问题是在运行中逐步暴露出来，这就要求编制的软件容易理解和修改。在软件的设计方法中，结构化设计是最好的一种设计方法，这种设计方法是由整体到局部，然后再由局部到细节，先考虑整个系统所要实现的功能，确定整体目标，然后把这个目标分成一个个的任务。任务中可以分成若干个子任务，送样逐层细分，逐个实现。本仪表就是采用这种模块化的设计方法。这样不但使得设计目标明确、思路清晰，而且在检错、调试时也很方便。当出现问题时，可以根据问题的种类和现象来判断是哪一部分出的问题，很容易找出故障所在和故障原因。同时，采用模块化程序结构设计方案，对于系统功能的扩充和修改也提供了很大的方便。

实时性。实时性是本系统的基本要求。即要求系统及时响应外部事件的发生，并及时给出处理结果。近年来，由于硬件的集成度与速度的提高，配合相应的软件，实时性容易满足要求，特别是对于汇编语言编制的软件。  

1. 可测试性。系统软件的可测试性具有两方面的含义:其一是指比较容易地制定出测试准则，并根据这些准则对软件进行测定；其二是软件设计完成后，首先在模拟环境下运行，经过静态分析和动态仿真运行，证明准确无误后才可投入实际运行。  
2. 准确性。准确性对整个系统具有重要意义。系统要进行大量运算，算法的正确性和准确性问题对控制结果有直接影响，因此在算法选择、位数选择方面要适合要求。
3. 可靠性。可靠性是系统软件最重要的指标之一，它要求两方面的意义:第一是运行参数环境发生变化时，软件都能可靠运行并给出正确结果，也就是要求软件具有自适应性:第二是在环境恶劣干扰严重情况下，软件必须保证也能可靠运行，这对整个系统尤为重要。



## 4.2 软件组成

由于整个系统软件相对比较庞大，为了便于编写、调试、修改和增删，系统软件的编制采用了模块化的设计。即整个控制软件由许多独立的小模块组成，它们之间通过软件接口连接，遵循模块内部数据关系紧凑，模块之间数据关系松散的原则，按功能形成模块化结构。

系统的软件主要由主程序模块、数据采集模块、数据处理模块、控制算法模块等组成。主模块的功能是为其余几个模块构建整体框架及初始化工作；数据采集模块的作用是将A／D转换的数字量采集并储存到存储器中；数据处理模块是将采集到的数据进行一系列的处理，其中最重要的是数字滤波程序：控制算法模块完成控制系统的PID运算并且输出控制量。

下面就介绍本系统几个主要的程序模块。

## 4.3 程序结构分析

**主程序调用了4个子程序，分别是温度传感器读取程序，数码管显示程序、键盘扫描及按键处理程序、温度信号处理程序。**

* 键盘扫描电路及按键处理程序：实现键盘的输入按键的识别及进入相应的程序。
* 温度信号处理程序：对温度芯片送过来的数据进行处理，进行判断和显示。
* 数码管显示程序：向数码的显示送数，控制系统的显示部分。




## 4.4 数据处理模块

数据处理模块负责处理A／D转换后的数字量。其中最重要的环节是数字滤波，所以这里主要讨论系统采用的数字滤波程序。

###  4.4.1 数字滤波

模拟信号都必须经过A／D转换后才能为单片机接受，如果模拟信号受到扰动影响，将使A／D转换结果偏离真实值。因此仅仅对模拟量采样一次，我们是无法确定该结果是否可信的，必须经过多次采样，得到一个A／D转换的数据序列，通过某种处理后，才能得到一个可信度较高的结果。这种从数据序列中提取逼近真值数据的软件算法，通常称为数字滤波算法。

数字滤波克服了模拟滤波器的不足，它与模拟滤波器相比具有以下几个方面的优点:  

1. 由于数字滤波是用程序实现的，因而不需要增加硬件设备，而且可以多个输入通道共用一个滤波程序
2. 由于数字滤波不需要硬件设备，因而可靠性高、稳定性好，各回路之间不存在阻抗匹配等问题
3. 数字滤波可以对频率很低(如O．01HZ)的信号实现滤波，克服了模拟滤波器的缺陷，而且通过改

变数字滤波程序，可以实现不同的滤波方法或改变滤波参数，这比改变模拟滤波器的硬件要更灵活方便。

常用的数字滤波方法有程序判断滤波法、中值滤波法、算术平均滤波法、一阶滞后滤波法、去极值平均滤波法等等，下面简要介绍这几种数字滤波方法。

1. 程序判断滤波法首先要从经验出发，定出一个目标参数最大可能的变化范围。每次采样后都和上次的有效采样值进行比较，如果变化幅度不超过经验值，本次采样有效，否则，本次采样值应视为干扰而放弃，以上次采样值为准。该算法适用于变化缓慢的物理参数的采样过程，如湿度、液位等。
2. 中值滤波法对目标参数连续进行若干次采样，然后将这些采样进行排序，选取中间位置的采样值为有效值。对于变化较为剧烈的参数，此滤波方法不宜采用。
3. 算术平均滤波法是对目标参数进行连续采样，然后求其算术平均值作为有效采样值。该算法适用于抑制随机干扰。采样次数越大，平滑效果越好，但系统的灵敏度要下降。算术平均滤波不能将明显的脉冲干扰消除，只是将其影响削弱。

## 4.5 子程序设计

设计总体程序框图如下，总体程序由主程序，按键子程序，温度获取子程序三部分组成。  
读出温度子程序的主要功能包括初始化,判断DS18B20是否存在,若存在则进行一系列的读操,作若不存在则返回。

### 4.5.1 读出温度子程序

![图4-6 程序结构图](http://my.gunplan.top/static/4.2.1.PNG)

### 4.5.2 LED数码显示管程序

![图4-6 发光二级 数码显示管程序](http://my.gunplan.top/static/4.2.2.PNG)

### 4.5.3 键盘扫描及按键处理子程序

![图4-7  键盘扫描及按键处理子程序](http://my.gunplan.top/static/4.2.3.PNG)


## 4.6 显示处理

显示处理模块主要完成人机交互作用，具体实现将采样温度值、设定温度值以字符的形式通过液晶显示出来。本系统使用HTl621作为显示驱动器。HTl621是128点内存映象和多功能驱动器。附录中给出了显示处理模块的源程序。

# 第5章 系统软件调试

## 5.1 目测

1. 有无短路处。
2. 对照电路图看有无接错、漏接处。
3. 有无虚焊处。
4. 元件是否都对

## 5.2 硬件调试

首先应进行上电前的准备。为了防止硬件的损坏，应在电路板上电前进行电路检查，包括：对芯片的焊接方向进行检查，对芯片的引脚进行短路和断路检查。

在经过检查确认芯片的焊接没有任何问题的情况下，进行上电检查，在电源打开后，先判断电路是否存在异常，如出现芯片过热等现象，应及时切断电源，检查电路故障。在上电无异常状况的前提下，可以用万用表和示波器进行测量。首先测量电源芯片的输出电压是否正常，然后用示波器分别测量各个主要芯片电源引脚，察看电源的波形情况，如有纹波，则在预先留出的位置上焊上退耦电容以消除纹波，保证芯片工作正常。电源测量完毕后，进一步用示波器测量有源晶振的输出脚，其输出是频率为8MHz的波形(非方波，类似正弦波)。在确定晶振起振后，按住复位键，使单片机始终保持在复位状态，同时测量其各个引脚的电平情况，并同数据手册上表述的复位时的芯片引脚状态进行比对，由此可判断单片机是否正常。确认单片机正常之后就可以通过仿真器连接用户板进行调试。

## 5.3 软件的调试

由于软件的编写都是根据各个模块进行的，我们在进行软件的系统模拟调试时应，先确认硬件的接口标记是否在软件程序中一一对应，而且要检测所编写的软件有没有知识性的错误。在觉得基本没有问题后我们通过电脑将程序编译进入系统核心AT89S52单片机，检验软件与硬件各部分是否协调的工作。出现问题时我们要耐心的检查程序并作出适当的修改，直到软件系统的完全契合硬件电路，那我们软件就调试成功了。

1. 测试环境
   环境温度28摄氏度，室内面积20平方米
   测试仪器：数字万用表，温度计0----100摄氏度

2. 测试方法
   使系统运行，采用温度计同时测量室内度变化情况，得出系统测量的温度。

3. 测试结果
   设定温度由0摄氏度到40摄氏度
   标定温差<=1摄氏度   调节时间  15s（具体视现场情况）
   静态误差<=0.5摄氏度   最大超调量1摄氏度

4. 通过测试分析，对于实际室内的温度控制，可以再提出以下 2 点方法 :
   Ⅰ增加传感器个数，对各个温度传感器采集的数据进行求算术平均，可得到较为准确的温度值。
   Ⅱ对实际室内的温度控制，可采用功率较大的电炉，并且通过风扇对箱内温度进行充分搅和降温设备可采用空气压缩机等制冷设备。 

5. 通过实验测试和分析，发现虽然传感器的温度采集精度最高可得到 0.06 ℃，但测试得到的数据最小间隔为 0.03 ℃ 。通过分析，当对浮点数求平均处理时，遇到同一时刻两个传感头采集的温度相差不大，使 0.06 ℃ 时求出平均温度变为 0.03 ℃ 为了解该数据是否真实，可采用一个高精度的数字温度计测试，发现读出的值与其基本一致，由此推断如果在同一时间增加采集温度的个数，则可以进一步提高温度的精度。 

    

## 5.4 注意事项

1. 测驱动电路的过程中发现数码管不能正常显示的情况，经检验发现主要是由于接触不良的问题。其中包括线的接触不良和芯片的接触不良，在实验过程中，数码管有几段时隐时现。用万用表检测发现有线接触不良，重焊后就可正常显示。而芯片接触不良用万用表欧姆档检测有几个引脚本该相通的地方却未通，其解决方法为把芯片拔出正对万能板孔均匀用力插入。
2. 由于焊接时的大意损坏了元件，在调试是我们怎么都找不到问题的所在，我们是用排除法一个一个元件的测试的找出损坏的元件，重新换上新的元件，故障得以解决。
3. 还有关于程序调试过程中出现的问题。执行程序是发现程序执行不稳定，排除软件的错误外，经老师的指导才发现单片机的EA管脚没有接地。因为次程序只用到片内程序存储器，所以在程序执行时一定要把管脚接的，这样程序才能只执行片内的，不然程序会乱跳，从而导致程序执行不稳定。
4. 接三极管的过程中，发现电路不管程序是什么，数码管都是显示8字，经查除发现原来是三极管的极端弄错了，从新调整极端顺序。
5. 在电路调试时由于我们选用的是对射型的光电传感器由于没正对好使的调试一度中断，最后我们通过反复的调试解决了问题
6. 调试时由于线路的繁杂，没有仔细的找到对应部分的线路，使的调试的结果与预期出现很大的误差，我们通过梳理线路后就调试成功了并达到了预期的效果。
7. 在调试时几个模块的电路调试都不是很好，我们就要对线路的硬件连接做仔细的检查，调试的时候我们首先要确定连接的电路没有错误，各个元件管脚间没有虚连，那样我们的调试才会更顺利。# 结束语

这个最后的项目设计对我很有帮助的。这种设计使我对在大学学习的知识有了全面的了解和深入的思考，并让我对所学的知识以及思考和编写最终设计综合游戏的能力有所了解和提升。最后，我完成了这项任务。撰写论文的过程也是学习专业知识的过程的一个重要的阶段。它使我能够使用现有的专业基础知识来设计，分析和解决理论或实践问题，并将知识转化为实践技能培训。我已经掌握了运用自己的知识来解决实际问题的能力。

通过这个最终设计的结果，我发现只有提高理论水平，才能将教科书的知识和实践结合起来，理论知识可以为教学实践服务，以提高我的实践能力。这个设计非常有意义。我有很多经验。通过这个最后的项目，我们知道了理论与实践之间的距离，将理论与实践相结合的重要性，并且我们已经学到了很多我们无法从书本中学到的知识。

我们的学习不仅应以书籍为基础的限制，而且还应以解决理论和实践中的实际问题为目标和导向，而且还应结合实践去具体分析。理论问题是实践问题，问题解决是课程研究。学生本身就是作为专家来看待。用手解决问题比用大脑解决问题更深刻。学习应要求理论与实践相结合。理论问题也是实际问题。这种方法不仅有助于完成理论知识的巩固，而且将有助于推进实践，解决实际问题，并增强我们服务和解决问题的能力。

总的来说，这个最终的设计使我学到了很多东西。这是大学的最后也是最重要的一课。它对我们的未来产生深远的影响，具有十分重要的意义。





# 参考文献

[1] 李伯成.基于MCS-51单片机的嵌入式系统设计.电子工业出版社.2004  
[2] 宗光华,李大寨.多单片机系统应用技术.国防工业出版社.2003  
[3] 胡学海.单片机原理及应用系统设计. 电子工业出版社.2005  
[4] 孙育才,王荣兴,孙华芳.ATMEL新型AT89S52系列单片机及其应用.清华大学  
   出版社.2005  
[5] 于京,张景璐.51系列单片机C程序设计与应用案例.中国电力出版社.2006  
[6] 蔡杏山.Protel 99 SE 电路设计.人民邮电出版社. 2007  
[7] 杨小川.Protel DXP 设计指导教程. 清华大学出版社.2003  
[8]  李晓荃. 单片机原理与应用[M].  电子工业出版社，2000年8月  
[9]  何立民.  AVR单片机原理与接口技术[M]. 北京航空航天大学出版社，2002  
[10]  杨帮文. 新型继电器实用手册[M]. 北京人民邮电出版社.2004  
[11] 何希才.传感器及其应用电路[M].北京:电子工业出版社,2001.131-135  
[12] 丁镇生.传感器及传感技术应用[M].北京:电子工业出版社,1998.  
[13] 王家桢.传感器与变送器[M].北京:清华大学出版社,1996.  
[14] 曾巧媛.单片机原理及应用[M].北京：电子工业出版社.2002  
[15] 何力民.单片机高级教程[M].北京：北京航空大学出版社.2000  
[16] 金发庆.传感器技术与应用[M].北京：北京机械工业出版社.2000  
[17] Katsuhiko Ogata．Moden Control Engineering．Publishing house of electronics industry，2000：1 96—202.  
[18] Microchip 24C01B/02B 8 位PIC®单片机产品手册[ED/OL].  
[19] Borko H，Bernier C L．Indexing concepts and methods .New York:Academic .
[20] Dallas products data Book[M]，1999.  
[21] Maxim products data Book[M]，2001.  
[22] Shao Jianlong, He Chun. Design of a Portable Popular Multifunctional Development System for 8051 Single-chip Microprocessor Family [J].   Computer Engineering and Applications, 2003.13.
      




# 致 谢

本课题的完成中，我得到了很多人的帮助，在此表示衷心的感谢!

首先感谢我的指导老师高老师，我的课题是在他的指导和帮助下完成的，他深厚的理论功底和严谨的治学态度以及高度的敬业精神使我受益非浅，对我课题的完成起到了至关重要的作用。
经过这次毕业设计，使我觉得不论从理论知识还是从实际操纵中都学到了不少知识，我想归纳起来，主要有以下四个方面：  

* 经过这次毕业设计，它让我接触更多平时没接触的科学仪器设备、元器件以及获得相关的仪器调试经验，同时我也发现自己在这方面很多不足之处。体会到理论知识对实践有很大的知道作用，她让我知道，只有在正确的理论指引下，才能设计出合乎实际需要的硬件电路。
* 学会了高效率的查阅资料、运用工具书、医用网络查找资料。我发现，在我们所使用的书籍上有些知识在实际应用中其实不是十分理想，各种参数都需要自己去调整。偶尔还会遇到错误的资料现象，这就要求我们应更加注重实践环节。
* 在毕业设计中，我们应当注意重点与细节的关系。
* 失败不可怕，只要不趴下，昂首向前走，希望总会有的。
* 同组同学相互包容，彼此合作，取长补短，才能铸就最后的成功。可以说这次毕业设计是对所学知识的一次运用和检阅，同时对自学能力提出很高的要求，所以平时的学习离开思考，就是严重的错误，我们学习不应该有偏科现象，各方面知识都要接触，这样做才能为毕业设计打下基石。  

最后,我要感谢的母校东北石油大学大学,为我提供的良好的学习与发展环境。感谢我的指导教师高新成给予我帮助，感谢母校开放、公正的言论环境,现代、实用的学习环境,舒适、便捷的生活环境让我顺利度过了人生的关键三年。愿所有校园里认识的,不认识的；来过的,走过的……愿你们珍惜握在手里的现在,抓住机遇,拥有一个美好的明天。





# 附录一 程序

程序如下:

```assembly
TM_NUM EQU 23H
TM_L EQU 22H
TM_H EQU 21H
DSPBUF EQU 40H
DQ BIT P2.0
FLAG BIT 00H
ORG 0000H
AJMP MAIN
ORG 000BH
AJMP __INTT0__
ORG 30H
MAIN: MOV SP,#070H
      MOV TMOD,#02H
      MOV IE,#82H
      MOV TH0,#6
      MOV TL0,#6
      MOV R2,#04
      MOV R1,#40H
 LL1: MOV @R1,#00
      INC R1
      DJNZ R2,LL1
      SETB RS0
      MOV R2,#00
      MOV R3,#00
      MOV R4,#00
      MOV R5,#00
      MOV 6FH,#00H
      CLR RS0
      CLR P3.0
      MOV 30H,#02
      MOV 31H,#06
      MOV 32H,#0
      LCALL CHEWEN
__INSTANCE__:CLR TR0
      SETB P2.1
      JB P2.1,K3
      LCALL KKEY
   K3:CLR 01H
      MOV R2,44H
      CJNE R2,#00,K2
      SJMP K7
   K2:CPL P3.0
      MOV R3,#30
   K1:LCALL TM_DISP
      DJNZ R3,K1
      DJNZ R2,K2
   K7:MOV R2,45H
      CJNE R2,#00,K4
      SJMP K6
   K4:MOV R4,#255
  K44:CPL P3.0
      MOV R3,#30
   K5:LCALL TM_DISP
      DJNZ R3,K5
      DJNZ R4,K44
      DEC R2
      CJNE R2,#00,K4
  K6: CLR P3.0
      LCALL CHEWEN
      SETB TR0
MAIN2:JB 01H, __INSTANCE__
      LCALL TM_DISP
      SJMP MAIN2
CHEWEN:CLR RS1
       CLR RS0
      LCALL GET_TM
      LCALL TM_COV
      LCALL DTOB
      LCALL DTOB1
      CLR C
      MOV A,33H
      SUBB A,44H
      MOV 44H,A
      MOV A,34H
      SUBB A,45H
      MOV 45H,A
      RET

    __INTT0__:PUSH ACC
          PUSH B
          SETB RS0
          INC R2
          CJNE R2,#100,__JT0__
          INC 6FH
    
          MOV A,6FH
          CJNE A,#20,__JT0__
          MOV 6FH,#00H
          INC R3
          MOV R2,#00H
          CJNE R3,#2,__JT0__
          SETB 01H
          MOV R3,#00
    
     __JT0__: CLR RS0
          POP B
          POP ACC
          RETI


KKEY: MOV R2,#00
      MOV R4,#0AH
 KS2: LCALL TM_DISP
      DJNZ R4,KS2
      SETB P2.1
      JB P2.1,KKEY1
      JNB P2.1,$
      MOV 60H,#DSPBUF+1
      MOV R1,#DSPBUF+1
      MOV R2,#00
KEY1: LCALL TM_DISP_2
      MOV P2,#0FFH
      MOV A,P2
      ORL A,#01
      CPL A
      JZ KEY1

KEY2: JNB ACC.1,KEY3
      JNB P2.1,$
      INC R1

      INC R2
      CJNE R2,#03,L13
      MOV R1,#DSPBUF+1
      MOV R2,#00

 L13: MOV 60H,R1
      SJMP KEY1
KEY3: JNB ACC.2,KEY4
      JNB P2.2,$
      MOV A,@R1
      CJNE R1,#41H,L1
      CJNE A,#09,LL
      SJMP KEY5
  L1: CJNE R1,#42H,L2
      MOV A,@R1
      CJNE A,#09,LL
      SJMP KEY5
  L2: CJNE R1,#43H,L3
      CJNE A,#09,LL

KEY5: MOV @R1,#00
  L3: SJMP KEY1
  LL: INC A
      MOV @R1,A
  L6: SJMP KEY1
KEY4: JNB ACC.3,KEY1
      JNB P2.3,$
      MOV 30H,41H
      MOV 31H,42H
      MOV 32H,43H
      ACALL DTOB
KKEY1:RET

     DTOB:SETB RS0
          SETB RS1
          MOV A,31H
          MOV B,#10
          MUL AB
          ADD A,32H
          MOV 33H,A
          MOV 34H,#00
          MOV R6,30H
          CJNE R6,#00,JT2
          SJMP JT22
     JT2: MOV A,33H
          ADD A,#100
          MOV 33H,A
          MOV A,34H
          ADDC A,#00
          MOV 34H,A
          DJNZ R6,JT2
     JT22:CLR RS1
          CLR RS0
          RET

  DTOB1:  SETB RS0
          SETB RS1
          MOV A,42H
          MOV B,#10
          MUL AB
          ADD A,43H
          MOV 44H,A
          MOV 45H,#00
          MOV R6,41H
          CJNE R6,#00,JJT2
          SJMP JJT22
    JJT2: MOV A,44H
          ADD A,#100
          MOV 44H,A
          MOV A,45H
          ADDC A,#00
          MOV 45H,A
          DJNZ R6,JJT2
   JJT22: CLR RS1
          CLR RS0
          RET
WR_18B20: MOV R2,#08H
         CLR C
         SETB DQ
         MOV R3,#02H
         DJNZ R3,$
         NOP
    WR1: CLR DQ
         MOV R3,#03H
         DJNZ R3,$
         RRC A
         MOV DQ,C
         MOV R3,#20
         DJNZ R3,$
         SETB DQ
         MOV R3,#03H
         DJNZ R3,$
         DJNZ R2,WR1
         SETB DQ
         RET
RD_18B20: MOV R4,#02H
          MOV R1,#22H
     RE0: MOV R2,#08H
     RE1: CLR C
          SETB DQ
          NOP
          CLR DQ
          NOP
          NOP
          SETB DQ
          MOV R3,#01H
          DJNZ R3,$
          MOV C,DQ
          MOV R3,#010H
          DJNZ R3,$
          RRC A
          DJNZ R2,RE1
          MOV @R1,A
          DEC R1
          DJNZ R4,RE0
          RET
INI_18B20: SETB DQ
           NOP
           CLR DQ
           MOV R4,#150
           DJNZ R4,$
          ;LCALL TM_DISP
          ;LCALL TM_DISP
           SETB DQ
      TS0: MOV R4,#19H
           JNB DQ,TS1
           DJNZ R4,TS0
           SJMP TS2
      TS1: SETB FLAG
           SJMP TS3
      TS2: CLR FLAG
           SJMP TS4
      TS3: ;LCALL TM_DISP
           MOV R4,#120
           DJNZ R4,$
      TS4: SETB DQ
           RET
DELAY8ms: MOV R6,#2H
      KL1: MOV R7,#80H

      KL2: DJNZ R7,KL2
          DJNZ R6,KL1
          RET

GET_TM: SETB DQ
    S1: LCALL INI_18B20
        JB FLAG,S2
        SJMP S1
    S2: MOV R4,#10H
        DJNZ R4,$
        MOV A,#0CCH
        LCALL WR_18B20
        MOV A,#44H
        LCALL WR_18B20
        MOV R4,#0ffH
    S3: LCALL TM_DISP
        DJNZ R4,S3
    S4: LCALL INI_18B20
        JB FLAG,S5
        SJMP S4
    S5: MOV A,#0CCH
        LCALL WR_18B20
        MOV A,#0BEH
        LCALL WR_18B20
        LCALL RD_18B20
        LCALL INI_18B20
        MOV R4,#10H
    S6: LCALL TM_DISP
        DJNZ R4,S6
    S7: RET
TM_COV: MOV A,#0F0H
        ANL A,TM_L
        SWAP A
        MOV TM_NUM,A
        MOV A,TM_H
        ANL A,#07H
        SWAP A
        ORL A,TM_NUM
        MOV TM_NUM,A
        MOV R0,#DSPBUF
        JNB 0FH,SING
        MOV @R0,#0BH
        CPL A
        CLR ACC.7
        ADD A,#01H
        MOV TM_NUM,A
        SJMP SING1
  SING: MOV @R0,#0AH
 SING1: MOV B,#10
        DIV AB
        INC R0
        MOV @R0,A
        INC R0
        MOV A,B
        MOV @R0,A
        INC R0
        MOV A,#00H
        JNB 13H,DOT1
        ADD A,#50
  DOT1: JNB 12H,DOT2
        ADD A,#25
  DOT2: JNB 11H,DOT3
        ADD A,#12
  DOT3: JNB 10H,DOT4
        ADD A,#6
  DOT4: MOV B,#10
        DIV AB
        MOV @R0,A
        RET
TM_DISP: CLR RS1
         CLR RS0
         MOV DPTR,#TAB
         MOV R0,#DSPBUF
         MOV B,#0FEH
         MOV R5,#04
   DIP1: MOV A,@R0
         MOV P0,#0FFH
         MOV P1,#0FFH
         MOVC A,@A+DPTR
         CJNE R5,#02,DIP2
         ANL A,#7FH
   DIP2: MOV P0,A
         MOV A,B
         MOV P1,A
         RL A
         MOV B,A
         LCALL DELAY8ms
         INC R0
         DJNZ R5,DIP1
         RET
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
TM_DISP_1: CLR RS1
         CLR RS0
         MOV DPTR,#TAB
         MOV R0,#DSPBUF
         MOV B,#0FEH
         MOV R5,#04
 DDIP4:  MOV A,R0
         MOV P0,#0FFH
         MOV P1,#0FFH
         CJNE A,60H,DDIP1
         MOV A,#0FFH
         SJMP DDIP3
  DDIP1: MOV A,@R0
         MOVC A,@A+DPTR
  DDIP3: CJNE R5,#02,DDIP2
         ANL A,#7FH
  DDIP2: MOV P0,A
         MOV A,B
         MOV P1,A
         RL A
         MOV B,A
         LCALL DELAY8ms
         INC R0
         DJNZ R5,DDIP4
         RET
 ;;;;;;;;;;;;;;;;;;;;;
 TM_DISP_2: MOV R4,#10H
  KS4: LCALL TM_DISP
      DJNZ R4,KS4
      MOV R4,#1FH
  KS5: LCALL TM_DISP_1
      DJNZ R4,KS5
      RET
TAB:
DB 0C0H,0F9H,0A4H,0B0H,99H,92H,82H,0F8H,80H,90H,0FFH,0CFH
END

```

# 附录二  硬件电路图

![图10-8 硬件电路图](http://my.gunplan.top/static/yj1.png)
