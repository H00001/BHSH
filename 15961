# 绪 论
## 温度控制系统研究的目的和重要性
在人类历史上，环境温度起着极其重要的作用。环境温度是工业生产中最常见的工艺参数之一。每个物理变化和每个化学反应过程都与温度密切相关。因此，温度控制是生产自动化中的重要任务。随着社会的发展，科学技术的进步以及温度测量设备在各个领域的使用，智能化是现代温度控制系统发展的主要组成部分。尤其是近年来，温度控制系统已经应用于人们生活的各个方面，但是温度控制一直是一个尚未发展的领域，但这是一个与人类息息相关的世纪之久的问题。在这种实际情况下，温度控制系统的设计具有广阔的应用前景和重要性。

此结构是为室温控制系统设计的，控制对象是室温。温度控制通常用于日常生活和工业领域。过去，温度控制是手动进行的，没有给予足够的重视。实际上，在许多地方都必须很好地调节温度。鉴于此问题，此系统设计的目的是创建一个可使其自身适应设定温度的系统。它被广泛使用，功能强大，小巧美观，易于携带。这是一种实用且廉价的控制系统。

## 温度控制系统研究概况
国外对温度控制技术的研究始于1970年代。首先，使用模拟组合仪器来收集现场信息并执行指令，记录和控制。分布式控制系统出现在1980年代后期。目前正在开发用于计算机数据采集的控制系统的集成多因素控制系统。当前，温度测量和控制技术在全球不同国家中迅速发展，并且一些国家正在朝着完全自动化和无人值守的方向发展。

中国对温度测量和控制技术的研究相对较晚，始于1980年代。中国工程师和技术人员已经吸收了工业化国家对温度测量和控制技术的吸收，从而掌握了室内温度的微机控制技术。该技术仅限于控制环境中的单个温度因子。中国温度测控设备的计算机应用一般处于从消化吸收阶段，易应用阶段到实用化，全面应用阶段的过渡和发展。从技术上讲，大多数情况下都存在由单片机控制的单参数单回路系统，并且没有真正的集成多参数控制系统。与工业化国家相比，差距很大。我国温度测控的现状还远远没有达到工业化水平。生产中仍有很多困扰我们的问题。设备支持能力差，工业化程度低，环境控制落后，软件和硬件资源无法共享和可靠。缺点，例如不良性行为。

直至今日，温度控制系统已经取得了重大的技术突破，并且在技术上已经取得成熟，并在自动控制领域已经有了巨大成绩。因此，在目前发展的基础上，制造一个基于单片机的温度控制系统基本没有太大缺点的存在。

## 温度传感器技术
传感器技术是现代信息技术的主要内容之一，信息技术包括计算机技术、通信技术和传感器技术。计算机和通信技术发展极快，相当成熟，而传感器应用技术因为需要使用模拟技术，而模拟技术还有很多问题难以解决，因此传感器应用技术也有待进一步发展。为了适应现代科学技术的发展，世界总舵国家都把传感器技术列为现代的关键技术之一。通常将能把非电量转换为电量的器件称为传感器，其实质上是一种功能块，作用是将来自外界的各种信号转换成电信号。它是实现测试与自动控制系统的首要环节。如果没有传感器对原始参数进行精确可靠地测量，那么无论是信号转换或信息处理，或者最佳数据的显示和控制都将无法实现。 

温度传感器，使用范围广，数量多，居各种传感器之手。温度传感器的发展大致经历了以下三个阶段：传统的分立式温度传感器（含敏感元件），主要输能够进行非电量和电量之间的转换；模拟集成温度传感器/控制器；智能温度传感器。目前，国际上新型温度传感器正从模拟式向数字式、集成化、智能化及网络化的方向发展。温度传感器按传感器与被测介质的接触方式可分为接触式温度传感器和非接触式温度传感器两大类，其中，接触式温度传感器的测温元件与被测对象要有良好的热接触，通过热传导及对流原理达到热平衡，这个示值即为被测对象的温度。这种测温方法精度比较高，并可测量物体内部的温度分布。但对于运动的、热容量比较小的及对感温元件有腐蚀作用的对象，这种方法将会产生很大的误差。非接触测温的测温元件与被测对象互不接触。常用的是辐射热交换原理。此种测温方法的主要特点是可测量运动状态的小目标及热容量小或变化迅速的对象，也可测量温度场的温度分布，但受环境的影响比较大。 

温度传感器的发展大致可分为以下几种：  
1. 热电偶传感器。热点偶传感器是工业测量中应用最广泛的一种温度传感器，它与被测对象直接接触，不受中间介质的影响，具有较高的精度；测量范围广，可从-50℃～1600℃进行连续测量，特殊的热电偶如金,铁,镍,铬最低可测到-269℃，钨,铼最高可达2800℃。
2. 模拟集成温度传感器。采用硅半导体集成工艺制成的，因此亦称硅传感器或单片集成温度传感器。模拟集成温度传感器是在20世纪80年代问世的，它将温度传感器集成在一个芯片上、可完成温度测量及模拟信号输出等功能。模拟集成温度传感器的主要特点是：功能单一、测温误差小、价格低、响应速度快、传输距离远、体积小、微功耗等，适合远距离测温，不需要进行非线性校准，外围电路简单。
3. 光纤传感器。光纤测温技术可分为两类:全辐射测温法，单辐射测温法，双波长测温法，多波长测温法等。特点是：光纤挠性好、透光谱段宽、传输损耗低，无论是就地使用或远传均十分方便而且光纤直径小，可以单根、成束、Y型或阵列方式使用，结构布置简单且体积小。缺点是：测量起来困难,难于实现较高的精度，工艺比较复杂,且造价高，推广应用有一定困难。
4. 半导体吸收式光纤温度传感器。半导体吸收式光纤温度传感器是利用了半导体材料的吸收光谱随温度变化的特性实现的。一种传光型光纤温度传感器，是指在光纤传感系统中，光纤仅作为光波的传输通路，而利用其它如光学式或机械式的敏感元件来感受被测温度的变化。在这类传感器中，半导体吸收式光纤温度传感器是研究得比较深入的一种。
5. 智能温度传感器。智能温度传感器(亦称数字温度传感器）是在20世纪90年代中期问世的。它是微电子技术、计算机技术和自动测试技术（ATE）的结晶。目前，国际上已开发出多种智能温度传感器系列产品。智能温度传感器内部包含温度传感器、A/D传感器、信号处理器、存储器（或寄存器）和接口电路。有的产品还带多路选择器、中央控制器（中央处理单元）、随机存取存储器（随机存取存储器）和只读存储器（只读存储器）。智能温度传感器能输出温度数据及相关的温度控制量，适配各种微控制器（M中央处理单元），并且可通过软件来实现测试功能，即智能化取决于软件的开发水平。
6. 数字温度传感器。开始供电时，数字温度传感器处于能量关闭状态，供电之后用户通过改变寄存器分辨率使其处于连续转换温度模式或者单一转换模式。在连续转换模式下，数字温度传感器连续转换温度并将结果存于温度寄存器中，读温度寄存器中的内容不影响其温度转换;在单一转换模式，数字温度传感器执行一次温度转换，结果存于温度寄存器中，然后回到关闭模式，这种转换模式适用于对温度敏感的应用场合。在应用中，用户可以通过程序设置分辨率寄存器来实现不同的温度分辨率，其分辨率有8位、9位、10位、11位或12位五种，对应温度分辨率分别为1.0℃、0.5℃、0.25℃、0.125℃或0.0625℃，温度转换结果的默认分辨率为9位。DS1722有摩托罗拉串行接口和标准三线接口两种通信接口，用户可以通过SERMODE管脚选择通信标准。

## 本文研究的目的和意义
由于传统的温湿度监测装置主要使用51单片机，而在温湿度采集使用了大量的逻辑电路结构复杂，传输速度慢，而且利用这种方法生产的仪表大多是只能对柜内的温湿度进行采集和显示，而且误差较大，不适合安装在配电柜内，而本市采用Atmega8l-8AU单片机，其内部资源相对比51更为丰富，而且内部含有AD转换模块，省去大部分仪表对温湿度采集后还须设计放大及AD转换电路，来进行数据转换接收，这样相对比传统仪表本设计电路更加简单而且可靠性更强，能够适应配电柜内复杂电气环境，可以对内部断路器或者电力电子设备进行监测，更好的保证配电柜稳定正常运行。

随着互联网技术的发展，未来配电柜必然向着网络化的方向发展，实现整个配电系统的计算机网络化控制，这样对于监测仪表来讲，快速的数据传输，较大的内存空间已成为发展趋势，本设计正是由于这样的一个出发点设计，利用单片机集成化和快速的处理能力能够更好地适应将来市场发展，具备比传统仪表更高的市场潜力。

本设计通过对配电柜内部高压断路器或者电力电子设备进行温湿度采集监测，通过报警保证配电柜内主要工作器件的稳定工作，实现对于配电柜的保护和监测功能。本设计的研究，符合现在以及未来市场的需求，具有较高的实际意义，本设计不仅功能多、结构简单，由于采用更为精确的传感器进行数据采集，误差小，因此能够应用于更多的领域，由于我国电力系统的稳定和发展，能够保证电能更好地输送和分配，降低电力系统的危险，保障了变电所工作人员的人身安全。具有很大的研发意义。

## 设计主要内容
本文从传统的高压配电柜温湿度监测方法入手，分析了其对高压配电柜柜内温度检测的优点和不足。结合当前科技的发展，本文提出了一种基于 Atmega8-8AU单片机的异常温湿度监测报警系统的设计，实现对配电柜柜内温湿度的实时监测的目的。在本设计中，详细介绍了整个系统的功能以及整个系统的硬件和软件的设计。具体内容如下： 

首先，本文首先第一章介绍了对配电柜柜内温湿度监测的背景、发展现状及目的意义，阐述了本课题研究的出发点以及要达到的目标。系统地介绍了不同时期对高压配电柜柜内温湿度监测的方法，以及目前对高压配电柜温湿度监测的主要方式。介绍了现在国内对于温湿度监测技术的发展情况。通过分析配电柜故障出现的原因，依据配电柜工作与高压、高温、强电磁环境中的实际情况，通过自己学习知识和和实际调查，最终选择了一种利用热敏电阻测温，HS1101湿度传感器测湿的集成传感器实现温湿度的测量，利用单片机将传感器采集的数据进行处理实现配电柜柜内的温湿度的监测。第二章通过对硬件电路的设计阐述，将本设计实现的方式展现出来，讲述了设计原理。第三章则对软件设计部分进行了讲解，阐述了本设计在软件设计部分的思路和实现方法。第四章是对本设计整体可靠性能进行了相应分析，保证了整个系统的实际可行性。第五章对于实物进行实际的比较和分析。

### 总体设计原则
由于本设计的产品是应用在配电柜，在技术参数上参考的KYN28-12配电柜，所以在设计时元器件的选择要满足其技术要求。要实现对于柜内温、湿度实时监测，而且考虑到配电柜内复杂的工作环境，所以系统要有很好抗干扰能力，同要求测量结果精确并且能够通过数码管显示出来，通过对柜内温湿度值的判断进行相应的显示和报警。同时作为一个适应市场的设计那么其设计外观要适应配电柜仪表室的空间，所以要求体积尽量小，成本低，性价比高的芯片和电路设计。
### 设计方法实现
由于对于一款仪表的设计工作量十分繁重而且十分复杂，那么再设计过程中就要将系统模块划分通过一部部的模块设计最终完成整个及系统的设计[5]。
1. 硬件电路的实现  
硬件电路的设计就是要将设计中要实现功能转变为现实。通过单片机控制，外围电路的设计来实现整个系统的功能。那么对硬件电路设计就应该包括主控制器的外围接口的设计，还有其复位电路，时钟电路，报警电路。由于配电内的仪表室供电电压为220V交流电，单片机的供电电压为5V直流电。所以还需设计电源转换模块。将仪表能够直接在仪表室内取电使用，在要求实现显示、控制就包括显示电路、按键电路，和相应控制电路。对于要测量的采集就需要传感器使用那么对传感器的选择，对于这里，我选择了我实习公司生产的一款传感器，这款传感器结构简单功能齐全。
2. 软件设计  
对于软件在本设计中起着很重要的作用，系统的参数和驱动都是依靠软件来实现的。在系统中虽然只测量的量只有温湿度，但由于这两个量都是非电的物理量，这就需要在软件设计时添加很多算法和函数，这就使得程序变得复杂，在这里温度由于传感器直接采集电压信号所以就要添加A/D模块，由于热敏电阻的特性在程序设计师究竟是用插值法和查表法，湿度是频率信号的形式传输的，那么就可以采取利用外部时钟信号来启动定时器/计数器来测量，就需要在硬件内启动多个定时器和计数器的使用。加大了主程序的难度，那么在程序设计的时候就应该采用模块化的方法，将复杂程序进行简化，通过各个模块的相互配合来实现这个软件程序的驱动。
3. 软件和硬件的相互协调  
在某些特别的模块是可以同硬件来实现也可以通过软件实现的。通过软件和硬件相互协调可以优化设计方案，提高设计的质量，性能，降低设计的成本和负担，以软件为主的方案能降低成本，但需要投入大量的时间来进行软件设计。从可靠性来讲，硬件设计的越多那么器件的选择，焊接的质量会造成很多故障点；而软件会是在故障排除后，其可靠性不会发生改变相对稳定。所以在具体设计中应该结合系统的设计要求和相互对比在一些易于出现故障的地方进行反复的推敲，来确定是用软件设计来代替还是通过硬件设计来消除故障的发生，从而优化系统。

## 系统工作原理

单片机温度控制系统是以AT89C51单片机为控制核心，辅以采样反馈电路，驱动电路，晶闸管主电路对电炉炉温进行控制的微机控制系统。系统的原理框图如图2-1所示，其基本控制原理为: 用键盘将温度的设定值送入单片机，并在发光二极管显示，启动运行后，通过信号采集电路将温度信号采集到后，送入单片机系统进行PID 控制运算，将控制量输出，改变可控硅管的接通时间便可改变加热丝功率，以达到调节温度的目的控制电阻炉的加热。

当由于环境温度变化太剧烈或由于加热或降温设备出现故障，或者温度传感头出现故障导致在一段时间内不能将环境温度调整到规定的温度限内的时候，单片机通过三极管驱动扬声器发出警笛声。 

本毕业设计就是就应这样要求结合自己学习的知识设计一种能够实现对于温湿度能够进行实时的监测及报警，本设计具有精度高，电路简单，反应速度快，抗干扰性能强的特点整体结构包括硬件结构：主电路设计，显示电路、键盘电路。软件结构：主程序、温湿度采集程序，显示程序。程序采用progisp下载器将程序下载到单片机中。

当由于环境温度变化太剧烈或由于加热或降温设备出现故障，或者温度传感头出现故障导致在一段时间内不能将环境温度调整到规定的温度限内的时候，单片机通过三极管驱动扬声器发出警笛声。

## 系统功能介绍
本设计是对房间温度进行检测与控制，设计的温度控制系统实现了基本的温度控制功能：当温度低于设定的温度时，系统自动通过PWM启动加热装置，使温度上升。当温度高于设定的温度时，停止加热。三位数码管及时显示温度，精确到小数点后一位。  
本文设计的温度控制系统具有如下功能：
1. 通过温度芯片MF52NTC采集温度，并以数字信号的方式传送给单片机。
2. 四位数码管动态实时显示房间温度，显示精度0.10C。
3. 三个按键实现对于标准温度的设定。
4. 利用温湿度控制芯片对于温度进行自动或手动控制。


# 课题研究与开发技术基础

## AT89C51单片机

at89c51是一个os8-bit微处理器(fpeam只读存储器-flashprog随机存取只读存储器fpram和一个可自动擦除随机存取只读数据的存储器)，俗称嵌入式微控制器。该设计原件是采用基于atmel的高密度非易失性只读存储器的制造技术设计制造，与符合行业标准的atmcs-51指令集与输出引脚指令集是兼容的并可以一直连接到。由于多功能8位中央处理器和闪存指令集结合在一个独立的单芯片中，atmel的at89c51是一个高效的嵌入式微控制器，它为许多的嵌入式控制系统应用提供了一个灵活和廉价的解决方案。

![3-8硬件电路图](http://my.gunplan.top/static/3.2.png)

at89c51可由一个atmel公司的控制器在线进行编程，用于嵌入式温度数据采集和嵌入式数据通信。at89c51是一款低成本功耗、高性能的cmos8位嵌入式单片机，其中主要包含了可通过重复自动擦除1000次的闪存和具有8k字节的isp(指令系统内的prog随机存取程序和存储器matlable)的嵌入式闪存只读程序和存储器，该芯片元器件主要采用了基于atmel的一种高密度、非易失性的嵌入式存储技术设计制造，兼容了标准的mcs-53指令系统和80c51引脚的结构。该系列芯片元器件集成了一个通用的8位中央处理器和一个isp的嵌入式闪存存储单元，功能强大的微型嵌入式计算机的at89c51可以为许多嵌入式控制和管理系统的应用和分析指令系统的发展历程提供一些具有降低生产成本和经济效益的解决问题的方案。at89c51具有以下的特点：40针、4k字节闪存片上应用程序数据存储器、128字节随机存取应用程序数据存储器(随机存取数据存储器)、32个外部双向数据输入/外部输出(i/o)串行通信端口，5个串行中断优先级，2个串行中断优先级嵌套中断，2个16位的可编程定时计数器，2个全双工串行通信控制端口，watchdog(wdt)控制电路，片上时钟振荡器。

### 编程方式

at89c51有三个并行的i/o口，p0：p0.0~p0.7，p1.0~p1.7，p2.0~p2.7。此外，当没有片上或外部存储器时，p0端口可以用作公共i/o的端口，当主机使用外部或片上存储器时，p0端口也可以直接用作地址数据线/端口或数据线。p1端口也可以直接作为一个通用的公共i/o端口，p1.0、p1.1、p1.5~p1.7也可以具有特殊的端口功能，如表3.4所示。当主机没有片外存储器时，p2端口可以直接用作公共的i/o端口，当主机使用外部存储器时，p2端口也可以直接用作高8位地址。

|引脚|特殊功能|
|:-:|:-:|
|P1.0|T2：定时器|
|P1.1|T2EX：定时器|
|P1.5| MOSI：用于在线编程(ISP)|
|P1.6| MOSI：用于在线编程(ISP)|
|P1.7| SCK：用于在线编程(ISP)|

表3.4 at89c51p1端口的特殊控制功能

|引脚|特殊功能|
|:-:|:-:|
|P3.0|RXD (串行端口输入)|
|P3.1|TXD (串行端口输入)|
|P3.2|INT0(外部中断输入0)|
|P3.3|INT1(外部中断输入1)|
|P3.4 |T0(定时器0外部输入)|
|p3.5|t1(外部定时器1外部定时信号发出输入)|
|P3.6 |WR (外部数据存储器写控制)|
|p3.7|rd(外部的数据存储器对外部读取和控制)|

表3.5 AT89C51 P3端口的特殊功能

## MF52NTC热敏电阻

NTC（负温度系数）是负百分比电阻变化每度℃.要确定一个精确的电阻误差的热敏电阻的温度系数，高精度小体积MF52NTC热敏电阻探头要比玻封外型探头更小而引线绝缘，其设计非常可靠,工作环境温度 -50℃至125℃，快速的反应时间和高可靠性使它更加适用于医疗设备和电子温度计产品系列.

过热保护器件用于保护设备及内部电路，防止受到发热的影响。
PTC热敏电阻（温度检测传感器)在室温环境下电阻值不会发生变化，但一旦超过某一温度（居里点)，电阻值便会急速上升，通过利用这一特性，能够检测到异常发热。
此外，贴片NTC热敏电阻应用了从积层贴片陶瓷片式电容器中积累而来的积层技术，并在世界范围内率先生产出了行业最小形状的产品。

### NTC负温度系数热敏电阻构成

NTC（Negative Temperature Coefficient）是指随温度上升电阻呈指数关系减小、具有负温度系数的热敏电阻现象和材料．该材料是利用锰、铜、硅、钴、铁、镍、锌等两种或两种以上的金属氧化物进行充分混合、成型、烧结等工艺而成的半导体陶瓷，可制成具有负温度系数（NTC）的热敏电阻．其电阻率和材料常数随材料成分比例、烧结气氛、烧结温度和结构状态不同而变化．现在还出现了以碳化硅、硒化锡、氮化钽等为代表的非氧化物系NTC热敏电阻]材料。

NTC热敏半导瓷大多是尖晶石结构或其他结构的氧化物陶瓷，具有负的温度系数，电阻值可近似表示为：

式中RT、RT0分别为温度T、T0时的电阻值，Bn为材料常数．陶瓷晶粒本身由于温度变化而使电阻率发生变化，这是由半导体特性决定的。

### MF52NTC热敏电阻参数
温度传感器绝缘引线规格: UL 3398 22AWG.黑色  
传感器端子规格：XH 2.5黑色 
HOUSING规格：XH 2.5-2P.  
NTC温度传感器未标注尺寸公差为±1.5mm.  
热敏电阻器符合RoHS要求.  
NTC热敏电阻规格：R25=10K±1% B25/85=3435  

### MF52NTC热敏电阻特点
1. 体积小适用于狭窄空间
2. 快速响应时间，灵敏度高
3. .引线耐弯折及易焊接
4. 热敏电阻优良的电绝缘性能
5. NTC探头引线尺寸可按要求定制




## Atmega8l-8AU 芯片
主芯片的选择：对于本设计来讲有要实现功能很多，测量的量要实现很复杂，同时要求实物体积尽量小，所以就要选择一款功能是十分强大而且外部引脚较多的单片机。所以我选择了Atmega8l-8AU，这种单片机相对比51来讲传输速度更快，内部资源更丰富，同时其驱动能力更强每个端口都能设为输入输出，性价比高。

### Atmega8l-8AU具有的优势
Atmega8l-8AU 有如下特点:

1. 单片机内部具有高质量的Flash程序存储器大小为8K，支持ISP和IAP。便于程序的调试和开发。内部512字节EEPROM就有寿命长，可以长期保存数据避免断电丢失。内部RAM容量大并且能够满足高级语言开发[7]。
2. 单片机的外部I/O接口全部可以设置上拉电阻，并且可以单独设定为输入和输出两种模式。也可以设置为高阻态输入。I/O口具有资源灵活、驱动能力强大、功能强大的特点。
3. 单片机内部包含许多种独立的时钟分频器，为UART、I2C、SPI提供使用。这其中的8位或者16位定时器配合的具有多达10位的预分频器，能够通过程序的设定的分频系数提供多种定时时间[8]。单片机内独有的定时器/计数器双向形成的三角波，在和输出比较寄存器相互配合，形成占空比可变、频率可变、相位可变的方波设计方法[9]。
4. 单片机具备增强型的高速同步异步串口，可以实现硬件生成校验码、硬件检测和校验、两级接收缓冲、在接收时能够主动调整定位波特率，屏蔽数据帧数等功能，提高了通信的可靠性，程序编写更加方便，方便组成分布式网络和实现多机通信系统的复杂应用。由于串口功能十分强大，单片机速度快，中断响应时间比较短，能够实现高波特波特率通信。
5. 具有面向字节的高速硬件串行接口TWI、SPI。TWI与I2C接口兼容，能够实现主从机的接收和发送的全部4种组合的多机通信[10]。
6. 单片机具有自动上电的复位电路、独立的看门狗、低电压检测电路，多个复位源，能够设置在系统启动后延时程序运行。
7. 单片机内还具有多种省电休眠模式，抗干扰能力强



## Progisp

progisp是一款USB编程下载器，支持对所有的AVR芯片进行编程，还可以对数据改变下载、比较识别字，芯片擦除等选项进行选择。

### 功能特点

1. 可通过progisp对免驱动USB下载器进行在线升级。
2. 可以编写所有atmel的低压isp编程接口的avr单片机/s5x/s8253/93cxx/24cxx
3. 可以通过progisp自定义支持最新型号的芯片的编程。
4. 适应电压宽（2.7v-5.5v）
5. 可为目标板提供时钟（对于AVR锁定芯片特别有用）
6. 可超低速下载（使用32768HZ的精振）
7. 下载速度快（8K程序大约2秒）
8. 可配合progisp实现编程项目的工程化管理

### 使用方式
1. 选择芯片
点击选择芯片的下拉框，选择要下载的芯片。
点击“黑色的箭头”可以弹出下载器与你的目标 cpu 的提示接线图或 cpu 在编程座上的
摆放位置图，如果是 isp 下载线是 10pin下载线接口与目标 cpu的连线示意图
如果是 hv 模式是 cpu 在编程座上的摆放位置图
2. 编程选项
勾选“编程栏”相应的编程选项，点击“自动”可以完成编程。如果出错会有对话框弹
出进行提示。如果写入成功，信息提示栏会显示出相应成功的信息。也可以点击“擦除”擦
除芯片。
【提供时钟】勾选配合下载器的 XTAL 引脚可以解锁部分 avr 锁定芯片（ISP 模式有用）使
用方法 XTAL 连接目标板 cpu 的 XTAL1 引脚。这时就可以进入编程模式（锁定芯片是进入
不了编程模式的）。
【数据改变下载】指的是你调入的数据区的文件一旦改变，progisp 会自动执行“自动”执
行相应的动作。
【数据自动重载】指的是你调入的数据区的文件一旦改变且您点击了”自动“按钮，progisp
会重新调入您调入数据的文件，这个选项选中关闭 progisp，下次启动时会自动调入您最后
一次调入的文件。
所有的动作均可选择相应的主菜单来实现。
3. 数据缓冲区
可以点选下面的 flash 或 eeprom 进行切换。也可以直接在编辑区进行编辑
4. 编程器测试
如果你的下载器或编程器支持的话可以利用此栏测试你的下载器或编程器进行测试。
对于高压编程器，你可以使用万用表，负表笔连接编程座 20 脚。正表笔连接编程座其
他脚这时点击软件中对应编程座的测试条，红色，5v 输出，蓝色 0v，内部短的测试条除 40
脚出是 5v，其他位置均是 12.5v（这个数字式估测，12-13v 之间均正确）
对于 ISP 下载器测试方法相同，负表笔接 10 脚 gnd，需要注意的 Nc 不起作用。


## ICCAVR编译器
程序的编写采用ICCAVR软件编写它主要有以下几个特点：
1. ICCAVR是一个综合了编辑器和工程管理器的集成工作环境（IDE）；
2. 源文件全部被组织到工程之中，文件的编辑和工程的构筑也在这个环境中完成，错误显示在状态窗口中，并且当你点击编译错误时，光标自动跳转到错误的那一行；
3. 该工程管理器还能直接产生 INTEL HEX格式文件的烧写文件（该格式的文件可被大多数
编程器所支持，可以直接下载到芯片中使用）和符合 AVRStudio的调试文件(COFF格式)。
4. ICCAVR是一个32位的程序，支持长文件名。
5. ICCAVR是一个综合了编辑器和工程管理器的集成开发环境(IDE)，是一个纯32位的程序，可在 Win 95、Win 98、Win ME、Win NT、Win 2000、Win XP和Win 7环境下运行。

## 发光二极管数码管

发光二极管显示器即为新型发光二极管显示器，具有数据显示醒目、成本低、配置灵活、接口可以方便等特点，单片机电源管理控制系统在应用数据管理操作系统的设计中常用它来直接显示电源管理操作系统的日常工作生活的状态和过程中所采集的数据在信息网络中所输入的数值等。

根据大屏幕发光点阵二极管的排列和结构不同，可将大屏幕发光点阵二极管显示器划分为大屏幕发光二极管点阵数码管和大屏幕发光二极管点阵数码显示器。大屏幕发光二极管点阵数码管主要就是用于在屏幕上显示英文数字和一些英文字母和图形符号，发光二极管点阵显示器同样可以在屏幕上显示英文数字、字母、男人和图形等。大屏幕发光点阵二极管数字点阵显示虽然点阵显示灵活，但它们主要占用的是单片微型计算机系统的软硬件资源比大屏幕发光二极管点阵数码管显示器要多得多。除了使用指定的程序，大屏幕发光点阵数码管显示器或led点阵显示器主要用于请求特殊的点阵显示场合，几乎所有的微型计算机系统应用点阵显示系统都使用大屏幕发光二极管数字点阵显示。

### 数字管理

数字管理的显示系统主要有两种显示模式，包括静态数据管理显示程序模式和动态显示程序模式。静态数据管理显示的程序非常不复杂，静态数据管理显示系统的程序模式设计起来非常简单，占用cpu的内存时间很少。仅需要当系统的显示字符串发生更改时才可以调用动态显示程序。但是，硬件和集成电路很多。每个八位数字晶体管都至少必须需要一个8位i/o电源输出输入端口，一个8位限流电源输出驱动器和8个8位限流输出电阻。通常偶尔也可能会需要使用少量的圆形数码管。发光二极管的应用由于静态扫描显示器需要使用较少的电子管组件，并且需要使用更多的静态数字组件与电子管组件在显示器之间进行切换很麻烦。为了有效简化了电路并且大大降低了成本，系统设计使用了一种动态扫描数字显示的方法。

动态扫描显示模式的工作原理是分别打开每个显示器，即一次仅显示一位。为了使用户看到所有的显示器都已显示，必须加快每个显示器的照明周期(增加扫描频率)。通过使用人眼的视觉残留效果，可以实现与连续显示所有显示器相同的效果。动态扫描显示电路如图3.2.2所示：

![图3.2.2动态扫描图](http://my.gunplan.top/static/003.jpg)

# 系统硬件电路设计
本系统实现的功能主要是:通过传感器将温、湿度采集,并实时通过数码管显示、通过端口与主机进行实时的数据传输,其中主机可以控制仪表的工作、系统给定温、湿度值得设定,系统通过传感器得到的数据以及程序的控制能够自动或者手动来调节温、湿度的变化。原理框图如图1所示:

## 硬件模块

根据本设计要实现的具体功能能够大致确定硬件电路应包含以下几个模块：主控制器、温湿度传感器、数码管显示电路、键盘电路、ISP下载电路、报警电路、电源电路等[6]。

## 主电路设计

### 时钟电路设计

时钟单片定时的标准，时钟电路必须按照单片机的要求来设计[11]。本设计的是在单片机外部采用8MHZ的晶体振荡器，单片机上XTAL1与XTAL2的作用分别是单片机内的振荡器的反向放大器的输入和输出，并在其两端加入电容用来消除噪声。放大器的模式是由熔丝位CKOPT来控制的。当熔丝位处于编程状态时振荡器在其输出引脚产生的振荡是满幅度的。这种模式频率范围比较宽而且十分适合噪声环境或者需要利用XTAL2引脚驱动第二个时钟缓冲器的时候。当熔丝位处于没被编程的时候，振荡器的信号输出幅度是比较小的。这样可以很大程度上降低功率损耗，同时这种情况下频率范围很窄不能够驱动其他时钟。

### 显示电路设计

发光二极管LED是简单而且廉价的显示输出设备，是目前智能仪器应用最为广泛显示设备，具有低电压，驱动电流小、快速响应、使用寿命长等特点[20]。数码管有共阴、共阳极两种，本设计采用共阳极的2个3位8段数码管来显示温湿度得值。在数码管的每段都应接一个电阻作为限流使用，当LED显示器与单片机的借口相接时，需要用锁存器将总线上瞬时信息锁存，来驱动显示器。驱动显示器的方式有静态驱动和动态驱动两种。

静态驱动是一个锁存器对应一位显示器的接口形式称为静态显示只要将显示信息送入锁存器中，显示器就将持续显示该信息，显示亮度易于保证，其缺点时当显示器为数较多时，需要较多的锁存器，限流电阻等硬件，成本高，功耗也大。

动态驱动是当显示器为数较多时，适合采用动态驱动，其利用人视觉上残留的现象是个显示器轮流点亮，当每个显示器点亮的通电频率在50Hz以上时，人就不会感觉到显示器的闪动了。

由于要显示3位8段数码管而且有两个，所应采用动态驱动方式，利用两个74HC595锁存器，其中电源和清楚短接高电平，输出有效端和低端接低电平，数据从串行数输入端接入锁存器，在每个数据输入时钟上升沿时，串口数据移入锁存器内的寄存器，在每8个时钟周期完成一次数据传输在下一个时钟上升沿时，数据在出行输出端接处，由于采用两个锁存器，当串行输出端和和下一个锁存器的串行输入端连接时，两个锁存器实现了级联，数据会进入下一个锁存器，当给输出始终一个上升沿时数据进入锁存器这个时候当输出有效端低电平时，数据会从Q0~Q7端口传出，由低位到高位输出，这时，锁存器输出端和Led的8段相连，通过限流电阻的保护数码管的每段会被点亮，当级联的数据进入下一个锁存器是时通过同样的道理，由其控制这数码管的位选端，可以选择点那个数码管，这样一个锁存器控制显示的数字，另一个控制着点那个数码管实现数据的显示。

其电路图如图2-5所示：

![pastedGraphic.png](blob:file:///ae05aee0-a651-4861-a24e-04e0ebf8a880)

### 复位电路设计

单片机的复位是指利用硬件或者软件实现单片机和其内部逻辑电路的初始化复位是系统启动完成不可缺少的步骤。 在实际中复位引脚会受到很多外界影响，而且复位引脚通常会与ISP端口相接这样的话，其接线会较长，所以利用一个RC串联电路可增强抗干扰能力。同时在系统掉电时，电容会放电，给复位引脚一个高电平，当电源来电时，就会给复位引脚一个复位信号。而在正常时在电容充电完成复位引脚会一直处于低电平。

![图3-1电路硬件图](http://my.gunplan.top/static/2.0.1.png)

该解决方案使用AT89C51为核心处理芯片，芯片DS18B20测量内部温度，通过发送信号传输总线到MCU，并且和一个4位LED显示管温度。偏差用于控制电阻丝导通/截止时间的长度。实现恒温控制的界面的最终想法是最终想法。

## 各模块设计

### 温度采集电路

温度是一个常见非电物理量要想测量温度必须将其转变成可以测量的电信号，随意对于温度测量电路采用热敏电阻为感应器件，通过分压的方式利用电压的变化来反映当前的温度值[12]。热敏电阻主要有以下几个特点：

1. 电阻温度系数大，灵敏度高，通常温度变化1℃，阻值就变化1%~6%,戴南组温度系数绝对值比一般的金属电阻大10~100倍。
2. 结构简单，体积小。
3. 高电阻率，较小的热惯性，适合动态测量。
4. 使用方便，组织和温度变化成非线性关系。

根据电阻率随着温度变化的典型特性不同热敏电阻基本分为三种类型：负温度系数热敏电阻、正温度系数热敏电阻和临界温度热敏电阻。本设计温度采集电路采用MF52NTC温敏电阻作为感应元件，NTC热敏电阻器，其电阻率随着温度的升高而均匀减小，NTC热敏电阻一般采用负电阻系数很大的固体多晶半导体氧化物的混合物制成。测温、温度补偿和控温电路都可以根据热敏电阻的这一特性来设计，而且还可以设计成用来降低电路的浪涌电流的功率型组件。

NTC热敏电阻的温度特性符合指数规律： 

![equation.pdf](blob:file:///497db6e9-1c39-44d7-8c36-ed70daa333fb)             （2-1）

式中：*R*t为绝对温度时的电阻值、R0为参考温度T0 (K)下的电阻值，单位Ω，*B*为热敏电阻的负温度材料系数。

由于*B*值并不是稳定不变的，随着温度的变化，*B*值也会相应的变化。所以NTC热敏电阻在实际中的特性只能用指数关系曲线来粗略的概述，用这样的方法仅仅能将温度在一定的精度确定温度值和电阻值所在的范围。本设计采用温度采集电路如图2-2所示：

从上图可以看出温敏电阻和定值电阻R5形成了一个串联分压电路，输出电压*V*temp由于分压得到了一个随电阻值变化而变化的电压值，通过这个电压变化的数值能够得到NTC电阻的大小，也就能算出当前的温度值。从上图可以看出温敏电阻和定值电阻R5形成了一个串联分压电路，输出电压*V*temp由于分压得到了一个随电阻值变化而变化的电压值，通过这个电压变化的数值能够得到NTC电阻的大小，也就能算出当前的温度值。

![pastedGraphic.png](blob:file:///52d9a8a7-ae50-4023-93d7-f174e10cc9f2)

图2-2温度采集电路

利用欧姆定律可以算出输出电压值*V*temp和NTC电阻值的关系表达式：

![equation_1.pdf](blob:file:///bb19d1be-6f0c-4944-992e-bdfa37dc1fa9)         （2-2）

那么这温度点对于ADC转换之后的数字量可以计算：

![equation_2.pdf](blob:file:///6ee048b9-010f-49ca-99d4-cc8dccd6d6c4)         （2-3）

例如，查表可知当温度值为0度是*R*t电阻值为12.6900 千欧,那么该温度的数字量为572，以此类推可得到个温度的数字量。

### 温度传感器电路

本文在课题教学研究中所采用的的温度传感器一般可以分为采用一个美国两个单线的四位数字小型环境温度传感器例如ds18b20。该稳压传感器4.7k##hz该传感器用于输出稳压信号的上和下拉稳压电阻直接通过连接输入到一个微控制器的一个p1.0引脚。

半导体温度传感器DS18B20产生Dalalas数字温度传感器，多并行总线技术。该器件在小型集成电路芯片上制造温度敏感的半导体器件、 A / D 转换器、存储器等。在对本设计中的温度传感器进行多次比较和考虑之后，选择了单线数字设备DS18B20，主要是由于以下原因：

1. 该检测系统的主要特点功能是：在一个允许温度范围的工作检测温度是-55℃〜+125℃，±0.5度的工作温度和在测量值的精度是5℃。温度函数转换器高精度。9至12变量，温度检测值数据可以被直接转换成一个串行16位的非二进制的或数字输出形式的数据输出;最大输入时间频率转变精度为12位测量精度转变为750ms;它们都可以通过一条数据线被直接供电，具有超低电源功耗。
2. 系统进行成本：由于我国计算机信息技术和微电子科学技术的发展，新型企业大规模集成电路设计越来越具有强大，体积变得小是越来越会发生的，价格也会下跌。DS18B20提交空间与普通晶体管之间几乎没有本质区别的，价格只有约$1。
3. 降低系统总线技术操作复杂度：由于设备ds18b20是单总线测量设备，微处理器与之进行接口时只不过需要至少占用在校学生一个模拟i/o口，一根模拟总线测量方式线就可以同时连接数十个设备ds18b20，温度管理进行总线测量方法完全无需任何模拟企业外部网络控制元件，因此，与传统模拟工业生物温度传感器中的网络系统相比，可以测量得到大大幅度增加以及减少系统布线调试次数，降低温度管理系统的技术复杂性，减少重大工程项目的基础建设工作量。
4. 减少系统的引线调试和日常维护：由于大量减少的系统引线数量可以不会引起一些小的事情，大量使用减少接线的工程数量，减少接线工程数量产生的引线施工成本量大大降低，系统的内部布线过程复杂度的降低调试和日常维护另一方面，因为系统引线接口数量的减少产生的故障数量大大下降，使得整个系统中的接口工作变得简单许多，给系统的日常调试工作带来更多方便，之所以认为dsl8820是全方位数字化的元器件，故障基本不会同时发生，干扰性的和可抗性强，因此为了让整个系统的在整个日常生活中而所进行需要保证正常工作的维护任务大大减少，为了更好保证系统可用性而所进行的日常维护相关工作保证正常系统运行的维护工作。

ds18b20温度控制系统传感器引线技术通常存在一个小的引线，引线上的数量通常是3，并且我们可以确定不在一个企业内部：一个单线程的数据网络信息传输包括系统总线数据端口vvdq、外部数据电源线vdd和公共网络地址总线端口gnd。ds18b20有2种直流供电的工作方法：其一种就是采用杜邦线的直流供电电压模式。此时，vdd被完全接地。当它开始产生能量空闲时，它通过内部一个电容器线路来让它存储剩余电量用从外部数据线路中获得剩余能量并用来让它完成整个温度功率转换，相应的当它完成整个温度功率转换的持续时间也会更长。在这种应用情况下，使用一个单片机的一个矩形i/o输出端口让它来自动拉起一个ds18b20总线。另一种模式是外部温度电源连接模式(vdd电源连接+5v)，完成外部温度变化测量的时候相应操作时间短。

在本设计项目中我也可以直接采用由大学生企业提供的并不在相关企业内部的各种电子信息流的流动强度及其发展计算方式等来进行设计实现。cds18b20传感器与驱动单片机的接口连接，其内部接口集成电路设计方案如软件图2-2所示。

![图2-2外部电路](http://my.gunplan.top/static/003.jpg)

### 温、湿度报警电路
本次设计有2个温湿度的设定最低点和2个温湿度的设定最高点。当前温湿度中的某项数据高于或低于该范围时，单片机将对其产生处理方案，在反馈给继电器的同时也将启动报警电路。蜂鸣器发声原理是电流通过电磁线圈，使电磁线圈产生磁场来驱动振动膜发声的，因此需要一定的电流才能驱动它，单片机IO引脚输出的电流较小，单片机输出的TTL电平基本上驱动不了蜂鸣器[18]，因此需要增加一个电流放大的电路。本设计采用一个三极管C8550来放大驱动蜂鸣器。蜂鸣器报警电路如图2-4所示：

图2-4 温湿度报警电路
如图所示，蜂鸣器的正极接到VCC（＋5V）电源上面，蜂鸣器的正极接到三极管的集电极，三极管的基极B经过限流电阻R1后由单片机的引脚控制，当单片机输出高电平时，三极管T1截止，没有电流流过线圈，蜂鸣器不发声；当单片机输出低电平时，三极管导通，这样蜂鸣器的电流形成回路，发出声音。因此，我们可以通过程序控制单片机引脚的电平来使蜂鸣器发出声音和关闭。在蜂鸣器两端并联一个二极管，起到续流的作用，当三极管停止导通时，由电流突然减小，而蜂鸣器内部线圈的缘故，会产感应电流，所以添加一个续流二级管起到保护电路的作用[19]。


### 通用键盘显示电路设计

![图2-3外部电路](http://my.gunplan.top/static/003.jpg)

所示，ale时钟脉冲可以作为一个时钟同步电路7805，从而与示意图的两个时钟脉冲同步。2-3。7805芯片的控制中断电路控制输出信号irqr连接到一个控制单片机的一个p1-1引脚。缓冲器输入地址是将寄存器中的a0连接输入到整个单片机的一个p2-5引脚，ae的缓冲信号则是连接到整个单片机的一个p2-6引脚。读写器和信号数据线缆分别和两个单片机的信号读写器和信号数据线缆来进行连接相连。7805芯片的外部数据传递运输线路由d0-d7与整个单片机的外部数据线直接相连进行相应的连接。

来自7805芯片和AT89C51芯片的许多信号是一致的，可以直接级联，这非常容易控制。7805芯片的8位数据线进行直接连接到AT89C51芯片的P0端口。读取和写入信号连接到89C51的读取和写入信号。 AT89C51锁存信号ALE连接到7805 CLK，在内部分频后，会产生一个公共的非外部时钟脉冲。7805芯片的端子请求信号由反相器反转，然后连接到AT89C51的P1.1端口。 AT89C51的三个可寻址寄存器只需要两个地址即可寻址，即命令/状态寄存器地址和数据寄存器的地址值。7805芯片中与地址相关的信号是A0和芯片选择信号。您的连接直接确定寄存器地址在哪里。一旦确定了硬件电路，就确定了寄存器的地址。

发光驱动二极管的色号发光驱动效率和显示颜色分别取决于每个制造商的材料，如果出现没有什么意外情况是可以使用egred色号，出现其他意外情况可以使用reyellow或是egreen色号。发光电子二极管又称发光电子二极管主要是利用智能电子技术通过测量管理系统控制测量仪表中简单而常用的进入输出一个控制装置，通常说它可以直接用于用来指示一个机器的工作状态或其他相关企业服务信息。具有系统功耗低、配置灵活、接口方便、价格低廉、使用寿命长、对各种电子管直流的流动强度和电势差异性要求低、易于手动实现连接多种电路等多大优点。

液晶电视显示器本身是被动电子显示器，它本身不向外调节发出一种具有一定粒子性的主动电磁波，只需向外调节其发出一种具有一定粒子性的被动电磁波的频率数量。目前，常用的彩色液晶信息显示器通常是根据中国的而液晶对于信息显示失真率的问题总是按克列拉斯效应的基本原理设计制成的，它通常可以通过同时获得一个位于黑色信息发展初始背景上的一个白色初始字符或一个白色初始背景上的一个黑色初始字符的方式显示不同信息形式。便携式检测仪器主要用于电力测量和分析控制和检测智能动力电池中的电力，考虑到低损耗功率的应用要求，经常我们需要同时使用的就是液晶电视显示器，重量轻，功耗低的而且体积小，因此，广泛作为采用的检测手段。但是必须需要借助外来的灯光进行显示。阴极红外射线图形显像管这种显示器虽然可以同时显示多种图形，但显示界面更复杂，成本更高。

在多路显示温度自动巡检仪中只要您需要同时显示4位的和数字两种形式的显示温度和检测路数，可以不必考虑使用某种价格较高的荧光阴极或红射线液晶显像管;4位数字发光光电二极管的实际工作频率电子在直流的波动强度一般为240ma左右，由于需要使用一个交流电源进行供电，足以完全提供四位发光光电二极管液晶显示器所使用需要的最大功率，对于四位发光光电二极管而言，仅有4位，体积也很小，这样比较符合发光光电二极管和四位液晶电视显示器的诸多性能特点，本检测系统建议选择四位发光光电二极管液晶显示器。

键盘设计是一组多按键的整体组合。其主要工作功能之一是实时控制操作系统的正常工作运行状态，向系统接口输入大量数据和发出命令。有两种键盘类型：标准编码数字键盘和非标准编码数字键盘。

除了单个按键之外，编码器的键盘系统还包括一个用于自动生成键码的多个硬件控制电路、抖动控制电路、多个击键和多个按键之间移动时的保护器等电路。每按一个数字键，就表示可以自动重新生成这个数字键的键码。同时还会产生一个脉冲控制信号，通知系统中央处理控制单元进行接收。这种单片键盘使用方便，接口使用程序简单，但由于需要使用更多的相关硬件集成电路，价格也会变得更高，一般来说单片机键盘应用在该系统中的应用不是非常多。

非按列编码数字键盘仅由按行矩阵排列和非按列排行矩阵两种形式的编码键盘所组成。按键的抖动作用主要是简单地停止连接或自动断开触点，按键的触点抖动、按键软件代码的自动形成和每个按键的自动识别都必须是由按键软件操作来自动完成的。由于其价格经济并且实用，在各种单片机硬件应用管理系统中已经得到广泛应用。

上述一系列比较之后，它应该是非编码键盘。

P0端口： P0端口为8位漏极级开路双向 I/O 端口，每个引脚可吸收8TTL 栅极电子流的强度。当端口 P1的引脚首次写入1时，它被定义为高阻输入。P0可用于非内部程序数据存储器，可以定义为数据/地址的第八位。在 FIASH 编程中，P0作为原始代码输入端口。检查 FIASH 时，P0输出原始代码，必须拉起 P0的外部。

端口设置p1：端口设置p1是一个8位双向模拟i/o输出端口，内部分别提供上或下拉输出电阻。端口强度p1缓冲区强度可以达到接收进入输出4ttl门口的电子负载流的最大强度。p1端口的写入管脚板在写入1后，内部拉高，可以直接作为数据输入。当一个端口上的p1从外部被下拉到低稳压电平时，它将达到输出一个电子到直流的最大强度，这可能是由于内部上压下拉。在执行可以被擦除的非读写数据存储器程序编程和数据验证程序过程中，p1端口通常作为第8个输入地址被程序接收。

p2端口：p2端口是它是一个内部上和下拉稳压电阻的8位双向模拟i/o端口。p2端口栅极缓冲器引脚可以用来接收和控制输出4个ttttl栅极缓冲电子的直流的缓冲强度，当一个端口缓冲p2被直接写入"1"时，其引脚被内部上和下拉栅极电阻拉高并可以用作缓冲输入。因此，当它被直接用作电流输入时，端口位于p2的引脚被外部电压拉低到位于输出端的电子负载流的最大强度。这可能是由于内部上下牵拉的原因缘故。当p2端口，用于外部执行程序数据存储器或外部程序数据处理存储器同时访问的16位数据地址，输出时的端口相当p28的8位地址。读出和存储写入外部输出数据时在存储器输入地址8时，p2端口作为输出数据内容在特殊寄存功能下的寄存器。p2端口在整个闪存硬件编程和数据验证系统工作期间使它可以同时接收高八位存储地址以及存储信号和闪存控制器在系统中的信号。

p3端口：p3端口引脚为8个双向直流i/o控制端口，带有内部上压下拉控制电阻，可同时接收和控制输出4个在tttl栅极上的电子到直流的最大强度。当两个p3端口开始写入"1"时，它们在内部被迅速拉升并达到高水平并且被用作信号输入。作为一个输入，由于外部下拉低，p3端口将由于上下下拉而达到输出一个电子负载流的最大强度(ill)。

p3端口如果可以使用作为at89c51的一些特殊控制功能的通用接口也是完全可以的，如下面列表所示：

管脚备选功能

：-：：-：

P3.0 RXD (串行输入)

P3.1 TXD (串行输出)

P3.2/INT0(外部中断0)

P3.3/INT1(外部中断1)

P3.4 T0(定时器0外部输入)

p3.5t1(外部微波信号定时器1外部微波信号发出输入)

P3.6/WR (外部数据存储器写门)

P3.7/RD (外部数据存储器读取频闪)

p3端口同时它也可以用来接收一些主要的可用于总线进行射频闪烁信号编程和射频编程性能验证的射频控制电路信号。

rst：振荡器的复位字节输入。当外部振荡微处理器重置为一个器件时，在两个机器工作周期内保持一个rst引脚的高电平。ale/prog：当振荡器访问一个企业外部的数据网络存储器时，使用网络地址锁存器引脚所允许的外部输出正脉冲信号的高电平来对锁存网络地址的位置和状态进行复位字节。此引脚主要用于在振荡器的闪存脉冲编程期间通过脉冲输入用于闪存编程的脉冲。在通常的，周期性脉冲输出的ale正脉冲信号的恒定脉冲频率大约为1/6振荡器的频率。因此，它们实际上可以跳过一个用作外部脉冲输出的周期性脉冲或跳过一个用于定时目的。但是应该注意的是每一次都需要指出的一点是，外部的数据存储器，这将被用于跳过一个新的ale脉冲。如果振荡器需要禁用一个alert的复位字节输出，可以在振荡器的sfr8eh地址上重新设置0。此时，ale只需要执行一个movr，movd指令为一个新的ale。另外，该引脚被略微拉高。如果外部微处理器在外部脉冲执行的状态ale禁止，则该引脚的设置无效。

psen：外部的应用程序例如数据包和存储器的编程代码包含指令集的选择和数据通门控制信号。在外部软件程序执行的指令代码流在提取中的指令外部程序中的数据流在存储器系统中的每个代码提取指令值在提取期间，每个外部程序机器执行周期有效两次/psen。但是，访问外部应用程序例如数据库和存储器时，这两个有效的/psen的控制信号通常可能不会同时一起出现。

ea/vpp：这是用于保证当/ea端口器继续工作保持低稳压电位，这期间的外部应用程序相同存储器(0000h-ffffh)，无论它的存储器类型是否与内部的应用程序相同存储器。需要特别注意，当外部应用程序开始使用加密的文件方法1时，/ea中的存储器端口会自动锁定内部以用于防止文件重置;同时当/ea端口的继续运行保持正常的最高位时，这里的内部应用程序没有内存。该引脚还同时可以作为用于在不对闪存进行编程期间用于应用12v值的闪存进行编程的备用电源(vpp)。

xtal1：反向控制电路主要用来进行控制振荡信号放大器的时钟输入和内部时钟输出是用来进行控制系统的内部时钟质量管理工作以及辅助系统控制反向电路的外部驱动控制器的输入。

XTAL2：来自反向振荡器的输出。

### 电源电路

 由于配电柜内的交流电压为220V，而单片机电源电压为5V，所以设计一个经变压器变压在经过整流桥调压，再稳压的一个电源电路设计[20]。系统原理如图2-6所示：



图2-6 电源系统原理

首先当电源电压220V进过电压器变压会得到一个12V的交流电但是单片所需供电为5V的直流电，锁着需利用整流电路将交流电转换为直流电，这里采用MB10s整流桥堆，MB10S整流桥堆的工作原理为与单相全桥整流电路相似，能够使将变压器变压后的电压和电流保持一个方向不变但其虽然电压的方向单一的，但含有较大的交流成分，并不能直接给单片机供电，因此，在一般整流电路后，还需利用滤波电路将脉动的直流电压变为平滑的直流电压，电容滤波电路是比较常见而且简单滤波电路，电容比一般采用电解电容， 电容滤波电路利益哦那个电容的充放电作用，使输出电压趋于平滑。  

虽然整流滤波电路能够将交流电变为变为比较平滑的直流电压，可是由于输出电压是变压器副边电压有效值，当电压发生波动时，输出电压也会有波动，并且由于整流桥内的内阻影响当负载变化时内阻电压也会变化，从而影响输出电压的平均为了使输出的直流电更加稳定，还需采用稳压电路，稳压电路采用7805三端稳压器。折是一种集成电路元件，其外部有三个引脚分别为输入端、输出端、和公共端。按照功能可以分为固定式和可调式。本设计的电路采用固定式，其稳压电路如图所示，电容C3用于消除输出电压的高频噪声，一般取小于1![equation.pdf](blob:file:///8692716f-8334-4023-a7c8-02204f3f2fec)F的电容，也可以采用大一些的比如几微法的电容这样可获得比较大的脉冲电流。后电解的电解电容是用来滤波的。如果输入线很长的话，也可以在输入端加一个电容用来防止电路的自激振荡，但是如果C3的容量很大的话，一旦输入端断开，C3会向稳压器放电，从而损坏稳压器，所以，也可以再在输入和输出之间装一个二极管来保护电路。同其他的大功率元件一样7085的封装有金属和塑料封装两种其外形同设计成便于自身散热或者安装散热器。所以电源电路最终设计如图2-7所示：

![pastedGraphic.png](blob:file:///637b65c2-4a51-4cbc-a4d2-55b48e86867d)



## 温度控制电路的设计

![图3.2.2温度控制电路](http://my.gunplan.top/static/3.3.png)

通过正确设置开关元件脉冲的宽度来我们可以控制三端双向的可控硅开关元件的开启和脉冲关闭。当伴随着脉冲宽度的增加(脉冲占空比增加)时，三端双向的可控硅开关元件的脉冲导通加热时间和温度延长，电阻丝的开关元件加热的时间也延长，温度也升高。相反，如果我们减小了脉冲的宽度(相当于减小脉冲占空比)，则双向可控硅的脉冲导通加热时间和温度缩短，电阻丝的开关元件加热时间和温度缩短，从而大大降低了元件的温度。

**以此方法来控制温度的恒定不变。**



## 传感器接口电路设计

### 温度数据采集电路

ds18b20是基于dallassemiconductorcorporation的一个网络数字温度传感器。与其他的温度传感器连接方式相比，ds18b20具有以下的功能：当网络连接到如上所述微处理器的唯一单线路的接口模式中，只有一个端口可以被用于直接实现一个微处理器和ds18b20之间的双向通信的线路。

ds18b20支持独立的多点温度网络。几个节点ds18b20可以仅在三条线上通过并联进行连接，以方便地实现基于互联网的多点温度的测量。ds18b20不一定需要外围的组件。所有的传感器集成元件和温度信号转换集成电路都可以像普通的晶体管一样直接集成在单个温度集成电路中。传感器的温度测量范围一般为55〜125°c，温度集成电路测量的固有温度和分辨率范围为0.5°c。温度测量的结果直接传感器输出一个9位数字的温度测量信号，并直接通过"初始化总线"接口串行发送到传感器的中央控制单元。同时，可以直接发送crcr的温度校验码，具有较强的温度抗干扰和自动纠错的功能。温度测量的结果以9位数字的模式串行传输。

尽管ds18b20具有简单的嵌入式温度自动测量和控制系统，较高的分辨率和温度测量的精度，方便的网络连接以及较少的线路和资源占用等诸多优点，但在实际的应用中还是应该充分考虑以下的几个方面：

1. 尽管操作系统的硬件很简单，但我们还是需要相对复杂的软件处理器来对其进行温度补偿。由于ds18b20与其他微处理器之间的读写串行编程需要数据同时传输，因此必须注意保证在读写串行编程期间的连续读写编程时间，否则将是无法对读取进行温度补偿测量的结果。

2. ds18b20的可靠性相关数据未提及任何连接到单个总线的微处理器ds18b20的数量。这很容易就会导致一个错误的假设，即微处理器可以在总线上连接任意数量的总线ds18b20，而在实际的应用中并非如此。如果一条单个总线上微处理器连接了8个以上的总线ds18b20，则几乎没有必要考虑解决单个总线微处理器的可靠性和总线驱动问题以及我们在设计多点温度控制和测量传感器系统时所需要注意和考虑的一些问题。

3. 连接长度的限制是指采用连接长度为ads18b20的信号总线的电缆。由于它具有信号电缆的稳定性和电子电缆的阻挡比较大等特性，如果距离太大，信号传输幅度也会有所降低。如果在测试中普通信号电缆的双绞线传输电缆的长度明显地超过50m，则表示温度降低或读取数据不正确。如果将普通信号总线的电缆改为带屏蔽普通信号电缆的数据传输双绞线，则正常的总线通信数据传输距离应该可以轻松地达到150m。

ds18b20提供两种不同类型的器件封装：pr-35和pdsoic。引脚的顺序排列如下下表3.1所示。该软件封装操作系统中实际上已经使用了基于pr-35软件包的封装工具包。尽管如此，dds18b20仅用于提供一个返回9位温度数字的一个温度测量值，如如下图3.1.2所示。

管脚管脚定义说明

：-：：-：：-：

8脚SOIC 3脚PR-35

21 GND地

12 I/O 数据输入

83 VCC电源

34567 NC空脚

表3-1 DS18B20管脚排列

图3.1.2ds18b20温度值的表示计算方法

d9为低字节的符号位，0为正，1为负，高字节(d10~d15)的其他位用二进制符号位的补码或扩展位形式进行了表示;d0~d8为数据位，以二进制数据位的补码或扩展形式进行表示。如下表3.2显示了数值与温度之间的非线性关系。

温度测量数据(二位位十六进制)数据(十六进制)

：-：：-：：-：

+125000000001111101000FAH

+2500000000001100100032H

+0.500000000000000010001H

000000000000000000000H

+0.51111111111111111 FFFFH

-251111111111001110 FFCEH

-551111111110010010 FF92

表3.2 DS18B20值与温度的关系

由于房间的环境温度不能为负，因此系统不会考虑负温度。这样，您在选择硬件时就可以使用市售组件，而不必使用工业组件，从而可以大大降低成本。读取温度信息后，微控制器仅需要将低字节(D0〜D8)发送到主机和控制电路。

### 发光二极管显示接口电气设计

选择的系统控制方式是四路开关室温动态实时传感器显示，显示精度0.1℃。具体的电路原理图所示如图3.2：

![3-2硬件电路图](http://my.gunplan.top/static/3.2.png)


### 本章小结
这一章主要介绍了本设计的硬件电路设计部分，将硬件的设计模块和实现方式进行了阐述，本设计主要通过电源转换电路可以将硬件直接接在配电柜的仪表室内，通过显示电路是监控的温湿度值可以显示在数码管上，利用键盘电路可以将参数设定在硬件内并且可以控制柜内温湿度控制器，来保证温湿度的稳定。但是由于有配电柜内的空间较大有时一个传感器不能满足，将柜内温湿度直观地反映出来，可能涉及到多点测量，这样的话可能会造成信号在传输过程中出现问题，同时由于配电柜内电气干扰很大可能会造成数据的失真情况，所以柜体很大的配电柜内使用本设计的话还需加入隔离电路来保证数据接受的稳定和测量精度。


# 系统软件设计


任何形式的微机都离不开软件。软件设计是设计硬件的重要部分，通过软件才能让单片机实现他的功能，其实再从设计方案开始时就应该考虑到软件设计，因为软件程序的大小，决定这硬件CPU的内存选择，这就要涉及到单片机的选型了，这样可方便软件和硬件之间的相互协调工作，并且想好之后的软件设计和调试工具。当硬件做好之后软件设计就可开展开来，软件是可以单独编写然后进行调试的，当再测试工具上么有问题时，就可将软件下载单片机中来，测试硬件的功能。
对于程序设计应该满足以下要求：
1. 可靠性，对于任何硬件来言，其驱动程序都应该要求工作可靠，如果程序本身就不可靠的话，那么不管他设计的有多么巧妙，功能多齐全，结构都复杂这都是毫无用处的。它与硬件的设计不同，硬件的使用可能会受到外部因素的影响，但对于软件来他的可靠性主要在于程序是否正确。
2. 精度，程序中可能包含着大量计算，可能有大量的函数使用和复杂的数据处理，就拿本设计而言，在温度采集中采用串联分压方式最终传感器采集的是电信号，并不能被单片机直接接收，所以还要加数模转换，单片机内部的10位AD转换在计算温度是采用应该是插值的方法，这就需要大量的计算。而且在数码管上显示的时候还需设定显示的精度。
3. 速度，对于硬件来讲，他是有工作周期的，要按照时间节拍执行一步步指令，如果程序执行速度很慢的话，在工作周期内不能够完成相应的操作，就可能会造成丢失或者某些重要操作的延误。
4. 易理解性、易维护性。通常是指软件系统容易阅读和理解，容易发现和纠正错误，容易修改和补充。由于生产过程自动化程度的不断提高，测控系统的结构日趋复杂，设计人员很难在短时间内就对整个系统理解无误，软件的设计与调试不可能一次完成，有些问题是在运行中逐步暴露出来，这就要求编制的软件容易理解和修改。在软件的设计方法中，结构化设计是最好的一种设计方法，这种设计方法是由整体到局部，然后再由局部到细节，先考虑整个系统所要实现的功能，确定整体目标，然后把这个目标分成一个个的任务。任务中可以分成若干个子任务，送样逐层细分，逐个实现。本仪表就是采用这种模块化的设计方法。这样不但使得设计目标明确、思路清晰，而且在检错、调试时也很方便。当出现问题时，可以根据问题的种类和现象来判断是哪一部分出的问题，很容易找出故障所在和故障原因。同时，采用模块化程序结构设计方案，对于系统功能的扩充和修改也提供了很大的方便。
5. 实时性是电子测量系统的普遍要求，即要求系统及时响应外部事件的发生，并及时给出处理结果。近年来，由于硬件的集成度与运算速度的提高，配合相应的软件，实时性比较容易满足设计要求；
6. 准确性对整个系统具有重要意义，尤其是测量系统，系统要进行一定量的运算，算法的正确性和准确性对结果有着直接的影响，因此在算法的选择、计算的精度等方面都要符合设计的要求；
7. 可靠性是系统软件最重要的指标之一，作为能够稳定运行的系统，抗干扰技术的应用是必不可少的，最起码的要求是在软件受到干扰出现异常时，系统还能恢复正常工作。结合上述编制系统软件的基本要求，首先讨论软件的设计思想。

软件设计的基本方法是结构化程序设计基本步骤为：
1. 从上到下分层设计，把整个软件任务划分若干大的任务，每个大任务再分若干个小任务，这样一层层的分下去，直到这个小任务可以用编程语言实现为止，一般是先从主程序来设计，其他子程序，分程序，先用一些模块来代替，当系统一级程序编好之后，再将这些模块一次扩展为模块，，从而完成整个程序的设计。
2. 模块化编程，分层设计没有解决怎么产生每一层次的程序模块，模块化编程可以对同一部分内容的任意改动并且不行其他程序的设计，要不然就不能够将这些组成同一模块，按照这样思路模块内的程序更利于独立运行、修改和调试，方便实现一些有独特功能的子程序设计。
3. 结构化编程，采用模块化的结构程序更利于进一步细分，优于任何单一入口和出口的程序呢都是有以下三种基本结构组成：顺序结构、条件结构、循环结构。这三种结构在编程语言中都有对应的语句或者指令，而且他们都是单一出口和入口，这样查找问题是很方便。
现在单片机主要的开发语言是C语言，C语言相对比汇编来讲有更好的可靠性并且他可反复擦写。而且在设计完成相同功能的程序时，C语言的效率要比汇编的效率高出很多。并且更加方便调试和更改。其编程语言相能够更好兼容其他高级语言和和汇编词汇，同时也能够象汇编那样根据硬件的内部特性来设计程序驱动单片机的内部寄存器和外部接口。C语言是一种能快速上手而且易懂的结构化编程语言。每一程序都可以由一个或者多个相互独立的程序组成，可以互相调用。其语言模块还能够与汇编相互组合成为一个完整的程序。在目前的单片机编程序言中，C语言越来越受到人们的欢迎。


## 软件设计思想

为了满足系统的要求，编制软件时必须符合以下基本要求: 

易理解性、易维护性。通常是指软件系统容易阅读和理解，容易发现和纠正错误，容易修改和补充。由于生产过程自动化程度的不断提高，测控系统的结构日趋复杂，设计人员很难在短时间内就对整个系统理解无误，软件的设计与调试不可能。

一次完成，有些问题是在运行中逐步暴露出来，这就要求编制的软件容易理解和修改。在软件的设计方法中，结构化设计是最好的一种设计方法，这种设计方法是由整体到局部，然后再由局部到细节，先考虑整个系统所要实现的功能，确定整体目标，然后把这个目标分成一个个的任务。任务中可以分成若干个子任务，送样逐层细分，逐个实现。本仪表就是采用这种模块化的设计方法。这样不但使得设计目标明确、思路清晰，而且在检错、调试时也很方便。当出现问题时，可以根据问题的种类和现象来判断是哪一部分出的问题，很容易找出故障所在和故障原因。同时，采用模块化程序结构设计方案，对于系统功能的扩充和修改也提供了很大的方便。

实时性。实时性是本系统的基本要求。即要求系统及时响应外部事件的发生，并及时给出处理结果。近年来，由于硬件的集成度与速度的提高，配合相应的软件，实时性容易满足要求，特别是对于汇编语言编制的软件。  

1. 可测试性。系统软件的可测试性具有两方面的含义:其一是指比较容易地制定出测试准则，并根据这些准则对软件进行测定；其二是软件设计完成后，首先在模拟环境下运行，经过静态分析和动态仿真运行，证明准确无误后才可投入实际运行。  
2. 准确性。准确性对整个系统具有重要意义。系统要进行大量运算，算法的正确性和准确性问题对控制结果有直接影响，因此在算法选择、位数选择方面要适合要求。
3. 可靠性。可靠性是系统软件最重要的指标之一，它要求两方面的意义:第一是运行参数环境发生变化时，软件都能可靠运行并给出正确结果，也就是要求软件具有自适应性:第二是在环境恶劣干扰严重情况下，软件必须保证也能可靠运行，这对整个系统尤为重要。



## 软件组成

由于整个系统软件相对比较庞大，为了便于编写、调试、修改和增删，系统软件的编制采用了模块化的设计。即整个控制软件由许多独立的小模块组成，它们之间通过软件接口连接，遵循模块内部数据关系紧凑，模块之间数据关系松散的原则，按功能形成模块化结构。

系统的软件主要由主程序模块、数据采集模块、数据处理模块、控制算法模块等组成。主模块的功能是为其余几个模块构建整体框架及初始化工作；数据采集模块的作用是将A／D转换的数字量采集并储存到存储器中；数据处理模块是将采集到的数据进行一系列的处理，其中最重要的是数字滤波程序：控制算法模块完成控制系统的PID运算并且输出控制量。

下面就介绍本系统几个主要的程序模块。

## 程序结构分析
本系统单片机的软件程序结构采用模块化的结构编程，主要包括：主程序设计，EEPROM读写程序设计，锁存器程序设计，显示程序设计，按键程序设计、温度采集程序设计、湿度采集程序设计。

**主程序调用了4个子程序，分别是温度传感器读取程序，数码管显示程序、键盘扫描及按键处理程序、温度信号处理程序。**

* 键盘扫描电路及按键处理程序：实现键盘的输入按键的识别及进入相应的程序。
* 温度信号处理程序：对温度芯片送过来的数据进行处理，进行判断和显示。
* 数码管显示程序：向数码的显示送数，控制系统的显示部分。


## 主程序
主程序功能是首先完成各部分初始化，包括设备初始化、定时器初始化、看门狗初始化，EEPROM初始化。然后是调用各模块的的子程序进行相应的功能实现其包括温湿度显示、AD转换、温湿度控制及报警。如图3-1所示。

## 按键程序设计
本设计按键只有三个:设置键、加、减。这三个键要实现功能是通过设置键实现系统参数的设置，再长按设置键一定时间之后，进入手动模式，在手动模式中可以设定温湿度的给定范围，在一定时间没设置是系统自动跳回自动状态，显示当湿度的数值，由于键盘有按下和松开两种形式，其中按下时暂时的，当停止按压时按键就会变为开的形式，由于按键的状态值只是在程序中给定的但是实际上按键是在操作中实现的，所应该对按键进行消除抖动来协调人工操作和程序读取时的快慢不协调问题其程序框图如图3-2所示：
本系统在按键设置上采用两种模式，在默认情况下是手动模式，在手动模式时，按一下设置键可以是界面切换到设计界面，可以分别设置温湿度的上限，和下限，通过加、减键可以进行参数的更改和设定。在将这些设置完成后系统恢复到显示状态，显示当前测量的温湿度的值，另一种模式为自动模式，其设定方式是通过长按设置键来使模式切换到自动，在自动模式时，能够自动判断当前的状态，如果发现温湿度超限，则会发出报警信号。

图3-2 按键程序框图
1. 判断是否有键按下
按键的一端接在单片机串口上另一端是接地的因此当按键按下时单片机的接口上会得到一个低电平的输入。所以当有按键按下时单片机的接口应该收到一个0x00得值或者低于0xff得值。
2. 确定按下的是哪一个键
有本设计有3个按键，这样当按键按下时就要对识别是哪个按键按下，但是由于仪表内的参数是程序都设定好的，只要将按键设计不同的工作模式就行了。通过模式切换就可以知道 按下那个按键了。
3. 等待按键释放
在按键按下以后，还需确定按键是否松开，来判断按键的时间因为系统设计对于按键的模式分为按一次和长按，这样对于按键释放的时间就要进行相应的判断来使单片机切换到相应的模式。
4. 按键的值
由于按键不同模式其标志定位的值是不同的，系统需读取按键的值来是驱动单片机的模式切换。
5. 按键的消抖处理
按键消除抖动的方式有两种：一种为构建硬件电路来消除按键的抖动，主要原理是是利用RS触发器得互锁功能，能够消除抖动，但是这样就会加大硬件设计的负担，同时是电路复杂，按照通常的仪表来讲其显示模块一般不会占用太大的空间，应为配电柜仪表室空间是有限。所以我们采用的是另一种利用程序的延时消抖方式，利用单片机首次检测到按键信号的时候延时一段时间，在确定按键的状态，这样可以读出稳定之后的状态，相对硬件来讲软件的不增加成本，也不复杂。

## 温度采集模块
Y1由于单片机只能读取数字信号。当温度传感器将温度以电压量采集的，所以采用atmega8内AD模块进行数模转换，在硬件设计时也提到了对于温度计算的方法能够但不是每个二进制AD值都对应着整数温度这样的话测量出的温度就会有很大的误差需要进行校准，所以设计选择了用插值法来进行校准，这种方法是将校准曲线的分为许多小的区间，每个区间利用多项式进行拟合根据输入量的所在的区间来计算出现和对精准的测量值。线性插值原理如图3-3所示。 


图3-3 线性插值原理

当传感器的输入和输出按要求进行分段这样就可以将每一段的趋向近似呈直线来看，假设在Xi和Xi+1之间那么它相对的输出值可以近似地看成：
                      （3-1）
通过这样的计算可以将将温度值进行校准但是如何将置换华为是程序设计的具体是实现过程是这样的，首先要将校准曲线进行合理的分段选取基点。然后确定个插值点的AD得值，然后计算出相应输出值，最后还要查表比较，确定其所在的范围，再根据公式求出相应的值。温度采集程序如图3-4所示：




## 显示处理

显示处理模块主要完成人机交互作用，具体实现将采样温度值、设定温度值以字符的形式通过液晶显示出来。本系统使用HTl621作为显示驱动器。HTl621是128点内存映象和多功能驱动器。附录中给出了显示处理模块的源程序。

## 数据存储寄存器程序设计
EEPROM主要是将数据进行保存以保证在掉电的情况下单片机还能保存当前的数据那么他设计程序很简单基本就是包括从EEPROM写数据及然后就是进行判断是否写完然后设置寄存器，设置存储地址，置位写操作。读程序的方式跟写操作是同样的。
## 本章小结
这一部分主要对单片机的软件驱动动程序进行了设计，程序的设计采用了模块化的方式，如何将单片机要实现的功能利用软件的方式进行驱动，对于软件编写，不应该利用过多的技巧使编程语言变得生涩让人难懂，同时也不该将程序变得太长，这样也会造成与硬件不协调。在本系统中虽然测量的量只有温度和湿度两个量，当但是却采用了许多函数进行计算，程序比较复杂，这对与单片机的数据的处理能力有了很高的要求。虽然采用模块化编程的开发率很高但是效率有点低，但作为一种很基础的编程方式具有很好的指导意义和启发。


# 系统软件调试
对一个单片机系统来说不仅仅只有其性能的好坏、功能强弱以及成本的高低，可靠性也是一个十分重要的指标，如果一个系统的靠靠度不高那么会增加其维修成本降低使用寿命影响其正常的功能。在本系统研发阶段主要能够提高系统可靠性有以下几种方法：
1. 系统自身的可靠性，再设计过程中应减少设计和制作对系统自身可靠性的影响。
2. 抗干扰技术：提高系统的开干扰能力能够降低在实际运行时外部因素对于系统的影响。
3. 系统的容错性设计：要明确系统在受到外部因素影响时，系统能够进行避免和减少损失。
## 系统自身的可靠性设计
系统自身的可靠性是是通过自身硬件设计和软件设计来决定的，在硬件设计时能降低不稳定因素方法就是尽量在电路中少用器件，这样可以降低元器件失效对于系统自身的影响，当时当电路设计进行简化是会造成功能实现，这样的话并不能提高系统自身的稳定性，所以在设计时，为了尽最大程度对系统可靠性的保证，选择了对主芯片进行最大化利用，尽量开发其内丰富资源从简外围电路的设计，降低元件对自身的影响。在软件方面也应避免程序的冗杂。

## 硬件调试

首先应进行上电前的准备。为了防止硬件的损坏，应在电路板上电前进行电路检查，包括：对芯片的焊接方向进行检查，对芯片的引脚进行短路和断路检查。

在经过检查确认芯片的焊接没有任何问题的情况下，进行上电检查，在电源打开后，先判断电路是否存在异常，如出现芯片过热等现象，应及时切断电源，检查电路故障。在上电无异常状况的前提下，可以用万用表和示波器进行测量。首先测量电源芯片的输出电压是否正常，然后用示波器分别测量各个主要芯片电源引脚，察看电源的波形情况，如有纹波，则在预先留出的位置上焊上退耦电容以消除纹波，保证芯片工作正常。电源测量完毕后，进一步用示波器测量有源晶振的输出脚，其输出是频率为8MHz的波形(非方波，类似正弦波)。在确定晶振起振后，按住复位键，使单片机始终保持在复位状态，同时测量其各个引脚的电平情况，并同数据手册上表述的复位时的芯片引脚状态进行比对，由此可判断单片机是否正常。确认单片机正常之后就可以通过仿真器连接用户板进行调试。

## 软件的调试

由于软件的编写都是根据各个模块进行的，我们在进行软件的系统模拟调试时应，先确认硬件的接口标记是否在软件程序中一一对应，而且要检测所编写的软件有没有知识性的错误。在觉得基本没有问题后我们通过电脑将程序编译进入系统核心AT89S52单片机，检验软件与硬件各部分是否协调的工作。出现问题时我们要耐心的检查程序并作出适当的修改，直到软件系统的完全契合硬件电路，那我们软件就调试成功了。

1. 测试环境
   环境温度28摄氏度，室内面积20平方米
   测试仪器：数字万用表，温度计0----100摄氏度

2. 测试方法
   使系统运行，采用温度计同时测量室内度变化情况，得出系统测量的温度。

3. 测试结果
   设定温度由0摄氏度到40摄氏度
   标定温差<=1摄氏度   调节时间  15s（具体视现场情况）
   静态误差<=0.5摄氏度   最大超调量1摄氏度

4. 通过测试分析，对于实际室内的温度控制，可以再提出以下 2 点方法 :
   Ⅰ增加传感器个数，对各个温度传感器采集的数据进行求算术平均，可得到较为准确的温度值。
   Ⅱ对实际室内的温度控制，可采用功率较大的电炉，并且通过风扇对箱内温度进行充分搅和降温设备可采用空气压缩机等制冷设备。 

5. 通过实验测试和分析，发现虽然传感器的温度采集精度最高可得到 0.06 ℃，但测试得到的数据最小间隔为 0.03 ℃ 。通过分析，当对浮点数求平均处理时，遇到同一时刻两个传感头采集的温度相差不大，使 0.06 ℃ 时求出平均温度变为 0.03 ℃ 为了解该数据是否真实，可采用一个高精度的数字温度计测试，发现读出的值与其基本一致，由此推断如果在同一时间增加采集温度的个数，则可以进一步提高温度的精度。 

    

## 注意事项

1. 测驱动电路的过程中发现数码管不能正常显示的情况，经检验发现主要是由于接触不良的问题。其中包括线的接触不良和芯片的接触不良，在实验过程中，数码管有几段时隐时现。用万用表检测发现有线接触不良，重焊后就可正常显示。而芯片接触不良用万用表欧姆档检测有几个引脚本该相通的地方却未通，其解决方法为把芯片拔出正对万能板孔均匀用力插入。
2. 由于焊接时的大意损坏了元件，在调试是我们怎么都找不到问题的所在，我们是用排除法一个一个元件的测试的找出损坏的元件，重新换上新的元件，故障得以解决。
3. 还有关于程序调试过程中出现的问题。执行程序是发现程序执行不稳定，排除软件的错误外，经老师的指导才发现单片机的EA管脚没有接地。因为次程序只用到片内程序存储器，所以在程序执行时一定要把管脚接的，这样程序才能只执行片内的，不然程序会乱跳，从而导致程序执行不稳定。
4. 接三极管的过程中，发现电路不管程序是什么，数码管都是显示8字，经查除发现原来是三极管的极端弄错了，从新调整极端顺序。
5. 在电路调试时由于我们选用的是对射型的光电传感器由于没正对好使的调试一度中断，最后我们通过反复的调试解决了问题
6. 调试时由于线路的繁杂，没有仔细的找到对应部分的线路，使的调试的结果与预期出现很大的误差，我们通过梳理线路后就调试成功了并达到了预期的效果。
7. 在调试时几个模块的电路调试都不是很好，我们就要对线路的硬件连接做仔细的检查，调试的时候我们首先要确定连接的电路没有错误，各个元件管脚间没有虚连，那样我们的调试才会更顺利。

