# 第3章 系统硬件电路设计 

![图3-1 电路硬件图](http://my.gunplan.top/static/2.0.1.png)

本方案以 AT89C51 为核心，通过 DS18B20 检测室内的温度，将信号传给单片机，用四位 发光二极管数码管显示温度,同时,通过检测温度与标准设定温度的偏差来控制电阻丝通断时间的长度，从而达到恒温控制的目的。

## 3.1 各模块设计

### 3.1.1 温度传感器电路 

本课题采用的的温度传感器采用美国单线的数字温度传感器 DS18B20。这个传感器中 4.7 K 中传感器中输出信号的上拉电阻直接连接到微控制器的 P1.0 引脚。

温度传感器 DS18B20 是Dalalas半导体公司生产的数字温度传感器，采用多并行总线技术。该器件在小型集成电路芯片上制造温度敏感的半导体器件、 A / D 转换器、存储器等。在对本设计中的温度传感器进行多次比较和考虑之后，选择了单线数字设备DS18B20，主要是由于以下原因： 

1. 系统的特性：允许的范围检测是-55℃～+125℃ ，测温精度为士0.5℃；温度转换精度 9 ~ 12 位可变，温度转换值可直接以 16 位二进制数字方式串行输出；12位精度转换的最大时间为750ms；它可以由数据线供电，具有超低功耗。

2. 系统成本: 由于计算机技术和微电子技术的发展，新型大规模集成电路越来越强大，体积越来越小，价格越来越低。DS18B20 的占空间提交几乎和普通三极管没有本质区别，价格只有 1 美元左右。
3. 系统复杂度: 由于 DS18B20 是单总线设备，微处理器与之接口时只需要占用一个 I/O 口，一根总线可以连接数十个 DS18B20,温度测量无需任何外部元件，因此，与模拟传感器相比，可以大大减少布线次数,降低系统的复杂性，减少项目的建设量。
4. 系统的调试和维护: 由于引线的减少，大量减少接线的数量，减少工程产生的施工量降低，系统的布线复杂度的调试和维护方面，由于引线的减少，使得系统接口大为简化，给系统的调试带来方便，同时因为DSl8820是全数字元器件，故障率很低，抗干扰性强，因此减少了系统的在日常生活中，为了保证可用性进行的日常相关保证正常运行的工作。

DS18B20 温度传感器存在引线，引线数量是3，并且不在内部: 单线数据传输总线端口 DQ 、外部电源线 VDD 和公共地线 GND。DS18B20 有两种供电模式: 一种是数据线的供电模式。此时，VDD 被接地。当它产生空闲时，它通过内部电容器来存储电量用从数据线获得能量来完成温度转换，相应的完成温度转换的时间更长。在这种情况下，使用单片机的一个 I/O 端口来拉起 DS18B20 总线。另一种是外部电源模式 (VDD 连接 + 5V)，完成温度测量的相应时间短。

在本项目中采用提供不在内部的电子流的强度方式实现DS18B20传感器与单片机的连接，其接口电路如图2-2所示。

![图2-2 外部电路](http://my.gunplan.top/static/003.jpg)

### 2.2.2 通用键盘显示电路设计

![图2-3 外部电路](http://my.gunplan.top/static/003.jpg)

如图2-3所示，ALE信号作为8279的时钟信号，从而与时钟同步。8279的中断信号IRQ接到单片机的P1.1引脚。缓冲器地址A0接到单片机的P2.5引脚，片选信号则接到单片机的P2.6引脚。读写信号分别和单片机的读写信号相连。8279的数据线D0-D7与单片机的数据线直接相连。

8279与AT89C51的许多信号是兼容的，可直接连接，十分方便。8279的8位数据线直接连接到AT89C51的P0口。读写信号分别于89C51的读写信号相连接。AT89C51 的锁存信号 ALE 接 8279 的 CLK，内部分频后产生一个公共内部时钟信号。8279的终端请求信号经一个反相器反向后接AT89C51的P1.1.AT89C51的三个可寻址寄存器只需要两个地址，即命令/状态寄存器地址和数据寄存器地址。8279中与地址有关的信号为A0和片选信号，它们的链接情况直接决定着寄存器的地址，一旦硬件电路确定，寄存器的地址也就确定下来了。

发光二极管的发光效率和颜色取决于制造材料，如果没有什么意外是使用RED色号，出现其他情况使用yellow或green色号。发光二极管发光二极管是智能测量控制仪表中简单而常用的输出装置，通常用于指示机器的状态或其他信息。具有功耗低、配置灵活、接口方便、价格低廉、使用寿命长、对电子流的强度和电势差要求低、易于实现多路等优点。

液晶显示器是被动显示器，它本身不向外发出具有粒子性的电磁波，只需调节出具有粒子性的电磁波的数量。目前，常用的液晶显示器是根据液晶失真总是列效应的原理制成的,它可以获得黑色背景上的白色字符或白色背景上的黑色字符的显示形式。对于的便携式智能测控仪表并且使用电池供电，为了考虑到低功耗的要求，经常需要使用体积小的液晶显示器,重量轻，功耗极低，因此，广泛应用于仪器仪表。但是必须借助外来光显示。阴极射线显像管 显示器可以显示图形，但界面更复杂，成本更高。

在多路温度巡检仪中只需要显示4位数字形式的温度和路数，可以不必使用价格较高的阴极射线显像管；4位发光二极管的工作电子流的强度为240mA左右，由于使用交流电源供电，足以提供发光二极管显示器所需要的功率，对于发光二极管而言，仅有4位，体积也很小，这样比较发光二极管 和 液晶显示器的诸多特点，本系统选择 发光二极管显示器。

键盘是一组键的组合。其主要功能是控制系统的工作状态，向系统输入数据和命令。有两种类型: 编码键盘和非编码键盘。

除了按键之外，编码键盘还包括用于生成键码的硬件电路、抖动电路、多键和按键移动保护电路。每按一个键，就可以自动生成这个键的键码。同时产生脉冲信号，通知中央处理单元接收。这种键盘使用方便，接口程序简单，但需要更多的硬件电路，价格更贵，一般单片机应用系统使用较少。

非编码键盘仅由按行排列和列矩阵形式的键组成。按键的作用是简单地连接或断开触点，按键的抖动、按键代码的形成和按键的识别都是由软件来完成的。由于其经济实用，在单片机应用系统中得到广泛应用。

经过以上对比，可以采用非编码式键盘。

P0 端口: P0 端口为 8 位漏极级开路双向 I/O 端口，每个引脚可吸收 8TTL 栅极电子流的强度。当端口 P1 的引脚首次写入 1 时，它被定义为高阻输入。P0 可用于外部程序数据存储器，可以定义为数据/地址的第八位。在 FIASH 编程中，P0 作为原始代码输入端口。检查 FIASH 时，P0 输出原始代码，必须拉起 P0 的外部。

端口 P1: 端口 P1 是一个 8 位双向 I/O 端口，内部提供上拉电阻。端口 P1 缓冲区可以接收输出 4TTL 门电子流的强度。P1 端口的管脚写入 1 后，内部拉高，可以作为输入。当端口 P1 从外部被下拉到低电平时，它将输出电子流的强度，这是由于内部上拉。在 FLASH 编程和验证过程中，P1 端口作为第八个地址被接收。

P2 端口: P2 端口是一个内部上拉电阻的 8 位双向 I/O 端口。P2 端口缓冲器可以接收和输出 4 个 TTL 栅极电子流的强度，当端口 P2 被写入 “1” 时，其引脚被内部上拉电阻拉高并用作输入。因此，当它被用作输入时，端口 P2 的引脚被外部拉低到输出电子流的强度。这是由于内部上拉的缘故。P2 口用于外部程序存储器或 16 位地址外部数据存储器存取时，P2 口输出地址的上八位。当给出地址 “1” 时，它利用了内部上拉。在读写外部八位地址数据存储器时，P2 端口输出其特殊功能寄存器的内容。P2 端口在闪存编程和验证期间接收高八位地址信号和控制信号。

P3 端口: P3 端口引脚为 8 个双向 I/O 端口，带有内部上拉电阻，可接收和输出 4 个 TTL 栅极电子流的强度。当 P3 端口写入 “1” 时，它们在内部被拉升到高水平并用作输入。作为输入，由于外部下拉低，P3 端口将由于上拉而输出电子流的强度 (ILL)。

P3 端口也可以作为 AT89C51 的一些特殊功能端口，如下表所示:

管脚      备选功能 

:--: :-------------------------: 

P3.0 RXD (串行输入)

P3.1 TXD (串行输出)

P3.2    /INT0（外部中断0） 

P3.3   /INT1（外部中断1） 

P3.4 T0 (定时器 0 外部输入)

P3.5 T1 (定时器 1 外部输入)

P3.6 /WR (外部数据存储器写门)

P3.7 /RD (外部数据存储器读取频闪)

P3 端口同时接收一些用于闪烁编程和编程验证的控制信号。

RST：复位输入。当振荡器重置器件时，在两个机器周期内保持 RST 引脚高电平。ALE/PROG: 访问外部存储器时，使用地址锁存器允许的输出电平来锁存地址的状态字节。此引脚用于在闪存编程期间输入编程脉冲。在平时，ALE 输出频率周期恒定的正脉冲信号，为振荡器频率的 1/6。因此，它可以用作外部输出的脉冲或用于定时目的。但需要注意的是，每次用作外部数据存储器时，都会跳过一个 ALE 脉冲。如果要禁止 ALE 的输出，可以在 SFR8EH 地址上设置 0。此时，ALE 只执行 MOVR，MOVD 指令为 ALE。另外，该引脚被略微拉高。如果微处理器在外部执行状态 ALE 禁止，则设置无效。

PSEN：外部程序存储器的选通信号。在执行的代码指令存储器指令提取期间，每个机器周期有效两次/PSEN。但是，访问外部数据存储器时，这两个有效的/PSEN 信号不会出现。

EA/VPP: 当/EA 保持低电平时，此期间的外部程序存储器 (0000H-FFFFH)，不管是否有内部程序存储器。注意，当使用加密方法 1 时，/EA 锁定内部以重置;当/EA 端保持高位时，这里的内部程序内存。该引脚还用于在闪存编程期间应用 12v 编程电源 (VPP)。

XTAL1: 反向振荡放大器的输入和内部时钟工作电路的输入。

XTAL2：来自反向振荡器的输出。

\### 2.3.1 振荡器特性 

XTAL1 和 XTAL2 分别是反相放大器的输入和输出。该反向放大器可以配置为片内振荡器。石晶振荡和陶瓷振荡均可采用。如果使用外部时钟源驱动设备，则不应连接 XTAL2。对内部时钟信号的多余输入需要通过两频分频触发，因此对外部时钟信号的脉冲宽度没有要求,但是必须保证脉冲的高低电平的所需宽度。

\### 2.3.2 芯片擦除 

通过组合正确的控制信号并保持 ALE 引脚低 10 ms，可以完成整个 PE-ROM 阵列和三个锁存位的电擦除。在芯片擦除操作中，代码数组被写入 “1”，并且必须在重复编程非空存储字节之前执行此操作。

此外，AT89C51 配备了固定逻辑，可以从低频到零频率静态，支持两种软件可选的关机模式。空闲时中央单元停止工作。然而，随机存取存储器，定时器，计数器，串行接口和中断系统继续工作。在关机模式下，将保存随机存取存储器的内容，并冻结振荡器，并停用所使用的其他芯片功能，直到下一次硬件复位为止。

许多尚不了解51单片机的互联网用户会遇到以下问题：书籍和在线教程中的AT89S51是什么？8051 、 89C51 等，但没听说过 89S51。

在这里，剛入門的人应阐明单片机实际使用的产品理念。MCS-51 微控制器是美国英特公司于 1980年推出的一款产品。典型产品为 8031 (无内置程序存储器，实际使用已从市场上淘汰)，8051 (芯片采用 HMOS，功耗为 630mW，是 89C51 的 5 倍) 日期根据实际使用)。到目前为止，8751和其他通用产品仍是兼容的MCS-51核心系列微控制器（目前已停产89S51、89C51等）。在大学和职业学校的培训文档中，MCS-51微控制器仍然用作基础理论学习的代表。

在一些文档中，8051 甚至被称为 MCS-51 系列 MCU。8051是早期最典型的代表。由于 MCS-51 单片机的深刻意义，许多公司推出了兼容系列的单片机，这意味着内核确实存在 MCS-51。成为8位微控制器的标准。

其他公司的 51 MCU 产品与 MCS-51 核心兼容。相同的程序，在每个微控制器制造商的硬件上执行的结果是相同的，例如，我们常说的 89C51，如 at89c51 (已停产)，89S51，飞利浦 (飞利浦) 和 WINBOND(Winbond) 等。已停产的是 ATMEL 公司的 AT89C51 单片机。同时，许多功能在原始基础上得到了改进，例如B.时钟。闪存越好（程序存储器的内容至少可以重写1000次）。只读存储器 (一次写入)，AT89C51 的性能远远优于 8051。

关于市场营销，PIC单片机阵营对89C51提出了质疑。89C51 最严重的存在缺陷是 ISP (在线更新程序) 功能 是不被能夠使用的。需要添加 ISP 功能等新功能才能继续 MCS-51 图例。在这种情况下，89S51取代了89C51。目前，89S51依然变成了市场中人民的选择之中的绝大部分。市场份额最大的 Atmel 已经停止生产 AT89C51，将改用 AT89S51。89S51 进行了技术改进。89S51 采用全新的 0.35 标注，可控制制造基本成本，改善功能，增强竞争力。89SXX 可兼容 89CXX 等 51 系列芯片。同时，Atmel不再接受89C的订单。你在市场上看到的 89C51 实际上是 Atmel 以前生产的大量库存。

## 3.2 AT89C51单片机简介 

AT89C51 是一种低电势差,具有 4k 字节闪烁可编程可擦除只读存储器的高性能 CMOS8-bit 微处理器 (FPE 只读存储器-Flash Prog 随机存取存储器 RAM 和可擦除只读存储器),俗称微控制器。该器件采用 ATMEL 高密度非易失性存储器制造技术制造，与行业标准 MCS-51 指令集和输出引脚兼容。由于多功能 8 位中央处理器和闪存结合在一个单芯片中，ATMEL 的 AT89C51 是一个高效的微控制器，它为许多嵌入式控制系统提供了一个灵活和廉价的方案。

![3-8 硬件电路图](http://my.gunplan.top/static/3.2.png) 

本方案以 AT89C51 为核心，通过 DS18B20 检测室内的温度，将信号传给单片机，用四位发光二极管数码管显示温度，同时，通过检测温度与标准设定温度的偏差来控制电阻丝通断时间的长度，从而达到恒温控制的目的。

单片机选用ATMEL公司的可在线编程的AT89C51，用于温度采集及数据通讯。AT89C51 是一款低功耗、高性能的 CMOS 8 位单片机,其中包含可重复擦除 1000 次的具有 8k 字节 ISP (系统内 prog 随机存取存储器 matlable) 的闪存只读程序存储器,该器件采用 ATMEL 的高密度、非易失性存储技术制造，兼容标准 MCS-53 指令系统和 80C51 引脚结构。该芯片集成了通用的 8 位中央处理器和 ISP 闪存存储单元，功能强大的微型计算机的 AT89C51 可以为许多嵌入式控制应用系统提供具有成本效益的解决方案。AT89C51 具有以下特点: 40 针、 4k 字节闪存片上程序存储器、 128 字节随机存取数据存储器 (随机存取存储器) 、 32 个外部双向输入/输出 (I/O) 端口，5 个中断优先级，2 个中断嵌套中断，2 个 16 位可编程定时计数器，2 个全双工串行通信端口,watchdog (WDT)电路，片上时钟振荡器。

AT89C51 有三个并行 I/O 口，P0:P0.0 ~ P0.7，P1.0 ~ P1.7，P2.0 ~ p2.7。当没有片上存储器时，P0 端口可以用作公共 I/O 端口，当使用外部存储器时，P0 端口可以用作地址线/数据线。P1 端口可以作为通用的 I/O 端口，P1.0 、 P1.1 、 P1.5 ~ P1.7 也有特殊的功能，如表 3.4 所示。当没有片外存储器时，P2 端口可以用作公共 I/O 端口，当使用外部存储器时，P2 端口可以用作高 8 位地址。

|引脚     特殊功能 

:--: :-----------------------: 

P1.0     T2: 定时器 

P1.1    T2EX: 定时器 

P1.5 MOSI: 用于在线编程 (ISP)

P1.6 MOSI: 用于在线编程 (ISP)

P1.7 SCK: 用于在线编程 (ISP)

表 3.4 AT89C51 P1 端口的特殊功能

引脚      特殊功能 

:--: :-------------------------: 

P3.0 RXD (串行端口输入)

P3.1 TXD (串行端口输入)

P3.2 INT0 (外部中断输入 0)

P3.3 INT1 (外部中断输入 1)

P3.4 T0 (定时器 0 外部输入)

P3.5 T1 (定时器 1 外部输入)

P3.6 WR (外部数据存储器写控制)

P3.7 RD (外部数据存储器读取控制)

表 3.5 AT89C51 P3 端口的特殊功能

本室内的温度监测系统主要采用单片机进行通讯和温度采集。P3.0 拿起 DS18B20。P0 端口用于温度显示接口的设计。单片机与控制电路共用一个外部时钟，采用片内存储器，设有上电复位功能。单片机最小系统如图3.2.1： 

[图 3.2.1 SCM 最小系系统(http://my.gunplan.top/static/3.2.1.png) 

## 3.3 8279芯片简介 
### 3.3.1 引脚介绍 

8279采用单5V电源供电，40脚封装。

DB0～DB7:双向数据总线，用来传送8279与中央处理单元之间的数据和命令。

CLK: 时钟输入线，用于产生具有内部定时的时钟脉冲。

复位: 复位输入线，复位后 8279 设置在字符显示的左输入端，两键锁定的接触回弹式，程序时钟预分频器设置为 31,并且复位信号在高电平下有效。

CS: 芯片选择输入线，低电平有效，CS 端低电平时单片机可读写 8279

A0: 缓冲区低地址。当 A0 为高电平时，表示数据总线是命令或状态。当 A0 低时，表示数据总线是数据总线。

研发: 读取信号输入线，低电平有效，读出缓冲区，并将数据发送到外部总线。

WR: 写信号输入线，低电平激活，读出缓冲器并将数据从外部数据总线写入 8279 的缓冲器。

RL2-- 1 40 --VCCRL3-- 2 39 --RL 1 

CLK-- 3 38 --RL 0 

IRQ-- 4 37 --CNTL/STB 

RL4-- 5 36 --SHIFT 

RL5-- 6 35 --SL 3 

RL6-- 7 34 --SL 2 

RL7-- 8 33 --SL 1 

RESRT-- 9 32 --SL 0 

RD-- 10 31 --OUT B0 

WR-- 11 30 --OUT B1 

DB0-- 12 29 --OUT B2 

DB1-- 13 28 --OUT B3 

DB2-- 14 27 --OUT A0 

DB3-- 15 26 --OUT A1 

DB4-- 16 25 --OUT A2 

DB5-- 17 24 --OUT A3 

DB6-- 18 23 --BD 

DB7-- 19 22 --CS 

VSS-- 20 21 --A0 

IRQ: 中断请求输出行，高级有效。在键盘模式下，当 FIFO/sensor 随机存取存储器中有数据时，中断线变为高电平，每次 FIFO/sensor 随机存取存储器读出,断开的线路降至较低水平。如果随机存取存储器中仍有信息，该行将再次变为高水平。在传感器工作模式下，每当检测到传感器信号变化时，中断线就会变高。

SL0 ~ SL3: 扫描线用于扫描按键开关、传感器阵列和显示数字，可编程或解码。

RL0 ~ RL7: 返回线通过按钮或传感器开关与扫描线连接。上拉电路设置在返回线内部，以保持在高水平。只有当一次按压关闭时，相应的返回线才变为低电平;无按键闭合时，均保持高电平。

SHIFT: 换位功能。当开关闭合时，它被拉至较低的水平。当未按下换档开关时，换档输入保持在高电平。在键盘扫描模式下，按键关闭，按键位置和换位输入状态一起存储。

CNTL/STB:当CNTL/STB开关闭合时将其拉到低电平，否则始终保持高电平， 对于键盘输入方式，此线用作控制输入端，当键被按下时，按键位置就和控制输入状态一起被存贮起来，在选通输入方式中，作选通用，把数据存入FIFO 随机存取存储器中。

OUTA3～OUTA0及OUTB3～OUTB0:显示输出A口及B口，这两个口是16×4切换的数字显示。这两个端口可被独立控制，也可看成一个8位端口。

BD: 空间显示。此输出信号用于在数字转换期间显示空格，或使用 “显示空格” 命令控制空格字符的显示。

VCC:+5V电源输入线。 

VSS:地线输入线。 

### 3.3.2 8279 的编程方法

8279可按其功能分为:键盘功能块;显示功能块;控制功能块;接口与中央处理器功能块的控制功能块包括控制和定时寄存器、定时和控制、扫描计数器三个部分，它主要用于控制键盘和显示功能块的工作。

控制和定时寄存器: 用于存储来自中央处理器的编程命令。当中央处理器编程 8279 确定键盘和显示器的工作方式和其他工作条件时，首先将命令控制数据放在数据总线上，然后使 A0 = 1,WR = 0CS = 0,并将命令键存储在 WR 上升沿的控制和定时寄存器中，并对其进行解码，建立适当的功能。

定时和控制:它含基本的定时计数器,第一个计数器是一个分频系数为2-31的前置定时器，分频系数可由程序预置,使内部频率为100KHz,从而能给出5.1ms键盘扫描时间和10.3ms反跳时间,其它计数器将此基本频率分频后,提供适当的按键扫描.行扫描.键盘阵列扫描.以及显示器扫描次数。

扫描计数器:扫描计数器有两种工作方式,在编码工作方式时,计数器提供一种二进制计数,通过管脚SL0-SL3输出后经外部译码才能提供给键盘和显示器的扫描作用,在译码工作方式时,扫描计数器对最低二位进行译码,SL0-SL3输出4选1的译码信号,作为显示器和键盘的译码扫描。

键盘功能块包括: 返回缓冲区、键盘弹跳和控制、 8x8 FIFO 传感器随机存取存储器、 FIFO/传感器随机存取存储器状态。

#### 返回缓冲器与键盘反跳及控制 

八个返回行由返回缓冲区缓冲。在键盘工作模式下，逐个检测这些行，找出行键中已关闭的键。如果回弹电路检测到钥匙关闭，则等待 10.3ms，然后记录钥匙是否仍然关闭。如果仍然关闭，则矩阵中 key 的行地址和列地址以及 SHIFT 和 CNTL 的状态一起发送到 FIFO 随机存取存储器,并且 FIFO 随机存取存储器中的数据格式如下:

D7 D6 D5 D4 D3 D2 D1 D0 

CNTL SHIFT SCAN RET URN 

数据格式中,最高位CNTL,次高位为SHIFT状态,D5-D3来自扫描计数器,D2-D0来自返回计数器，扫描线计数器和回扫线计数器的值分别反映出被按下键的行.列的值，如果在传感器阵列中，返回行上的数据直接进入与正在扫描的阵列相对应的传感器随机存取存储器中的行，这样,每个开关的位置直接反映为一个传感器随机存取存储器的位置。

#### FIFO/传感器随机存取存储器

8x8 随机存取存储器是键盘模式和选通模式下的先进先出 (FIFO) 存储器。每条新的信息都是按顺序写的，然后按照写的顺序读出来。当传感器阵列扫描时，存储器被用作传感器随机存取存储器。此时，随机存取存储器中的每一行存储传感器阵列中相应行的状态。

#### FIF0/传感器随机存取存储器状态

在键盘或门控模式下，FIFO 状态跟踪 FIFO 中的字符数注意它是 “满” 还是 “空”，过多的写入或读取被认为是错误,当 FIFO 不为空时，状态逻辑提供一个中断应用程序 IRQ 信号。在传感器阵列扫描模式下，如果一个传感器改变，IRQ 是一个有效的高电平。FIFO 状态字的低 3 位表示 FIFO 中的字符数，F 表示 FIFO 随机存取存储器已满;O (超过 mn) 表示超限错误，即试图将另一个字符发送到完整的 FIFO;U (done 下) 表示 null 错误，即试图读取空 FIFO。S/F 有两种含义: 在传感器扫描模式下，S/F 是指传感器随机存取存储器中至少包含一个传感器闭合指示，在特殊错误模式下,S/F 位是一个错误标志，指示是否发生了多通道同时关闭错误,Du 位表示显示随机存取存储器尚未可用，因为 “清除显示” 或 “清除全部” 命令已完成其消除操作。

显示功能块包括:显示寄存器,16X8显示随机存取存储器,显示地址寄存器) 

#### 显示随机存取存储器和显示寄存器 

8279内部有16X8的显示随机存取存储器,通过显示寄存器和两个四位端口0UT A0-3,0UT BO-3来刷新显示,显示器可以是白炽灯,也可以是8段数码管,显示随机存取存储器可以是16X8的形式,也可以构成两个16x4的随机存取存储器形式,显示随机存取存储器可由中央处理单元进行读写,被读写的随机存取存储器字节地址由显示地址寄存器指示.显示[地址寄存器保存当前中央处理单元读或写随机取存储器地址,以及正显示着的那两个4位半字节的地址,读写地址由中央处理单元命令[编程],也可置为每次读写后地址自动加1的工作方式,在设置了正确的工作方式后,显示随机存取存储器可由中央处理单元读出,半字节A和半字节B地址自动由8279更新,以适应由中央处理单元送入的数据,A和B半字节可独立送入,也可作为一个字送入,随中央处理单元所设置的工作方式而定。

#### I/O 接口功能块 

8279 通过 I/O 控制与中央处理单元系统总线接口 8279，I/O 控制部分使用 CS。A0.RD和WR四条线控制中央处理单元与8279之间的数据交换,数据缓冲器是数据交换的双向通道,控制信号与数据交换间的逻辑关系见下表: 

CS  A0  WR  RD  状态 

---- ---- ---- ---- ------------------------

1   0   -   -   中央处理单元从8279读状态 

0   1   0   1   中央处理单元向8279写状态 

1   0   -   -   中央处理单元从8279读数据 

0   0   1   -   中央处理单元向8279写数据 

1 X 数据缓冲区输出处于三种状态

x为任意数(0或1) 

### 3.3.3 8279的操作 

如前所述，8279 可以适应各种键盘和显示器的不同工作方式，由于 8279 中各个功能块的工作是可编程的，用户可以根据自己的要求,用向 8279 写命令字的方法对 8279 的工作方式进行编程,从上表可以看出，只要 CS = 0 同时 WR = 0 = 1,然后你可以将命令字写到 8279，并在 wR 的上升沿将命令驱动到 8279。

对中央处理单元而言,8279只有两个口地址,一个用于读写命令和状态(CS=0,A0=1),一个用于读写数据(CS=0,A0=0)但用于编程命令字却有多种,在8279中用于区别各种不同命令字的方法是命令字代码的高3位(D7,D6,D5,)编码而低5位是命令字的真正内容 

#### 8279的编程命令 

键盘/显示器方式设置 

最高位  最低位 

-------- ---------------

命令代码 0 0 0 D D K K K 

其中DD为显示方式,KKK为键盘方式 

DD的表示： 

编码 功能 

---- -------------------------

00  8个8位字符显示--左端传入 

01 16 8 位字符显示-左输入

10 8 8 位字符显示-右输入

11  16个8位字符显示--右端送入 

所谓左端送 

编码  功能 

----- ---------------------

0 0 0 编码扫描键盘--2键连锁 

0 0 1 译码扫描键盘--2键连锁 

0 1 0 编码扫描键盘--N键巡回 

0 1 1 译码扫描键盘--N键巡回 

1 0 0 编码扫描传感器阵列 

1 0 1 译码扫描传感器阵列 

1 1 0 选通输入,编码显示扫描 

1 1 1 选通输入,译码显示扫描 

其中2键连锁和N键巡回是8279对键盘中被按下键的两种处理方式,编码扫描和译码扫描是SL0-SL3 对链盘和显示器的两种扫描形。

程序时钟 

命令代码 0 0 1 P P P P P 

此命令确定定时和控制中预标量的分频系数。代码 PPPPP 可以形成数字 2-31。预标量可以对外部时钟进行分频，得到内部基频，如果选择基频为 100KHZ，可以得到上述规定的扫描和回弹时间,分频系数为;外部时钟100KHZ复位脉冲过后若无代码送入则自动为31。 

读FIF0/传感器随机存取存储器 

命令代码: 0 1 0 AI X A X = 任意

该命令用于确定中央处理器读取操作的对象是 8279 中的 FIF0/传感器随机存取存储器，并用于确定 8 个随机存取存储器字节中的哪一个被读取,其中 AAA 表示中央处理器要读取的行，AI 自动添加 1 个特征位,并且这两者在键盘扫描模式下是不相关的，对于每次后续读取 8279，数据会按照与数据首次输入 fif0 相同的顺序自动发送出去。从 FIFO 读取所有后续读取，直到写入新命令。在传感器阵列方式中,AAA选择传感器随机存取存储器 8行中的一行若AI=1,则下一次读取便读自传感器随机存取存储器中的下一行。

读显示器随机存取存储器 

命令代码:0 1 1 AI A A A A 

中央处理单元对8279写此命令,则确定了 中央处理单元 以显示器 随机存取存储器为数据源进行读操作,其中AAAA为显示器随机存取存储器的地址,AI 为自动加1特征位,若AI=1,则每读一行随机存取存储器之后[行地址]自动加1。 

写显示器随机存取存储器 

命令代码: 1 0 0 AI A A A A 

中央处理单元将此命令写入 8279，它规定下一步将写入 8279 的显示随机存取存储器。寻址模式和自动加 1 功能与读显示随机存取存储器相同。

显示器写入禁止/空格 

命令代码: 1 0 1 X IW IW BL BL X=任意 

A B A B 

此命令用于屏蔽A或B端口输出及使显示器显示空格,如果显示器用作双排4位显示,则必须把其中一个4位屏蔽掉这样中央处理单元送入显示器的信息就不会影响另一半,IW为屏蔽特征位,若对某一端口设置IW=1,则该端口就被屏蔽,有必要注意的是:B0与D0对应,BL为显示空格标志位,若某一端口的BL置1,则此端口显示空格.当您想要以单个 8 位输出格式创建显示空间时，必须设置两个 BL 标志以使显示完全空白。

消除 

命令代码: 1 1 0 CD CD CD CF CA 

此命令用于按一定格式清除显示随机存取存储器的 FIF0 状态，其中 CD 指定清除格式:

CD CD CD 

0 X 全"0"(x为任意) 

1 0 AB =16 进制 

1 0 20(0 O 1 0 0 0 0 0) 

1 1 全册"1" 

当显示为 “1” (或 CA = 1) 时，允许清除显示

CF清除FIFO状态(包括中断),若CF=1,则清除FIF0状态,并对中断线复位自传感器随机存取存储器的指示器亦被置于0行CA为总清,其效果相当于CD和CF的合成,当CA=1时,利用CD指示的清除格式清除显示器随机存取存储器,并清除FIF0状态,C孔也使内部定时重新同步.在显示器随机存取存储器被清除期间(约16us)不能写入,同时在此期间FIFO的最高有效位被置"1"当显示随机存取存储器再度变为可用时即自动复位。

中断结束/出错方式设置 

命令代码: 1 1 1 E X X X X X=任意 

在传感器阵列方式时,此命令使IRQ线变低,并允许对随机存取存储器再写(检测到一个传感器位变化时,IRQ线可能已升高了,因此这样做可阻止在其复位以前把信息再度写入随机存取存储器).在 N 键电路模式下，如果 E 位被编程为 “1”，芯片电路将以特殊的错误模式运行。

主要用于检查 N 键巡视模式特殊错误模式下的多次按键。如果在一个反弹周期内按下两个键，则可以视为同时多次按下，并建立一个错误标志以防止进一步写入 FIF0,并设置中断 (如中断设置)。这样，错误标志可以被 FIFO 状态字命令读取，CF = 1 的清除命令可以重置错误标志。

1. 锯齿波是由单结晶体管BT和R1，R2，R3，W1和C1组成的张驰震荡产生，然后经射极跟随器V1、R4输出。

2. 控制电势差 (Uk) 和锯齿波电势差与电子流的强度叠加，送至 v2 基极。综合电势差是我们。当 Us> 0(0.7) 时，V2 打开，Us <0，则 V2 结束。

3. 由V2、V3以及R8、R9、DW1组成一直流开关，当V2基极电势差Ube2〉0(0.7)，V2导通，Ube3接近零电位，V3截止，直流开关导通。输出24V直流电势差。

4. 过零脉冲的输出由同步变压器 TB 、整流桥 D1 、 R10 和 R11 组成削波同步电源,它与直流开关的输出电势差一起控制 V4 和 V5。只有当 DC 开关打开时，V4 才关闭，并且 V4 和 V5 基极电极与发射器之间存在工作电势差，因此它可以在此期间工作。当每次同步电势差过零时，V4 关断，其集电极输出正电势差，这就使 V5 从截止接通，通过脉冲变压器输出触发脉冲,并且这个脉冲使晶闸管 T 在需要导通的时候导通。

直流开关导通时，连续正弦波控制电势差 Uk 的大小决定了直流开关导通时间的长短,这也决定了在设定的周期内传导的周期数，因此，可以调整输出功率。显然，控制电势差 Uk 越大，它传导的周期越多，输出功率越大，电阻炉的温度越高。相反，电阻炉的温度越低。

闭环控制自动调温的基本指导思想是在系统中增设温度传感器和温度调节器，温度传感器的基本功能是检测电炉的实际温度，并变换成电势差讯号和炉温控制电势差Uk进行比较，根据两者差值的大小（e=Uk-Uft）和变化方向（即e为正还是为负），通过调节器进行相反方向的调节，使调节器的输出控制直流开关导通时间的长短，从而使设定周期内晶闸管的导通周波数增大或者减小，相应的电炉温度升高一点或者减小一点。采用这种控制方式，炉温可在小范围内变化，控制精度高。

方案二: 为了简化电路，采用单片机作为控制核心来设计本课题。温度传感器 DS18B20 用于温度信号的采集。控温的基本思想是: 通过采集的温度与标准温度的差值，控制发热电阻丝的持续时间，从而达到恒温控制的目的。方案二的设计框图如下图所示： 

![2.2 方案二设计框图](http://my gunplan.top/static/003.jpg) 

本方案以单片机为控制核心，利用温度传感器采集温度，通过采集的温度与标准设定温度之差来控制温度,使温度保持在标准设定温度。该方案设计成本低，可靠性高，非常适用于系统动态性能和稳定性要求不是很高的场合。

## 3.4 传感器接口电路设计 

### 3.4.1 温度数据采集电路

DS18B20 是美国达拉斯半导体公司生产的网络化数字温度传感器。与其他温度传感器相比，DS18B20 具有以下特点: 独特的单线接口方式，当与微处理器连接时,只需一条端口线路即可实现微处理器与 DS18B20 的双向通信。

DS18B20 支持多点组网功能。在仅有的三条线上可以并联多个 DS18B20，实现网络化多点测温。DS18B20 在使用中不需要任何外围元件，所有的传感器元件和转换电路都像三极管一样集成在一个集成电路中。温度范围 55 ℃ ~ 125 ℃，固有测温分辨率 0.5 ℃;测量结果直接输出数字温度信号，通过 “单线总线” 串联传输到中央处理单元。同时可传输 CRC 验证码，具有较强的抗干扰和纠错能力;测量结果以9位数字量方式串行传送。

DS18B20虽然具有测温系统简单、测温精度高、连接方便、占用口线少等优点，但在实际应用中也应注意以下几方面的问题： 

1. 虽然系统硬件简单，但需要相对复杂的软件来补偿。由于 DS18B20 与微处理器之间采用串行数据传输，因此在读写编程时，必须严格保证读写时序，否则无法读取测温结果。

2. 在 DS18B20 的相关数据中，没有提到单总线上挂的 DS18B20 的数量，这很容易让人误以为可以挂任意数量的 DS18B20,实际应用中不是这样。当单个总线上挂了 8 个以上的 DS18B20 时，就需要解决微处理器的总线驱动问题,多点测温系统设计时应注意的事项。

3. 连接DS18B20的总线电缆有长度限制。由于信号电缆本身的电阻，当距离太长时会导致信号衰减。试验中，当采用普通信号电缆传输长度超过50m时，读取的测温数据将发生错误。当总线电缆改为带屏蔽电缆的双绞线时，正常通信距离可达 150m。

DS18B20有PR-35和SOIC两种封装形式，管脚排列如表3.1所示。本系统选用PR-35封装形式。DS18B20返回温度值虽然只有9位，如图3.1.2所示。

管脚  管脚定义   说明 

:-----: :------: :-----------: 

8脚SOIC       3脚PR-35 

2    1     GND地 

1 2 I/O 数据输入

8    3     VCC电源 

3   4 5 6 7   NC空脚 

表3-1 DS18B20管脚排列 

图3.1.2 DS18B20 温度值的表示方法

D9 为符号位，0 为正，1 为负，高字节 (D10 ~ D15) 的其他位用符号位的扩展位表示;D0～D8为数据位，以二进制补码表示。温度是以1/2℃LSB形式表示的。表3.2为数值和温度的关系。

温度数据 (二进制) 数据 (十六进制)

:--: :-----------------: :--------------: 

+125 0000 0000 1111 1010    00FAH 

+25  0000 0000 0011 0010    0032H 

+0.5 0000 0000 0000 0001    0001H 

0  0000 0000 0000 0000    0000H 

+0.5 1111 1111 1111 1111    FFFFH 

-25  1111 1111 1100 1110    FFCEH 

-55  1111 1111 1001 0010    FF92 

表 3.2 DS18B20 值与温度的关系

因房间环境温度不能出现负温情况，因此本系统不考虑负温情况，这样，在硬件选取上可以考虑选用商业级器件，不必要选用工业级器件，可以大幅度降低成本。因此，单片机读取温度信息后，只需将低字节 (D0 ~ D8) 发送给上位机和控制电路即可。

\### 3.4.2 发光二极管显示接口电气设计

本系统选用的是四位数码管动态实时显示房间温度，显示精度0.10C。具体电路图如图3.2： 

![3-2 硬件电路图] (http://my.gunplan.top/static/3.2.png) 

### 3.4.3 发光二极管数码管 

发光二极管显示器即为发光二极管显示器，具有显示醒目、成本低、配置灵活、接口方便等特点，单片机应用系统中常用它来显示系统的工作状态和采集的信息输入数值等。

根据发光二极管的排列结构不同，可将发光二极管分为 发光二极管数码管和 发光二极管点阵显示器。发光二极管数码管主要用于显示数字和一些字母和符号，发光二极管点阵显示器可以显示数字、字母、男人和图形等。发光二极管点阵显示虽然显示灵活，但它占用的单片机系统的软硬件资源比 发光二极管数码管要多得多。因此除专门应用大屏幕发光二极管点阵显示或有特殊显示要求场合外，几乎所有单片机应用系统都采用发光二极管数码管显示。本系统选用的是发光二极管数码管显示器。

有两种工作模式的数码管显示是包括，即静态显示模式和动态显示模式。静态显示程序非常简单，占用中央处理器的时间资源非常少。它只在显示字符改变时调用显示程序。然而，有许多硬件电路。每个数码管需要一个 8 位 I/O 端口、一个 8 位驱动器和 8 个限流电阻。一般用于数码管位数较少的场合。发光二极管静态显示由于使用的元器件较少，在数码管显示器较多的场合，电路显得烦琐，为了简化线路，减低成本，本系统选用的是动态扫描显示方式。

动态扫描显示模式的工作原理是将每个显示器逐个循环点亮，也就是说，任何时候只显示一位。为了使人看到所有显示器都在显示，就得加快循环点亮各位显示器的速度（提高扫描频率），利用人眼的视觉残留效应，给人感觉到与全部显示器持续点亮的效果一样。动态扫描显示电路如图3.2.2： 

![图 3.2.2 动态扫描图](http://my.gunplan.top/static/003.jpg) 

## 3.5 温度控制电路的设计 

![图 3.2.2 温度控制电路](http://my.gunplan.top/static/3.3.png) 

通过调节脉冲宽度来控制双向可控硅的通断。当脉冲宽度变宽 (占空比增大) 时，双向晶闸管的导通时间延长，电阻丝的发热时间延长，从而使温度升高。反之脉冲宽度变窄（占空比减小）时，双向可控硅的导通时间缩短，电阻丝的加热时间缩短使得温度降低。

以此方法来控制温度的恒定不变。

## 3.6 脉宽调制 

### 3.6.1 脉宽调制的介绍 

PWM 是脉冲宽度调制的英文缩写。方波高电平时间与周期的比值称为占空比，例如,具有 1 秒高电平和 1 秒低电平的 PWM 波的占空比为 50% 脉宽调制 PWM 是开关稳压电源中使用的术语。这是根据稳压的控制方式进行分类的。除 PWM 型外，还有 PFM 型和 PWM 和 PFM 混合型。脉宽调制 (PWM) 开关稳压电路是在控制电路输出频率保持不变的情况下，通过电势差反馈来调节其占空比,从而达到稳定输出电势差的目的。

脉冲宽度调制 (PWM) 是一种非常有效的利用微处理器的数字输出来控制模拟电路的技术，它被广泛应用于从测量、通信到功率控制和转换的许多领域。

### 3.6.2 基本原理 

随着电子技术的发展，出现了多种 PWM 技术，包括: 相电势差控制 PWM 、脉冲宽度 PWM 方法、随机 PWM 、 SPWM 方法、线电势差控制 PWM 等,然而,镍氢电池智能充电器采用的脉冲宽度 PWM 方法，以等脉宽的脉冲串作为 PWM 波形，通过改变脉冲串的周期可进行调制,可以通过改变脉冲的宽度或占空比来调节电势差,并且可以通过采用适当的控制方法来协调地改变电势差和频率。通过调节 PWM 的周期和 PWM 的占空比，可以达到控制充电电子流的强度的目的。

模拟信号的值可以不断变化，对其时间和幅度的分辨率没有限制。9v 电池是一种模拟设备，因为它的输出电势差不完全等于 9v，而是随着时间而变化，并且可以取任何真实值。类似地，从电池吸收的电子流的强度不限于一组可能的值范围。模拟信号和数字信号的区别在于后者的值只能在预定的一组可能值内，例如，在 {0V 的集合中,5V}。

模拟电势差和电子流的强度可直接用于控制，例如控制汽车收音机的音量。在简单的模拟收音机中，音量旋钮连接到可变电阻。拧动旋钮时，电阻值变大或变小；流过这个电阻的电子流的强度也增大或减小，从而改变驱动扬声器的电子流的强度值，使音量相应地变大或变小。与无线电一样，模拟电路的输出与输入成线性比例。

虽然模拟控制可能看起来直观和简单，但它并不总是非常经济或可行。其中之一是模拟电路倾向于随时间漂移，因此难以调整。可以解决这个问题的精密模拟电路可以非常大，体积庞大 (如老式的家用立体声设备) 和昂贵。模拟电路还可能产生严重的热量，其功耗与工作元件两端的电势差与电子流的强度的乘积成正比。模拟电路也可能对噪声敏感，任何扰动或噪声都肯定会改变电子流的强度值。

通过对模拟电路进行数字控制，可以大大降低系统的成本和功耗。此外，许多微控制器和 dsp 已经在芯片上包含了 PWM 控制器，这使得数字控制的实现变得更加容易。

脉冲宽度调制信号的设计思想

本课题的脉宽调制信号为矩形波，设定周期为 1s。它的产生将定时计数器设定在10ms定时，后通过寄存器R3来控制脉宽调制信号的周期，本课题只是达到一种模拟的效果，在精确上没有过高的要求，因此将1s周期分成100等份，即设定定时器的定时为10ms，R3中启动定时器的次数100。 

寄存器 R2 中存储的数据是根据检测电路和控制电路转换的数字。R2 中存储的值用于控制脉冲信号和 1s 内高电平的时间长度。这样可以从P2.6口检测到定周期脉冲可调的控制信号。

### 3.6.4 脉宽调制信号的作用 

脉宽调制信号由P3.0口输出将P3.0口输出的矩形波信号接于双向可控硅的控制端来控制可控硅的通断。当矩形波在一个周期内高电平的时间越长，双向可控硅的导通时间越长，即发热元件上发出的热量也越多。总之，发热元件上释放出能量的高低由矩形波在一个周期内高电平的时间长短所决定的。

### 3.6.5 脉冲宽度调制优点 

PWM 的优点之一是从处理器到受控系统的信号是数字形式的，没有数模转换。保持数字形式的信号最大限度地减少噪声的影响。噪声只有在其强度足以将逻辑 1 变为逻辑 0 或将逻辑 0 变为逻辑 1 时，才会影响数字信号。

抗噪性的增强是 PWM 相对于模拟控制的另一个优点，这也是某些情况下使用 PWM 进行通信的主要原因。从模拟信号切换到 PWM 可以大大延长通信距离。在接收端，可以滤除调制的高频方波，并通过适当的 RC 或 LC 网络将信号恢复为模拟形式。

总之，PWM 不仅经济、节省空间、抗噪声性能强，而且是一种值得工程师在许多设计应用中使用的有效技术。