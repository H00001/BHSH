# 系统硬件电路设计
本系统实现的功能主要是:通过传感器将温、湿度采集，并实时通过数码管显示、通过端口与主机进行实时的数据传输，其中主机可以控制仪表的工作、系统给定温、湿度值得设定,系统通过传感器得到的数据以及程序的控制能够自动或者手动来调节温、湿度的变化。原理框图如图1所示:

![图1](http://my.gunplan.top/static/mfd/001.png)

## 硬件模块

根据本设计要实现的具体功能能够大致确定硬件电路应包含以下几个模块：主控制器、温湿度传感器、数码管显示电路、键盘电路、ISP下载电路、报警电路、电源电路等[6]。

## 主电路设计

### 时钟电路设计

时钟单片定时的标准，时钟电路必须按照单片机的要求来设计[11]。本设计的是在单片机外部采用8MHZ的晶体振荡器，单片机上XTAL1与XTAL2的作用分别是单片机内的振荡器的反向放大器的输入和输出，并在其两端加入电容用来消除噪声。放大器的模式是由熔丝位CKOPT来控制的。当熔丝位处于编程状态时振荡器在其输出引脚产生的振荡是满幅度的。这种模式频率范围比较宽而且十分适合噪声环境或者需要利用XTAL2引脚驱动第二个时钟缓冲器的时候。当熔丝位处于没被编程的时候，振荡器的信号输出幅度是比较小的。这样可以很大程度上降低功率损耗，同时这种情况下频率范围很窄不能够驱动其他时钟。

### 显示电路设计

发光二极管LED是简单而且廉价的显示输出设备，是目前智能仪器应用最为广泛显示设备，具有低电压，驱动电流小、快速响应、使用寿命长等特点[20]。数码管有共阴、共阳极两种，本设计采用共阳极的2个3位8段数码管来显示温湿度得值。在数码管的每段都应接一个电阻作为限流使用，当LED显示器与单片机的借口相接时，需要用锁存器将总线上瞬时信息锁存，来驱动显示器。驱动显示器的方式有静态驱动和动态驱动两种。

静态驱动是一个锁存器对应一位显示器的接口形式称为静态显示只要将显示信息送入锁存器中，显示器就将持续显示该信息，显示亮度易于保证，其缺点时当显示器为数较多时，需要较多的锁存器，限流电阻等硬件，成本高，功耗也大。

动态驱动是当显示器为数较多时，适合采用动态驱动，其利用人视觉上残留的现象是个显示器轮流点亮，当每个显示器点亮的通电频率在50Hz以上时，人就不会感觉到显示器的闪动了。

由于要显示3位8段数码管而且有两个，所应采用动态驱动方式，利用两个74HC595锁存器，其中电源和清楚短接高电平，输出有效端和低端接低电平，数据从串行数输入端接入锁存器，在每个数据输入时钟上升沿时，串口数据移入锁存器内的寄存器，在每8个时钟周期完成一次数据传输在下一个时钟上升沿时，数据在出行输出端接处，由于采用两个锁存器，当串行输出端和和下一个锁存器的串行输入端连接时，两个锁存器实现了级联，数据会进入下一个锁存器，当给输出始终一个上升沿时数据进入锁存器这个时候当输出有效端低电平时，数据会从Q0~Q7端口传出，由低位到高位输出，这时，锁存器输出端和Led的8段相连，通过限流电阻的保护数码管的每段会被点亮，当级联的数据进入下一个锁存器是时通过同样的道理，由其控制这数码管的位选端，可以选择点那个数码管，这样一个锁存器控制显示的数字，另一个控制着点那个数码管实现数据的显示。

其电路图如图2-5所示：

![图2-5 显示电路](http://my.gunplan.top/static/mfd/005.png)

### 复位电路设计

单片机的复位是指利用硬件或者软件实现单片机和其内部逻辑电路的初始化复位是系统启动完成不可缺少的步骤。 在实际中复位引脚会受到很多外界影响，而且复位引脚通常会与ISP端口相接这样的话，其接线会较长，所以利用一个RC串联电路可增强抗干扰能力。同时在系统掉电时，电容会放电，给复位引脚一个高电平，当电源来电时，就会给复位引脚一个复位信号。而在正常时在电容充电完成复位引脚会一直处于低电平。

![图3-1电路硬件图](http://my.gunplan.top/static/2.0.1.png)

该解决方案使用AT89C51为核心处理芯片，芯片DS18B20测量内部温度，通过发送信号传输总线到MCU，并且和一个4位LED显示管温度。偏差用于控制电阻丝导通/截止时间的长度。实现恒温控制的界面的最终想法是最终想法。

## 各模块设计

### 温度采集电路

温度是一个常见非电物理量要想测量温度必须将其转变成可以测量的电信号，随意对于温度测量电路采用热敏电阻为感应器件，通过分压的方式利用电压的变化来反映当前的温度值[12]。热敏电阻主要有以下几个特点：

1. 电阻温度系数大，灵敏度高，通常温度变化1℃，阻值就变化1%~6%,戴南组温度系数绝对值比一般的金属电阻大10~100倍。
2. 结构简单，体积小。
3. 高电阻率，较小的热惯性，适合动态测量。
4. 使用方便，组织和温度变化成非线性关系。

根据电阻率随着温度变化的典型特性不同热敏电阻基本分为三种类型：负温度系数热敏电阻、正温度系数热敏电阻和临界温度热敏电阻。本设计温度采集电路采用MF52NTC温敏电阻作为感应元件，NTC热敏电阻器，其电阻率随着温度的升高而均匀减小，NTC热敏电阻一般采用负电阻系数很大的固体多晶半导体氧化物的混合物制成。测温、温度补偿和控温电路都可以根据热敏电阻的这一特性来设计，而且还可以设计成用来降低电路的浪涌电流的功率型组件。

![图2-2温度采集电路](http://my.gunplan.top/static/mfd/002.png)


从上图可以看出温敏电阻和定值电阻R5形成了一个串联分压电路，输出电压*V*temp由于分压得到了一个随电阻值变化而变化的电压值，通过这个电压变化的数值能够得到NTC电阻的大小，也就能算出当前的温度值。从上图可以看出温敏电阻和定值电阻R5形成了一个串联分压电路，输出电压*V*temp由于分压得到了一个随电阻值变化而变化的电压值，通过这个电压变化的数值能够得到NTC电阻的大小，也就能算出当前的温度值。

例如，查表可知当温度值为0度是*R*t电阻值为12.6900 千欧,那么该温度的数字量为572，以此类推可得到个温度的数字量。

利用欧姆定律可以算出输出电压值*V*temp和NTC电阻值的关系表达式：


$ V_{temp} = R_t/(R_t+R_5)*V_{cc} $  （2-2）

那么这温度点对于ADC转换之后的数字量可以计算：

$ D_{adc} = 1024*R_t/(R_t+R_5) $（2-3）

例如，查表可知当温度值为0度是*R*t电阻值为12.6900 千欧,那么该温度的数字量为572，以此类推可得到个温度的数字量。

### 温度传感器电路

本文在课题教学研究中所采用的的温度传感器一般可以分为采用一个美国两个单线的四位数字小型环境温度传感器例如ds18b20。该稳压传感器4.7k##hz该传感器用于输出稳压信号的上和下拉稳压电阻直接通过连接输入到一个微控制器的一个p1.0引脚。

半导体温度传感器DS18B20产生Dalalas数字温度传感器，多并行总线技术。该器件在小型集成电路芯片上制造温度敏感的半导体器件、 A / D 转换器、存储器等。在对本设计中的温度传感器进行多次比较和考虑之后，选择了单线数字设备DS18B20，主要是由于以下原因：

1. 该检测系统的主要特点功能是：在一个允许温度范围的工作检测温度是-55℃〜+125℃，±0.5度的工作温度和在测量值的精度是5℃。温度函数转换器高精度。9至12变量，温度检测值数据可以被直接转换成一个串行16位的非二进制的或数字输出形式的数据输出;最大输入时间频率转变精度为12位测量精度转变为750ms;它们都可以通过一条数据线被直接供电，具有超低电源功耗。
2. 系统进行成本：由于我国计算机信息技术和微电子科学技术的发展，新型企业大规模集成电路设计越来越具有强大，体积变得小是越来越会发生的，价格也会下跌。DS18B20提交空间与普通晶体管之间几乎没有本质区别的，价格只有约$1。
3. 降低系统总线技术操作复杂度：由于设备ds18b20是单总线测量设备，微处理器与之进行接口时只不过需要至少占用在校学生一个模拟i/o口，一根模拟总线测量方式线就可以同时连接数十个设备ds18b20，温度管理进行总线测量方法完全无需任何模拟企业外部网络控制元件，因此，与传统模拟工业生物温度传感器中的网络系统相比，可以测量得到大大幅度增加以及减少系统布线调试次数，降低温度管理系统的技术复杂性，减少重大工程项目的基础建设工作量。
4. 减少系统的引线调试和日常维护：由于大量减少的系统引线数量可以不会引起一些小的事情，大量使用减少接线的工程数量，减少接线工程数量产生的引线施工成本量大大降低，系统的内部布线过程复杂度的降低调试和日常维护另一方面，因为系统引线接口数量的减少产生的故障数量大大下降，使得整个系统中的接口工作变得简单许多，给系统的日常调试工作带来更多方便，之所以认为dsl8820是全方位数字化的元器件，故障基本不会同时发生，干扰性的和可抗性强，因此为了让整个系统的在整个日常生活中而所进行需要保证正常工作的维护任务大大减少，为了更好保证系统可用性而所进行的日常维护相关工作保证正常系统运行的维护工作。

ds18b20温度控制系统传感器引线技术通常存在一个小的引线，引线上的数量通常是3，并且我们可以确定不在一个企业内部：一个单线程的数据网络信息传输包括系统总线数据端口vvdq、外部数据电源线vdd和公共网络地址总线端口gnd。ds18b20有2种直流供电的工作方法：其一种就是采用杜邦线的直流供电电压模式。此时，vdd被完全接地。当它开始产生能量空闲时，它通过内部一个电容器线路来让它存储剩余电量用从外部数据线路中获得剩余能量并用来让它完成整个温度功率转换，相应的当它完成整个温度功率转换的持续时间也会更长。在这种应用情况下，使用一个单片机的一个矩形i/o输出端口让它来自动拉起一个ds18b20总线。另一种模式是外部温度电源连接模式(vdd电源连接+5v)，完成外部温度变化测量的时候相应操作时间短。

在本设计项目中我也可以直接采用由大学生企业提供的并不在相关企业内部的各种电子信息流的流动强度及其发展计算方式等来进行设计实现。cds18b20传感器与驱动单片机的接口连接，其内部接口集成电路设计方案如软件图2-2所示。

![图2-2外部电路](http://my.gunplan.top/static/003.jpg)

### 温度报警电路
本次设计有2个温湿度的设定最低点和2个温湿度的设定最高点。当前温湿度中的某项数据高于或低于该范围时，单片机将对其产生处理方案，在反馈给继电器的同时也将启动报警电路。蜂鸣器发声原理是电流通过电磁线圈，使电磁线圈产生磁场来驱动振动膜发声的，因此需要一定的电流才能驱动它，单片机IO引脚输出的电流较小，单片机输出的TTL电平基本上驱动不了蜂鸣器[18]，因此需要增加一个电流放大的电路。本设计采用一个三极管C8550来放大驱动蜂鸣器。蜂鸣器报警电路如图2-4所示：
![图2-4 温湿度报警电路](http://my.gunplan.top/static/mfd/003.png)
如图所示，蜂鸣器的正极接到VCC（＋5V）电源上面，蜂鸣器的正极接到三极管的集电极，三极管的基极B经过限流电阻R1后由单片机的引脚控制，当单片机输出高电平时，三极管T1截止，没有电流流过线圈，蜂鸣器不发声；当单片机输出低电平时，三极管导通，这样蜂鸣器的电流形成回路，发出声音。因此，我们可以通过程序控制单片机引脚的电平来使蜂鸣器发出声音和关闭。在蜂鸣器两端并联一个二极管，起到续流的作用，当三极管停止导通时，由电流突然减小，而蜂鸣器内部线圈的缘故，会产感应电流，所以添加一个续流二级管起到保护电路的作用[19]。



### 电源电路设计

由于室内的交流电压为220V，而单片机电源电压为5V，所以设计一个经变压器变压在经过整流桥调压，再稳压的一个电源电路设计[20]。系统原理如图2-6所示：

![图2-6 电源系统原理](http://my.gunplan.top/static/mfd/006.png)

首先当电源电压220V进过电压器变压会得到一个12V的交流电但是单片所需供电为5V的直流电，锁着需利用整流电路将交流电转换为直流电，这里采用MB10s整流桥堆，MB10S整流桥堆的工作原理为与单相全桥整流电路相似，能够使将变压器变压后的电压和电流保持一个方向不变但其虽然电压的方向单一的，但含有较大的交流成分，并不能直接给单片机供电，因此，在一般整流电路后，还需利用滤波电路将脉动的直流电压变为平滑的直流电压，电容滤波电路是比较常见而且简单滤波电路，电容比一般采用电解电容， 电容滤波电路利益哦那个电容的充放电作用，使输出电压趋于平滑。  

虽然整流滤波电路能够将交流电变为变为比较平滑的直流电压，可是由于输出电压是变压器副边电压有效值，当电压发生波动时，输出电压也会有波动，并且由于整流桥内的内阻影响当负载变化时内阻电压也会变化，从而影响输出电压的平均为了使输出的直流电更加稳定，还需采用稳压电路，稳压电路采用7805三端稳压器。折是一种集成电路元件，其外部有三个引脚分别为输入端、输出端、和公共端。按照功能可以分为固定式和可调式。本设计的电路采用固定式，其稳压电路如图所示，电容C3用于消除输出电压的高频噪声，一般取小于1F的电容，也可以采用大一些的比如几微法的电容这样可获得比较大的脉冲电流。后电解的电解电容是用来滤波的。如果输入线很长的话，也可以在输入端加一个电容用来防止电路的自激振荡，但是如果C3的容量很大的话，一旦输入端断开，C3会向稳压器放电，从而损坏稳压器，所以，也可以再在输入和输出之间装一个二极管来保护电路。同其他的大功率元件一样7085的封装有金属和塑料封装两种其外形同设计成便于自身散热或者安装散热器。所以电源电路最终设计如图2-7所示：

![图2-7 电源电路图](http://my.gunplan.top/static/mfd/007.png)



## 温度控制电路的设计

![图3.2.2温度控制电路](http://my.gunplan.top/static/3.3.png)

通过正确设置开关元件脉冲的宽度来我们可以控制三端双向的可控硅开关元件的开启和脉冲关闭。当伴随着脉冲宽度的增加(脉冲占空比增加)时，三端双向的可控硅开关元件的脉冲导通加热时间和温度延长，电阻丝的开关元件加热的时间也延长，温度也升高。相反，如果我们减小了脉冲的宽度(相当于减小脉冲占空比)，则双向可控硅的脉冲导通加热时间和温度缩短，电阻丝的开关元件加热时间和温度缩短，从而大大降低了元件的温度。

**以此方法来控制温度的恒定不变。**



## 传感器接口电路设计

### 温度数据采集电路

ds18b20是基于dallassemiconductorcorporation的一个网络数字温度传感器。与其他的温度传感器连接方式相比，ds18b20具有以下的功能：当网络连接到如上所述微处理器的唯一单线路的接口模式中，只有一个端口可以被用于直接实现一个微处理器和ds18b20之间的双向通信的线路。

ds18b20支持独立的多点温度网络。几个节点ds18b20可以仅在三条线上通过并联进行连接，以方便地实现基于互联网的多点温度的测量。ds18b20不一定需要外围的组件。所有的传感器集成元件和温度信号转换集成电路都可以像普通的晶体管一样直接集成在单个温度集成电路中。传感器的温度测量范围一般为55〜125°c，温度集成电路测量的固有温度和分辨率范围为0.5°c。温度测量的结果直接传感器输出一个9位数字的温度测量信号，并直接通过"初始化总线"接口串行发送到传感器的中央控制单元。同时，可以直接发送crcr的温度校验码，具有较强的温度抗干扰和自动纠错的功能。温度测量的结果以9位数字的模式串行传输。

尽管ds18b20具有简单的嵌入式温度自动测量和控制系统，较高的分辨率和温度测量的精度，方便的网络连接以及较少的线路和资源占用等诸多优点，但在实际的应用中还是应该充分考虑以下的几个方面：

1. 尽管操作系统的硬件很简单，但我们还是需要相对复杂的软件处理器来对其进行温度补偿。由于ds18b20与其他微处理器之间的读写串行编程需要数据同时传输，因此必须注意保证在读写串行编程期间的连续读写编程时间，否则将是无法对读取进行温度补偿测量的结果。

2. ds18b20的可靠性相关数据未提及任何连接到单个总线的微处理器ds18b20的数量。这很容易就会导致一个错误的假设，即微处理器可以在总线上连接任意数量的总线ds18b20，而在实际的应用中并非如此。如果一条单个总线上微处理器连接了8个以上的总线ds18b20，则几乎没有必要考虑解决单个总线微处理器的可靠性和总线驱动问题以及我们在设计多点温度控制和测量传感器系统时所需要注意和考虑的一些问题。

3. 连接长度的限制是指采用连接长度为ads18b20的信号总线的电缆。由于它具有信号电缆的稳定性和电子电缆的阻挡比较大等特性，如果距离太大，信号传输幅度也会有所降低。如果在测试中普通信号电缆的双绞线传输电缆的长度明显地超过50m，则表示温度降低或读取数据不正确。如果将普通信号总线的电缆改为带屏蔽普通信号电缆的数据传输双绞线，则正常的总线通信数据传输距离应该可以轻松地达到150m。

ds18b20提供两种不同类型的器件封装：pr-35和pdsoic。引脚的顺序排列如下下表3.1所示。该软件封装操作系统中实际上已经使用了基于pr-35软件包的封装工具包。尽管如此，dds18b20仅用于提供一个返回9位温度数字的一个温度测量值，如如下图3.1.2所示。

管脚管脚定义说明

：-：：-：：-：

8脚SOIC 3脚PR-35

21 GND地

12 I/O 数据输入

83 VCC电源

34567 NC空脚

表3-1 DS18B20管脚排列

图3.1.2ds18b20温度值的表示计算方法

d9为低字节的符号位，0为正，1为负，高字节(d10~d15)的其他位用二进制符号位的补码或扩展位形式进行了表示;d0~d8为数据位，以二进制数据位的补码或扩展形式进行表示。如下表3.2显示了数值与温度之间的非线性关系。

温度测量数据(二位位十六进制)数据(十六进制)

：-：：-：：-：

+125000000001111101000FAH

+2500000000001100100032H

+0.500000000000000010001H

000000000000000000000H

+0.51111111111111111 FFFFH

-251111111111001110 FFCEH

-551111111110010010 FF92

表3.2 DS18B20值与温度的关系

由于房间的环境温度不能为负，因此系统不会考虑负温度。这样，您在选择硬件时就可以使用市售组件，而不必使用工业组件，从而可以大大降低成本。读取温度信息后，微控制器仅需要将低字节(D0〜D8)发送到主机和控制电路。

### 发光二极管显示接口电气设计

选择的系统控制方式是四路开关室温动态实时传感器显示，显示精度0.1℃。具体的电路原理图所示如图3.2：

![3-2硬件电路图](http://my.gunplan.top/static/3.2.png)


### 本章小结
这一章主要介绍了本设计的硬件电路设计部分，将硬件的设计模块和实现方式进行了阐述，本设计主要通过电源转换电路可以将硬件直接接在配电柜的仪表室内，通过显示电路是监控的温湿度值可以显示在数码管上，利用键盘电路可以将参数设定在硬件内并且可以控制柜内温湿度控制器，来保证温湿度的稳定。但是由于有配电柜内的空间较大有时一个传感器不能满足，将柜内温湿度直观地反映出来，可能涉及到多点测量，这样的话可能会造成信号在传输过程中出现问题，同时由于配电柜内电气干扰很大可能会造成数据的失真情况，所以柜体很大的配电柜内使用本设计的话还需加入隔离电路来保证数据接受的稳定和测量精度。


