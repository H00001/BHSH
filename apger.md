# 摘要

# Abstract

# 绪论

## 温度控制系统研究的目的和意义
在人类的历史长河中，环境温度扮演着极其重要的角色。环境温度是工业生产中常见的工艺参数之一，任何物理变化和化学反应过程都与温度密相关，因此温度控制是生产自动化的重要任务。随着社会的发展，科技的进步，以及测温仪器在各个领域的应用，智能化是现代温度控制系统发展的主流方向。特别是近几年来，温度控制系统早已应用到人们生活的各个方面，但温度控制一直是一个未开发的领域，却又与人们息息相关的一个世纪问题。针对这种实际情况，设计一个温度控制系统具有广泛的应用前景与意义。
本设计为房间温度控制系统设计，控制的对象是房间温度。温度控制在日常生活及工业领域应用十分广泛，比如温室、水池、发酵缸、电源等场所的温度控制。而以往温度控制是由人工完成的而且不够重视。其实在很多场所温度都需要得到很好的控制。针对这一问题，本系统设计的目的是实现可以根据设定温度进行自行调节的系统，它应用广泛，功能强大，小巧美观，便于携带，是一款既实用又廉价的控制系统。

## 温度控制系统研究概况
国外对于温度控制技术研究较早，始于20世纪70年代。先是采用模拟式的组合仪表，采集现场信息并进行指示、记录和控制。80年代末出现了分布式控制系统。目前正开发和研制计算机数据采集控制系统的多因子综合控制系统。现在世界各国的温度测控技术发展很快，一些国家在实现自动化的基础上正向着完全自动化、无人化的方向发展。
我国对于温度测控技术的研究较晚，始于20世纪80年代。我国工程技术人员在吸收发达国家温度测控技术的基础上，才掌握了温度室内微机控制技术，该技术仅限于对温度的单项环境因子的控制。我国温度测控设施计算机应用，在总体上正从消化吸收、简单应用阶段向实用化、综合性应用阶段过渡和发展。在技术上，以单片机控制的单参数单回路系统居多，尚无真正意义上的多参数综合控制系统，与发达国家相比，存在较大差距。我国温度测量控制现状还远远没有达到工厂化的程度，生产实际中仍然有许多问题困扰着我们，存在着装备配套能力差，产业化程度低，环境控制水平落后，软硬件资源不能共享和可靠性差等缺点。

##  温度传感器技术
传感器技术是现代信息技术的主要内容之一，信息技术包括计算机技术、通信技术和传感器技术。计算机和通信技术发展极快，相当成熟，而传感器应用技术因为需要使用模拟技术，而模拟技术还有很多问题难以解决，因此传感器应用技术也有待进一步发展。为了适应现代科学技术的发展，世界总舵国家都把传感器技术列为现代的关键技术之一。通常将能把非电量转换为电量的器件称为传感器，其实质上是一种功能块，作用是将来自外界的各种信号转换成电信号。它是实现测试与自动控制系统的首要环节。如果没有传感器对原始参数进行精确可靠地测量，那么无论是信号转换或信息处理，或者最佳数据的显示和控制都将无法实现。
     温度传感器，使用范围广，数量多，居各种传感器之手。温度传感器的发展大致经历了以下三个阶段：传统的分立式温度传感器（含敏感元件），主要输能够进行非电量和电量之间的转换；模拟集成温度传感器/控制器；智能温度传感器。目前，国际上新型温度传感器正从模拟式向数字式、集成化、智能化及网络化的方向发展。温度传感器按传感器与被测介质的接触方式可分为接触式温度传感器和非接触式温度传感器两大类，其中，接触式温度传感器的测温元件与被测对象要有良好的热接触，通过热传导及对流原理达到热平衡，这个示值即为被测对象的温度。这种测温方法精度比较高，并可测量物体内部的温度分布。但对于运动的、热容量比较小的及对感温元件有腐蚀作用的对象，这种方法将会产生很大的误差。非接触测温的测温元件与被测对象互不接触。常用的是辐射热交换原理。此种测温方法的主要特点是可测量运动状态的小目标及热容量小或变化迅速的对象，也可测量温度场的温度分布，但受环境的影响比较大。
温度传感器的发展大致可分为以下几种：
（1）热电偶传感器。热点偶传感器是工业测量中应用最广泛的一种温度传感器，它与被测对象直接接触，不受中间介质的影响，具有较高的精度；测量范围广，可从-50℃～1600℃进行连续测量，特殊的热电偶如金,铁,镍,铬最低可测到-269℃，钨,铼最高可达2800℃。
（2）模拟集成温度传感器。采用硅半导体集成工艺制成的，因此亦称硅传感器或单片集成温度传感器。模拟集成温度传感器是在20世纪80年代问世的，它将温度传感器集成在一个芯片上、可完成温度测量及模拟信号输出等功能。模拟集成温度传感器的主要特点是：功能单一、测温误差小、价格低、响应速度快、传输距离远、体积小、微功耗等，适合远距离测温，不需要进行非线性校准，外围电路简单。
（3）光纤传感器。光纤测温技术可分为两类:全辐射测温法，单辐射测温法，双波长测温法，多波长测温法等。特点是：光纤挠性好、透光谱段宽、传输损耗低，无论是就地使用或远传均十分方便而且光纤直径小，可以单根、成束、Y型或阵列方式使用，结构布置简单且体积小。缺点是：测量起来困难,难于实现较高的精度，工艺比较复杂,且造价高，推广应用有一定困难。
（4）半导体吸收式光纤温度传感器。半导体吸收式光纤温度传感器是利用了半导体材料的吸收光谱随温度变化的特性实现的。一种传光型光纤温度传感器，是指在光纤传感系统中，光纤仅作为光波的传输通路，而利用其它如光学式或机械式的敏感元件来感受被测温度的变化。在这类传感器中，半导体吸收式光纤温度传感器是研究得比较深入的一种。
（5）智能温度传感器。智能温度传感器(亦称数字温度传感器）是在20世纪90年代中期问世的。它是微电子技术、计算机技术和自动测试技术（ATE）的结晶。目前，国际上已开发出多种智能温度传感器系列产品。智能温度传感器内部包含温度传感器、A/D传感器、信号处理器、存储器（或寄存器）和接口电路。有的产品还带多路选择器、中央控制器（CPU）、随机存取存储器（RAM）和只读存储器（ROM）。智能温度传感器能输出温度数据及相关的温度控制量，适配各种微控制器（MCU），并且可通过软件来实现测试功能，即智能化取决于软件的开发水平。
随着科学技术的不断进步与发展，温度传感器的种类日益繁多，数字温度传感器更因适用于各种微处理器接口组成的自动温度控制系统具有可以克服模拟传感器与微处理器接口时需要信号调理电路和A/D转换器的弊端等优点，被广泛应用于工业控制、电子测温计、医疗仪器等各种温度控制系统中。其中，比较有代表性的数字温度传感器有DS18B20、MAX6575、DS1722、MAX6635等。相比较而言，传统的温度检测以热敏电阻为温度敏感元件，热敏电阻成本低，但需要后续信号处理电路，而且热敏电阻的可靠性相对较差，测量温度的准确度低，检测系统的精度差。数字式温度传感器的种类也不少，并且在实际工程设计中具有上述诸多优点。















# 系统总体方案设计
##  方案论证
方案一：本课题的初步设计方案是通过控制调功电路的导通比，来实现对被调对象的控制，由图1可见，负载是加热器件，而过零触发电路是由锯齿波发生，信号综合，直流开关，同步电压与过零脉冲输出5个环节组成。如下图所示:
                             图2.1 方案一电路图 
图2.1为第一个设计方案，该方案的工作原理简述如下：
（1）锯齿波是由单结晶体管BT和R1，R2，R3，W1和C1组成的张驰震荡产生，然后经射极跟随器V1、R4输出。
（2）控制电压（Uk）与锯齿波电压进行电流叠加后送到V2的基极，合成电压为Us，当Us>0（0.7）时V2导通，Us<0，则V2截止。
（3）由V2、V3以及R8、R9、DW1组成一直流开关，当V2基极电压Ube2>0(0.7)，V2导通，Ube3接近零电位，V3截止，直流开关导通。输出24V直流电压。
（4）过零脉冲的输出，由同步变压器TB，整流桥D1及R10，R11组成一削波同步电源，这个电源与直流开关的输出电压共同去控制V4与V5。只有当直流开关导通期间，V4截止，V4、V5基电极和发射极之间才有工作电压，才能工作在期间，同步电压每次过零时，V4截止，其集电极输出正电压，使V5由截止转导通，经脉冲变压器输出触发脉冲而此脉冲使晶闸管T在需要导通的时刻导通。
在直流开关导通期间使出连续的正弦波控制电压Uk的大小决定了直流开关导通时间的长短，也就决定了在设定周期内导通的周波数，从而可输出功率的调节。显然，控制电压Uk越大，则导通的周波数就越多，输出的功率也就越大，电阻炉的温度也就越高，反之，电阻炉的温度就越低。
闭环控制自动调温的基本指导思想是在系统中增设温度传感器和温度调节器，温度传感器的基本功能是检测电炉的实际温度，并变换成电压讯号和炉温控制电压Uk进行比较，根据两者差值的大小（Δe=Uk-Uft）和变化方向（即△e为正还是为负），通过调节器进行相反方向的调节，使调节器的输出控制直流开关导通时间的长短，从而使设定周期内晶闸管的导通周波数增大或者减小，相应的电炉温度升高一点或者减小一点。采取这种控制方式，可以使炉温在较小的范围内变化，控制精度高。
方案二：为了使得电路的简单化，采用单片机作为控制核心来设计本课题，温度信号采集使用温度传感器DS18B20，温度控制的基本思想为：通过采集到的温度与标准温度之间的差值来控制加热电阻丝的通电时间长短，从而起到恒温控制的目的。方案二的设计框图如下图所示：

图 2.2 方案二设计框图
本方案采用单片机作为控制核心，使用温度传感器进行温度采集，通过将采集到的温度与标准设定温度之间的差值进行温度控制，从而使得温度维持在标准设定温度。本方案设计成本低，具有具有较高的可靠性，对于系统动态性能与稳定要求不是很高的场合非常的合适。
2.2 系统功能介绍
本设计是对房间温度进行检测与控制，设计的温度控制系统实现了基本的温度控制功能：当温度低于设定的温度时，系统自动通过PWM启动加热装置，使温度上升。当温度高于设定的温度时，停止加热。三位数码管及时显示温度，精确到小数点后一位。
本文设计的温度控制系统具有如下功能：
（1）通过温度芯片DS18B20采集温度，并以数字信号的方式传送给单片机。
（2）四位数码管动态实时显示房间温度，显示精度0.10C。
（3）三个按键实现标准温度的设定。
（4）利用PWM实现温度的控制。

































## 系统硬件电路设计

 图3.0电路硬件图
此方案以AT89C51为核心，通过DS18B20检测房间温度，将信号传输至单片机，用四位LED数码管显示温度，同时通过将检测的温度与标准设定温度的偏差来控制电阻丝通断时间的长短，从而达到恒温控制的目的。
3.1传感器接口电路设计
3.1.1温度数据采集电路
    DS18B20是美国DALLAS半导体公司生产的可组网数字式温度传感器，与其它温度传感器相比，DS18B20具有以下特性：独特的单线接口方式，DS18B20在与微处理器连接时仅需要一条口线即可实现微处理器与DS18B20的双向通讯。DS18B20支持多点组网功能，多个DS18B20可以并联在唯一的三线上，实现组网多点测温。DS18B20在使用中不需要任何外围元件，全部传感器元件及转换电路集成在形如一只三极管的集成电路内。温度范围－55℃～＋125℃，固有测温分辨率±0.5℃；测量结果直接输出数字温度信号，以“一线总线”串行传送给CPU，同时可传送CRC效验码，具有极强的抗干扰纠错能力；测量结果以9位数字量方式串行传送。
DS18B20虽然具有测温系统简单、测温精度高、连接方便、占用口线少等优点，但在实际应用中也应注意以下几方面的问题：
（1）系统的硬件虽然简单但需要相对复杂的软件进行补偿，由于DS18B20与微处理器间采用串行数据传送，因此，在对DS18B20进行读写编程时，必须严格的保证读写时序，否则将无法读取测温结果。
（2）在DS18B20的有关资料中均未提及单总线上所挂DS18B20数量问题，容易使人误认为可以挂任意多个DS18B20，在实际应用中并非如此。当单总线上所挂DS18B20超过8个时，就需要解决微处理器的总线驱动问题，这一点在进行多点测温系统设计时要加以注意。
(3)连接DS18B20的总线电缆有长度限制。由于信号电缆本身存在电阻，距离过长时将导致信号衰减。试验中，当采用普通信号电缆传输长度超过50m时，读取的测温数据将发生错误。当将总线电缆改为双绞线带屏蔽电缆时，正常通讯距离可达150m。
DS18B20有PR-35和SOIC两种封装形式，管脚排列如表3.1所示。本系统选用PR-35封装形式。DS18B20返回温度值虽然只有9位，如图3.1.2所示。

管脚	管脚定义	说明
8脚SOIC    3脚PR-35		
2               1	GND	地
1               2	I|O	数据输入端
8               3	VCC	电源
3 4 5 6 7	NC	空脚
表3.1 DS18B20管脚排列

图3.1.2 DS18B20温度值表示方法
D9为符号位，0表示正，1表示负，高字节的其他位（D10～D15）是以符号位的扩展位表示的；D0～D8为数据位，以二进制补码表示。温度是以1/2℃LSB形式表示的。表3.2为数值和温度的关系。





温度	数据（二进制）	数据（十六进制）
+125	0000 0000 1111 1010	00FAH
+25	0000 0000 0011 0010	0032H
+0.5	0000 0000 0000 0001	0001H
0	0000 0000 0000 0000	0000H
+0.5	1111 1111 1111 1111	FFFFH
-25	1111 1111 1100 1110	FFCEH
-55	1111 1111 1001 0010	FF92H
表3.2 DS18B20数值和温度的关系
因房间环境温度不能出现负温情况，因此本系统不考虑负温情况，这样，在硬件选取上可以考虑选用商业级器件，不必要选用工业级器件，可以大幅度降低成本。因此单片机读取温度信息后，只需将低字节（D0～D8）送入上位机和控制电路即可。
3.2 LED显示接口电设计
 本系统选用的是四位数码管动态实时显示房间温度，显示精度0.10C。具体电路图如图3.2：
                           
                


图3.2
3.2.1 AT89C51单片机
单片机选用ATMEL公司的可在线编程的AT89C51，用于温度采集及数据通讯。AT89C51 是一个低功耗，高性能CMOS 8位单片机，片内含8k Bytes ISP(In-system programmable)的可反复擦写1000次的Flash只读程序存储器，器件采用ATMEL公司的高密度、非易失性存储技术制造，兼容标准MCS-51指令系统及80C51引脚结构，芯片内集成了通用8位中央处理器和ISP Flash存储单元，功能强大的微型计算机的AT89C51可为许多嵌入式控制应用系统提供高性价比的解决方案。AT89C51具有如下特点：40个引脚，4k Bytes Flash片内程序存储器，128 bytes的随机存取数据存储器（RAM），32个外部双向输入/输出（I/O）口，5个中断优先级2层中断嵌套中断，2个16位可编程定时计数器,2个全双工串行通信口，看门狗（WDT）电路，片内时钟振荡器。
AT89C51有3个并行I/O端口，P0:P0.0～P0.7、P1.0～P1.7、P2.0～P2.7。P0端口在没有片内存储器时，可以作为普通I/O口使用，外接存储器时作为地址线/数据线使用。P1端口可以作为普通I/O口使用，同时P1.0、P1.1、P1.5～P1.7还具备特殊功能，如表3.4所示。P2端口在没有片外存储器时，可以作为普通I/O口使用，外接存储器时作为高8位地址使用。

引脚	特殊功能
P1.0	T2: 定时器|计数器2的外部计数器输入
P1.1	T2EX: 定时器|计数器2的捕捉|重载触发及方向控制
P1.5	MOSI: 用于在线编程（ISP）
P1.6	MOSI: 用于在线编程（ISP）
P1.7	SCK: 用于在线编程（ISP）

表3.4 AT89C51 P1端口的特殊功能






引脚	特殊功能
P3.0	RXD (串行口输入)
P3.1	TXD (串行口输入)
P3.2	INT0 (外部中断输入0)
P3.3	INT1 (外部中断输入1)
P3.4	T0（定时器0外部输入）
P3.5	T1（定时器1外部输入）
P3.6	WR （外部数据存储器写控制）
P3.7	RD （外部数据存储器读控制）

表3.5  AT89C51 P3端口的特殊功能
单片机在本房间温度监控系统中主要用于通讯及温度采集。P3.0接DS18B20。P0口用于温度显示接口的设计。单片机与控制电路共用一个外部时钟，采用片内存储器，设有上电复位功能。单片机最小系统如图3.2.1：
    
                                                                                                                                                                            

                                   图 3.2.1 单片机最小系统
3.2.2 LED数码管
             
                         
LED显示器即为发光二极管显示器，具有显示醒目、成本低、配置灵活、接口方便等特点，单片机应用系统中常用它来显示系统的工作状态和采集的信息输入数值等。
LED显示器按其发光管排布结构的不同，可分为LED数码管显示其和LED点阵显示器。LED数码管主要用来显示数字及少数字母和符号，LED点阵显示器可显示数字、字母、汉子和图形等。LED点阵显示器虽然显示灵活，但其占用的单片机系统软件、硬件资源远大于LED数码管。因此除专门应用大屏幕LED点阵显示或有特殊显示要求场合外，几乎所有单片机应用系统都采用LED数码管显示。本系统选用的是LED数码管显示器。
数码管显示器有两种工作方式，即静态显示方式和动态显示方式。静态显方式程序非常简单，占用CPU时间资源很少，只是在显示字符改变时调用一下显示程序。但硬件电路繁多，每个数码管需要一个8位I/O口、一个8位驱动、8个限流电阻。一般用于数码管位数较少的场合。LED静态显示由于使用的元器件较少，在数码管显示器较多的场合，电路显得烦琐，为了简化线路，减低成本，本系统选用的是动态扫描显示方式。
动态扫描显示方式的工作原理是：逐个地循环点亮各位显示器，也就是说在任意时刻只有1位显示器在显示。为了使人看到所有显示器都在显示，就得加快循环点亮各位显示器的速度（提高扫描频率），利用人眼的视觉残留效应，给人感觉到与全部显示器持续点亮的效果一样。动态扫描显示电路如图3.2.2：

图3.2.2动态扫描图
3.3 温度控制电路的设计

​      



                                       图3.3
                                  
      通过调节脉冲宽度来控制双向可控硅的通断。当脉冲宽度变宽（占空比增大）时，双向可控硅的导通时间延长，电阻丝加热时间延长从而使温度升高。反之脉冲宽度变窄（占空比减小）时，双向可控硅的导通时间缩短，电阻丝的加热时间缩短使得温度降低。
以此方法来控制温度的恒定不变。
#  脉宽调制
## 脉宽调制的介绍
PWM就是脉冲宽度调制的英文缩写，方波高电平时间跟周期的比例叫占空比，例如1秒高电平1秒低电平的PWM波占空比是50%
　  脉宽调制PWM是开关型稳压电源中的术语。这是按稳压的控制方式分类的，除了PWM型，还有PFM型和PWM、PFM混合型。脉宽宽度调制式（PWM）开关型稳压电路是在控制电路输出频率不变的情况下，通过电压反馈调整其占空比，从而达到稳定输出电压的目的。                                         脉宽调制(PWM)是利用微处理器的数字输出来对模拟电路进行控制的一种非常有效的技术，广泛应用在从测量、通信到功率控制与变换的许多领域中。  
## 基本原理
　　随着电子技术的发展，出现了多种PWM技术，其中包括：相电压控制PWM、脉宽PWM法、随机PWM、SPWM法、线电压控制PWM等，而在镍氢电池智能充电器中采用的脉宽PWM法，它是把每一脉冲宽度均相等的脉冲列作为PWM波形，通过改变脉冲列的周期可以调频，改变脉冲的宽度或占空比可以调压，采用适当控制方法即可使电压与频率协调变化。可以通过调整PWM的周期、PWM的占空比而达到控制充电电流的目的。 
　　模拟信号的值可以连续变化，其时间和幅度的分辨率都没有限制。9V电池就是一种模拟器件，因为它的输出电压并不精确地等于9V，而是随时间发生变化，并可取任何实数值。与此类似，从电池吸收的电流也不限定在一组可能的取值范围之内。模拟信号与数字信号的区别在于后者的取值通常只能属于预先确定的可能取值集合之内，例如在{0V, 5V}这一集合中取值。 
　　模拟电压和电流可直接用来进行控制，如对汽车收音机的音量进行控制。在简单的模拟收音机中，音量旋钮被连接到一个可变电阻。拧动旋钮时，电阻值变大或变小；流经这个电阻的电流也随之增加或减少，从而改变了驱动扬声器的电流值，使音量相应变大或变小。与收音机一样，模拟电路的输出与输入成线性比例。 
　　尽管模拟控制看起来可能直观而简单，但它并不总是非常经济或可行的。其中一点就是，模拟电路容易随时间漂移，因而难以调节。能够解决这个问题的精密模拟电路可能非常庞大、笨重(如老式的家庭立体声设备)和昂贵。模拟电路还有可能严重发热，其功耗相对于工作元件两端电压与电流的乘积成正比。模拟电路还可能对噪声很敏感，任何扰动或噪声都肯定会改变电流值的大小。 
　　通过以数字方式控制模拟电路，可以大幅度降低系统的成本和功耗。此外，许多微控制器和DSP已经在芯片上包含了PWM控制器，这使数字控制的实现变得更加容易了。 
4.3 脉宽调制信号的设计思想

本课题的脉宽调制信号是设定周期为1s矩形波。它的产生将定时计数器设定在10ms定时，后通过寄存器R3来控制脉宽调制信号的周期，本课题只是达到一种模拟的效果，在精确上没有过高的要求，因此将1s周期分成100等份，即设定定时器的定时为10ms，R3中启动定时器的次数100。
寄存器R2中存放的数据是根据检测电路和控制电路转换过来的一个数，R2中存放的数值的大小用于控制脉冲信号，在1s内高电平的时间长短。这样可以从P2.6口检测到定周期脉冲可调的控制信号。

4.4脉宽调制信号的作用

          可控脉冲

脉宽调制信号由P3.0口输出将P3.0口输出的矩形波信号接于双向可控硅的控制端来控制可控硅的通断。当矩形波在一个周期内高电平的时间越长，双向可控硅的导通时间越长，即发热元件上发出的热量也越多。总之，发热元件上释放出能量的高低由矩形波在一个周期内高电平的时间长短所决定的。
4.5脉冲宽度调制优点
　　PWM的一个优点是从处理器到被控系统信号都是数字形式的，无需进行数模转换。让信号保持为数字形式可将噪声影响降到最小。噪声只有在强到足以将逻辑1改变为逻辑0或将逻辑0改变为逻辑1时，也才能对数字信号产生影响。 
　　对噪声抵抗能力的增强是PWM相对于模拟控制的另外一个优点，而且这也是在某些时候将PWM用于通信的主要原因。从模拟信号转向PWM可以极大地延长通信距离。在接收端，通过适当的RC或LC网络可以滤除调制高频方波并将信号还原为模拟形式。 
　　总之，PWM既经济、节约空间、抗噪性能强，是一种值得广大工程师在许多设计应用中使用的有效技术。 















# 系统软件设计
本设计总体程序框图如下，总体程序由主程序，按键子程序，温度获取子程序三部分组成。




​     

                         图5.1 总体程序框图












​     
​                      
                          图5.2读温度流程图













# 系统软件调试
6.1目测
1.有无短路处。
2.对照电路图看有无接错、漏接处。
3.有无虚焊处。
4元件是否都对
6.2硬件调试
首先应进行上电前的准备。为了防止硬件的损坏，应在电路板上电前进行电
路检查，包括：对芯片的焊接方向进行检查，对芯片的引脚进行短路和断路检查。
在经过检查确认芯片的焊接没有任何问题的情况下，进行上电检查，在电源打开
后，先判断电路是否存在异常，如出现芯片过热等现象，应及时切断电源，检查
电路故障。在上电无异常状况的前提下，可以用万用表和示波器进行测量。首先
测量电源芯片的输出电压是否正常，然后用示波器分别测量各个主要芯片电源引
脚，察看电源的波形情况，如有纹波，则在预先留出的位置上焊上退耦电容以消
除纹波，保证芯片工作正常。电源测量完毕后，进一步用示波器测量有源晶振的
输出脚，其输出是频率为8MHz的波形(非方波，类似正弦波)。在确定晶振起
振后，按住复位键，使单片机始终保持在复位状态，同时测量其各个引脚的电平
情况，并同数据手册上表述的复位时的芯片引脚状态进行比对，由此可判断单片
机是否正常。确认单片机正常之后就可以通过仿真器连接用户板进行调试。
6.3 软件的调试
由于软件的编写都是根据各个模块进行的，我们在进行软件的系统模拟调试时应，先确认硬件的接口标记是否在软件程序中一一对应，而且要检测所编写的软件有没有知识性的错误。在觉得基本没有问题后我们通过电脑将程序编译进入系统核心AT89S52单片机，检验软件与硬件各部分是否协调的工作。出现问题时我们要耐心的检查程序并作出适当的修改，直到软件系统的完全契合硬件电路，那我们软件就调试成功了。
1、测试环境
环境温度28摄氏度，室内面积20平方米
测试仪器：数字万用表，温度计0----100摄氏度
2、测试方法
使系统运行，采用温度计同时测量室内度变化情况，得出系统测量的温度。
3、测试结果
设定温度由0摄氏度到40摄氏度
标定温差<=1摄氏度   调节时间  15s（具体视现场情况）
静态误差<=0.5摄氏度   最大超调量1摄氏度
4、通过测试分析，对于实际室内的温度控制，可以再提出以下 2 点方法 ：
Ⅰ增加传感器个数，对各个温度传感器采集的数据进行求算术平均，可得到较为准确的温度值。
 Ⅱ对实际室内的温度控制，可采用功率较大的电炉，并且通过风扇对箱内温度进行充分搅和，降温设备可采用空气压缩机等制冷设备。 
5、通过实验测试和分析，发现虽然传感器的温度采集精度最高可得到 0.06 ℃，但测试得到的数据最小间隔为 0.03 ℃ 。通过分析，当对浮点数求平均处理时，遇到同一时刻两个传感头采集的温度相差不大，使 0.06 ℃ 时求出平均温度变为 0.03 ℃ 为了解该数据是否真实，可采用一个高精度的数字温度计测试，发现读出的值与其基本一致，由此推断如果在同一时间增加采集温度的个数，则可以进一步提高温度的精度。 
6.4 注意事项
  （1）测驱动电路的过程中发现数码管不能正常显示的状况，经检验发现主要是由于接触不良的问题。其中包括线的接触不良和芯片的接触不良，在实验过程中，数码管有几段时隐时现。用万用表检测发现有线接触不良，重焊后就可正常显示。而芯片接触不良用万用表欧姆档检测有几个引脚本该相通的地方却未通，其解决方法为把芯片拔出正对万能板孔均匀用力插入。
   （2）由于焊接时的大意损坏了元件，在调试是我们怎么都找不到问题的所在，我们是用排除法一个一个元件的测试的找出损坏的元件，重新换上新的元件，故障得以解决。
   （3）还有关于程序调试过程中出现的问题。执行程序是发现程序执行不稳定，排除软件的错误外，经老师的指导才发现单片机的EA管脚没有接地。因为次程序只用到片内程序存储器，所以在程序执行时一定要把管脚接的，这样程序才能只执行片内的，不然程序会乱跳，从而导致程序执行不稳定。
   （4）接三极管的过程中，发现电路不管程序是什么，数码管都是显示8字，经查除发现原来是三极管的极端弄错了，从新调整极端顺序。
   （5）在电路调试时由于我们选用的是对射型的光电传感器由于没正对好使的调试一度中断，最后我们通过反复的调试解决了问题
   （6）调试时由于线路的繁杂，没有仔细的找到对应部分的线路，使的调试的结果与预期出现很大的误差，我们通过梳理线路后就调试成功了并达到了预期的效果。
   （7）在调试时几个模块的电路调试都不是很好，我们就要对线路的硬件连接做仔细的检查，调试的时候我们首先要确定连接的电路没有错误，各个元件管脚间没有虚连，那样我们的调试才会更顺利。




​                       
​                     
















                          结束语
这次毕业设计让我受益匪浅。通过这次设计我对自己在大学里所学的知识得到了全面的回顾，并充分发挥对所学知识的理解和对毕业设计的思考及书面表达能力，最终完成了这份论文。撰写论文的过程也是专业知识的学习过程，它使我运用已有的专业基础知识，对其进行设计，分析和解决一个理论问题或实际问题，把知识转化为能力的实际训练。培养了我运用所学知识解决实际问题的能力。
通过这次毕业设计我发现，只有理论水平提高了，才能够将课本知识与实践相整合，理论知识服务于教学实践，以增强自己的动手能力。这个设计十分有意义 我获得很深刻的经验。通过这次毕业设计，我们知道了理论和实际的距离，也知道了理论和实际想结合的重要性，，也从中得知了很多书本上无法得知的知识。
我们的学习不但要立足于书本，以解决理论和实际教学中的实际问题为目的，还要以实践相结合，理论问题即实践课题，解决问题即课程研究，学生自己就是一个专家，通过自己的手来解决问题比用脑子解决问题更加深刻。学习就应该采取理论与实践结合的方式，理论的问题，也就是实践性的课题。这种做法既有助于完成理论知识的巩固，又有助于带动实践，解决实际问题，加强我们的动手能力和解决问题的能力。
总的来说这次的毕业设计使得我学习了很多它是大学里的最后一堂课也是重要的一堂课，他对我们的将来都具有深远的影响。




​                       





# 参考文献

[1]李伯成.基于MCS-51单片机的嵌入式系统设计.电子工业出版社.2004
[2]宗光华,李大寨.多单片机系统应用技术.国防工业出版社.2003
[3]胡学海.单片机原理及应用系统设计. 电子工业出版社.2005
[4]孙育才,王荣兴,孙华芳.ATMEL新型AT89S52系列单片机及其应用.清华大学  
   出版社.2005
[5]于京,张景璐.51系列单片机C程序设计与应用案例.中国电力出版社.2006
[6]蔡杏山.Protel 99 SE 电路设计.人民邮电出版社. 2007
[7]杨小川.Protel DXP 设计指导教程. 清华大学出版社.2003           
[8] 李晓荃. 单片机原理与应用[M].  电子工业出版社，2000年8月
[9] 何立民.  AVR单片机原理与接口技术[M]. 北京航空航天大学出版社，2002  
[10] 杨帮文. 新型继电器实用手册[M]. 北京人民邮电出版社.2004
[11]何希才.传感器及其应用电路[M].北京:电子工业出版社,2001.131-135.
[12]丁镇生.传感器及传感技术应用[M].北京:电子工业出版社,1998..
[13]王家桢.传感器与变送器[M].北京:清华大学出版社,1996..
[14]曾巧媛.单片机原理及应用[M].北京：电子工业出版社.2002
[15]何力民.单片机高级教程[M].北京：北京航空大学出版社.2000
[16]金发庆.传感器技术与应用[M].北京：北京机械工业出版社.2000
      
                          







# 致 谢

本课题的完成中，我得到了很多人的帮助，在此表示衷心的感谢!
首先感谢我的指导老师王老师，我的课题是在的指导和帮助下完成的，她深厚的理论功底和严谨的治学态度以及高度的敬业精神使我受益非浅，对我课题的完成起到了至关重要的作用。
经过这次毕业设计，使我觉得不论从理论知识还是从实际操纵中都学到了不少知识，我想归纳起来，主要有以下四个方面：
（1）经过这次毕业设计，它让我接触更多平时没接触的科学仪器设备、元器件以及获得相关的仪器调试经验，同时我也发现自己在这方面很多不足之处。体会到理论知识对实践有很大的知道作用，她让我知道，只有在正确的理论指引下，才能设计出合乎实际需要的硬件电路。
（2）学会了高效率的查阅资料、运用工具书、医用网络查找资料。我发现，在我们所使用的书籍上有些知识在实际应用中其实不是十分理想，各种参数都需要自己去调整。偶尔还会遇到错误的资料现象，这就要求我们应更加注重实践环节。
（3）在毕业设计中，我们应当注意重点与细节的关系。
（4）失败不可怕，只要不趴下，昂首向前走，希望总会有的。
（5）同组同学相互包容，彼此合作，取长补短，才能铸就最后的成功。可以说这次毕业设计是对所学知识的一次运用和检阅，同时对自学能力提出很高的要求，所以平时的学习离开思考，就是严重的错误，我们学习不应该有偏科现象，各方面知识都要接触，这样做才能为毕业设计打下基石。
最后,我要感谢的母校扬州职业大学,为我提供的良好的学习与发展环境。母校开放、公正的言论环境,现代、实用的学习环境,舒适、便捷的生活环境让我顺利度过了人生的关键三年。愿所有校园里认识的,不认识的；来过的,走过的……愿你们珍惜握在手里的现在,抓住机遇,拥有一个美好的明天。





# 附录一 程序
程序如下；
TM_NUM EQU 23H
TM_L EQU 22H
TM_H EQU 21H
DSPBUF EQU 40H
DQ BIT P2.0
FLAG BIT 00H
ORG 0000H
AJMP MAIN
ORG 000BH
AJMP T0INT
ORG 30H
MAIN: MOV SP,#070H
      MOV TMOD,#02H
      MOV IE,#82H
      MOV TH0,#6
      MOV TL0,#6
      MOV R2,#04
      MOV R1,#40H
 LL1: MOV @R1,#00
      INC R1
      DJNZ R2,LL1
      SETB RS0
      MOV R2,#00
      MOV R3,#00
      MOV R4,#00
      MOV R5,#00
      MOV 6FH,#00H
      CLR RS0
      CLR P3.0
      MOV 30H,#02
      MOV 31H,#06
      MOV 32H,#0
      LCALL CHEWEN
MAIN1:CLR TR0
      SETB P2.1
      JB P2.1,K3
      LCALL KKEY
   K3:CLR 01H
      MOV R2,44H
      CJNE R2,#00,K2
      SJMP K7
   K2:CPL P3.0
      MOV R3,#30
   K1:LCALL TM_DISP
      DJNZ R3,K1
      DJNZ R2,K2
   K7:MOV R2,45H
      CJNE R2,#00,K4
      SJMP K6
   K4:MOV R4,#255
  K44:CPL P3.0
      MOV R3,#30
   K5:LCALL TM_DISP
      DJNZ R3,K5
      DJNZ R4,K44
      DEC R2
      CJNE R2,#00,K4
  K6: CLR P3.0
      LCALL CHEWEN
      SETB TR0
MAIN2:JB 01H, MAIN1
      LCALL TM_DISP
      SJMP MAIN2
CHEWEN:CLR RS1
       CLR RS0
      LCALL GET_TM
      LCALL TM_COV
      LCALL DTOB
      LCALL DTOB1
      CLR C
      MOV A,33H
      SUBB A,44H
      MOV 44H,A
      MOV A,34H
      SUBB A,45H
      MOV 45H,A
      RET

    T0INT:PUSH ACC
          PUSH B
          SETB RS0
          INC R2
          CJNE R2,#100,JT0
          INC 6FH
    
          MOV A,6FH
          CJNE A,#20,JT0
          MOV 6FH,#00H
          INC R3
          MOV R2,#00H
          CJNE R3,#2,JT0
          SETB 01H
          MOV R3,#00
    
     JT0: CLR RS0
          POP B
          POP ACC
          RETI
 ;;;;;;;;;;;;;;;;;;;;;;;;;;;

KKEY: MOV R2,#00
      MOV R4,#0AH
 KS2: LCALL TM_DISP
      DJNZ R4,KS2
      SETB P2.1
      JB P2.1,KKEY1
      JNB P2.1,$
      MOV 60H,#DSPBUF+1
      MOV R1,#DSPBUF+1
      MOV R2,#00
KEY1: LCALL TM_DISP_2
      MOV P2,#0FFH
      MOV A,P2
      ORL A,#01
      CPL A
      JZ KEY1

KEY2: JNB ACC.1,KEY3
      JNB P2.1,$
      INC R1

      INC R2
      CJNE R2,#03,L13
      MOV R1,#DSPBUF+1
      MOV R2,#00
 L13: MOV 60H,R1
      SJMP KEY1
KEY3: JNB ACC.2,KEY4
      JNB P2.2,$
      MOV A,@R1
      CJNE R1,#41H,L1
      CJNE A,#09,LL
      SJMP KEY5
  L1: CJNE R1,#42H,L2
      MOV A,@R1
      CJNE A,#09,LL
      SJMP KEY5
  L2: CJNE R1,#43H,L3
      CJNE A,#09,LL

KEY5: MOV @R1,#00
  L3: SJMP KEY1
  LL: INC A
      MOV @R1,A
  L6: SJMP KEY1
KEY4: JNB ACC.3,KEY1
      JNB P2.3,$
      MOV 30H,41H
      MOV 31H,42H
      MOV 32H,43H
      ACALL DTOB
KKEY1:RET
 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

     DTOB:SETB RS0
          SETB RS1
          MOV A,31H
          MOV B,#10
          MUL AB
          ADD A,32H
          MOV 33H,A
          MOV 34H,#00
          MOV R6,30H
          CJNE R6,#00,JT2
          SJMP JT22
     JT2: MOV A,33H
          ADD A,#100
          MOV 33H,A
          MOV A,34H
          ADDC A,#00
          MOV 34H,A
          DJNZ R6,JT2
     JT22:CLR RS1
          CLR RS0
          RET

  DTOB1:  SETB RS0
          SETB RS1
          MOV A,42H
          MOV B,#10
          MUL AB
          ADD A,43H
          MOV 44H,A
          MOV 45H,#00
          MOV R6,41H
          CJNE R6,#00,JJT2
          SJMP JJT22
    JJT2: MOV A,44H
          ADD A,#100
          MOV 44H,A
          MOV A,45H
          ADDC A,#00
          MOV 45H,A
          DJNZ R6,JJT2
   JJT22: CLR RS1
          CLR RS0
          RET
WR_18B20: MOV R2,#08H
         CLR C
         SETB DQ
         MOV R3,#02H
         DJNZ R3,$
         NOP
    WR1: CLR DQ
         MOV R3,#03H
         DJNZ R3,$
         RRC A
         MOV DQ,C
         MOV R3,#20
         DJNZ R3,$
         SETB DQ
         MOV R3,#03H
         DJNZ R3,$
         DJNZ R2,WR1
         SETB DQ
         RET
RD_18B20: MOV R4,#02H
          MOV R1,#22H
     RE0: MOV R2,#08H
     RE1: CLR C
          SETB DQ
          NOP
          CLR DQ
          NOP
          NOP
          SETB DQ
          MOV R3,#01H
          DJNZ R3,$
          MOV C,DQ
          MOV R3,#010H
          DJNZ R3,$
          RRC A
          DJNZ R2,RE1
          MOV @R1,A
          DEC R1
          DJNZ R4,RE0
          RET
INI_18B20: SETB DQ
           NOP
           CLR DQ
           MOV R4,#150
           DJNZ R4,$
          ;LCALL TM_DISP
          ;LCALL TM_DISP
           SETB DQ
      TS0: MOV R4,#19H
           JNB DQ,TS1
           DJNZ R4,TS0
           SJMP TS2
      TS1: SETB FLAG
           SJMP TS3
      TS2: CLR FLAG
           SJMP TS4
      TS3: ;LCALL TM_DISP
           MOV R4,#120
           DJNZ R4,$
      TS4: SETB DQ
           RET
DELAY8ms: MOV R6,#2H
      KL1: MOV R7,#80H

      KL2: DJNZ R7,KL2
          DJNZ R6,KL1
          RET
GET_TM: SETB DQ
    S1: LCALL INI_18B20
        JB FLAG,S2
        SJMP S1
    S2: MOV R4,#10H
        DJNZ R4,$
        MOV A,#0CCH
        LCALL WR_18B20
        MOV A,#44H
        LCALL WR_18B20
        MOV R4,#0ffH
    S3: LCALL TM_DISP
        DJNZ R4,S3
    S4: LCALL INI_18B20
        JB FLAG,S5
        SJMP S4
    S5: MOV A,#0CCH
        LCALL WR_18B20
        MOV A,#0BEH
        LCALL WR_18B20
        LCALL RD_18B20
        LCALL INI_18B20
        MOV R4,#10H
    S6: LCALL TM_DISP
        DJNZ R4,S6
    S7: RET
TM_COV: MOV A,#0F0H
        ANL A,TM_L
        SWAP A
        MOV TM_NUM,A
        MOV A,TM_H
        ANL A,#07H
        SWAP A
        ORL A,TM_NUM
        MOV TM_NUM,A
        MOV R0,#DSPBUF
        JNB 0FH,SING
        MOV @R0,#0BH
        CPL A
        CLR ACC.7
        ADD A,#01H
        MOV TM_NUM,A
        SJMP SING1
  SING: MOV @R0,#0AH
 SING1: MOV B,#10
        DIV AB
        INC R0
        MOV @R0,A
        INC R0
        MOV A,B
        MOV @R0,A
        INC R0
        MOV A,#00H
        JNB 13H,DOT1
        ADD A,#50
  DOT1: JNB 12H,DOT2
        ADD A,#25
  DOT2: JNB 11H,DOT3
        ADD A,#12
  DOT3: JNB 10H,DOT4
        ADD A,#6
  DOT4: MOV B,#10
        DIV AB
        MOV @R0,A
        RET
TM_DISP: CLR RS1
         CLR RS0
         MOV DPTR,#TAB
         MOV R0,#DSPBUF
         MOV B,#0FEH
         MOV R5,#04
   DIP1: MOV A,@R0
         MOV P0,#0FFH
         MOV P1,#0FFH
         MOVC A,@A+DPTR
         CJNE R5,#02,DIP2
         ANL A,#7FH
   DIP2: MOV P0,A
         MOV A,B
         MOV P1,A
         RL A
         MOV B,A
         LCALL DELAY8ms
         INC R0
         DJNZ R5,DIP1
         RET
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
TM_DISP_1: CLR RS1
         CLR RS0
         MOV DPTR,#TAB
         MOV R0,#DSPBUF
         MOV B,#0FEH
         MOV R5,#04
 DDIP4:  MOV A,R0
         MOV P0,#0FFH
         MOV P1,#0FFH
         CJNE A,60H,DDIP1
         MOV A,#0FFH
         SJMP DDIP3
  DDIP1: MOV A,@R0
         MOVC A,@A+DPTR
  DDIP3: CJNE R5,#02,DDIP2
         ANL A,#7FH
  DDIP2: MOV P0,A
         MOV A,B
         MOV P1,A
         RL A
         MOV B,A
         LCALL DELAY8ms
         INC R0
         DJNZ R5,DDIP4
         RET
 ;;;;;;;;;;;;;;;;;;;;;
 TM_DISP_2: MOV R4,#10H
  KS4: LCALL TM_DISP
      DJNZ R4,KS4
      MOV R4,#1FH
  KS5: LCALL TM_DISP_1
      DJNZ R4,KS5
      RET
TAB:
DB 0C0H,0F9H,0A4H,0B0H,99H,92H,82H,0F8H,80H,90H,0FFH,0CFH
END






附录二  硬件电路图
